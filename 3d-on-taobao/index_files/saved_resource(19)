KISSY.add("item-detail/track/index",["node","base","json"],function(e,t){var n=t("node"),i=t("base"),a=t("json"),o=n.all,r=o("body"),s=i.extend({send:function(t){var n=this,i=n.get("startTime"),o={ua:navigator.userAgent,msg:"",nick:"",file:"",line:0,delay:+new Date-i,screen:screen.width+"x"+screen.height,scrolltop:document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0,url:"//item.taobao.com/track/",category:"",sampling:1e3};if(t=e.merge(o,t),7===parseInt(Math.random()*t.sampling)){try{var r=/_nk_=([^;]+)/.exec(document.cookie);r&&(t.nick=r[1])}catch(s){}t.msg=["[u"+t.url+"]","[t"+t.delay+"]","[c"+t.category+"]","[r"+t.sampling+"]"].join("")+(e.isObject(t.msg)?a.stringify(t.msg):t.msg),n.sendImage("//gm.mmstat.com/jstracker.2?"+["type=9","id=jstracker","v=0.02","ua="+encodeURIComponent(t.ua),"msg="+encodeURIComponent(t.msg),"nick="+decodeURIComponent(t.nick),"file="+encodeURIComponent(t.file),"line="+t.line,"screen="+t.screen,"scrolltop="+t.scrolltop,"t="+(new Date).valueOf()].join("&"))}},sendImage:function(e){var t="_img_"+ +new Date,n=window[t]=new Image;n.onload=n.onerror=function(){window[t]=null},n.src=e,n=null}},{ATTRS:{startTime:{value:window.g_config&&window.g_config.startTime||+new Date}}}),c=new s;return r.on("track",function(e){var t={msg:e.msg,category:e.category};e.url&&(t.url=e.url),e.delay&&(t.delay=e.delay),c.send(t)}),s}),KISSY.add("item-detail/hub/index",["log"],function(e,t){var n=t("log").getLogger("hub"),i=e.namespace("Hub",!0),a=window;e.mix(i,{mods:{},loadCSS:function(e,t,n){var i=window.document.createElement("link"),a=t||window.document.getElementsByTagName("script")[0];i.rel="stylesheet",i.href=e,i.media="async",a.parentNode.insertBefore(i,a),setTimeout(function(){i.media=n||"all"})},add:function(t){var o;if(t.factory)o=t.factory.call(t,a.Hub,a.KISSY,a.DT);else{if(!t.instance)return void n.info("No factory or instance provided for mod [ %s ]",t.name);o=t.instance}o.__modName=t.name,i.mods[t.name]=o;var r=this.listeners,s=t.listen;for(var c in s){var d=s[c];if(d){var l=o[d];if(e.isFunction(l))if("!"!==c.charAt(c.length-1))c in r||(r[c]=[]),r[c].push({fn:l,fnName:d,mod:o});else if(c=c.substring(0,c.length-1),c in this.fired)try{l()}catch(u){n.error("Event [ %s ] execute error: %s",c,u.message)}else{var f=this;e.ready(function(){if(c in f.fired)try{l()}catch(e){n.error("Event [ %s ] execute error: %s",c,e.message)}})}else n.info("[ %s ] is not a function",d)}else n.info("No method found for event [ %s ]",c)}},fire:function(t,i,a){var o=this.fired;t in o||(o[t]=!0),n.info("Firing event [ %s ]",t);var r=this.listeners[t];if(!r)return void n.info("No listeners for [ %s ]",t);for(var s=0,c=r.length;c>s;s++){var d=r[s],l=d.fn,u=d.mod;l.call(u,i),e.isFunction(a)&&a()}},listeners:{},fired:{}})}),KISSY.add("item-detail/config/index",["log","node","dom","cookie"],function(e,t){function n(){try{return TB.Global.util.getNick()}catch(e){return""}}function i(t){var n=t.split(".");return e.reduce(n,function(e,t){return"undefined"==typeof e?e:e[t]},window)}function a(){try{return g_config.sellerNick}catch(e){return""}}function o(){var e;return e=i("g_config.idata.item.sellerNickGBK")?g_config.idata.item.sellerNickGBK:TB.Global.util.encodeGBK(a())}function r(e,t){return t?e[t]:e}function s(t){if(s.config)return r(s.config,t);var n=Hub.config.get("sku")||{},i=e.mix(n,{skuId:null,spanStock:ie("#J_SpanStock")[0],linkBuy:ie("#J_LinkBuy")[0],dlChoice:ie("#J_DlChoice")[0],iptAmount:ie("#J_IptAmount")[0],form:ie("#J_FrmBid")[0],valItemInfo:{},linkAdd:ie(".J_LinkAdd")[0],apiAddCart:ue,valCartInfo:{},valExpanded:!1,valFastBuyUrl:ue,spanLimitProm:ie("#J_SpanLimitProm")[0],spanPromLimitCount:ie("#J_SpanPromLimitCount")[0],emLimitPromCountdown:ie("#J_EmLimitPromCountdown")[0],limit:0,apiBidCount:ue,isTripItem:!!Hub.config.get("trip"),valLoginUrl:ue,valLoginIndicator:ue,valPostFee:{}},!1);return i.dlChoice?(i.sku=!0,i.elmProps=H()):i.sku=!1,i.cart=!(!i.linkAdd||!i.valCartInfo.itemId),s.config=i,r(i,t)}function c(e){var t=g_config;return r(t,e)}function d(t){var n=e.namespace("g_config.vdata.sys.toggle",!0);return r({descPicRatio:n.p,noThumb:n.thumb,noWangpuPic:"false"===n.dcP,msRefresh:n.autoRefresh},t)}function l(t){var n=e.namespace("g_config.vdata.viewer",!0);return r(n,t)}function u(t){var n=e.namespace("g_config.idata.item",!0);return r(n,t)}function f(t){var n=e.namespace("g_config.idata.shop",!0);return r(n,t)}function m(t){var n=e.namespace("g_config.idata.seller",!0);return r(n,t)}function g(e){var t=Hub.config.get("desc")||{};return r(t,e)}function p(t){if(se||~location.href.indexOf("lucky"))return!0;if(t){var n=e.namespace("g_config.idata.toggle",!0),i=Number(n[t]);if(10==i)return!0;var a=unescape(re.get("tracknick")).charCodeAt();if(null!=a&&null!=i)return i>a%10}}function h(){return g_config.Price}function v(e){e=e||I();var t=R(e);if(!t){var n=K();t=n&&n[e]}return t?t.price:h()}function b(){return u("title")||ie(".tb-main-title","#J_Title").attr("data-title")}function y(){var t=e.namespace("g_config.vdata.asyncViewer.viewer",!0),n=e.namespace("g_config.vdata.viewer",!0),i=e.namespace("g_config.vdata.sys",!0),a=ie("#J_TokenField").val()||r(t,"tkn")||r(n,"tkn")||r(i,"tkn");return a||ne.warn("Current token is null"),a}function k(){return fe.deliveryId||Hub.config.get("defaultCityId")}function _(){return fe.lastValidator}function w(){return c("itemId")}function C(){var e=m(),t=u("type");return e.starSeller?t="star":e.globalBuyer||e.globalSeller?t="global":e.agricultureSeller&&(t="agriculture"),t}function S(){return s("skuId")}function I(){return s("skuFlag")}function T(){return parseInt(s("iptAmount").value,10)}function x(){return le.buyer_from}function J(){return le.root_refer}function P(){return document.referrer}function X(){return le.frm}function D(){var e=s("form").elements;return e&&e.channelkey?e.channelkey.value:void 0}function L(){var e=s("form").elements;return e&&e.flushingPictureServiceId?e.flushingPictureServiceId.value:void 0}function A(t){try{return e.isEmptyObject(t)||e.isEmptyObject(t.def)&&!t.notAvailable}catch(n){}}function M(){var e=g_config.PromoData;return A(e)?null:e}function R(e){e=e||"def";var t=M(),n=t&&t[e];return n&&n[0]}function N(e){var t=R(e);return t&&t.amountRestriction}function B(){}function j(e){return e=e||I(),Number(N(e)||B())}function E(){return s("skuInfo")}function H(){return oe.query(".J_TSaleProp","#detail")}function K(){return s("valItemInfo").skuMap}function F(){return!!s("dlChoice")}function O(){return!!s("skuSelected")}function Y(){return e.namespace("g_config.DynamicStock",!0).stock}function U(){return e.namespace("g_config.vdata.sys",!0).now}function V(){return window.Snapup_config}function G(){var e=V();return Number(e?e.limit:0/0)}function $(){var t=e.trim(ie(s("iptAmount")).attr("data-type"));return"ju"==t}function q(){return Number(me)}function z(e){me=e}function W(){return"3"==e.namespace("g_config.DynamicStock",!0).stockType}function Z(){return s("wholeSibUrl")}function Q(){var e=q(),t=j(),n=G();return t&&e>t&&(e=t),n&&e>n&&(e=n),e}function ee(){return l()&&l("id")==m("id")&&l("lgin")}function te(t){return t?e.namespace("g_config.activitySource",!0)[t]:e.namespace("g_config.activitySource",!0)}var ne=t("log").getLogger("config"),ie=t("node").all,ae=ie("body"),oe=t("dom"),re=t("cookie"),se=!!~location.host.indexOf("daily"),ce=!!~location.host.indexOf("itempre"),de="createTouch"in document,le=e.unparam(location.search.replace(/\?/gi,"")),ue="",fe={};ae.on("config:set",function(e){var t=e.key,n=e.value;fe[t]=n});try{var me=parseInt(s("spanStock").firstChild.nodeValue,10)}catch(ge){var me=0}return{isTouch:de,isDaily:se,isPre:ce,isMS:u("tka"),isPM:u("auction"),isJU:$(),isSibRequested:c("sibFirst"),isOwner:ee(),hasSku:F,hasSkuSelected:O,getGlobalConfig:c,getItemConfig:u,getShopConfig:f,getSellerConfig:m,getBuyerConfig:l,getToggleConfig:d,getSkuConfig:s,getDescConfig:g,getTaobaoHost:function(){return se?"daily.taobao.net":"taobao.com"},getCdnHost:function(){return se?"//g-assets.daily.taobao.net":"//g.alicdn.com"},getLucky:p,getSibUrl:Z,getItemId:w,getShopType:C,getSkuId:S,getSkuFlag:I,getSkuInfo:E,getSkuProps:H,setStock:z,getStock:q,getAmount:T,getLimit:j,getToken:y,getPrice:v,getDefPrice:h,getTitle:b,getDeliveryId:k,getLastValidator:_,getSkuMap:K,getPromoMap:M,getBuyerFrom:x,getRootRefer:J,getUrlRefer:P,getFrm:X,getChannelkey:D,getFlushingPictureServiceId:L,getDynamicStock:Y,getNow:U,getMSConfig:V,getMSLimit:G,getUserNick:n,getGBKSellerNick:o,getSellerNick:a,getChannelStock:W,getStockLimit:Q,getActivitySource:te}}),KISSY.add("item-detail/dt/index",["event","log","../config/"],function(e,t){var n=t("event"),i=n.Target,a=(t("log").getLogger("dt"),t("../config/"));e.Config.timeout=5,e.namespace("TB.Detail",!0),e.namespace("DT",!0),e.mix(DT,a,!0,["getToken"]),e.mix(DT,{Messenger:e.mix({},i)})}),KISSY.add("item-detail/price/index",["log","node"],function(e,t){function n(){var e=m("#J_StrPriceModBox");return e.length?e.addClass(h).attr(p,0):void 0}function i(){var e=m("#J_PromoPrice");return e.length?e:void 0}function a(e){var t=k[e];return t&&t.el}function o(e){var t=k[e];return t&&!t.lock}function r(e){var t=k[e];t.lock=!0}function s(t,n){e.isString(n)&&(n=y[n]);var i=t.all("#J_StrPrice");i.length?i.css(n):t.all(".tb-property-cont").css(n)}function c(e,t){return e.attr(p,t||0)}function d(e){var t=e.id,n=e.el,i=e.name,a=e.price,o=e.content,r=e.style;if(!t)return f.warn('Price type "id" is null');if(k[t])return f.warn('Price type "%s" has existed',t);var d;if(n?d=m(n):(i&&a||i&&o)&&(o=o||'<em class="tb-rmb">\xa5</em><em class="tb-rmb-num">'+a+"</em>",d=m('<li class="tb-detail-price"><span class="tb-property-type">'+i+'</span><strong class="tb-property-cont">'+o+"</strong></li>")),!d.length)return f.warn('Price type "%s" el is null',t);d.addClass(h),r&&s(d,r);var l=Number(e.weight),u=b.all(v),g=u.length;if(l){c(d,l);for(var y=0;g>y;y++){var _=m(u[y]),w=Number(_.attr(p));if(l>w){_.before(d);break}if(l==w||y+1===g){_.after(d);break}}}else c(d),m(u[g-1]).after(d);e.el=d,k[t]=e}function l(e){var t=e.id,n=a(t);if(n&&n.length){var i=e.hidden;i===!0?n.hide():i===!1&&n.show();var c=e.name;if(c){var d=n.all(".tb-property-type");d.length&&d.html(c)}var l=e.price;if(l){var u=n.all(".tb-rmb-num");u.length&&u.html(l)}var f=e.content;if(f){var m=n.all(".tb-property-cont");m.length&&m.html(f)}var g=e.style,p=e.unlock;g&&(p||o(t))&&s(n,g);var h=e.lock;h&&r(t)}}function u(e){var t=e.link,n=e.linkName||"\u89c4\u5219\u8be6\u60c5";if(t){var i=m('<a target="_blank" class="tb-price-rule" href="'+t+'">'+n+"</a>");b.append(i)}}var f=t("log").getLogger("price"),m=t("node").all,g=m("body"),p="data-price-wight",h="J_PriceItem",v="."+h,b=m(".tb-meta"),y={del:{"font-size":"14px",color:"#3c3c3c","font-weight":"400","text-decoration":"line-through"},small:{"font-size":"14px",color:"#3c3c3c","font-weight":"400","text-decoration":"none"},strong:{"font-size":"24px",color:"#3c3c3c","font-weight":"700","text-decoration":"none"},light:{"font-size":"14px",color:"#ff4400","font-weight":"700","text-decoration":"none"},bright:{"font-size":"24px",color:"#ff4400","font-weight":"700","text-decoration":"none"}},k={origin:{type:"origin",el:n()},promotion:{type:"promotion",el:i(),lock:!0}};g.on("price:create",function(e){d(e)}),g.on("price:update",function(e){l(e)}),g.on("price:rule",function(e){u(e)})}),KISSY.add("item-detail/domain/index",["log","../config/"],function(e,t){function n(){try{var e=document.domain.split(".");document.domain=e.slice(e.length-2).join(".")}catch(t){i.warn(t.message)}}var i=t("log").getLogger("domain"),a=t("../config/");return{init:function(){a.getLucky("domainDegradeMod")&&n()},degrade:n}}),KISSY.add("item-detail/base/layout",["log","node"],function(e,t){var n=(t("log").getLogger("layout"),t("node").all),i=n(window),a=n("body"),o="w990",r=1180;return{init:function(){this.check(),this.bind()},bind:function(){i.on("resize",this.check)},check:function(){var e=Number(a.width());r>e?a.addClass(o):a.removeClass(o)}}}),KISSY.add("item-detail/base/miaosha",["log","node","dom"],function(e,t){{var n,i,a,o,r,s=(t("log").getLogger("base"),t("node").all),c=(s("body"),t("dom")),d=c.get,l=g_config.vdata,u=g_config.idata;g_config.DyBase}return{init:function(){n=u.item,i=u.seller,a=u.shop,o=l.sys,r=l.viewer,n.tka||(this.showStart(),this.setSecKills())},showStart:function(){if(n.dbst>o.now||0==n.dbst){var e="";n.fcat&&(e='<div class="tb-btn-add tb-btn-appoint"><a style="background-image: url(//gtms01.alicdn.com/tps/i4/T10ImqXoJsXXXXXXXX-126-35.png);background-position: 0 0;" href="//house.taobao.com/buyer/appointForm.htm?itemId='+n.id+'" title="\u514d\u8d39\u9884\u7ea6" id="J_LinkAppoint">\u514d\u8d39\u9884\u7ea6<b style="background-image: url(//gtms01.alicdn.com/tps/i4/T10ImqXoJsXXXXXXXX-126-35.png);background-position: 0 0;"></b></a></div>');var t='					<div class="tb-key tb-key-sku"> 						<div class="tb-skin"> 							<div class="tb-action tb-clear"> 								<div class="tb-btn-wait"><a title="\u5373\u5c06\u5f00\u59cb" href="#">\u5373\u5c06\u5f00\u59cb</a></div> '+e+"</div>                               </div>                           </div>";c.html("#J_isku",t)}},setSecKills:function(){var e=d("#J_secKills");e&&(o.timk||r.timk)&&(e.name=r.timkn||o.timkn,e.value=r.timk||o.timk)}}}),KISSY.add("item-detail/gl/index",function(e){var t=new Date;return function n(i,a){function o(t){e.later(function(){var n=t(),i=n+e.now();window[i]=new Image,window[i].src=n,window[i].onload=function(){window[i]=void 0}},0)}function r(){var o=i.split("?"),r="/"+a+"."+o[0],s=[];o[1]&&s.push(o[1]);var c=g_config.beacon;e.isEmptyObject(c)||s.push(e.param(c)),("4.0.0"==i||"5.0.0"==i||"12.408"==i)&&s.push("clicktime="+(new Date-t)),("4.0.0"==i||"5.0.0"==i)&&(n.scrollShopBanner&&s.push("b=1"),n.scrollItemDetail&&s.push("d=1")),s.push("v=14"),s=s.join("&");var d="H"+function(e){e=(e||"").split("#")[0].split("?")[0];var t=e.length,n=function(e){var t,n=e.length,i=0;for(t=0;n>t;t++)i=31*i+e.charCodeAt(t);return i};return t?n(t+"#"+e.charCodeAt(t-1)):-1}(r);goldlog.record(r,null,s,d)}if(i){a=a||"tbdetail";try{r()}catch(s){}Math.round(100*Math.random())<(g_config.m_ratio||0)&&{"4.0.0":1,"5.0.0":1,"3.0.0":1,12.39:1,12.405:1,12.408:1,12.6:1,12.5:1}[i.split("?")[0]]&&o(function(){var t="//poc."+(location.host.indexOf(".daily.")>0?"daily.taobao.net":"taobao.com")+"/1.gif",n={key:a+"."+i,t:e.now(),v:2014};return t+"?"+e.param(n)})}}}),KISSY.add("item-detail/base/const",function(){var e=g_config.DyBase;return{CC:-9,NORMAL:0,PASS:1,DELETED:-1,INSTOCK:-2,DELETED_BY_XIAOER:-4,INSTOCK_BY_XIAOER:-3,INSTOCK_WHEN_PUBLISH:-5,close:e.purl+"/close_auction.htm?item_id=",edit:e.surl+"/auction/publish/edit.htm?item_num_id=",noitem:e.iurl+"/auction/noitem.htm",churl:"//chongzhi.taobao.com/goods/good_on_sale.do?",admUrl:"//mckinley.admin.taobao.org/mckinley/auction/commodity/listAuction.htm?auction_id=",bNoticUrl:"//www.taobao.com/go/act/315/xb_20100707.php?spm=2013.1.1000126.24",btip:"\u7b2c\u4e00\u6b21\u6dd8\u5b9d\u8d2d\u7269",suit:e.spurl+"/myservice/report/entry.htm?spm=2013.1.1000373.1.7aae99&display_type=3&auction_num_id=",cupr:e.murl+"/cu_pr.htm?item_num_id=",dcImg:'<img src="//gtms01.alicdn.com/tps/i8/T1J.8vXclxXXXXXXXX-16-16.png"/>\u88c5\u4fee\u6b64\u9875\u9762',report_pre:'	        <div id="J_Report" class="tb-report">                	<p class="tb-report-hd">\u4e3e\u62a5</p>                	<ul class="tb-report-bd">                		<li><a id="J_isuit" href="',report_sufix:'" target="_blank">\u4e3e\u62a5\u6b64\u5546\u54c1</a></li>                		<li><a href="//bbs.taobao.com/catalog/thread/154504-977100.htm?spm=2013.1.1000373.2" target="_blank">\u5546\u54c1\u4e3e\u62a5\u6f14\u793a</a></li>                		<li><a href="//bbs.taobao.com/catalog/424023.htm?spm=2013.1.1000373.3" target="_blank">\u8d2d\u7269\u5b89\u5168\u9632\u9a97</a></li>                		<li><a href="//315.taobao.com?spm=2013.1.1000373.4" target="_blank">\u6d88\u8d39\u8d28\u91cf\u66dd\u5149</a></li>                	</ul>            </div>',prepay:'			<div id="J_PayGuide" class="tb-payguide">			    <ul class="tb-tabs tb-clearfix">			        <li id="J_Btips" class="tab-shopping">\u7b2c\u4e00\u6b21\u6dd8\u5b9d\u8d2d\u7269\uff1f</li>			        <li class="J_Tab" data-index="0"><a href="#" hidefocus="true">\u6211\u6709\u94f6\u884c\u5361\uff0c\u5982\u4f55\u652f\u4ed8</a><i></i></li>			        <li class="J_Tab" data-index="1"><a href="#" hidefocus="true">\u6ca1\u6709\u94f6\u884c\u5361\uff0c\u5982\u4f55\u652f\u4ed8</a><i></i></li>			        <li class="tab-alipay J_Tab" data-index="2"><a href="#" hidefocus="true">\u652f\u4ed8\u4fdd\u969c\uff0c\u4ea4\u6613\u5b89\u5168</a><i></i></li>			    </ul>			    <div class="tb-panels">			        <div class="panel-paymethod J_Panel" style="display: block">			            <p><img src="//gtms01.alicdn.com/tps/i4/T1nN9fXiBpXXXXXXXX-685-50.png" alt="\u7b2c\u4e00\u6b65\uff0c\u70b9\u51fb\u7acb\u523b\u8d2d\u4e70\uff1b\u7b2c\u4e8c\u6b65\uff0c\u9009\u62e9\u5feb\u5b57\u6807\u8bc6\u7684\u94f6\u884c\uff08\u65e0\u9700\u7f51\u94f6\uff09\uff1b\u7b2c\u4e09\u6b65\uff0c\u586b\u5199\u94f6\u884c\u5361\u57fa\u672c\u4fe1\u606f\uff0c\u5b8c\u6210\u4ed8\u6b3e" /></p>			            <a href="//www.taobao.com/go/chn/zhifu_newbie.php" target="_blank">\u66f4\u591a\u94f6\u884c\u5361\u652f\u4ed8\u529e\u6cd5</a>			        </div>			        <div class="panel-payway J_Panel" style="display: none">			            <p><img src="//gtms01.alicdn.com/tps/i1/T1oN9fXiBpXXXXXXXX-468-50.png" alt="\u652f\u4ed8\u65b9\u5f0f\uff1a\u8d27\u5230\u4ed8\u6b3e\uff1b\u7f51\u70b9\u4ed8\u6b3e\uff1b\u627e\u4ed6\u4eba\u652f\u4ed8\uff1b\u6d88\u8d39\u5361\u4ed8\u6b3e" /></p>			            <a href="//www.taobao.com/go/chn/zhifu_newbie.php" target="_blank">\u67e5\u770b\u8be6\u7ec6\u652f\u4ed8\u65b9\u5f0f\u4ecb\u7ecd</a>			        </div>			        <div class="panel-alipay J_Panel" style="display: none">			            <p>\u652f\u4ed8\u5b9d\u62c5\u4fdd\u4ea4\u6613\uff1a\u4f7f\u7528\u652f\u4ed8\u5b9d\u201c\u6536\u8d27\u6ee1\u610f\u540e\uff0c\u5356\u5bb6\u624d\u80fd\u62ff\u5230\u94b1\u201d\u4fdd\u969c\u60a8\u7684\u4ea4\u6613\u5b89\u5168\uff0c\u8ba9\u60a8\u8d2d\u7269\u6ca1\u6709\u540e\u987e\u4e4b\u5fe7\uff01</p>			            <p>\u652f\u4ed8\u5b9d\u63d0\u4f9b24\u5c0f\u65f6\u8d44\u91d1\u76d1\u63a7\uff0c\u98ce\u63a7\u4f53\u7cfb\u4fdd\u969c\u201c\u652f\u4ed8\u5b9d\u8d26\u6237\u201d360\u5ea6\u5b89\u5168\uff01</p>			        </div>			    </div>			</div> 		',validSts:[0,1,-2,-5],bidCloseSts:[0,1,-9],sValidSts:[0,1,-2,-5,-3,-9]}}),KISSY.add("item-detail/base/viewer",["../gl/","log","node","dom","./const"],function(e,t){var n,i,a,o,r,s=t("../gl/"),c=t("log").getLogger("base"),d=t("node").all,l=(d("body"),t("dom")),u=t("./const"),f=l.get,m=g_config.vdata,g=g_config.idata,p=g_config.DyBase,h={checkCC:function(){if(!g_config.idata.item.xjcc){if(this.canBuyerView())return!0;if(this.canSellerView())return!0}-1===location.href.indexOf("debug")&&(window.location=u.noitem+"?itemid="+g.item.id+"&catid="+g.item.cid)},setPreClose:function(){if(this.isOwner()&&!n.bnow&&this.canBidClose()&&f("#J_TEditItem")){var e=document.createElement("a");e.href=u.close+n.id,e.target="_blank",e.innerHTML="\u63d0\u524d\u6210\u4ea4",f("#J_TEditItem").appendChild(e)}},setReport:function(){if(!this.isOwner()&&this.iStart()&&f("#J_TEditItem")){var e=u.report_pre+u.suit+n.id+u.report_sufix;l.html("#J_TEditItem",e)}},showBtips:function(){if(0==r.buyerId||null!=r.bs&&"0"==r.bs){f("#J_PPayGuide")&&(f("#J_PPayGuide").innerHTML=u.prepay);var e=u.bNoticUrl;f("#J_Btips")&&(f("#J_Btips").innerHTML=u.btip+'\uff1f <a target="_blank" href="'+e+'">\u8d2d\u7269\u987b\u77e5</a>')}},setAdmin:function(){if(r.admin&&f("#J_TEditItem")){var e=u.admUrl+n.id;l.html("#J_TEditItem",'<a href="'+e+'" target="_blank">\u5546\u54c1\u5904\u7406</a>')}},setEdit:function(){if(this.isOwner()&&n.edit&&f("#J_TEditItem")){var e=document.createElement("a"),t=n.auto||!1,i=u.edit+n.id+"&auto="+t;1==n.chong&&(i=u.churl),e.href=i,e.target="_blank",e.innerHTML="\u7f16\u8f91",f("#J_TEditItem").appendChild(e),l.addClass(f(".tb-report"),"tb-hidden")}},setForm:function(){var e=r.buyDomain;if(e){var t=f("#J_FrmBid");if(t){var n=t.getAttribute("action");n&&t.setAttribute("action",n.replace(/buy.daily.taobao.net|buy.taobao.com/g,e))}}},setDcEdit:function(){this.isOwner()&&n.edit&&g.shop.xshop&&f("#J_dcpg")&&(l.html("#J_dcpg",'<a href="'+p.durl+"/design.htm?pageId="+a.pid+"&siteId="+a.sid+"&sid="+a.id+'&curr_tab=0" target="_blank">\u88c5\u4fee\u9875\u9762</a> <a href="//bda.sycm.taobao.com/items/therm/item_therm.htm#/pc/scanPage?itemId='+g_config.itemId+'" target="_blank" class="thermometer">\u5b9d\u8d1d\u6e29\u5ea6\u8ba1</a>'),l.css("#J_dcpg","display","block"))},iStart:function(){return 0==n.dbst?!1:o&&o.now&&n.dbst?o.now>n.dbst:!0},isOwner:function(){return m.viewer&&m.viewer.id==g.seller.id&&m.viewer.lgin},canBuyerView:function(){var e,t=u.validSts,n=g.item.status;if(-9==g.seller.status)return!1;for(var i=0;i<t.length;i++)if(n==t[i])return!0;return-3===n?e=1:(n=-9)&&(e=2),s("23425?type="+e),!1},canBidClose:function(){for(var e=u.bidCloseSts,t=0;t<e.length;t++)if(g.item.status==e[t])return!0;return!1},canSellerView:function(){if(!this.isOwner())return!1;for(var e=u.sValidSts,t=0;t<e.length;t++)if(g.item.status==e[t])return!0;return!1},getJuType:function(){var e=g.item,t=g.seller,n=6;return e.ju&&"1"==e.jmark&&r.lgin&&r.id==e.jbid&&r.id!=t.id&&(n=4),n},init:function(){n=g.item,i=g.seller,a=g.shop,o=m.sys,r=m.viewer,c.info("Init viewer info start");try{n.tka||(h.checkCC(),h.setReport(),h.setEdit(),h.setAdmin(),h.setDcEdit(),h.showBtips()),h.setPreClose(),h.setForm()}catch(e){c.warn("Init viewer info failed: %s",e.message)}c.info("Init viewer info end")}};return h}),KISSY.add("item-detail/base/disablehover",function(){function e(){return"createTouch"in document}function t(){if(e())try{for(var t=/:hover/,n=0;n<document.styleSheets.length;n++)for(var i=document.styleSheets[n],a=i.cssRules.length-1;a>=0;a--){var o=i.cssRules[a];o.type===CSSRule.STYLE_RULE&&t.test(o.selectorText)&&i.deleteRule(a)}}catch(r){}}return{init:function(){t()}}}),KISSY.add("item-detail/base/fastclick",function(){function e(t,i){function a(e,t){return function(){return e.apply(t,arguments)}}var o;if(i=i||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=i.touchBoundary||10,this.layer=t,this.tapDelay=i.tapDelay||200,this.tapTimeout=i.tapTimeout||700,!e.notNeeded(t)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,c=0,d=r.length;d>c;c++)s[r[c]]=a(s[r[c]],s);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,i){var a=Node.prototype.removeEventListener;"click"===e?a.call(t,e,n.hijacked||n,i):a.call(t,e,n,i)},t.addEventListener=function(e,n,i){var a=Node.prototype.addEventListener;"click"===e?a.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),i):a.call(t,e,n,i)}),"function"==typeof t.onclick&&(o=t.onclick,t.addEventListener("click",function(e){o(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,a=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),o=i&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),r=navigator.userAgent.indexOf("BB10")>0;return e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(i&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,i;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),i=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;i&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,o;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],i){if(o=window.getSelection(),o.rangeCount&&!o.isCollapsed)return!0;if(!a){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,r,s,c,d,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,r=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,o&&(d=e.changedTouches[0],l=document.elementFromPoint(d.pageX-window.pageXOffset,d.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=l.tagName.toLowerCase(),"label"===s){if(t=this.findControl(l)){if(this.focus(l),n)return!1;l=t}}else if(this.needsFocus(l))return e.timeStamp-r>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(l),this.sendClick(l,e),i&&"select"===s||(this.targetElement=null,e.preventDefault()),!1);return i&&!a&&(c=l.fastClickScrollParent,c&&c.fastClickLastScrollTop!==c.scrollTop)?!0:(this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,i,a;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(i>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(r&&(a=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),a[1]>=10&&a[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction?!0:"none"===e.style.touchAction?!0:!1},e.attach=function(t,n){return new e(t,n)},{init:function(){"createTouch"in document&&e.attach(document.body)}}}),KISSY.add("item-detail/base/ju",["log","node","dom","./viewer"],function(e,t){var n,i,a,o,r,s=(t("log").getLogger("base"),t("node").all),c=(s("body"),t("dom")),d=c.get,l=t("./viewer"),u=g_config.vdata,f=g_config.idata;return{init:function(){n=f.item,i=f.seller,a=f.shop,o=u.sys,r=u.viewer,n.tka||this.juTips()},genJTips:function(){var e="",t=n.jurl||n.jkurl;return n.ju?e='\u60a8\u53ea\u6709\u5728\u805a\u5212\u7b97\u9875\u9762\u70b9\u51fb\u201c\u9a6c\u4e0a\u62a2\u201d\uff0c\u624d\u53ef\u4eab\u53d7\u6b64\u5b9d\u8d1d\u7684\u4f18\u60e0\u4ef7\u683c\uff0c<a href="'+t+'">\u70b9\u6b64\u8fdb\u5165</a>':n.iju&&(e='\u805a\u5212\u7b97\u6d3b\u52a8\u5546\u54c1\uff0c<a href="'+t+'">\u70b9\u51fb\u6b64\u5904</a>\u4eab\u53d7\u56e2\u8d2d\u4f18\u60e0\u4ef7\u3002'),e},genJurl:function(){var e=this.genJTips();if(d("#J_juValid")){var t='<div class="tb-purchase-not-allowed">'+e+"</div>";d("#J_juValid").innerHTML=t,d("#J_juValid").className=""}},juTips:function(){n.ju&&(r.lgin?r.id==n.jbid||l.isOwner()||this.genJurl():this.genJurl())}}}),KISSY.add("item-detail/base/index",["log","node","./layout","./miaosha","./viewer","./disablehover","./fastclick","./ju"],function(e,t){var n=(t("log").getLogger("base"),t("node").all),i=n("body"),a=t("./layout"),o=t("./miaosha"),r=t("./viewer"),s=t("./disablehover"),c=t("./fastclick"),d=t("./ju");return{init:function(){a.init(),s.init(),c.init(),i.on("user:info:viewer",function(){o.init(),r.init(),d.init()})}}}),KISSY.add("item-detail/login/index",function(){return function(e){var t;KISSY.use("tbc/mini-login/2.1.0/",function(n,i){return t?(t.on("login",e),void t.show()):(t=new i({zindex:2e8}),t.on("login",e),void t.show())})}}),KISSY.add("item-detail/querystring/index",function(e){var t={};return t.parse=function(t){return"string"!=typeof t?{}:(t=e.trim(t).replace(/^(\?|#)/,""),t?e.reduce(e.trim(t).split("&"),function(t,n){var i=n.replace(/\+/g," ").split("="),a=i[0],o=i[1];return a=decodeURIComponent(a),o=void 0===o?null:decodeURIComponent(o),t.hasOwnProperty(a)?e.isArray(t[a])?t[a].push(o):t[a]=[t[a],o]:t[a]=o,t},{}):{})},t.stringify=function(t){return t?e.map(e.keys(t),function(n){var i=t[n];return e.isArray(i)?e.map(i,function(e){return encodeURIComponent(n)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(n)+"="+encodeURIComponent(i)}).join("&"):""},t}),KISSY.add("item-detail/buy/index",["../gl/","log","../login/","node","dom","event","../config/","../querystring/"],function(e,t){function n(){var t={};return e.each(C,function(n){
var i={};if(e.isFunction(n))try{i=n(h)}catch(a){l.warn("Buy param append execution failed")}e.isString(i)&&(i=v.parse(i)),e.mix(t,i)}),t}function i(){var t=b();e.each(y,function(n){if(e.isFunction(n))try{n(t)}catch(i){l.warn("Action before buy failed: %s",i.message)}})}function a(e){e.submit()}function o(e,t){var n=b().form,i=n.elements,a=i[e];if(a)a.value=t;else try{a=g.create('<input type="hidden" name="'+e+'" value="'+t+'"/>'),g.append(a,n)}catch(o){l.warn("Append new form param error: ",o.message)}}function r(t){var n={quantity:h.getAmount(),skuId:h.getSkuId(),frm:h.getFrm(),buyer_from:h.getBuyerFrom(),item_url_refer:h.getUrlRefer(),root_refer:h.getRootRefer(),source_time:+new Date};e.isObject(t)&&e.mix(n,t),e.each(n,function(e,t){null!=e&&o(t,e)})}function s(t){var o=b().form;window.self!=window.top&&(o.target="_top");var s=n();if(e.isObject(t)&&e.mix(s,t),r(s),i(),c&&c.available())try{c.submit(o)}catch(d){l.error("Buy impl error: %s",d.message),a(o)}else a(o)}var c,d=t("../gl/"),l=t("log").getLogger("buy"),u=t("../login/"),f=t("node").all,m=f("body"),g=t("dom"),p=t("event"),h=t("../config/"),v=t("../querystring/"),b=h.getSkuConfig,y=[],k="tb-disabled",_=".J_LinkBuy",w="#J_juValid";m.on("buy:button",function(e){var t=e.content,n=e.disabled,i=e.hidden,a=e.cls,o=f(_,w);try{n===!0?o.addClass(k):n===!1&&o.removeClass(k),t&&o.html(t),i===!0?o.hide():i===!1&&o.show(),a&&o.addClass(a)}catch(r){l.warn("Button modify error")}}),m.on("buy:before",function(e){y.push(e.action)});var C=[];return m.on("buy:params",function(e){C.push(e.params)}),m.on("buy:impl",function(e){c=e}),m.on("buy:submit",function(e){var t=e.params;u(function(){s(t)})}),{init:function(){function e(){d("4.0.0"),m.fire("sku:validate",{alert:!0,confirmBtn:"J_LinkBuy",success:function(){m.fire("buy:submit")}})}var t=b(),n=t.linkBuy;n?p.on(n,"click",function(t){t.preventDefault(),e(t)}):p.on("#detail","click",function(t){var n=t.target;!(g.hasClass(n,"J_LinkBuy")||"b"===n.tagName.toLowerCase()&&g.parent(n,".J_LinkBuy"))||g.hasClass(n,"tb-disabled")||g.parent(n,".tb-disabled")||(t.preventDefault(),e(t))})}}}),KISSY.add("item-detail/resource/sib",["../config/","log","node","base"],function(e,t){{var n=t("../config/"),i=t("log").getLogger("sib"),a=t("node"),o=t("base"),r="timeout",s=a.all;s("body")}return o.extend({initializer:function(){var t=this,i=t.get("timeout");if(n.isSibRequested){var a=+new Date;setTimeout(function(){g_config.RequstPrior?"success"===g_config.RequstPrior?t.success():t.error():+new Date-a>i?(t.set("status",r),t.error()):setTimeout(arguments.callee,100)},30)}else{var o=n.getSibUrl();if(o){var s=document.referrer,c="&ref="+encodeURIComponent(s.replace(/userid=%s/gi,""));o.length+c.length<2e3&&(o+=c),e.getScript(o,{success:e.bind(t.success,t),error:e.bind(t.error,t),timeout:i/1e3})}}},success:function(){var e=this;i.info("Request success"),e.set("success",!0),e.set("complete",!0),e.execHandlers()},error:function(){var e=this,t=e.get("status");i.error("Request %s",t===r?"timeout":"failed"),e.set("error",!0),e.set("complete",!0),e.execHandlers()},getSibData:function(){return{promotion:n.getPromoMap()}},execHandlers:function(){var t=this,n=t.get("success"),a=(t.get("error"),n?"successHandlers":"errorHandlers"),o=t.get(a),r=t.getSibData();e.each(o,function(e){try{e(r)}catch(t){i.warn("Exec failed: %s",t.message)}}),t.set(a,[])}},{ATTRS:{status:{},timeout:{value:6e3},success:{value:!1},error:{value:!1},complete:{value:!1},successHandlers:{value:[]},errorHandlers:{value:[]}}})}),KISSY.add("item-detail/resource/index",["node","./sib"],function(e,t){var n=t("node"),i=t("./sib"),a=new i,o=n.all,r=o("body");r.on("resource:sib",function(e){var t=e.success,n=e.error,i=a.get("complete"),o=a.get("successHandlers"),r=a.get("errorHandlers");t&&o.push(t),n&&r.push(n),a.set("successHandlers",o),a.set("errorHandlers",r),i&&a.execHandlers()})}),KISSY.add("item-detail/newsku/index",["node","sku","../config/"],function(e,t){function n(t){var n=r.getSkuMap(),i="";return e.each(n,function(e,n){return e.skuId==t?(i=n,!1):void 0}),i}function i(t){var n=["a1z0d","a1z09","a1z10","a230r","a219r"];return t&&e.isString(t)&&e.inArray(t.split(".")[0],n)?!0:!1}var a=t("node"),o=t("sku"),r=t("../config/"),s=a.all,c=s("body"),d=function(){var e=this;c.on("stock:ready",function(){e.init(),e.bind()})};return d.prototype.init=function(){var e=this,t=s(".J_Prop","#J_isku");e.sku=new o({root:".J_Prop",hook:"li",skuMap:e.getSkuMap(),promoMap:e.getPromoMap(),stockMap:e.getStockMap(),attrName:"data-value",selectedClass:"tb-selected",disabledClass:"tb-out-of-stock"}),TB.SKU=e.sku,e.props=[],t.each(function(t){var n=s(t),i=n.one("ul"),a=n.one("li");if(i&&a){var o=i.hasClass("tb-img"),r=a.hasClass("J_isAutoProp"),c="",d="",l="";r?l=a.attr("id"):(c=i.attr("data-property"),d=a.attr("data-value").split(":")[0]),e.props.push({pvid:"",name:"",elmt:null,prop:c,propId:d,hasImg:o,isAuto:r,hookId:l})}}),c.fire("sku:ready",{props:e.props})},d.prototype.get=function(e){return this.sku.get(e)},d.prototype.set=function(e,t){return this.sku.set(e,t)},d.prototype.bind=function(){var t=this,n=s(".tb-rmb-num","#J_StrPrice"),i=t.sku.hasPromo(),a=g_config.Price||n.html(),o=(t.sku.getDefaultPromo(),t.sku.getDefaultStock());t.sku.on("skuFound skuChanged",function(e){var t=e.sku;n.html(i?t.priceDefault:t.price),c.fire("stock:update",{stock:t.stock})}),t.sku.on("skuLost",function(){n.html(a),c.fire("stock:update",{stock:o.stock})}),t.sku.on("selectionChanged",function(n){var i=n.sku;e.each(t.props,function(e){var t=null,n=null,a="",o="";if(t=e.isAuto?s("#"+e.hookId):i.props[e.propId],t&&t.length&&(n=t[0],a=t.attr("data-value"),o=t.one("span").html(),e.hasImg&&t===i.el)){var r=t.one("a"),d=t.data("data-src");d?c.fire("thumb:show",{src:d}):(d=r.css("backgroundImage"),~d.indexOf("url(")&&(d=d.match(/url\("?([^\)^"]*)/)[1].replace("30x30","400x400"),t.data("data-src",d),c.fire("thumb:show",{src:d})))}e.elmt=n,e.pvid=a,e.name=o})}),t.sku.on("skuFound",function(e){var t=e.sku;c.fire("sku:found",{sku:t})}),t.sku.on("skuChanged",function(e){var t=e.sku;c.fire("sku:changed",{sku:t})}),t.sku.on("skuLost",function(){c.fire("sku:lost")}),t.sku.on("selectionChanged",function(e){var n=e.sku;c.fire("sku:selectionChanged",{sku:n,props:t.props})}),c.on("sku:set",function(e){e.skuMap&&(t.sku.set("skuMap",e.skuMap),t.sku.serializeSkuMap()),e.pvs&&t.sku.setCurrentSku(e)}),t.sku.init();var r=t.getDefPvs();r&&c.fire("sku:set",{pvs:r})},d.prototype.getItemInfo=function(){var e={};return Hub&&(e=Hub.config.get("sku").valItemInfo),e},d.prototype.getSkuMap=function(){var e=this,t=e.getItemInfo();return t.skuMap},d.prototype.getDefPvs=function(){var t=this,a=e.unparam(location.search.replace(/\?/gi,"")),o=t.getItemInfo();if(i(a.spm)){if(a.skuId)return n(a.skuId);if(a.sku)return a.sku}return o.defSelected&&o.defSelected.length?o.defSelected.join(";"):!1},d.prototype.getPromoMap=function(){return g_config.PromoData||{}},d.prototype.getStockMap=function(){return g_config.DynamicStock||{}},new d}),KISSY.add("item-detail/prepayprice/template/bookingsteps-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+='<div id="J_BookingSteps" class="tb-booking-steps tb-clearfix">\n    <div class="J_BookingRulesContainer">\n        <span class="J_BookingRules">\u89c4\u5219</span>\n        <div class="J_BookingRulesContent">\n        <p>1. \u9884\u4ed8\u6b3e\u4e0b\u5355\u540e\uff0c\u8bf7\u5728';var u={},f=[],m=d(o,e,"preTimeLimit",0,5);f.push(m),u.params=f,u.fn=function(e){var t="";t+="";var n=l(o,e,{},"preTimeLimit",0,5);return t+=c(n,!0),t+=""},u.inverse=function(){var e="";return e+="30"},n+=s(o,e,u,"if",5),n+='\u5206\u949f\u5185\u4ed8\u6b3e\uff0c\u8d85\u65f6\u5c06\u81ea\u52a8\u5173\u95ed\u8ba2\u5355\u3002</p>\n        <p>2. \u5c3e\u6b3e\u7684\u652f\u4ed8\u8bf7\u81f3\u201c\u5df2\u4e70\u5230\u7684\u5b9d\u8d1d\u201d\u9875\u9762\u3002</p>\n        <p>3. \u8bf7\u5728\u8981\u6c42\u7684\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u5185\u652f\u4ed8\u5c3e\u6b3e\uff0c\u56e0\u4e70\u5bb6\u539f\u56e0\u672a\u5982\u671f\u652f\u4ed8\u5c3e\u6b3e\uff0c\u8d85\u65f6\u5c06\u81ea\u52a8\u5173\u95ed\u8ba2\u5355\uff0c\u9884\u4ed8\u6b3e\u4e0d\u4e88\u9000\u8fd8\uff0c\u8bf7\u52a1\u5fc5\u6ce8\u610f\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u5e76\u53ca\u65f6\u652f\u4ed8\u5c3e\u6b3e\u3002</p>\n        <p>4. \u53d1\u8d27\u65f6\u95f4\u8bf7\u4ee5\u9884\u552e\u5546\u54c1\u8be6\u60c5\u9875\u9762\u4e2d\u7684\u201c\u53d1\u8d27\u65f6\u95f4\u201d\u63cf\u8ff0\u4e3a\u51c6\u3002</p>\n        <p class="tb-booking-warn">5. \u9884\u4ed8\u6b3e\u652f\u4ed8\u540e\u3001\u5c3e\u6b3e\u652f\u4ed8\u524d\uff0c\u56e0\u4e70\u5bb6\u81ea\u8eab\u539f\u56e0\u8981\u6c42\u64a4\u9500\u8ba2\u5355\u5e76\u8fd4\u8fd8\u9884\u4ed8\u6b3e\u7684\uff0c\u53cc\u65b9\u53ef\u534f\u5546\u5904\u7f6e\uff0c\u4f46\u5356\u5bb6\u6709\u6743\u62d2\u7edd\u3002\u975e\u56e0\u4e70\u5bb6\u8d23\u4efb\uff0c\u5bfc\u81f4\u8ba2\u5355\u4e27\u5931\u7ee7\u7eed\u5c65\u884c\u6761\u4ef6\u7684\uff0c\u5219\u5356\u5bb6\u5e94\u8fd4\u8fd8\u9884\u4ed8\u6b3e\u3002</p>\n        <p>6. \u4e70\u5bb6\u5168\u6b3e\u652f\u4ed8\u540e\uff0c\u82e5\u56e0\u5356\u5bb6\u8fdd\u7ea6\uff0c\u9020\u6210\u4ea4\u6613\u65e0\u6cd5\u5c65\u884c\u6216\u5ef6\u8fdf\u53d1\u8d27\u4e14\u8ba2\u5355\u72b6\u6001\u4e3a\u201c\u4ea4\u6613\u5173\u95ed\u201d\uff0c\u5219\u5356\u5bb6\u5e94\u6309\u7167\u300a\u6dd8\u5b9d\u89c4\u5219\u300b\u53ca\u76f8\u5173\u89c4\u5219\u8fdb\u884c\u8fdd\u7ea6\u8d54\u4ed8\u5904\u7406\u3002</p>\n        </div>\n    </div>\n    <div class="tb-wrap-booking-steps tb-clearfix" >\n        <div class="tb-booking-steps-sec tb-booking-steps-sec-front" >\n            <p class="tb-booking-title" >\u9884\u4ed8\u6b3e\u652f\u4ed8\u65f6\u95f4\u6bb5</p>\n            <p class="tb-booking-time" >\n            <em class="tb-booking-time-left" >';var g=l(o,e,{},"preTimeLeft",0,17);n+=c(g,!1),n+='</em>\n            <em class="tb-booking-time-token" >-</em>\n            <em class="tb-booking-time-right" >';var p=l(o,e,{},"preTimeRight",0,19);n+=c(p,!1),n+='</em>\n            </p>\n        </div>\n        <div class="tb-booking-steps-sec tb-booking-steps-sec-arr" ></div>\n        <div class="tb-booking-steps-sec tb-booking-steps-sec-final" >\n            <p class="tb-booking-title" >\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u6bb5</p>\n            <p class="tb-booking-time" >\n            <em class="tb-booking-time-left" >';var h=l(o,e,{},"payTimeLeft",0,26);n+=c(h,!1),n+='</em>\n            <em class="tb-booking-time-token" >-</em>\n            <em class="tb-booking-time-right" >';var v=l(o,e,{},"payTimeRight",0,28);return n+=c(v,!1),n+="</em>\n            </p>\n        </div>\n    </div>\n</div>\n"}}),KISSY.add("item-detail/prepayprice/index",["log","node","../login/","overlay","xtemplate/runtime","./template/bookingsteps-xtpl","event"],function(e,t){var n=t("log").getLogger("prepayprice"),i=t("node").all,a=(t("../login/"),t("overlay")),o=t("xtemplate/runtime"),r=t("./template/bookingsteps-xtpl"),s=i("body"),c=t("event"),d={popup:null,confirm:function(){if(this.popup)return this.popup.show(),void this.popup.center();var e='<div class="tb-preorder-confirm"><h3>\u9884\u8ba2\u534f\u8bae\u8bf4\u660e</h3><p>1. \u9884\u5148\u652f\u4ed8\u9884\u4ed8\u6b3e\uff0c\u5230\u671f\u652f\u6301\u5c3e\u6b3e</p><p>2. \u903e\u671f\u4e0d\u652f\u6301\u5c3e\u6b3e\uff0c\u9884\u4ed8\u6b3e\u6055\u4e0d\u9000\u8fd8</p><p>3. \u5c3e\u6b3e\u53ef\u901a\u8fc7\u56de\u590d\u652f\u4ed8\u5b9d\u77ed\u4fe1\u6216\u5230"\u5df2\u4e70\u5230\u7684\u5b9d\u8d1d"\u5b8c\u6210\u652f\u4ed8</p><p>4. \u4e0d\u652f\u6301\u4e03\u5929\u65e0\u7406\u7531\u9000\u6362\u8d27</p><a href="//service.taobao.com/support/knowledge-5675737.htm" target="_blank">\u8be6\u7ec6\u8bf4\u660e &raquo;</a><div class="tb-checkbox"><label><input type="checkbox" id="J_PreorderCheckbox">\u786e\u8ba4\u63a5\u53d7\u534f\u8bae<span>\uff08\u52fe\u9009\u540e\u624d\u53ef\u4ee5\u7ee7\u7eed\u9884\u8ba2\u8be5\u5b9d\u8d1d\uff09</span></label></div><div class="tb-preorder-actions"><a href="#" class="tb-accept tb-preorder-actions-button" id="J_PreorderAccept">\u786e\u5b9a</a><a href="#" class="tb-cancel tb-preorder-actions-button" id="J_PreorderCancel">\u53d6\u6d88</a></div></div><div class="tb-canvas"></div>',t=new a.Popup({content:e,elCls:"tb-preorder-confirm-root",closable:!0,align:{node:0}});this.popup=t,t.show(),t.center(),i("#J_PreorderAccept").on("click",function(e){e.preventDefault(),"checked"===i("#J_PreorderCheckbox").attr("checked")?(t.hide(),s.fire("buy:submit")):alert("\u60a8\u5fc5\u987b\u63a5\u53d7\u534f\u8bae\uff0c\u624d\u80fd\u9884\u8ba2")}),c.on("#J_PreorderCancel","click",function(e){e.preventDefault(),t.hide()})},isInPrePay:function(){return BookingConfig.stepPrePayStart<g_config.vdata.sys.now&&g_config.vdata.sys.now<BookingConfig.stepPrePayEnd},init:function(){function t(){s.fire("buy:button",{disabled:!0}),s.fire("cart:button",{disabled:!0})}function a(){try{var e=g_config.PromoData,t=[];for(var i in e)if("def"!=i)try{var a=parseFloat(e[i][0].price);if(isNaN(a))throw Error("price is NaN");t.push(parseFloat(a))}catch(o){}if(t.sort(function(e,t){return e-t}),t.length)var r=t[0],s=t[t.length-1];else{var r=parseFloat(e.def[0].price);if(isNaN(r))return null}return{minPrice:r,maxPrice:s}}catch(o){n.warn("Get price range failed: %s",o.message)}}function c(e,t){var o,r,s=!1,c=a();try{"def"==e&&n.info("Can not a def sku"),o=g_config.PromoData[e][0].price,o=parseFloat(o),isNaN(o)&&n.info("Price is NaN")}catch(d){if("def"===e){var l=Hub.config.get("preorder");if(l)if(l.range)try{o=c.minPrice,r=c.maxPrice}catch(d){o=parseFloat(l.minPrice),r=parseFloat(l.maxPrice)}else try{o=c.minPrice,c.maxPrice&&o!==c.maxPrice&&(s=!0)}catch(d){o=parseFloat(l.price)}}else o=parseFloat(t.price)}if(r&&r!==o&&(s=!0),o){var u=o*BookingConfig.rate1/100;i("#J_BookingPriceAmount").text(o.toFixed(2)),i("#J_BookingPriceFront").text(u.toFixed(2));var f=i(".tb-booking-price .tb-rmb-qi");f.length&&f[s?"show":"hide"]()}}var d=this;if("undefined"!=typeof BookingConfig&&"undefined"!=typeof g_config&&g_config.vdata&&g_config.vdata.sys&&g_config.vdata.sys.now&&g_config&&g_config.prePayApi){if(g_config.prePayApi.preTimeLeft&&g_config.prePayApi.preTimeRight&&(-1===g_config.prePayApi.preTimeLeft.indexOf("\u6708")||-1===g_config.prePayApi.preTimeRight.indexOf("\u6708"))){var l=g_config.prePayApi.preTimeLeft,u=l.split(" "),f=u[0].split("-"),m=f[1]+"\u6708",g=f[2]+"\u65e5<br>",p=u[1].split(":"),h=p[0]+"\u65f6",v=p[1]+"\u5206",b=g_config.prePayApi.preTimeRight,y=b.split(" "),k=y[0].split("-"),_=k[1]+"\u6708",w=k[2]+"\u65e5<br>",C=y[1].split(":"),S=C[0]+"\u65f6",I=C[1]+"\u5206";g_config.prePayApi.preTimeLeft=m+g+h+v,g_config.prePayApi.preTimeRight=_+w+S+I}if(g_config.prePayApi.payTimeLeft&&g_config.prePayApi.payTimeRight&&(-1===g_config.prePayApi.payTimeLeft.indexOf("\u6708")||-1===g_config.prePayApi.payTimeRight.indexOf("\u6708"))){var l=g_config.prePayApi.payTimeLeft,u=l.split(" "),f=u[0].split("-"),m=f[1]+"\u6708",g=f[2]+"\u65e5<br>",p=u[1].split(":"),h=p[0]+"\u65f6",v=p[1]+"\u5206",b=g_config.prePayApi.payTimeRight,y=b.split(" "),k=y[0].split("-"),_=k[1]+"\u6708",w=k[2]+"\u65e5<br>",C=y[1].split(":"),S=C[0]+"\u65f6",I=C[1]+"\u5206";g_config.prePayApi.payTimeLeft=m+g+h+v,g_config.prePayApi.payTimeRight=_+w+S+I}var T=new o(r).render(g_config.prePayApi);i(".tb-meta").after(T),i(".J_BookingRulesContainer").on("mouseleave",function(){i(".J_BookingRulesContent").hide(),i(".J_BookingRules").removeClass("J_BookingRulesHovered")}).on("mouseenter",function(){i(".J_BookingRulesContent").show(),i(".J_BookingRules").addClass("J_BookingRulesHovered")});var x=i('<li class="tb-detail-price tb-booking-price">                    <span class="tb-property-type">\u9884\u552e\u4ef7</span>                    <strong class="tb-booking-price-amount" >                        <em class="tb-rmb">&yen;</em><em class="tb-rmb-num" id="J_BookingPriceAmount">--</em>                        <em class="tb-rmb-qi tb-hidden">\u8d77</em>                    </strong>                    </li>'),J=i('<li class="tb-detail-price tb-booking-price">                    <span class="tb-property-type">\u9884\u4ed8\u6b3e</span>                    <strong class="tb-booking-price-front" >                        <em class="tb-rmb">&yen;</em><em class="tb-rmb-num" id="J_BookingPriceFront">--</em>                        <em class="tb-rmb-qi tb-hidden">\u8d77</em>                    </strong>                </li>');s.fire("price:create",{id:"preprice-amount",el:x,weight:1}),s.fire("price:create",{id:"preprice-front",el:J,weight:1}),s.fire("price:update",{id:"origin",style:"del",lock:!0}),d.isInPrePay()?s.fire("buy:button",{content:"\u7acb\u5373\u8d2d\u4e70"}):(t(),s.on("sku:selected",function(){setTimeout(t)}),s.on("sku:unselected",function(){setTimeout(t)}),BookingConfig.stepPrePayStart>g_config.vdata.sys.now?s.fire("buy:button",{content:"\u5373\u5c06\u5f00\u59cb"}):g_config.vdata.sys.now>BookingConfig.stepPrePayEnd&&s.fire("buy:button",{content:"\u7acb\u5373\u8d2d\u4e70"}));var P=!1,X=[];s.on("sku:selected",function(e){setTimeout(function(){P?c(e.sku.flag,e.sku):X.push([c,e.sku.flag,e.sku])})}),s.on("sku:unselected",function(){setTimeout(function(){P?c("def"):X.push([c,"def"])})}),s.fire("resource:sib",{success:function(){P=!0,c("def"),e.each(X,function(e){e[0].apply(null,e.slice(1))})}})}}};return d}),KISSY.add("item-detail/sizepicker/index",["dom","event","node","../login/","../domain/"],function(e,t){function n(){var e=i.get(".J_TMySizeProp"),t=i.get("#J_TMySize"),n=null,d=c?"//size.daily.taobao.net/mini/mini.htm":"//size.taobao.com/mini/mini.htm",l='<div id="J_SizeIframeWrap" class="tb-size-picker-wrap" ><a href="#" class="tb-close-btn">X</a><iframe width="350" height="300" frameborder="0" scrolling="no" src="'+d+"?stdCatId="+i.attr(t,"data-value-rt")+"&leafCatId="+i.attr(t,"data-value")+"&catType="+i.attr(t,"data-value-type")+"&templateId="+i.attr(t,"data-template-id")+"&auctionId="+g_config.itemId+'"></iframe></div>';if(e){var u=i.get(".J_Prop");e!==u&&i.insertBefore(e,u),a.on(t,s,function(){r.degrade();var e=i.get(".tb-meta"),t=i.offset(e).left,c=i.offset(e).top;o(function(){i.get("#J_SizeIframeWrap")||(n=i.create(l),i.append(n,"body"),i.css(n,{left:t,top:c,width:330,height:265}),i.show(n),a.on("#J_SizeIframeWrap .tb-close-btn",s,function(e){e.halt(),i.remove(n),a.remove("#J_TSizeFrame *")}))})})}}var i=t("dom"),a=t("event"),o=(t("node").all,t("../login/")),r=t("../domain/"),s="click",c=TB.Global.isDaily;return{init:n}}),KISSY.add("item-detail/logistic/index",["log","node","base"],function(e,t,n,i){var a=t("log").getLogger("logistic"),o=t("node"),r=t("base"),s=o.all,c=s("body");i.exports=r.extend({init:function(){a.info("Init logistic"),this.render(),this.initWL()},render:function(){var e=this,t=e.get("tpl"),n=e.get("renderTo");s(t).insertAfter(n)},initWL:function(){var t=this,n=t.get("itemId"),i=t.get("userId"),o=t.get("initUrl"),r=t.get("initData"),d=t.get("renderId"),l=t.get("changeAnyInfo");if(t.hasAddressList()){var u=s("#J_FrmBid");u.append(['<input type="hidden" id="J_AddressId" name="addressId" value="">','<input type="hidden" id="J_DivisionCode" name="divisionCode" value="">','<input type="hidden" id="J_DeliveryGroupInfo" name="deliveryGroupInfo" value="">'].join(""));var f=s("#J_AddressId"),m=s("#J_DivisionCode"),g=s("#J_DeliveryGroupInfo"),p=function(e){var t=e.addressData,n=e.serviceData,i=t.userArea.id.split("_");f.val(i[1]),m.val(i[0]),g.val(n.id)}}e.use("address-detail/wlroute",{success:function(e,t){try{var s=new t({itemId:n,userId:i,initUrl:o,initData:r,renderId:d,changeAnyInfo:function(t){p&&p(t),t.changeSkuByUser||l&&e.isFunction(l)&&l(t)}})}catch(u){a.warn("WlRoute init error: %s",u.messsage)}c.on("sku:found sku:changed",function(e){var t=e.sku;s.onChangeSku(t.skuId,"changeSkuByUser")})},error:function(e){a.warn("Component %s load error",e.name)}})},hasAddressList:function(){var e=this,t=e.get("initData"),n=t.data&&t.data.addressList;return n&&n.length?!0:!1}},{ATTRS:{tpl:{},renderTo:{},itemId:{value:g_config.itemId},userId:{valueFn:function(){return g_config.vdata&&g_config.vdata.asyncViewer&&g_config.vdata.asyncViewer.viewer&&g_config.vdata.asyncViewer.viewer.buyerId}},initUrl:{valueFn:function(){return g_config.DeliveryFee&&g_config.DeliveryFee.dataUrl}},initData:{valueFn:function(){return g_config.DeliveryFee}},renderId:{},changeAnyInfo:{}}})}),KISSY.add("item-detail/region/info",["dom","xtemplate"],function(e,t){var n,i,a=t("dom"),o=t("xtemplate"),r=DT.Messenger,s={update:function(e){n.innerHTML=e},getDefault:function(){return i},restoreDefault:function(){n.innerHTML=i},resetMore:function(){var e=a.get("#J_Carriage");if(!e)return!1;var t=a.parent(e,".tb-collapsed");t&&a.removeClass(t,"tb-collapsed");var n=a.get(".tb-carriage-hasmore",e);n&&a.removeClass(n,"tb-carriage-hasmore")},showMore:function(){var e=a.get("#J_Carriage");if(!e)return!1;var t=a.get(".J_EnsureExpress",e);if(!t||e.offsetHeight<30)return!1;var n=a.parent(t,"div");a.addClass(n,"tb-collapsed"),a.addClass(e,"tb-carriage-hasmore"),e.appendChild(a.create('<a class="tb-toggler J_Toggle" href="#">\u66f4\u591a</a>'))}};return{init:function(){return(n=a.get("#J_CurrentRegionName"))?(i=a.text(n),s):!1},updateEstimation:function(){},getCost:function(t){var n,i=this,c=a.get("#J_Carriage");if(c&&(n=c.getAttribute("data-url"))){n+=(n.indexOf("?")?"&":"?")+"areaId="+t;var d=(a.get(".J_EnsureExpress",c),{href:"//bbs.taobao.com/catalog/thread/567766-257640850.htm",title:"\u5168\u529b\u4e3a\u60a8\u51c6\u65f6\u9001\u8fbe, \u70b9\u51fb\u4e86\u89e3\u66f4\u591a\u7269\u6d41\u4fdd\u969c",cls:"tb-ensure-express J_EnsureExpress"}),l=function(t){if(t){var n,r=t.postDesc,c='<a href="{{href}}" target="_blank" class="{{cls}}" title="{{title}}">{{name}}</a>: {{money}}<span class="tb-ensure-time">({{signText}})</span> {{postage}}';r&&(n=r["default"],n&&(e.isString(n)?i.updateCost(n.replace(/(&yen;)/g,'<em class="tb-rmb-num"><em class="tb-rmb">$1</em>')):(n.postage=n.postage?"<span>"+e.trim(n.postage).replace(/:\s+/g,":").replace(/(&yen;)/g,'<span><em class="tb-rmb-num"><em class="tb-rmb">$1</em>').split(/\s+/).join("</em></span> <span>")+"</em></span>":"",i.updateCost(new o(c).render(e.merge(n,d)))),s.resetMore(),i.showMore()));var l=a.get(".tb-estimation","#J_LogisticInfo");t.consignAssignment?(l||a.insertAfter(a.create(e.substitute('<span class="tb-estimation">{consignAssignment}</span>',t)),"#J_Carriage"),a.html(l,t.consignAssignment)):l&&a.remove(l)}},u=function(e){a.html("#J_Carriage",e.carriage),a.html("#J_Estimation",e.estimation),r.fire("shippingInfoChanged",e)},f=~n.indexOf("json/postageFee.htm")?u:l;e.jsonp(n,f)}},showMore:s.showMore}}),KISSY.add("item-detail/stockinfo/index",["node","base","../config/","../newsku/"],function(e,t){var n=t("node"),i=t("base"),a=n.all,o=t("../config/"),r=o.getSkuConfig,s=a("body"),c=t("../newsku/"),d=i.extend({render:function(){var e=this,t=e.get("$buy"),n=e.get("$add"),i=e.get("$msg"),a=e.get("$prop"),o=e.get("$size");r.spanStock&&s.fire("stock:update",{show:!0}),a.show(),o.show(),i.addClass("tb-hidden"),t.removeClass("tb-disabled"),n.removeClass("tb-disabled")},update:function(t){var n=this,i=n.get("skuMap"),a=n.get("skuMapCache"),o=(n.get("defaultData"),n.get("regionalStock"));if(o){if(n.render(),o.nosku){var r=o.nosku,c=r.actualQuantity,d=r.withHoldingQuantity;s.fire("stock:update",{stock:c}),s.fire("sku:oversold",{oversold:"0"===c&&"0"!==d})}else i=n.restoreCache(i),e.each(o,function(e,t){var n=i[t];if(n){var o=e.actualQuantity,r=e.withHoldingQuantity;n.stock=o,n.oversold="0"===o&&"0"!==r,n.oversold=n.oversold+"","0"===n.stock&&"false"===n.oversold&&(delete i[t],a[t]=n)}}),n.set("skuMapCache",a),s.fire("sku:set",{pvs:""}),n.set("skuMap",i);t&&n.set("defaultData",o),n.set("regionalStock",null),s.fire("sku:validate")}},request:function(t){var n=this,i=n.get("config"),a=i&&i.areaLimit;a&&t.code&&e.getScript(a+"&areaId="+t.code,function(){n.update()})},isNoStock:function(){var t=!0,n=c.get("skuMap");return e.each(n,function(e){return 0!==e.stock||"false"!==e.oversold?(t=!1,!1):void 0}),t},restoreCache:function(t){var n=this,i=n.get("skuMapCache");return e.each(i,function(e,n){t[n]=e}),n.set("skuMapCache",{}),t},restoreDefault:function(){var t=this,n=t.get("defaultData");e.isEmptyObject(n)||(t.set("regionalStock",n),t.update())}},{ATTRS:{$buy:{value:a(".J_LinkBuy","#J_juValid")},$add:{value:a(".J_LinkAdd","#J_juValid")},$msg:{value:a(".tb-msg","#J_isku")},$prop:{value:a(".J_Prop","#J_isku")},$size:{value:a("#J_TMySize")},config:{getter:function(){return r()}},skuMap:{getter:function(){return c.get("skuMap")},setter:function(e){s.fire("sku:set",{skuMap:e})}},skuMapCache:{value:{}},defaultData:{value:{}},regionalStock:{getter:function(){return g_config.RegionalStock},setter:function(e){g_config.RegionalStock=e}}}});return new d}),KISSY.add("item-detail/region/picker",["dom","event","xtemplate","./info","node"],function(e,t){function n(e){s.addClass(e,k),s.removeClass(r,_),r=null}function i(e,t){var n=s.offset(t),a=n.top-e.offsetHeight,o=n.left-e.offsetWidth;return(i=function(e){var t=s.offset(e);return{top:t.top-a-5,left:t.left-o}})(e,t)}function a(e){if(e!==r){var t=s.text(e),n=s.attr(e,"data-code");r&&s.removeClass(r,_),s.addClass(e,_),r=e,T.provName=t,T.provCode=n,I.fire(w,{elem:e,name:t,code:n})}}function o(e){var t=s.text(e),n=s.attr(e,"data-code"),i=s.attr(s.parent(e,"div"),"data-prov-code")||s.attr(e,"data-code");T.cityName=t,T.cityCode=n,u.getCost(n);var a={name:t,code:n,provCode:i};f.fire(C,a),I.fire(C,a)}var r,s=t("dom"),c=t("event"),d=c.Target,l=t("xtemplate"),u=t("./info"),f=(t("node").all,DT.Messenger),m="click",g="mouseenter",p="mouseleave",h=[{code:"zxs",name:"\u76f4\u8f96\u5e02"},{code:"130000",name:"\u6cb3\u5317"},{code:"140000",name:"\u5c71\u897f"},{code:"150000",name:"\u5185\u8499\u53e4"},{code:"210000",name:"\u8fbd\u5b81"},{code:"220000",name:"\u5409\u6797"},{code:"230000",name:"\u9ed1\u9f99\u6c5f"},{code:"320000",name:"\u6c5f\u82cf"},{code:"330000",name:"\u6d59\u6c5f"},{code:"340000",name:"\u5b89\u5fbd"},{code:"350000",name:"\u798f\u5efa"},{code:"360000",name:"\u6c5f\u897f"},{code:"370000",name:"\u5c71\u4e1c"},{code:"410000",name:"\u6cb3\u5357"},{code:"420000",name:"\u6e56\u5317"},{code:"430000",name:"\u6e56\u5357"},{code:"440000",name:"\u5e7f\u4e1c"},{code:"450000",name:"\u5e7f\u897f"},{code:"460000",name:"\u6d77\u5357"},{code:"510000",name:"\u56db\u5ddd"},{code:"520000",name:"\u8d35\u5dde"},{code:"530000",name:"\u4e91\u5357"},{code:"540000",name:"\u897f\u85cf"},{code:"610000",name:"\u9655\u897f"},{code:"620000",name:"\u7518\u8083"},{code:"630000",name:"\u9752\u6d77"},{code:"640000",name:"\u5b81\u590f"},{code:"650000",name:"\u65b0\u7586"},{code:"710000",name:"\u53f0\u6e7e"},{code:"810000",name:"\u9999\u6e2f"},{code:"820000",name:"\u6fb3\u95e8"},{code:"hw",name:"\u6d77\u5916"}],v={zxs:[{code:"110100",name:"\u5317\u4eac"},{code:"500100",name:"\u91cd\u5e86"},{code:"120100",name:"\u5929\u6d25"},{code:"310100",name:"\u4e0a\u6d77"}],340000:[{code:"340200",name:"\u829c\u6e56"},{code:"341200",name:"\u961c\u9633"},{code:"340300",name:"\u868c\u57e0"},{code:"340100",name:"\u5408\u80a5"},{code:"340700",name:"\u94dc\u9675"},{code:"341300",name:"\u5bbf\u5dde"},{code:"341600",name:"\u4eb3\u5dde"},{code:"340400",name:"\u6dee\u5357"},{code:"341700",name:"\u6c60\u5dde"},{code:"341500",name:"\u516d\u5b89"},{code:"340800",name:"\u5b89\u5e86"},{code:"341100",name:"\u6ec1\u5dde"},{code:"341800",name:"\u5ba3\u57ce"},{code:"341400",name:"\u5de2\u6e56"},{code:"341000",name:"\u9ec4\u5c71"},{code:"340600",name:"\u6dee\u5317"},{code:"340500",name:"\u9a6c\u978d\u5c71"}],820000:[{code:"820100",name:"\u6fb3\u95e8\u534a\u5c9b"},{code:"820200",name:"\u79bb\u5c9b"}],350000:[{code:"350500",name:"\u6cc9\u5dde"},{code:"350100",name:"\u798f\u5dde"},{code:"350700",name:"\u5357\u5e73"},{code:"350900",name:"\u5b81\u5fb7"},{code:"350600",name:"\u6f33\u5dde"},{code:"350200",name:"\u53a6\u95e8"},{code:"350400",name:"\u4e09\u660e"},{code:"350800",name:"\u9f99\u5ca9"},{code:"350300",name:"\u8386\u7530"}],620000:[{code:"620400",name:"\u767d\u94f6"},{code:"620800",name:"\u5e73\u51c9"},{code:"621000",name:"\u5e86\u9633"},{code:"620200",name:"\u5609\u5cea\u5173"},{code:"620500",name:"\u5929\u6c34"},{code:"620700",name:"\u5f20\u6396"},{code:"621100",name:"\u5b9a\u897f"},{code:"622900",name:"\u4e34\u590f"},{code:"623000",name:"\u7518\u5357"},{code:"621200",name:"\u9647\u5357"},{code:"620900",name:"\u9152\u6cc9"},{code:"620600",name:"\u6b66\u5a01"},{code:"620300",name:"\u91d1\u660c"},{code:"620100",name:"\u5170\u5dde"}],440000:[{code:"441500",name:"\u6c55\u5c3e"},{code:"445200",name:"\u63ed\u9633"},{code:"445300",name:"\u4e91\u6d6e"},{code:"440600",name:"\u4f5b\u5c71"},{code:"440500",name:"\u6c55\u5934"},{code:"440300",name:"\u6df1\u5733"},{code:"440200",name:"\u97f6\u5173"},{code:"440100",name:"\u5e7f\u5dde"},{code:"445100",name:"\u6f6e\u5dde"},{code:"441600",name:"\u6cb3\u6e90"},{code:"440900",name:"\u8302\u540d"},{code:"440400",name:"\u73e0\u6d77"},{code:"441400",name:"\u6885\u5dde"},{code:"441300",name:"\u60e0\u5dde"},{code:"441200",name:"\u8087\u5e86"},{code:"440800",name:"\u6e5b\u6c5f"},{code:"440700",name:"\u6c5f\u95e8"},{code:"442000",name:"\u4e2d\u5c71"},{code:"441700",name:"\u9633\u6c5f"},{code:"441800",name:"\u6e05\u8fdc"},{code:"441900",name:"\u4e1c\u839e"}],450000:[{code:"450100",name:"\u5357\u5b81"},{code:"450800",name:"\u8d35\u6e2f"},{code:"451000",name:"\u767e\u8272"},{code:"451300",name:"\u6765\u5bbe"},{code:"451200",name:"\u6cb3\u6c60"},{code:"450700",name:"\u94a6\u5dde"},{code:"450300",name:"\u6842\u6797"},{code:"451400",name:"\u5d07\u5de6"},{code:"450500",name:"\u5317\u6d77"},{code:"451100",name:"\u8d3a\u5dde"},{code:"450900",name:"\u7389\u6797"},{code:"450600",name:"\u9632\u57ce\u6e2f"},{code:"450200",name:"\u67f3\u5dde"},{code:"450400",name:"\u68a7\u5dde"}],520000:[{code:"522300",name:"\u9ed4\u897f\u5357"},{code:"520100",name:"\u8d35\u9633"},{code:"520400",name:"\u5b89\u987a"},{code:"520300",name:"\u9075\u4e49"},{code:"522700",name:"\u9ed4\u5357"},{code:"522600",name:"\u9ed4\u4e1c\u5357"},{code:"522400",name:"\u6bd5\u8282"},{code:"522200",name:"\u94dc\u4ec1"},{code:"520200",name:"\u516d\u76d8\u6c34"}],460000:[{code:"460100",name:"\u6d77\u53e3"},{code:"460200",name:"\u4e09\u4e9a"}],130000:[{code:"130800",name:"\u627f\u5fb7"},{code:"130100",name:"\u77f3\u5bb6\u5e84"},{code:"130200",name:"\u5510\u5c71"},{code:"130500",name:"\u90a2\u53f0"},{code:"130700",name:"\u5f20\u5bb6\u53e3"},{code:"131000",name:"\u5eca\u574a"},{code:"130300",name:"\u79e6\u7687\u5c9b"},{code:"131100",name:"\u8861\u6c34"},{code:"130900",name:"\u6ca7\u5dde"},{code:"130600",name:"\u4fdd\u5b9a"},{code:"130400",name:"\u90af\u90f8"}],410000:[{code:"410300",name:"\u6d1b\u9633"},{code:"410700",name:"\u65b0\u4e61"},{code:"411200",name:"\u4e09\u95e8\u5ce1"},{code:"411600",name:"\u5468\u53e3"},{code:"411500",name:"\u4fe1\u9633"},{code:"411400",name:"\u5546\u4e18"},{code:"411300",name:"\u5357\u9633"},{code:"411100",name:"\u6f2f\u6cb3"},{code:"411000",name:"\u8bb8\u660c"},{code:"410900",name:"\u6fee\u9633"},{code:"410800",name:"\u7126\u4f5c"},{code:"410600",name:"\u9e64\u58c1"},{code:"410500",name:"\u5b89\u9633"},{code:"410400",name:"\u5e73\u9876\u5c71"},{code:"410200",name:"\u5f00\u5c01"},{code:"411700",name:"\u9a7b\u9a6c\u5e97"},{code:"410100",name:"\u90d1\u5dde"}],230000:[{code:"230500",name:"\u53cc\u9e2d\u5c71"},{code:"232700",name:"\u5927\u5174\u5b89\u5cad"},{code:"231200",name:"\u7ee5\u5316"},{code:"231000",name:"\u7261\u4e39\u6c5f"},{code:"230900",name:"\u4e03\u53f0\u6cb3"},{code:"230100",name:"\u54c8\u5c14\u6ee8"},{code:"230800",name:"\u4f73\u6728\u65af"},{code:"230700",name:"\u4f0a\u6625"},{code:"230600",name:"\u5927\u5e86"},{code:"230400",name:"\u9e64\u5c97"},{code:"230300",name:"\u9e21\u897f"},{code:"230200",name:"\u9f50\u9f50\u54c8\u5c14"},{code:"231100",name:"\u9ed1\u6cb3"}],420000:[{code:"420100",name:"\u6b66\u6c49"
},{code:"420500",name:"\u5b9c\u660c"},{code:"420600",name:"\u8944\u9633"},{code:"420300",name:"\u5341\u5830"},{code:"420200",name:"\u9ec4\u77f3"},{code:"420800",name:"\u8346\u95e8"},{code:"421000",name:"\u8346\u5dde"},{code:"421100",name:"\u9ec4\u5188"},{code:"420700",name:"\u9102\u5dde"},{code:"422800",name:"\u6069\u65bd"},{code:"421300",name:"\u968f\u5dde"},{code:"421200",name:"\u54b8\u5b81"},{code:"420900",name:"\u5b5d\u611f"}],430000:[{code:"431300",name:"\u5a04\u5e95"},{code:"430100",name:"\u957f\u6c99"},{code:"430400",name:"\u8861\u9633"},{code:"430600",name:"\u5cb3\u9633"},{code:"430800",name:"\u5f20\u5bb6\u754c"},{code:"430300",name:"\u6e58\u6f6d"},{code:"433100",name:"\u6e58\u897f"},{code:"431200",name:"\u6000\u5316"},{code:"431100",name:"\u6c38\u5dde"},{code:"431000",name:"\u90f4\u5dde"},{code:"430900",name:"\u76ca\u9633"},{code:"430700",name:"\u5e38\u5fb7"},{code:"430500",name:"\u90b5\u9633"},{code:"430200",name:"\u682a\u6d32"}],220000:[{code:"220500",name:"\u901a\u5316"},{code:"220100",name:"\u957f\u6625"},{code:"220600",name:"\u767d\u5c71"},{code:"220800",name:"\u767d\u57ce"},{code:"220700",name:"\u677e\u539f"},{code:"220400",name:"\u8fbd\u6e90"},{code:"220300",name:"\u56db\u5e73"},{code:"220200",name:"\u5409\u6797"},{code:"222400",name:"\u5ef6\u8fb9\u671d\u9c9c\u65cf"}],320000:[{code:"320500",name:"\u82cf\u5dde"},{code:"321300",name:"\u5bbf\u8fc1"},{code:"321200",name:"\u6cf0\u5dde"},{code:"321100",name:"\u9547\u6c5f"},{code:"321000",name:"\u626c\u5dde"},{code:"320800",name:"\u6dee\u5b89"},{code:"320700",name:"\u8fde\u4e91\u6e2f"},{code:"320600",name:"\u5357\u901a"},{code:"320400",name:"\u5e38\u5dde"},{code:"320900",name:"\u76d0\u57ce"},{code:"320200",name:"\u65e0\u9521"},{code:"320300",name:"\u5f90\u5dde"},{code:"320100",name:"\u5357\u4eac"}],360000:[{code:"360500",name:"\u65b0\u4f59"},{code:"360200",name:"\u666f\u5fb7\u9547"},{code:"360700",name:"\u8d63\u5dde"},{code:"360900",name:"\u5b9c\u6625"},{code:"360600",name:"\u9e70\u6f6d"},{code:"361000",name:"\u629a\u5dde"},{code:"360800",name:"\u5409\u5b89"},{code:"360300",name:"\u840d\u4e61"},{code:"360100",name:"\u5357\u660c"},{code:"360400",name:"\u4e5d\u6c5f"},{code:"361100",name:"\u4e0a\u9976"}],210000:[{code:"210500",name:"\u672c\u6eaa"},{code:"211100",name:"\u76d8\u9526"},{code:"211000",name:"\u8fbd\u9633"},{code:"210800",name:"\u8425\u53e3"},{code:"210700",name:"\u9526\u5dde"},{code:"210600",name:"\u4e39\u4e1c"},{code:"210400",name:"\u629a\u987a"},{code:"210300",name:"\u978d\u5c71"},{code:"210200",name:"\u5927\u8fde"},{code:"210100",name:"\u6c88\u9633"},{code:"211300",name:"\u671d\u9633"},{code:"211200",name:"\u94c1\u5cad"},{code:"210900",name:"\u961c\u65b0"},{code:"211400",name:"\u846b\u82a6\u5c9b"}],150000:[{code:"152500",name:"\u9521\u6797\u90ed\u52d2"},{code:"150300",name:"\u4e4c\u6d77"},{code:"150700",name:"\u547c\u4f26\u8d1d\u5c14"},{code:"150100",name:"\u547c\u548c\u6d69\u7279"},{code:"150400",name:"\u8d64\u5cf0"},{code:"150600",name:"\u9102\u5c14\u591a\u65af"},{code:"152900",name:"\u963f\u62c9\u5584"},{code:"152200",name:"\u5174\u5b89"},{code:"150900",name:"\u4e4c\u5170\u5bdf\u5e03"},{code:"150800",name:"\u5df4\u5f66\u6dd6\u5c14"},{code:"150500",name:"\u901a\u8fbd"},{code:"150200",name:"\u5305\u5934"}],640000:[{code:"640100",name:"\u94f6\u5ddd"},{code:"640400",name:"\u56fa\u539f"},{code:"640500",name:"\u4e2d\u536b"},{code:"640200",name:"\u77f3\u5634\u5c71"},{code:"640300",name:"\u5434\u5fe0"}],630000:[{code:"632100",name:"\u6d77\u4e1c"},{code:"632700",name:"\u7389\u6811"},{code:"632600",name:"\u679c\u6d1b"},{code:"632500",name:"\u6d77\u5357\u85cf\u65cf"},{code:"632300",name:"\u9ec4\u5357"},{code:"632200",name:"\u6d77\u5317"},{code:"630100",name:"\u897f\u5b81"},{code:"632800",name:"\u6d77\u897f"}],370000:[{code:"370600",name:"\u70df\u53f0"},{code:"371500",name:"\u804a\u57ce"},{code:"371000",name:"\u5a01\u6d77"},{code:"370300",name:"\u6dc4\u535a"},{code:"371200",name:"\u83b1\u829c"},{code:"371400",name:"\u5fb7\u5dde"},{code:"370500",name:"\u4e1c\u8425"},{code:"370900",name:"\u6cf0\u5b89"},{code:"370800",name:"\u6d4e\u5b81"},{code:"370700",name:"\u6f4d\u574a"},{code:"370400",name:"\u67a3\u5e84"},{code:"370200",name:"\u9752\u5c9b"},{code:"370100",name:"\u6d4e\u5357"},{code:"371700",name:"\u83cf\u6cfd"},{code:"371600",name:"\u6ee8\u5dde"},{code:"371300",name:"\u4e34\u6c82"},{code:"371100",name:"\u65e5\u7167"}],140000:[{code:"140100",name:"\u592a\u539f"},{code:"140400",name:"\u957f\u6cbb"},{code:"140700",name:"\u664b\u4e2d"},{code:"140900",name:"\u5ffb\u5dde"},{code:"141000",name:"\u4e34\u6c7e"},{code:"140800",name:"\u8fd0\u57ce"},{code:"140500",name:"\u664b\u57ce"},{code:"140300",name:"\u9633\u6cc9"},{code:"141100",name:"\u5415\u6881"},{code:"140200",name:"\u5927\u540c"},{code:"140600",name:"\u6714\u5dde"}],610000:[{code:"610200",name:"\u94dc\u5ddd"},{code:"611000",name:"\u5546\u6d1b"},{code:"610900",name:"\u5b89\u5eb7"},{code:"610700",name:"\u6c49\u4e2d"},{code:"610500",name:"\u6e2d\u5357"},{code:"610400",name:"\u54b8\u9633"},{code:"610100",name:"\u897f\u5b89"},{code:"610300",name:"\u5b9d\u9e21"},{code:"610800",name:"\u6986\u6797"},{code:"610600",name:"\u5ef6\u5b89"}],510000:[{code:"513400",name:"\u51c9\u5c71"},{code:"510300",name:"\u81ea\u8d21"},{code:"510500",name:"\u6cf8\u5dde"},{code:"510900",name:"\u9042\u5b81"},{code:"513300",name:"\u7518\u5b5c"},{code:"513200",name:"\u963f\u575d"},{code:"512000",name:"\u8d44\u9633"},{code:"511900",name:"\u5df4\u4e2d"},{code:"511800",name:"\u96c5\u5b89"},{code:"511600",name:"\u5e7f\u5b89"},{code:"511400",name:"\u7709\u5c71"},{code:"511300",name:"\u5357\u5145"},{code:"511000",name:"\u5185\u6c5f"},{code:"511500",name:"\u5b9c\u5bbe"},{code:"510700",name:"\u7ef5\u9633"},{code:"510800",name:"\u5e7f\u5143"},{code:"510400",name:"\u6500\u679d\u82b1"},{code:"510100",name:"\u6210\u90fd"},{code:"511700",name:"\u8fbe\u5dde"},{code:"511100",name:"\u4e50\u5c71"},{code:"510600",name:"\u5fb7\u9633"}],710000:[{code:"710100",name:"\u53f0\u5317"},{code:"710200",name:"\u9ad8\u96c4"},{code:"710900",name:"\u5609\u4e49"},{code:"710800",name:"\u65b0\u7af9"},{code:"710700",name:"\u57fa\u9686"},{code:"710600",name:"\u5357\u6295"},{code:"710400",name:"\u53f0\u4e2d"},{code:"710500",name:"\u91d1\u95e8"},{code:"710300",name:"\u53f0\u5357"}],540000:[{code:"542200",name:"\u5c71\u5357"},{code:"542300",name:"\u65e5\u5580\u5219"},{code:"542600",name:"\u6797\u829d"},{code:"542400",name:"\u90a3\u66f2"},{code:"542100",name:"\u660c\u90fd"},{code:"542500",name:"\u963f\u91cc"},{code:"540100",name:"\u62c9\u8428"}],810000:[{code:"810100",name:"\u9999\u6e2f\u5c9b"},{code:"810300",name:"\u65b0\u754c"},{code:"810200",name:"\u4e5d\u9f99"}],650000:[{code:"650100",name:"\u4e4c\u9c81\u6728\u9f50"},{code:"654300",name:"\u963f\u52d2\u6cf0"},{code:"652300",name:"\u660c\u5409"},{code:"650200",name:"\u514b\u62c9\u739b\u4f9d"},{code:"652100",name:"\u5410\u9c81\u756a"},{code:"652200",name:"\u54c8\u5bc6"},{code:"652700",name:"\u535a\u5c14\u5854\u62c9"},{code:"652900",name:"\u963f\u514b\u82cf"},{code:"653100",name:"\u5580\u4ec0"},{code:"653200",name:"\u548c\u7530"},{code:"654200",name:"\u5854\u57ce"},{code:"654000",name:"\u4f0a\u7281"},{code:"652800",name:"\u5df4\u97f3\u90ed\u695e"},{code:"653000",name:"\u514b\u5b5c\u52d2\u82cf\u67ef\u5c14\u514b\u5b5c"}],530000:[{code:"530100",name:"\u6606\u660e"},{code:"530400",name:"\u7389\u6eaa"},{code:"530500",name:"\u4fdd\u5c71"},{code:"530300",name:"\u66f2\u9756"},{code:"530700",name:"\u4e3d\u6c5f"},{code:"530900",name:"\u4e34\u6ca7"},{code:"532500",name:"\u7ea2\u6cb3"},{code:"532800",name:"\u897f\u53cc\u7248\u7eb3"},{code:"533400",name:"\u8fea\u5e86"},{code:"533300",name:"\u6012\u6c5f"},{code:"532900",name:"\u5927\u7406"},{code:"530600",name:"\u662d\u901a"},{code:"533100",name:"\u5fb7\u5b8f"},{code:"532600",name:"\u6587\u5c71"},{code:"532300",name:"\u695a\u96c4"},{code:"530800",name:"\u666e\u6d31"}],330000:[{code:"330400",name:"\u5609\u5174"},{code:"331100",name:"\u4e3d\u6c34"},{code:"330600",name:"\u7ecd\u5174"},{code:"330100",name:"\u676d\u5dde"},{code:"330500",name:"\u6e56\u5dde"},{code:"330700",name:"\u91d1\u534e"},{code:"330300",name:"\u6e29\u5dde"},{code:"330800",name:"\u8862\u5dde"},{code:"330900",name:"\u821f\u5c71"},{code:"330200",name:"\u5b81\u6ce2"},{code:"331000",name:"\u53f0\u5dde"}],hw:[{code:"990000",name:"\u6d77\u5916"}]},b='<div id="J_RegionDialog"><h3>\u9009\u62e9\u4f60\u7684\u6536\u8d27\u57ce\u5e02</h3><p class="tb-region-default">\u4f60\u5f53\u524d\u7684\u6240\u5728\u5730\uff1a<a id="J_RegionDefault" href="#"></a></p><div id="J_RegionProvinces" class="tb-region-provinces tb-clearfix"></div><div id="J_RegionCities" class="tb-region-cities tb-hidden tb-clearfix"></div></div>',y='<ul class="tb-clearfix">{{#each list}}<li><a data-code="{{code}}" href="#">{{name}}</a></li>{{/each}}</ul>',k="tb-hidden",_="tb-selected",w="provChange",C="regionChange",S="restoreDefault",I=e.merge({},d),T={},x=!1;return{init:function(e){var t,r,d=s.get("#J_RegionDialog"),u=s.get("#J_RegionDefault"),b=s.get("#J_RegionProvinces"),_=s.get("#J_RegionCities");return d&&u&&b&&_?(u.innerHTML=e,b.innerHTML=new l(y).render({list:h}),r=s.query("a",b),c.on(u,m,function(e){e.preventDefault(),f.fire(S),I.fire(S)}),c.on(r,m,function(e){e.preventDefault()}),c.on(r,g,function(){t&&clearTimeout(t),a(this)}),c.on(r,p,function(){t=setTimeout(function(){n(_)},300)}),I.on(w,function(e){s.removeClass(_,k);var t=new l(y),n=t.render({list:v[e.code]});s.html(_,n),s.css(_,i(e.elem,d)),s.attr(_,"data-prov-code",/zxs|hw/.test(e.code)?"":e.code)}),c.on(_,g,function(){t&&clearTimeout(t)}),c.on(_,p,function(){n(this)}),c.on(_,m,function(e){var t=e.target;"a"===t.tagName.toLowerCase()&&(e.preventDefault(),o(t))}),void(x=!0)):!1},isInited:function(){return x},getOriginHtml:function(){return b},getCurrentRegion:function(){var e={},t=T.provName,n=T.provCode,i=T.cityName,a=T.cityCode;return e=/zxs|hw/.test(n)?{name:i,code:a}:{name:t+i,code:n}},onRestoreDefault:function(t){e.isFunction(t)&&I.on(S,t)},onRegionChange:function(t){e.isFunction(t)&&I.on(C,t)}}}),KISSY.add("item-detail/dialog/index",["overlay","event","dom"],function(e,t){var n=t("overlay"),i=t("event"),a=t("dom"),o=document,r=o.body,s="",c="click";return new function(){function t(){var e='<div class="tb-detail-dialog ks-popup-hidden ks-overlay-hidden"><div class="J_Content tb-content ks-popup-content"></div><span class="J_Close tb-close"></span></div>',t=a.create(e);return r.appendChild(t),t}var o={klass:s,content:s,triggerType:c,align:{}};this.attach=function(r,s){if(r=a.get(r),s=e.merge(o,s),!r||!e.isPlainObject(s))return!1;var d,l=t(),u=a.get(".J_Content",l),f=a.get(".J_Close",l);return a.addClass(l,s.klass),u.innerHTML=s.content,d=new n.Popup({srcNode:l,elStyle:{display:"block",visibility:"hidden",position:"absolute",left:"-9999px",top:"-9999px"},trigger:r,triggerType:s.triggerType,align:s.align}),d.hide(),i.on(f,c,function(){d.hide()}),d}}}),KISSY.add("item-detail/transit/cost",["log","../login/","../config/","node","dom"],function(e,t){function n(e){var t={mode:e[1],code:e[2],cost:e[3],addon:e[4]},n=t.mode;k[n]?k[n].push(t):k[n]=[t]}function i(t,n){var i,a,o,r,s;for(i=0,a=t.length;a>i;i++){if(r=t[i],s=r.code,-1!=e.indexOf(n,s.split(","))){o=r;break}"1"===s&&(o=r)}return o}function a(e){var t,n,a=[];for(t in k)n=i(k[t],e),n&&(a[a.length]=n);return a}function o(t){var n={},i=a(t);return e.each(i,function(t){e.each(y,function(e){e==t.mode&&(n[e]=t.cost)})}),n[p]=n[v]&&n[b]?Math.min(n[v],n[b]):n[v],n}function r(t){var n=[];e.each([g,p,h],function(e,i){var a=t[e];a&&(n[i]="<em>"+_[e]+": "+a+"\u5143</em>")}),c.innerHTML=n.join("")}var s,c,d,l=(t("log").getLogger("transit"),t("../login/"),t("../config/")),u=(l.isDaily,l.getSkuConfig),f=t("node").all,m=(f("body"),t("dom")),g="1",p="2",h="7",v="4",b="5",y=[g,h,v,b],k={},_={};return _[g]="\u5e73\u90ae",_[p]="\u5feb\u9012",_[v]="\u5feb\u9012\u516c\u53f8",_[b]="\u90ae\u653f\u5feb\u9012",_[h]="EMS",d={update:function(t){t=e.isString(t)?o(t):t,e.isPlainObject(t)&&r(t)},restoreDefault:function(){c.innerHTML=s}},{init:function(){var t=u().valPostFee;return c=m.get("#J_Carriage"),t&&c?(e.isArray(t.items)&&e.each(t.items,function(e){n(e)}),s=c.innerHTML,d):!1}}}),KISSY.add("item-detail/transit/manager",["log","../region/info","../stockinfo/","../region/picker","../dialog/","./cost","node","dom"],function(e,t){var n=(t("log").getLogger("transit"),t("../region/info")),i=t("../stockinfo/"),a=t("../region/picker"),o=t("../dialog/"),r=t("./cost"),s=t("node").all,c=s("body"),d=t("dom");return{init:function(){var e=d.get("#J_CurrentRegion"),t=n.init(),s=r.init();if(e&&t){var l=("true"===d.attr(e,"data-update-cost"),o.attach(e,{klass:"tb-region-dialog",content:a.getOriginHtml(),align:{node:e,points:["tl","tl"],offset:[-137,25]}}));this.regionDialog=l,l.on("show",function(){a.isInited()||a.init(t.getDefault()),c.fire("region:pick")}),a.onRestoreDefault(function(){l.hide(),t.restoreDefault(),s&&s.restoreDefault(),i.restoreDefault()}),a.onRegionChange(function(e){l.hide(),t.update(a.getCurrentRegion().name),i.request(e)})}}}}),KISSY.add("item-detail/transit/index",["log","./manager","../region/info","../login/","../config/","node"],function(e,t){var n,i=t("log").getLogger("transit"),a=t("./manager"),o=t("../region/info"),r=(t("../login/"),t("../config/"),t("node").all),s=r("body"),c=DT.Messenger,d=function(){};return d.prototype.init=function(e){i.info("Init old logistic");var t=this;n=e,t.bind()},d.prototype.render=function(t){var i=this;if("setupService"===t.postageType)r(".tb-property .sep-line").css("border-bottom","none"),s.fire("onsitesetup:data",t);else{var o=['<div class="tb-logistic tb-clearfix">','<span class="tb-name tb-property-type">\u914d\u9001</span>','<div id="J_LogisticInfo" class="tb-logistic-info">','<span class="tb-location">',"<em>{location}</em>","</span>",t.destination?" \u81f3 ":"","buyerPayPostfee"===t.postageType&&"true"!==t.areaLimit||"sellerPayPostfee"===t.postageType?"":['<a id="J_CurrentRegion" class="tb-region" href="javascript:;" title="\u9009\u62e9\u6536\u8d27\u57ce\u5e02" hidefocus="true" data-update-cost="true">','<em id="J_CurrentRegionName">{destination}</em>','<i class="tb-arrow-roll">',"<em></em>","<span></span>","</i>","</a>"].join(""),'<span id="J_Carriage" class="tb-carriage" data-url="{dataUrl}">{carriage}</span>','<span class="tb-estimation">{estimation}</span>',"</div>","</div>"].join(""),d=e.substitute(o,t),l=r(".tb-meta");if(r(d).insertAfter(l),a.init(n),t.skuList){var u="def",f=t.skuList;s.on("sku:selected",function(e){u=e.sku.skuId,f[u]&&i.setPostage(f[u])}),s.on("sku:unselected",function(){u="def",f[u]&&i.setPostage(f[u])}),c.on("shippingInfoChanged",function(e){f=e.skuList,f[u]&&i.setPostage(f[u])})}i.setPostage()}},d.prototype.bind=function(){var e=this;c.on("item:info:logistic",function(t){"carriage"in t?(e.render(t),o.showMore()):a.init(n)})},d.prototype.setPostage=function(e){var t=r("#J_Carriage"),n=r("#J_Estimation");e&&(t.html(e.carriage),n.html(e.estimation))},new d}),KISSY.add("item-detail/serviceitems/index",["node","base"],function(e,t,n,i){var a=t("node"),o=t("base"),r=a.all,s=r("body");i.exports=o.extend({initializer:function(){var e=this,t=e.get("delayInsurance");t&&e.init()},init:function(){var t=this,n=t.get("itemId"),i=t.get("renderId"),a=t.get("seedPath");e.getScript(a,function(){e.use("life/c/service-items/",function(e,a){var o=new a(r(i),n);t.set("serviceItems",o),t.render(),t.bind()})}),s.on("sku:found sku:changed",function(e){var n=e.sku;t.set("skuId",n.skuId)})},render:function(){var e=this,t=e.get("serviceItems");t.render()},bind:function(){var e=this,t=e.get("skuId"),n=e.get("formEl"),i=e.get("serviceItems");r(n).append('<input type="hidden" name="fuwubaoInfo" value="">'),i.on("afterFormDataChange",function(e){var t=e.newVal&&e.newVal.fuwubaoInfo;n.elements.fuwubaoInfo.value=t}),s.fire("cart:params",{params:function(){return"fuwubaoInfo="+i.get("formData").fuwubaoInfo}}),s.on("sku:found sku:changed",function(e){var t=e.sku;i.set("skuId",t.skuId)}),t&&i.set("skuId",t)}},{ATTRS:{skuId:{},formEl:{},itemId:{value:g_config.itemId},renderId:{value:"#J_ServiceItems"},seedPath:{value:"//g.alicdn.com/tb/life/2.0.1/config.js"},serviceItems:{},delayInsurance:{valueFn:function(){return g_config.delayInsurance}}}})}),KISSY.add("item-detail/onsitesetup/index",["log","../login/","../gl/","../config/","../dialog/","../transit/manager","node","event","dom","io"],function(e,t){function n(){N.css(k,"visibility","hidden")}function i(){N.css(k,"visibility","visible")}function a(e){T.value=e}function o(){P.hasSkuSelected()&&(N.removeClass(N.get(".tb-key","#detail"),"tb-incomplete"),N.addClass("#J_SureContinue",P.getLastValidator()?"J_LinkAdd":"J_LinkBuy"))}function r(){var e=0;return A(".tb-onsite-setup-option").each(function(t,n){N.hasClass(t,Q)&&(e=n+1)}),e}function s(){b=N.get(".tb-onsite-setup-current"),y=N.get(".tb-onsite-setup-status"),_=N.get(".tb-onsite-setup-current-choice"),k=N.get(".tb-onsite-setup-options"),w=N.get(".tb-district-selector"),I=D().form,T=N.create('<input name="fuwu_option" type="hidden" value="-1" />'),N.append(T,I)}function c(){function e(e){e&&(N.removeClass("#J_CurrentRegionName","tb-no-district"),U=e.code||e.cityId,V=null,d())}return b?(j.on("regionChange",function(t){e(t),J("1.3.1.1?city="+t.code,"tbmarket")}),j.on("restoreDefault",function(){e(v)}),R.on(b,H,function(){N.addClass(b,ee)}),R.on(b,K,function(){N.removeClass(b,ee)}),R.on(b,E,function(e){e.preventDefault(),N.hasClass(b,Z)?(N.removeClass(b,Z),n()):(N.addClass(b,Z),i())}),R.on(k,E,function(e){e.preventDefault(),N.removeClass(b,Z);var t=e.target;"A"!==t.tagName&&(t=t.parentNode),N.html(_,N.html(t)),N.removeClass(N.children(t.parentNode.parentNode),Q),N.addClass(t.parentNode,Q),a(N.attr(t,"data-id")),n(),o(),J("1.3.1.2?change=1&result="+r(),"tbmarket")}),R.on(y,K,function(){N.hasClass(b,Z)&&(N.removeClass(b,Z),n(),J("1.3.1.2?change=0&result="+r(),"tbmarket"))}),C=X.attach(w,{klass:"tb-district-list-wrap",content:'<span class="tb-district-list-close"></span><ul class="tb-district-list tb-clearfix"></ul>',align:{node:w,points:["tl","tl"],offset:[-137,25]}}),C.on("show",function(){L.regionDialog&&L.regionDialog.hide()}),S=N.get(".tb-district-list"),R.on(S,E,function(e){e.preventDefault();var t=e.target;"A"===t.tagName&&(V=N.attr(t,"data-id"),J("1.3.1.1?region="+V,"tbmarket"),N.html(w,N.html(t)),C.hide(),d())}),M.on("region:pick",function(){C.hide()}),M.on("sku:selected",function(e){var t,n=e.sku.skuId;q&&(t=q.options[n]?q.options[n]:q.defaultOption,l(t))}),void M.on("sku:unselected",function(){q&&l(q.defaultOption)})):!1}function d(){if(!G)return!1;Y=P.getSkuId(),$=parseInt(G.value,10),g(U);var t={cityId:U,itemId:O,skuId:Y,itemNum:$,districtId:V},n=e.param(t);return h=n,z[n]?u(z[n]):void B({url:"//"+F+n,dataType:"jsonp",jsonpCallback:"jsonp_onsitesetup",success:u,error:f})}function l(t){var n=t.length;e.each(t,function(e){e.fee||(e.fee=(e.totalFee/100).toFixed(2))}),1===n?(N.html(_,e.substitute("{name}+<strong>{fee}</strong>\u5143",t[0])),a(t[0].id),o()):(N.html(_,"\u4e3a\u60a8\u63d0\u4f9b\u9001\u8d27\u5b89\u88c5\u670d\u52a1\uff0c\u8bf7\u9009\u62e9"),a("-1")),N.html(k,""),e.each(t,function(t,i){var a=e.substitute(W,t);a=N.create(a),0===i&&N.addClass(a,"tb-onsite-setup-option-first"),i===n-1&&N.addClass(a,"tb-onsite-setup-option-last"),1===n&&N.addClass(a,"tb-onsite-setup-option-selected"),N.append(a,k)}),q.defaultDistrict&&(N.html(w,q.defaultDistrict.name),N.css(w,"visibility","visible")),q.districts&&q.districts.length&&(N.html(S,""),e.each(q.districts,function(t){var n=e.substitute('<li data-id="{id}"><a href="#" data-id="{id}">{name}</a></li>',t);n=N.create(n),N.append(n,S)}))}function u(e){if(!e.success)return f();q=e,N.css(y,"display","block"),N.removeClass("#J_CurrentRegion","tb-region-naked");var t,n=P.getSkuId();t=n&&q.options[n]?q.options[n]:q.defaultOption,l(t)}function f(){T.value="0",N.css(".tb-onsite-setup","display","none"),x.warn("Request data fail")}function m(t){v=t,M.fire("validator:register",{rule:function(){return T&&"-1"===T.value?(J("1.3.1.3?errortype=1","tbmarket"),"\u8bf7\u9009\u62e9\u60a8\u9700\u8981\u7684\u914d\u9001\u5b89\u88c5\u7684\u5730\u5740\u4e0e\u65b9\u5f0f\uff01"):!1}}),U=t.cityId;var n="1"===U;t.wildClass=n?"tb-no-district":"",t.defaultText=n?"\u9009\u62e9\u5730\u533a":t.destination;var i=['<dl class="tb-onsite-setup">','<dt class="tb-property-type">\u914d\u9001</dt>',"<dd>",'<span class="tb-location">','<em>{location}</em> \u81f3 <a title="\u9009\u62e9\u6536\u8d27\u57ce\u5e02" hidefocus="true" href="#" class="tb-region" id="J_CurrentRegion">','<em id="J_CurrentRegionName" class="{wildClass}">{defaultText}</em></a>','<span class="tb-district-selector"></span>',"</span>",'<div class="tb-onsite-setup-status" style="display: none">','<div class="tb-onsite-setup-current">','<div class="tb-cargo"></div>','<div class="tb-onsite-setup-current-choice">\u4e3a\u60a8\u63d0\u4f9b\u9001\u8d27\u5b89\u88c5\u670d\u52a1\uff0c\u8bf7\u9009\u62e9</div>','<div class="tb-triangle"></div>',"</div>",'<ul class="tb-onsite-setup-options"></ul>',"</div>","</dd>","</dl>"].join("");i=e.substitute(i,t),i=N.create(i),N.insertBefore(i,N.get(".tb-amount")),e.later(function(){L.init(p),s(),c(),n?N.addClass("#J_CurrentRegion","tb-region-naked"):(N.css(b,"display","block"),d())},0),G=N.get("#J_IptAmount"),F=D().apiOnSiteSetup}function g(e){M.fire("config:set",{key:"deliveryId",value:e}),U=e}var p,h,v,b,y,k,_,w,C,S,I,T,x=t("log").getLogger("onsitesetup"),J=(t("../login/"),t("../gl/")),P=t("../config/"),X=t("../dialog/"),D=P.getSkuConfig,L=t("../transit/manager"),A=t("node").all,M=A("body"),R=t("event"),N=t("dom"),B=t("io"),j=DT.Messenger,E="click",H="mouseenter",K="mouseleave",F=null,O=g_config.itemId,Y=null,U=null,V=null,G=null,$=1,q=null,z={},W='<li class="tb-onsite-setup-option" data-id="{id}"><a href="#" data-id="{id}">{name}+<strong>{fee}</strong>\u5143</a> </li>',Z="tb-onsite-setup-current-active",Q="tb-onsite-setup-option-selected",ee="tb-onsite-setup-current-hover";return{init:function(e){p=e,M.on("onsitesetup:data",function(e){m(e)})},setCityId:g}}),KISSY.add("item-detail/oversold/index",["log","../config/","node","dom"],function(e,t){var n=t("log").getLogger("oversold"),i=t("../config/"),a=i.getSkuConfig,o=t("node").all,r=o("body"),s=t("dom");return{isOver:!1,init:function(){var e=this;r.fire("resource:sib",{success:function(){e._init()}}),r.on("sku:oversold",function(t){e.isOver=t.oversold,e.update({oversold:e.isOver.toString()})})},_init:function(){var e=this,t=g_config.DynamicStock;t&&n.info("Virt quantity is %s, hold quantity is %s, stock is %s",t.virtQuantity,t.holdQuantity,t.stock),t&&"0"===t.virtQuantity?e.update({oversold:"true"}):(r.on("sku:selected",function(t){t.sku&&e.update(t.sku),r.fire("sku:validate")}),r.on("sku:unselected",function(){e.update({oversold:"false"})}))},update:function(e){var t=s.get("#J_juValid"),n=a.spanStock;if(t&&n){var o=s.query("a",t),c=s.get("#J_SureContinue"),d=i.getLimit();"true"===e.oversold?(s.addClass(o,"tb-disabled"),d||r.fire("stock:update",{show:!1}),c&&s.css(c,"display","none"),this.isOver=!0):(s.removeClass(o,"tb-disabled"),d||r.fire("stock:update",{show:!0}),c&&s.css(c,"display",""),this.isOver=!1),r.fire("sku:validate",{stock:!0})}}}}),KISSY.add("item-detail/cart/add",["log","../login/","../config/","uri","../querystring/","cookie","base","node"],function(e,t){function n(){var t=m.getSkuConfig();e.each(C,function(n){if(e.isFunction(n))try{n(t)}catch(i){u.warn("Action before cart failed: %s",i.message)}})}function i(){var t=[],n=m.getSkuConfig();return e.each(S,function(i){var a=i;if(e.isFunction(i))try{a=i(n)}catch(o){u.warn("Cart param append execution failed")}e.isObject(a)&&(a=p.stringify(a)),t.push(String(a))}),t.join("&")}function a(e,t){return e+(-1===e.indexOf("?")?"?":"&")+t}function o(){return l}function r(e){u.warn("Add cart request failed: %s",e),alert(e)}function s(){var e=document;return e.charset||e.characterSet||"gb2312"}function c(t,n,i){e.getScript(t,{success:n,error:i,timeout:10,charset:s()})}var d,l,u=t("log").getLogger("cart"),f=t("../login/"),m=t("../config/"),g=t("uri").Query,p=t("../querystring/"),h=t("cookie"),v=t("base"),b=t("node").all,y=b("body"),k=m.isDaily,_=k?"daily.taobao.net":"taobao.com",w=k?"http":"https";y.on("promo:price",function(e){l=e.price});var C=[];y.on("cart:before",function(e){C.push(e.action)});var S=[];y.on("cart:params",function(e){S.push(e.params)});var I=v.extend({addCart:function(t,s){var d=this;if(!d.adding){d.adding=!0;var l,p,h=m.getSkuConfig(),v=new g;m.hasSku()?(l=2,p=t.skuId):(l=1,p=t.itemId||I.getItemId());var b={outer_id:p,outer_id_type:l,quantity:t.amount,opp:o(),nekot:e.now(),ct:t.trackId,_tb_token_:m.getToken(),deliveryCityCode:m.getDeliveryId(),channelkey:m.getChannelkey(),frm:m.getFrm(),buyer_from:m.getBuyerFrom(),item_url_refer:m.getUrlRefer(),root_refer:m.getRootRefer(),flushingPictureServiceId:m.getFlushingPictureServiceId()};e.each(b,function(e,t){null!=e&&v.add(t,e)});var k=v.toString(),C=h.apiAddCart,S=a(C,k),T=i();T&&(S=a(S,T)),n(),u.info("Add cart request %s",S),c(S,function(){if(d.adding=!1,"undefined"==typeof TB.Detail.CartResult){var e="\u52a0\u5165\u8d2d\u7269\u8f66\u63a5\u53e3\u6570\u636e\u8fd4\u56de\u5f02\u5e38";return r(e)}var n=TB.Detail.CartResult;if(TB.Detail.CartResult=null,delete TB.Detail.CartResult,"NEED_LOGIN"===n.errorCode)return u.info("Server response: %s",n.errorCode),f(function(){d.add(t,s)});if("undefined"!=typeof n.error){if("TrackCartIsFull"===n.error){var i=w+"://login."+_+"/member/login.jhtml?from=detail&style=simple&redirectURL="+encodeURIComponent(location.href),e='\u60a8\u6dfb\u52a0\u7684\u5b9d\u8d1d\u79cd\u7c7b\u5df2\u7ecf\u8fbe\u5230\u4e0a\u9650\u4e86\uff0c<a href="'+i+'">\u767b\u5f55</a>\u540e\u53ef\u7ee7\u7eed\u6dfb\u52a0';return d.validator.showError(e)}return d.validator.showError("UserCartIsFull"===n.error?"\u60a8\u6dfb\u52a0\u7684\u5b9d\u8d1d\u79cd\u7c7b\u5df2\u7ecf\u8fbe\u5230\u4e0a\u9650\u4e86":n.error)}if(n.cartQuantity){var a=Number(n.cartQuantity);try{TB.Global.setCartNum&&TB.Global.setCartNum(a)}catch(o){u.warn("setCartNum error")}y.fire("toolbar:cart:num",{num:a}),y.fire("cart:add:success",{quantity:a,price:n.price})}n.sourceTime=t.sourceTime,s(n)},function(){d.adding=!1,y.fire("cart:add:error");var e="\u52a0\u5165\u8d2d\u7269\u8f66\u63a5\u53e3\u8bf7\u6c42\u5931\u8d25";return r(e)})}},add:function(e,t){var n=this,i=Number(e.amount);n.validator.check(i)&&(I.getTrackId.trackId?(e.trackId=I.getTrackId.trackId,this.addCart(e,t)):I.getTrackId(function(i){I.getTrackId.trackId=i,e.trackId=I.getTrackId.trackId,n.addCart(e,t)}))}},{ATTRS:{validator:{setter:function(e){this.validator=e}}},hasCart:function(){var e=m.getSkuConfig();return e.cart},getTrackId:function(t){u.info("Get track id");var n=m.getSkuConfig();if(n.valCartInfo&&n.valCartInfo.ct)return t(n.valCartInfo.ct);var i=h.get("t");if(-1===location.hostname.indexOf("taobao.com")&&-1===location.hostname.indexOf("taobao.net")&&n.apiGetTrackID){var o=n.apiGetTrackID,r=a(o,"varName=TB.Detail.TrackID&t="+e.now());u.info("Get track id request %s",r),c(r,function(){return"undefined"==typeof TB.Detail.TrackID?t(i):(t(TB.Detail.TrackID.ct),TB.Detail.TrackID=null,void delete TB.Detail.TrackID)},function(){t(i)})}else t(i)},getItemId:function(){return m.getSkuConfig().valCartInfo.itemId}}),T=new I;return y.on("cart:add",function(e){f(function(){e.sourceTime=+new Date,T.set("validator",e.validator),T.add(e,e.success)})}),{init:function(e){d=e}}}),KISSY.add("item-detail/cart/index",["log","../gl/","../config/","./add","cookie","dom","event","node"],function(e,t){var n,i,a=t("log").getLogger("cart"),o=t("../gl/"),r=t("../config/"),s=t("./add"),c=(t("cookie"),t("dom")),d=t("event"),l=t("node").all,u=l("body"),f=u,m=(r.getTaobaoHost(),"click"),g="mouseenter",p="mouseleave",h="mouseover",v=200,b={},y="tb-disabled",k=".J_LinkAdd",_="#J_juValid";u.on("cart:button",function(e){var t=e.content,n=e.disabled,i=e.hidden,o=e.cls,r=l(k,_);try{n===!0?r.addClass(y):n===!1&&r.removeClass(y),t&&r.html(t),i===!0?r.hide():i===!1&&r.show(),o&&r.addClass(o)}catch(s){a.warn("Button modify error")}}),u.on("cart:add:jump",function(t){var n=(r.isDaily?"//cart.daily.taobao.net":"//cart.taobao.com")+"/add_cart_succeed.htm?_input_charset="+document.charset,i=encodeURIComponent;try{var t={itemId:r.getGlobalConfig("itemId"),sellerId:r.getGlobalConfig("sellerId"),shopId:r.getGlobalConfig("shopId"),sellerNick:i(r.getGlobalConfig("sellerNick")),shopName:i(r.getGlobalConfig("shopName")),itemPic:r.getItemConfig("pic"),skuId:t.skuId||"",cartCount:t.cartQuantity,itemCount:t.amount,price:r.getPrice(),sourceTime:t.sourceTime,title:i(r.getTitle())}}catch(a){}var o=l("<form/>").attr({name:"cartJump",action:n,method:"post"});e.each(t,function(e,t){if(e){var n=l("<input>").attr({name:t,value:e,type:"hidden"});o.append(n)}}),f.append(o),o[0].submit()});var w=function(){var e=c.create('<div class="tb-msg tb-hidden"></div>'),t=c.create('<p class="tb-stop">\u53d1\u751f\u9519\u8bef</p>'),n=c.get(".tb-action");return n&&(e.appendChild(t),n.parentNode.insertBefore(e,n)),function(n,i){c[i?"addClass":"removeClass"](e,"tb-hidden"),i||(t.innerHTML=n)}}();u.on("cart:click",function(){var e,t;u.fire("sku:validate",{alert:!0,confirmBtn:"J_LinkAdd",success:function(){var n=r.getAmount();r.hasSku()?(e=2,t=r.getSkuId()):(e=1,t=r.getItemId()),u.fire("cart:add",{skuId:t,amount:n,success:function(i){i.amount=n,2==e&&(i.skuId=t),u.fire("cart:add:jump",i)},validator:{showError:function(e){w(e)},check:function(){return!0}}})},error:function(){u.fire("config:set",{key:"lastValidator",value:"cart"})}})});var C=function(e){e&&e.preventDefault(),o("5.0.0"),u.fire("cart:click")},S={init:function(e){i=e,(b=r.getSkuConfig())&&(s.init(e),this.bind())},bind:function(){var t=c.get("#J_LinkAdd");u.on("cart:add:success",function(e){try{TB.Global.setCartNum(e.quantity)}catch(t){a.warn("setCartNum error")}}),u.on("cart:popup:show",function(){u.fire("relatemarket:show")}),t?(d.on(t,g,function(){n=e.later(function(){u.fire("sku:validate")},v)}),d.on(t,p,function(){n&&n.cancel()}),d.on(t,m,C)):(d.on("#detail",m,function(e){var t=e.target;"b"===t.tagName.toLowerCase()&&(t=c.parent(t,".J_LinkAdd")),!c.hasClass(t,"J_LinkAdd")&&!c.hasClass(t.parentNode,"J_LinkAdd")||c.hasClass(t,"tb-disabled")||C(e)}),d.on("#detail","mouseover mouseout",function(t){if(b.isTripItem)return!1;var i=t.target,a=t.type,o=t.relatedTarget;"b"===i.tagName.toLowerCase()&&(i=c.parent(i,".J_LinkAdd")),c.hasClass(i,"J_LinkAdd")&&!c.hasClass(i,"tb-disabled")&&(h===a?(n&&n.cancel(),n=e.later(function(){u.fire("sku:validate")},v)):o==i||c.parent(o,".J_LinkAdd")||n&&n.cancel())}))}};return S}),KISSY.add("item-detail/promotion/index",["log","../config/","node","base","xtemplate"],function(e,t,n,i){var a=t("log").getLogger("promotion"),o=t("../config/"),r=t("node"),s=t("base"),c=t("xtemplate"),d=r.all,l=d("body"),u=s.extend({init:function(e){{var t=this,n=t.get("$ju");t.get("$defPrice")}if(e)if(t.set("promoData",e),e.notAvailable)t.onError(),n.removeClass(),n.html(e.notAvailable);else{var i=o.getSkuFlag()||"def";t.renderSku(i)}},renderSku:function(e){var t=this,n=t.get("promoData");if(n){var i=n[e];if(i&&i.length){t.set("skuData",i);try{t.render()}catch(o){a.warn("Render failed: %s",o.message)}}}},render:function(){var e=this,t=e.get("init"),n=e.get("skuData"),i=e.get("$hd"),a=e.get("$meta"),o=(e.get("$defPrice"),e.get("$promoWrap"));if(n&&n.length&&i.length){var r=n[0],s=n.slice(1);if(e.set("firstPromo",r),e.set("otherPromo",s),t){var d=e.get("$price"),u=e.get("$promoType"),f=e.get("$promoTips"),m=e.get("$promoInfo");d.text(e.getPromoPrice(r)),u.html(r.type||""),f.html(r.wenan||""),m.html(e.getPromoInfo(r))}else{if(!r)return void e.onError();a.addClass("tb-promo-meta"),l.fire("price:update",{id:"origin",style:"del",lock:!0}),o.removeClass("tb-hidden"),c.addCommand("promoPrice",function(t){return e.getPromoPrice(t.data)}),c.addCommand("promoInfo",function(t){return e.getPromoInfo(t.data)}),e.renderHd(r),e.bind()}e.renderBd(s),
e.validate()}},renderHd:function(t){var n=this,i=n.get("$hd"),a=n.get("tpl");i.html(new c(a.hd).render({firstPromo:e.mix(t,{ignoreRange:!0})}))},renderBd:function(e){var t=this,n=t.get("$bd"),i=t.get("tpl");n.html(new c(i.bd).render({otherPromo:e}))},validate:function(){var e=this,t=e.get("$hd"),n=e.get("$add"),i=e.get("$form"),a=e.get("$price"),o=(e.get("$defPrice"),e.get("$promoMore")),r=e.get("$promoInfo"),s=e.get("firstPromo"),c=e.get("otherPromo");s.wenan?t.addClass("tb-promo-no-login"):(t.removeClass("tb-promo-no-login"),l.fire("promo:price",{price:a.text()})),""!==r.html()?r.show():r.hide(),c&&c.length?o.show():o.hide(),s.channelkey&&!i[0].channelkey&&i.append('<input type="hidden" name="channelkey" value="'+s.channelkey+'"/>');var d=s.amountRestriction,u=s.isStart,f=s.limitTime;d&&"false"===u&&f?(l.fire("price:update",{id:"origin",style:"del",lock:!0}),a.parent().addClass("tb-promo-no-start")):(l.fire("price:update",{id:"origin",style:"bright"}),a.parent().removeClass("tb-promo-no-start")),"true"===s.cart?n.show():n.hide(),l.fire("promo:after")},bind:function(){var e=this,t=e.get("$promoWrap"),n=e.get("$bd"),i=e.get("$promoMore"),a=i.one("i");i.on("click",function(){var e=25,o=i.offset().top-t.offset().top,r=e+o;n.css("top",r+"px"),n.slideToggle(.1,function(){a.toggleClass("tb-arrow-up")})})},getPromoPrice:function(e){var t=e.price,n=e.priceRange,i=e.ignoreRange,a=e.currentRange;return!i&&a?a:t||n&&n.low+"-"+n.high||""},getPromoInfo:function(e){var t=this,n=t.get("tpl");return new c(n.ft).render({promo:e})},onError:function(){var e=this,t=(e.get("$defPrice"),e.get("$promoWrap"));l.fire("price:update",{id:"origin",style:"bright"}),t.hide()}},{ATTRS:{$meta:{value:d(".tb-meta")},$el:{value:d("#J_Promo")},$hd:{value:d("#J_PromoHd")},$bd:{value:d("#J_PromoBd")},$ju:{value:d("#J_juValid")},$add:{value:d(".tb-btn-add","#J_juValid")},$form:{value:d("#J_FrmBid")},$price:{getter:function(){return d("#J_PromoPriceNum")}},$defPrice:{value:d("#J_StrPrice")},$promoWrap:{value:d("#J_PromoPrice")},$promoType:{getter:function(){return d("#J_PromoType")}},$promoTips:{getter:function(){return d("#J_PromoTips")}},$promoMore:{getter:function(){return d("#J_PromoMore")}},$promoInfo:{getter:function(){return d("#J_PromoInfo")}},tpl:{value:{hd:["{{#firstPromo}}",'<div class="tb-promo-item-bd">','<strong class="tb-promo-price">','<em class="tb-rmb">&yen;</em>','<em id="J_PromoPriceNum" class="tb-rmb-num">',"{{#promoPrice}}{{firstPromo}}{{/promoPrice}}","</em>","</strong>",'<span id="J_PromoType" class="tb-promo-type">{{type}}</span>','<a id="J_PromoMore" class="tb-promo-more" href="javascript:;">','<i class="tb-arrow-roll">',"<em></em>","<span></span>","</i>","</a>",'<span id="J_PromoTips" class="tb-promo-tips">{{{wenan}}}</span>',"</div>",'<div class="tb-promo-item-ft">',"{{#promoInfo}}{{firstPromo}}{{/promoInfo}}","</div>","{{/firstPromo}}"].join(""),bd:["<ul>","{{#otherPromo}}",'<li class="tb-promo-item{{#if wenan}} tb-promo-no-login{{/if}}">','<div class="tb-promo-item-l">','<span class="tb-promo-price">','<em class="tb-rmb">&yen;</em>',"{{#promoPrice}}{{this}}{{/promoPrice}}","</span>",'<span class="tb-promo-type">{{type}}</span>',"</div>",'<div class="tb-promo-item-r">','<span class="tb-promo-tips">{{{wenan}}}</span>','<span class="tb-promo-info">{{add}}{{gift}}{{limitTime}}</span>',"</div>","</li>","{{/otherPromo}}","</ul>","<p>\u4ee5\u4e0a\u4ef7\u683c\u53ef\u5728\u4ed8\u6b3e\u65f6\u9009\u62e9\u4eab\u7528</p>"].join(""),ft:["{{#promo}}","{{#if vipPrices}}",'<div id="J_PromoInfo" class="tb-promo-info tb-promo-vip-info">',"<ul>","{{#vipPrices}}","<li>","{{#if xindex===0}}","<p>V1-V3</p>","{{else}}","{{#if xindex===1}}","<p>V4-V5</p>","{{else}}","<p>V6</p>","{{/if}}","{{/if}}","<p>",'<em class="tb-rmb">&yen;</em>',"{{this}}","</p>","</li>","{{/vipPrices}}","</ul>","</div>","{{else}}",'<div id="J_PromoInfo" class="tb-promo-info">',"{{add}}{{gift}}{{limitTime}}","</div>","{{/if}}","{{/promo}}"].join("")}},init:{value:!1},skuData:{},promoData:{},firstPromo:{},otherPromo:{}}}),f=new u;l.on("core:error",function(){f.onError()}),l.on("sku:selected",function(e){f.renderSku(e.flag)}),i.exports=f}),KISSY.add("item-detail/oneclick/index",["../gl/","node","base","../domain/"],function(e,t){var n=t("../gl/"),i=t("node"),a=t("base"),o=i.all,r=o("body"),s=t("../domain/");return a.extend({initializer:function(){var t=this,n=t.get("opts");n&&n.show&&e.use("oneclick/launcher.css",function(){t.render(),t.bind()})},render:function(){var e=this,t=e.get("tpl"),n=e.get("opts"),i=e.get("realEnable"),a=o("#J_isku");a.append(t),i&&(r.fire("buy:button",{content:"\u4e00\u952e\u8d2d\u4e70",cls:"J_LinkBuyOneClick"}),r.fire("buy:params",{params:function(){return{encryptString:n&&n.encryptString}}}))},bind:function(){var t=o("#J_OneClick");t.delegate("click",".J_GoOneClick",function(t){var i=o(t.currentTarget),a=i.attr("data-mode");t.halt(),"sign"===a&&n("12.200"),"modif"===a&&n("12.201"),s.degrade(),e.use("oneclick/launcher",function(e,t){s.degrade(),t.go(a)})})},submit:function(t){var n=this,i=n.get("opts");e.use("oneclick/launcher",function(e,n){s.degrade();var a=n.newBuy();t.target=a.targetToken,t.elements.onekey.value="1",t.elements.gmtCreate.value=i.gmtCreate,t.elements.checkCodeIds.value=i.checkCodeIds,t.elements.secStrNoCCode.value=i.secStrNoCCode,t.submit()})}},{ATTRS:{tpl:{value:{enable:['<div id="J_OneClick" class="tb-oneclick">','<span class="tb-oneclick-state">\u4e00\u952e\u8d2d\u4e70\u5df2\u5f00\u542f</span>','<a href="javascript:;" class="J_GoOneClick tb-h" data-mode="modif">\u8bbe\u7f6e</a>',"</div>"].join(""),disable:['<div id="J_OneClick" class="tb-oneclick tb-oneclick-open">','<a href="javascript:;" class="J_GoOneClick tb-oneclick-state tb-h" data-mode="sign">\u5f00\u542f\u4e00\u952e\u8d2d\u4e70</a>','<a href="//www.taobao.com/go/act/oneclick.php" target="_blank">\u5e2e\u52a9</a>',"</div>"].join("")},getter:function(e){var t=this,n=t.get("enable");return n?e.enable:e.disable}},opts:{},enable:{getter:function(){var e=this,t=e.get("opts");return t&&t.enable}},realEnable:{getter:function(){var e=this,t=e.get("enable"),n=e.get("hasAddressList");return t&&n}},hasAddressList:{}}})}),KISSY.add("item-detail/sku/stock",["../gl/","node","ua","../config/"],function(e,t){var n=t("../gl/"),i=t("node").all,a=i("body"),o=t("ua"),r=t("../config/");a.on("stock:update",function(e){var t=i(r.getSkuConfig("spanStock")),n=t.parent(),a=e.show,o=Number(e.stock);if(a===!0?n.removeClass("tb-hidden"):a===!1&&n.addClass("tb-hidden"),!isNaN(o)){r.setStock(o),t.html(o);var s=r.getLimit();if(s){var c=i(".J_StockVal");o>s?(0===c.length?i('<em>(\u9650\u8d2d<span class="J_StockVal">'+s+"</span>\u4ef6)</em>").insertAfter(n):c.html(s),n.addClass("tb-hidden")):(c.length&&c.parent().remove(),c=null,n.removeClass("tb-hidden"))}}});var s=function(e){this.init(e)};return s.prototype.init=function(e){var t=this;e=e||i("#J_Stock"),t.$stock=e,t.$input=i("input",e),t.$reduce=i(".J_Reduce",e),t.$increase=i(".J_Increase",e),e.length&&(t.check(),t.bind())},s.prototype.bind=function(){var e=this,t=e.$stock,a=e.$input;a.on("valuechange",function(){e.check()}),t.delegate("click","a",function(t){var o=i(t.currentTarget),r=parseInt(a.val());t.halt(),o.data("data-disable")||(r?o.hasClass("J_Increase")?e.roll("up",r,function(){a.val(r+1),n("14.0"),e.check()}):e.roll("down",r,function(){a.val(r-1),n("14.1"),e.check()}):a.val(1))})},s.prototype.check=function(){var t=this,n=t.$input,i=t.$reduce,o=t.$increase,s=n.val(),c=Number(s),d=Number(r.getStockLimit());s&&!c&&e.isNumber(c)&&(c=1,n.val(c)),1>c&&(c=1),c-1===0?i.data("data-disable",!0).addClass("tb-disable-reduce"):i.data("data-disable",!1).removeClass("tb-disable-reduce"),c>=99999999&&(c=99999999,n.val(c)),c>=d?o.data("data-disable",!0).addClass("tb-disable-increase"):o.data("data-disable",!1).removeClass("tb-disable-increase"),a.fire("sku:validate",{stock:!0,error:function(){n.fire("focus"),setTimeout(function(){n.fire("select")},50)}}),a.fire("quantity:changed",{quantity:c})},s.prototype.roll=function(e,t,n){var a,r,s,c=this,d="",l=c.$stock,u=function(e,t,n){var i="";e+="",i+='<span id="'+t+'" class="'+n+'">';for(var a=0;a<e.length;a++)i+="<span>"+e[a]+"</span>";return i+="</span>"};if("up"===e?(a=t+1,r=-25,s="J_StockNumUp"):(a=t-1,r=25,s="J_StockNumDown"),o.ie&&o.ie<8)return void n();d+=u(t,"J_StockNum","tb-stock-num"),d+=u(a,s,"tb-stock-num tb-stock-num-"+e),l.append(d);var f=i("#J_StockNum"),m=i("#"+s);f.last("span").animate({top:r,opacity:.5},{duration:.1,complete:function(){f.remove()}}),m.last("span").animate({top:r,opacity:1},{duration:.1,complete:function(){m.remove(),n&&n()}})},s}),KISSY.add("item-detail/core/index",["log","../gl/","../promotion/","../logistic/","../oneclick/","../stockinfo/","../sku/stock","../config/","node"],function(e,t){function n(){a();try{l.info("Init dynamic stock"),s()}catch(e){l.warn("Dynamic stock execution failed: %s",e.message)}try{l.info("Init postage fee"),o()}catch(e){l.warn("Postage fee execution failed: %s",e.message)}try{l.info("Init stock info"),v.getChannelStock()||p.update(!0)}catch(e){l.warn("Stock info execution failed: %s",e.message)}try{l.info("Init promo data"),v.isMS||v.isPM||r()}catch(e){l.warn("Promo data execution failed: %s",e.message)}try{l.info("Init stock widget"),new h}catch(e){l.warn("Stock widget execution failed: %s",e.message)}y.fire("core:ready")}function i(){c(),new h,y.fire("core:error")}function a(){var e=v.getDefPrice();e&&y.fire("price:update",{id:"origin",price:e})}function o(){function e(){var e=b("#J_SepLine");e.length&&e.css({borderBottom:"none"})}function t(e){y.fire("config:set",{key:"deliveryId",value:e}),v.getChannelStock()||p.request({code:e})}var n=g_config.PostageFee,i=g_config.DeliveryFee,a=n&&n.postage,o=a&&a.postageType;if(i&&"setupService"!==o){l.info("Render delivery fee");var r=new m,s=new g({opts:g_config.Oneclick,hasAddressList:r.hasAddressList()});if(y.fire("buy:impl",{name:"oneclick",submit:function(e){s&&(u("12.229"),s.submit(e))},available:function(){return s.get("realEnable")}}),r.hasAddressList())r.set({tpl:['<div class="tb-wl-wrap tb-clearfix">','<span class="tb-wl-txt tb-property-type">\u7269\u6d41</span>','<div id="J_WLInfo" class="tb-wl-ops"></div>',"</div>"].join(""),renderTo:"#J_isku .tb-amount",renderId:"J_WLInfo",changeAnyInfo:function(e){var n=e.addressData,i=n.userArea.id.split("_"),a=i[0];t(a)}});else{var c=['<div class="tb-logistic tb-clearfix">','<span class="tb-name tb-property-type">\u914d\u9001</span>','<div id="J_LogisticInfo" class="tb-logistic-info"></div>',"</div>"].join("");r.set({tpl:c,renderTo:".tb-meta",renderId:"J_LogisticInfo",changeAnyInfo:function(e){var n=e.addressData,i=n.userArea&&n.userArea.id,a=n.userCity&&n.userCity.id,o=i||a;t(o)}})}r.init()}else n?(l.info("Render postage fee"),k.fire("item:info:logistic",n.postage||{}),n.postage&&n.postage.cityId&&y.fire("config:set",{key:"defaultDeliveryId",value:n.postage.cityId})):v.isMS||v.isPM?(l.info("Miaosha or Paimai has no logistic data"),e()):(l.info("DeliveryFee and PostageFee is all null"),e())}function r(){try{f.init(v.getPromoMap())}catch(e){l.warn("Promotion init failed: %s",e.message)}}function s(){var e=g_config.DynamicStock,t=Hub.config.get("sku"),n=t.valItemInfo,i=n.skuMap;if(!e||!e.stock||i&&!e.sku)return c();var a=e.stock,o=e.sku,r={};y.fire("stock:update",{stock:a}),b(".J_ItemStock").html(a);try{g_config.idata.item.virtQuantity=e.virtQuantity,g_config.idata.item.holdQuantity=e.holdQuantity}catch(s){}if(o&&i){for(var d in i){var l=i[d],u=o[d];if(u&&u.stock){for(var f=d.split(";"),m=1,g=f.length-1;m!==g;)r[f[m]]=1,++m;l.oversold=u.oversold,l.stock=u.stock}else delete i[d]}n.carList||b("#J_isku li").each(function(){var e=b(this),t=e.attr("data-value");!t||r[t]||e.hasClass("J_Virtual")||e.remove()}),y.fire("sku:property:ready")}y.fire("stock:ready")}function c(){g_config.asyncStock&&Hub.config.get("sku").valItemInfo.skuMap&&y.fire("sku:property:ready"),y.fire("stock:ready")}function d(){y.fire("resource:sib",{success:n,error:i})}var l=t("log").getLogger("core"),u=t("../gl/"),f=t("../promotion/"),m=t("../logistic/"),g=t("../oneclick/"),p=t("../stockinfo/"),h=t("../sku/stock"),v=t("../config/"),b=t("node").all,y=b("body"),k=DT.Messenger;return{init:d}}),KISSY.add("item-detail/sku/validator",["log","dom","event","node","../config/","../stockinfo/","../oversold/"],function(e,t){var n,i,a=t("log").getLogger("sku"),o=t("dom"),r=t("event"),s=t("node").all,c=s("body"),d=t("../config/"),l=d.getSkuConfig,u=t("../stockinfo/"),f=t("../oversold/"),m="",g="click",p="mouseenter",h={},v=200,b=[],y=function(e){var t=o.create('<p class="tb-stop">\u8bf7\u7a0d\u540e\u91cd\u8bd5</p>'),n=o.create('<div class="tb-msg tb-hidden"></div>'),i=o.get(d.isMS?"#J_SecKill":".tb-action");return i?(n.appendChild(t),o.insertBefore(n,i),(y=function(e){return e&&(t.innerHTML=e),n})(e)):!1},k=function(t,n,i){var a,r=o.get(".tb-key","#detail"),s=o.get("#J_SureContinue"),c=o.get(".tb-choice","#J_SureSKU");return i?(o.html(c,i),void o.addClass(r,"tb-attention tb-incomplete")):(o.html(c,"\u8bf7\u52fe\u9009\u60a8\u8981\u7684\u5546\u54c1\u4fe1\u606f\uff01"),void(r&&s&&(a=o.query(".J_Prop",r),t?(o.addClass(r,"tb-attention tb-incomplete"),n&&o.addClass(s,n),e.each(a,function(n,i){var r=o.attr(a[i],"data-rel");e.indexOf(i,t)>-1?r?o.addClass("#"+r,"tb-error-prop"):o.addClass(a[i],"tb-error-prop"):r?o.removeClass("#"+r,"tb-error-prop"):o.removeClass(a[i],"tb-error-prop")})):(o.removeClass(r,"tb-attention"),o.removeClass(a,"tb-error-prop"),o.attr(s,"class","")))))},_=[],w=[],C=function(t,n,i){function a(){if(!d.hasSku())return!0;if(t=t||!1,!n){var e,a=[],o=[],r=[];if(b.length)for(e=g-1;e>=0;e--){var s=b[e];m===s.pvid?(r.push(e),o.push(s.prop)):a.unshift(s.prop+":"+s.name)}var c=o.length}return c>0?(t&&!n&&k(r,i),!1):(h.skuInfo=a,!0)}function r(){var e=m,t=d.getStock(),n=d.getAmount(),i=d.getLimit();switch(!0){case!0===f.isOver:e="\u5df2\u62cd\u5b8c, \u4f46\u8fd8\u6709\u4eba\u672a\u4ed8\u6b3e, \u5f85\u4f1a\u513f\u6765\u770b\u770b!";break;case d.hasSku()&&u.isNoStock():e="\u8be5\u5b9d\u8d1d\u5728\u60a8\u6240\u9009\u5730\u533a\u6682\u65e0\u5e93\u5b58\uff01",c.fire("stock:update",{show:!1}),s("#J_isku dl.J_Prop").hide(),s("#J_TMySize").hide(),c.fire("buy:button",{disabled:!0}),c.fire("cart:button",{disabled:!0});break;case!1===/^\d+$/.test(h.iptAmount.value)||0>=n:e="\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5b9d\u8d1d\u6570\u91cf\uff01";break;case n>t:e=d.isJU?"\u805a\u5212\u7b97\u7279\u4ef7\u5546\u54c1, \u6bcf\u4eba\u9650\u8d2d"+t+"\u4ef6":"\u60a8\u6240\u586b\u5199\u7684\u5b9d\u8d1d\u6570\u91cf\u8d85\u8fc7\u5e93\u5b58\uff01";break;case i>0&&n>i:e="\u60a8\u6240\u586b\u5199\u7684\u5b9d\u8d1d\u6570\u91cf\u8d85\u8fc7\u9650\u8d2d\u6570\u91cf\uff01"}for(var a=0,r=w.length;r>a;a++){var l=w[a],g=l.call();g&&(e=g)}return e&&m!==e?(o.removeClass(y(e),"tb-hidden"),!1):!0}function l(){for(var e=0,n=_.length;n>e;e++){var i=_[e],a=i.call();if(a)return t&&o.removeClass(y(a),"tb-hidden"),!1}return!0}var g=h.elmProps&&h.elmProps.length||0,p=!e.some([a,r,l],function(e){return!e()});return p&&o.addClass(y(),"tb-hidden"),p};return{init:function(t){if(i=t,h=l(),!h.iptAmount)return void a.info("Input amount is null");var s=this;if(c.on("sku:validate",function(e){C(e.alert,e.stock,e.confirmBtn)?e.success&&e.success():e.error&&e.error()}),c.on("validator:register",function(t){var n=t.rule;if(!e.isFunction(n))throw"Validator rule is not a function: "+n;"stock"==t.group?w.push(n):_.push(n)}),r.on("#detail","mouseover mouseout",function(t){var i=t.target,a=t.type,r=t.relatedTarget;o.hasClass(i,"J_LinkBuy")&&!h.isTripItem&&("mouseover"==a?(n&&n.cancel(),n=e.later(function(){C()},v)):r!=i&&o.parent(r,".J_LinkBuy")&&n&&n.cancel())}),h=l())if(d.hasSku()){var u=o.get("#J_SureSKU");u&&(r.on(u,g,function(e){var t=e.target;o.hasClass(t,"J_Close")&&k()}),c.on("sku:ready",function(e){b=e.props}),c.on("sku:selectionChanged",function(e){var t=e.sku,n=t.els;b=e.props;var i=n&&n.length===h.elmProps.length,a=o.get(".tb-key","#detail"),r=!h.form.fuwu_option||h.form.fuwu_option&&"-1"!==h.form.fuwu_option.value;i&&r?o.removeClass(a,"tb-incomplete"):o.addClass(a,"tb-incomplete")}))}else s.bind()},bind:function(){var t=o.get("#J_LinkBuy");t&&r.on(t,"mouseenter mouseleave",function(t){n&&n.cancel(),t.type===p&&(n=e.later(function(){c.fire("sku:validate")},v))})}}}),KISSY.add("item-detail/sku/index",["log","dom","event","../login/","node","../config/","../prepayprice/","../sizepicker/","../logistic/","../transit/","../serviceitems/","../onsitesetup/","../oversold/","../cart/","../core/","./validator"],function(e,t){var n=(t("log").getLogger("sku"),t("dom")),i=(t("event"),t("../login/"),t("node").all),a=i("body"),o=t("../config/"),r=o.getSkuConfig,s=t("../prepayprice/"),c=t("../sizepicker/"),d=(t("../logistic/"),t("../transit/")),l=t("../serviceitems/"),u=t("../onsitesetup/"),f=(t("../oversold/"),t("../cart/")),m=t("../core/"),g=t("./validator");e.mix(DT,{mods:{SKU:{}}});var p=DT.mods.SKU,h=document,v=(h.body,function(){var t,i={},o=0,s=function(){o=i.elmProps.length;var t=i.valItemInfo.skuMap,r=i.valItemInfo.defSelected;!function(){var n=g_config.vdata,i=g_config.idata.item.dbst,a=n.sys.now,o=n.ms;if(o){var r=o.skuList;i>=a||parseInt(o.stock,10)<=0||!o.sku||e.each(t,function(e,n){r[e.skuId]?t[n].stock=r[e.skuId]:delete t[n]})}}();var s=e.unparam(location.search.replace(/\?/gi,""));s.sku&&(r=s.sku.split(";"));var c="";a.on("sku:ready",function(){a.on("auto:change",function(e){var t=n.parent(e.trigger),i=c.split(";");i.push(n.attr(t,"data-value")),a.fire("sku:set",{pvs:i.join(";")})})}),a.on("sku:found sku:changed",function(e){var t=e.sku,n=t.skuId,o=";"+t.pvs+";";i.skuId=n,i.skuFlag=o,a.fire("sku:selected",{sku:t,flag:o})}),a.on("sku:lost",function(){i.skuId=null,i.skuFlag=null,a.fire("sku:unselected")}),a.on("sku:selectionChanged",function(e){var t=e.sku,n=t.els,a=t.pvs;c=a;var r=n&&n.length===o;i.skuSelected=r})};return{init:function(){i=r(),t=this,g_config.asyncStock?a.on("sku:property:ready",s):s(),a.on("sku:defSelected:update",function(e){i.valItemInfo.defSelected=e.data,s()})}}}());return Hub.add({name:"sku",instance:{getConfig:r}}),{init:function(){var e=r();g.init(p),e.cart&&f.init(p),s.init(),o.hasSku()&&"undefined"!=typeof e.elmProps&&0<e.elmProps.length&&v.init(),u.init(p),m.init(p),d.init(p),1===e.expanded&&n.addClass("#bd","expanded"),c.init(),new l({formEl:e.form})}}}),KISSY.add("item-detail/counter/index",["log","../config/","node","io"],function(S,require){function cutNum(num,len){return num>eval("1e"+len)-1?num.toString().substr(0,len-2)+"...":num}var logger=require("log").getLogger("counter"),Config=require("../config/"),$=require("node").all,IO=require("io"),emitter=$("body"),CONFIG=g_config,ID_ITEM=Config.getItemId(),API_COUNTER=Config.getGlobalConfig("counterApi"),API_RATE_COUNTER=Config.getGlobalConfig("rateCounterApi"),Counter=function(){};return Counter.prototype.init=function(){var e=this;API_COUNTER&&IO.jsonp(API_COUNTER,function(t){S.isPlainObject(t)?e.setFavCount(t):logger.warn("Expect fav data is object")}),API_RATE_COUNTER?IO.jsonp(API_RATE_COUNTER,function(t){e.setRateCount(t)}):($(".J_ReviewsCount").hide(),$(".tb-rate-counter").hide()),emitter.on("info:quantity",function(t){e.setSellCount(t)})},Counter.prototype.setCount=function(e,t){var n=$("#"+e);t?n.html(t):n.addClass("tb-zero").html("0")},Counter.prototype.setFavCount=function(e){var t=$("#J_Social"),n=$(".J_FavCount",t),i=parseInt(e["ICCP_1_"+ID_ITEM],10);i>0&&1e6>i&&n.html(" ("+cutNum(i,5)+"\u4eba\u6c14)")},Counter.prototype.setRateCount=function(e){var t=this,n=e["ICE_3_feedcount-"+ID_ITEM];t.setCount("J_RateCounter",n),$(".J_ReviewsCount").text(n)},Counter.prototype.setSellCount=function(e){var t=this,n=e.interval||30,i=e.quanity,a=e.confirmGoods,o=$("#J_SellCounter");o.length&&(null!=i&&o.parent().attr({title:(null!=i?n+"\u5929\u5185\u5df2\u552e\u51fa"+i+"\u4ef6":"")+(null!=a?"\uff0c\u5176\u4e2d\u4ea4\u6613\u6210\u529f"+a+"\u4ef6":"")}),null==a?$(".tb-sell-counter").hide():t.setCount("J_SellCounter",a));var r=$(".J_TDealCount","#J_TabBar");null==i?r.hide():r.text(i)},new Counter}),KISSY.add("item-detail/info/index",["log","io","node","../config/"],function(e,t){function n(t){var n=d.ifqUrlNew;if(n){t=t.data;var o=t.tradeQuantity;t.quantity={},t.quantity.interval=o.intervalDays,t.quantity.quanity=o.totalItems,t.quantity.confirmGoods=o.confirmGoodsItems,t.quantity.paySuccess=o.paySuccessItems,t.quantity.paySuccessItems=o.paySuccessRecords,t.quantity.confirmGoodsItems=o.confirmGoodsRecords,t.quantity.refundCount=o.refundSuccessRecords,t.quantity.filterRecords=o.filterRecords,t.showVideo=g_config.showVideo}"sm"===t.rgv587_flag?(a.info("Ifq Request Data_sufei"),e.use("sd/data_sufei/index,sd/data_sufei/css/taobao.css",function(e,n){new n({data:t,ioConfig:i,dialogConfig:{prefixCls:"sufei-tb-",headerContent:"\u8bbf\u95ee\u9a8c\u8bc1",zIndex:"99999999"},style:"taobao"})})):(a.info("Ifq success"),s.fire("info:quantity",t.quantity),t.videoInfo&&s.fire("info:shortVideo",t.videoInfo),t.showVideo&&t.showVideo===!0&&e.later(function(){s.fire("info:playVideo")},4e3))}var i,a=t("log").getLogger("info"),o=t("io"),r=t("node").all,s=r("body"),c=t("../config/"),d=c.getSkuConfig(),l=function(){var e=d.apiItemInfo;return e?(a.info("Request from %s",e),void o(i={type:"get",url:e,success:n,error:function(e,t){a.error("Request %s",t)},dataType:"jsonp",timeout:6,cache:!0})):n({})};return{init:l}}),KISSY.add("item-detail/ms/index",["node","../config/","log"],function(e,t){var n=t("node"),i=n.all,a=i("body"),o=t("../config/"),r=t("log").getLogger("ms"),s={init:function(){e.use("seckill",{success:function(e,t){try{a.fire("price:update",{id:"origin",style:"del",lock:!0}),a.fire("validator:register",{group:"stock",rule:function(){var e=o.getMSLimit(),t=o.getAmount();return t>e?"\u79d2\u6740\u5546\u54c1, \u6bcf\u4eba\u9650\u8d2d"+e+"\u4ef6":!1}});var n={};a.fire("buy:params",{params:function(){return n}});var s=i(".tb-ms-price .tb-rmb-num");s.length&&a.on("sku:found sku:changed",function(e){var t=e.sku;t.tkaPrice&&s.html(t.tkaPrice.toFixed(2))}),i(".tb-meta").after('<div class="tb-logistic tb-ms-logistic tb-clearfix"><span class="tb-name tb-property-type">\u914d\u9001</span><div class="tb-logistic-info">\u5356\u5bb6\u627f\u62c5\u8fd0\u8d39</div></div>'),t.init({container:"#J_SecKill",skuEl:"#J_isku",params:{status:o.getItemConfig("status"),dbst:o.getItemConfig("dbst"),lgin:o.getBuyerConfig("lgin"),token:o.getToken(),now:o.getNow(),isSKU:o.hasSku(),stock:o.getDynamicStock(),snapupConfig:o.getMSConfig(),autoRefresh:o.getToggleConfig("msRefresh")},getSkuId:function(){return o.getSkuId()},getAmount:function(){return o.getAmount()},submit:function(e){a.fire("sku:validate",{stock:!0,success:function(){n={answer:e.answer,secKillEncryptStr:e.sign},n[e.extra.name]=e.extra.value,a.fire("buy:submit")}})}})}catch(c){r.warn("Init failed: %s",c.message)}},error:function(e){r.warn("Component load failed: %s",e.message)}})}};o.isMS&&a.fire("resource:sib",{success:function(){s.init()}})}),KISSY.add("item-detail/channelstock/index",["node","../config/"],function(e,t){var n=t("node"),i=n.all,a=t("../config/"),o=i("body");return{init:function(){o.fire("resource:sib",{success:function(){a.getChannelStock()&&o.fire("validator:register",{group:"stock",rule:function(){{var e=a.getStock();a.getAmount()}return 0>=e?"\u8be5\u5b9d\u8d1d\u6682\u65e0\u4f18\u60e0\u5e93\u5b58":!1}})}})}}}),KISSY.add("item-detail/tbtoken/index",["log","dom","../config/","node"],function(e,t){function n(){var t=r.getToken(),n=/_tb_token_=[^&].*/i,i=o.query("a.J_TokenSign",document),s="_tb_token_="+t;a.info("Set fav token value: %s",t),e.each(i,function(e){var t=e.href;n.test(t)?e.href=t.replace(n,s):e.href+=(-1!==t.lastIndexOf("&")?"&":"?")+s})}function i(){var e=g_config.vdata,t=e.sys,n=e.viewer,i=n.tkn||t.tkn;a.info("Init token value: %s",i),o.get("#J_TokenField")&&(o.get("#J_TokenField").value=i),o.get("#J_frmTokenField")&&(o.get("#J_frmTokenField").value=i);var r=o.get(".collection-item");r&&(r.href+="&_tb_token_="+i);for(var s=[".xshop_sc",".shop-collect",".J_TDialogTrigger"],c=0;c<s.length;c++)if(r=o.query(s[c]))for(var d=0;d<r.length;d++){var l=r[d];l.href=l.href.replace("_tb_token_",""),l.href=l.href.replace("_tb_token_",""),l.href+="&_tb_token_="+i}}var a=t("log").getLogger("tbtoken"),o=t("dom"),r=t("../config/"),s=t("node").all,c=s("body");return c.on("user:info:viewer",i),{setFavToken:n}}),KISSY.add("item-detail/userinfo/index",["log","node"],function(e,t){function n(){var t=g_config,n=t.vdata,i=n.viewer,o=n.asyncViewer;t.cdn&&o&&(e.mix(i,o.viewer),a.fire("user:info:viewer",o))}var i=(t("log").getLogger("userinfo"),t("node").all),a=i("body");a.fire("resource:sib",{success:n})}),KISSY.add("item-detail/thumb/index",["log","../config/","imagezoom","dom","event","node"],function(e,t){var n,i,a,o,r,s,c,d=t("log").getLogger("thumb"),l=t("../config/"),u=t("imagezoom"),f=t("dom"),m=t("event"),g=t("node").all,p=g("body"),h=p,v="click",b="mouseenter",y="mouseleave",k="touchstart",_=f.get("#J_ImgBooth"),w=f.get("#J_UlThumb"),C=f.get(".tb-booth"),S=200,I=[],T=[],x=[],J=700,P=0,X=!l.isTouch,D="tb-selected",L="hidden",A={init:function(){if(n=this,_&&w){i=f.query("li",w),o=f.get("#J_ZoomIcon"),n.bindEvents(),6===e.UA.ie&&n.resizeHead();try{n.preloadImgs()}catch(t){d.warn("Preload images error")}}},preloadImgs:function(){c=f.create('<div style="width:0;height:0;overflow:hidden;">'),J=parseInt(_.getAttribute("data-hasZoom"),10),p.append(c);var t=_.getAttribute("data-size")||"400x400";e.each(f.query("img",w),function(e,n){var i=e.src,a=i.replace(/_\d0x\d0\.jpg(_\.webp)?$/g,"");T[n]={thumb:e,bigSrc:a},x[n]=i.replace(/_\d0x\d0/g,"_"+t)}),n.initZoom(0)},initImageZoom:function(e){if(!r){var t=400,n={imageNode:_,align:{node:_,points:["tr","tl"],offset:[10,-1]},bigImageSrc:e.src,bigImageWidth:e.width,bigImageHeight:e.height,width:t,height:t};r=new u(n)}},initZoom:function(e){return l.getToggleConfig().noThumb?void d.warn("Closed by toggle"):void(X&&n.loadZoomImage(e,function(e){var t=I[e];n.initImageZoom(t),n.setZoomIcon(e)}))},loadZoomImage:function(e,t){if(I[e])t&&t(e);else{var n=T[e],i=new Image;m.on(i,"load",function(){I[e]=i,i.width>=J&&(n.hasZoom=!0),t&&t(e)}),i.src=n.bigSrc,c.appendChild(i)}},setZoomIcon:function(e){T[e]&&T[e].hasZoom&&P===e?(n.setZoom(!0),n.showZoomIcon()):(n.setZoom(!1),n.hiddenZoomIcon())},setZoom:function(e){r&&r.set("hasZoom",e)},showZoomIcon:function(){f.removeClass(o,L)},hiddenZoomIcon:function(){f.addClass(o,L)},bindEvents:function(){m.on(w,v,function(e){e.preventDefault()}),m.on(i,k,function(e){var t=e.target;n.switchTo(t)}),m.on(i,b,function(t){s&&s.cancel();var i=t.target;s=e.later(function(){n.switchTo(i)},S)}),m.on(i,y,function(){s&&s.cancel()}),m.on(C,b,function(){T[P]&&T[P].hasZoom&&n.showImageZoom(P)}),m.on(C,y,function(){n.setZoomIcon(P)}),h.on("thumb:show",function(e){_&&w&&(_.src!==e.src&&(f.removeClass(i,D),_.src=e.src,n.setZoom(!1),n.hiddenZoomIcon(),P=null),h.fire("thumb:switch"))})},switchTo:function(t){if(t){"LI"!==t.tagName&&(t=f.parent(t,"LI"));var o=e.indexOf(t,i);P=o,f.removeClass(a||i[0],D),t=i[o],f.removeClass(a,D),f.addClass(t,D),a=t;var r=x[o];_.src!==r&&(_.src=r,n.initZoom(o)),h.fire("thumb:switch",{index:o})}},showImageZoom:function(e){if(P===e){n.hiddenZoomIcon();var t=I[e],i=x[e],a=T[e].bigSrc;r&&a&&(r.set("bigImageSrc",a),r.set("imageSrc",i),r.set("bigImageWidth",t.width),r.set("bigImageHeight",t.height),h.fire("thumb:zoom",{index:e,width:t.width}))}},refreshImageZoom:function(){r&&r.refreshRegion()},resizeHead:function(){var t=null;(t=e.get("#hd"))&&t.scrollHeight>250&&f.css(t,{height:"250px",overflow:"hidden"})}};A.init()}),KISSY.add("item-detail/contracticons/index",["log","node"],function(e,t){function n(t){var n=t,i=o("#J_ServiceIcon"),a=o("#J_ServiceIconBd"),r='<a class="J_Cont" href="{url}" target="_blank" title="{title}"><img src="{img}">{name}</a>',s="";n&&n.length&&(e.each(n,function(t){s+=e.substitute(r,t)}),a.prepend(s));var c=o("a",a);c.length&&i.show()}var i=t("log").getLogger("contracticons"),a=t("node"),o=a.all,r=o("body");return r.fire("resource:sib",{success:function(){try{n(g_config.ContractList)}catch(e){i.warn("Render contract icons failed: %s",e.message)}}}),{init:n}}),KISSY.add("item-detail/video/index",["node","ua"],function(e,t){var n=t("node").all,i=t("ua"),a=n("body"),o=function(){var e=!1;try{e=!!(navigator.mimeTypes["application/x-shockwave-flash"]||window.ActiveXObject&&new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(t){}e&&(i.ie&&i.ie<8||this.init())};o.prototype.init=function(){var e=this,t=Hub.config.get("video");t&&(e.$booth=n(".tb-booth"),e.$thumb=n("#J_UlThumb"),e.render({picUrl:t.picUrl.replace(/310x310/gi,"400x400"),domain:TB.Global.isDaily?"cloud.video.daily.taobao.net":"cloud.video.taobao.com",ownerId:t.videoOwnerId,videoId:t.videoId,autoplay:t.autoplay}),e.bind())},o.prototype.render=function(t){var i=this,a=i.$booth,o=i.$thumb,r=['<li id="J_VideoThumb" class="tb-video-thumb">','<div class="tb-pic tb-s50">','<a href="javascript:;">','<img src="{picUrl}">',"</a>","</div>",'<span class="tb-video-logo tb-iconfont">&#61465;</span>',"</li>"].join(""),s=['<div class="tb-video" style="background: url({picUrl}) center center no-repeat">','<object id="playerObject" name="playerObject" width="400px" height="400px" data="//{domain}/play/u/{ownerId}/p/{autoplay}/e/1/t/6/{videoId}.swf" type="application/x-shockwave-flash"','<param name="quality" value="high">','<param name="bgcolor" value="#FFFFFF">','<param name="wmode" value="transparent">','<param name="allowfullscreen" value="false">','<param name="allowscriptaccess" value="never">','<param name="movie" value="//{domain}/play/u/{ownerId}/p/{autoplay}/e/1/t/6/{videoId}.swf">',"</object>","</div>"].join("");i.$imageThumb=n("li",o),o.prepend(e.substitute(r,t)),i.$videoThumb=n("#J_VideoThumb"),a.append(e.substitute(s,t))},o.prototype.bind=function(){var e=this,t=e.$booth,n=e.$imageThumb,i=e.$videoThumb;i.on("mouseenter",function(){i.addClass("tb-selected"),n.removeClass("tb-selected"),t.replaceClass("tb-pic-mode","tb-video-mode")}),a.on("thumb:switch",function(){i.removeClass("tb-selected"),t.replaceClass("tb-video-mode","tb-pic-mode")}),i.fire("mouseenter")},new o}),KISSY.add("item-detail/pk/index",["node","../login/"],function(e,t){var n=t("node").all,i=t("../login/"),a=n("body");TB.Global.pkSkuId=0,a.on("sku:selected",function(e){TB.Global.pkSkuId=e.sku.skuId?e.sku.skuId:0}),n("#J_Social").after(e.all('<div id="J_SocialPkErrorInfo"></div>')),n(".J_TbPK").on("click",function(){if(TB.Global.isLogin&&!isNaN(TB.Global.util.getTag())){var t=e.all("#J_SocialPkErrorInfo");a.fire("toolbar:pk:add",{itemId:g_config.itemId,skuId:TB.Global.pkSkuId,from:2,anim:!0,trigger:e.all(".tb-social-pk"),pic:e.all("#J_UlThumb .tb-selected img").attr("src"),callback:function(n){if(!n||!n.success){var i=n&&n.error&&n.error.errorMessage?n.error.errorMessage:"\u52a0\u5165\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";e.all("#J_SocialPkErrorInfo").text(i),t.animate({display:"block"},{complete:function(){setTimeout(function(){t.animate({display:"none"},{easing:"easeOut",complete:function(){t.text("")}})},1e3)}})}}})}else i(function(){location.reload()})})}),KISSY.add("item-detail/insurance/index",["node","io","dom"],function(e,t){var n,i,a,o,r=t("node").all,s=r("body"),c=t("io"),d=t("dom"),l=function(){var e,t=Hub.config.get("sku");(e=t.apiInsurance)&&!g_config.delayInsurance&&c({type:"get",url:e,success:f,dataType:"jsonp",jsonpCallback:"jsonp_insurance",cache:!0})},u=function(e){var t=e?e.skuId:null;t&&o[t]?d.html(i,o[t]):d.html(i,a)},f=function(e){if(e.success){o=e.map,a=o.common,n='<dl class="tb-insurance tb-clearfix"><dt class="tb-property-type">\u670d\u52a1</dt><dd class="tb-insurance-content"></dd></dl>',n=d.create(n),i=d.get(".tb-insurance-content",n),d.html(i,a);var t=r("#J_isku .tb-amount");t.after(n),s.on("sku:selected",function(e){u(e.sku)}),s.on("sku:unselected",function(){u(null)})}};l()}),KISSY.add("item-detail/tags/index",["dom"],function(e,t){
function n(e){if(e){var t=['<ul class="tb-item-tags">'];for(var n in e)t.push('<li class="tb-item-tag">'),t.push(e[n]),t.push("</li>");t.push("</ul>"),t=t.join(""),t=i.create(t),i.insertBefore(t,"#J_TEditItem")}}var i=t("dom"),a=Hub.config.get("tags");a&&n(a)}),KISSY.add("item-detail/deposit/template/deposit-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+='<div class="tb-deposit-hd">\n    <p>\n        <i></i>\n        ';var u={},f=[],m=d(o,e,"ready",0,4);f.push(m),u.params=f,u.fn=function(e){var t="";t+='\n            <span>\n                \u5df2\u662f\u56e2\u8d2d\u4ef7\uff0c<em class="tb-h">';var n=l(o,e,{},"readyCount",0,6);return t+=c(n,!0),t+="</em>\u4eba\u5df2\u53c2\u56e2\uff01\n            </span>\n        "},u.inverse=function(e){var t="";t+='\n            <span>\n                <em class="tb-h">';var n=l(o,e,{},"groupNumber",0,10);t+=c(n,!0),t+="\u4eba</em>\u8d77\u56e2\uff0c";var i=l(o,e,{},"readyCount",0,10);return t+=c(i,!0),t+="\u4eba\u5df2\u53c2\u52a0\uff0c\u6682\u672a\u6210\u56e2\n            </span>\n        "},n+=s(o,e,u,"if",4),n+='\n    </p>\n</div>\n<div class="tb-deposit-bd">\n    <ul>\n        ';var g={},p=[],h=d(o,e,"stepGroups",0,17);p.push(h),g.params=p,g.fn=function(e){var t="";t+='\n            <li>\n                <p class="tb-deposit-price">\n                    <em class="tb-deposit-rmb">&yen;</em>\n                    <em class="tb-deposit-rmb-num">';var n=l(o,e,{},"price",0,21);t+=c(n,!0),t+='</em>\n                </p>\n                <p class="tb-deposit-bar';var i={},a=[],r=d(o,e,"progress",0,23);a.push(0!==r),i.params=a,i.fn=function(){var e="";return e+=" tb-deposit-bar-ready"},t+=s(o,e,i,"if",23),t+='">\n                    <i></i>\n                    <span style="width:';var u=l(o,e,{},"progress",0,25);t+=c(u,!0),t+='%"></span>\n                </p>\n                <p class="tb-deposit-count">\n                    ';var f=l(o,e,{},"number",0,28);return t+=c(f,!0),t+="\u4eba\n                </p>\n            </li>\n        "},n+=s(o,e,g,"each",17),n+='\n    </ul>\n</div>\n<div class="tb-deposit-ft">\n    \u5269\u4f59\u65f6\u95f4\uff1a<strong>';var v=l(o,e,{},"hh",0,35);n+=c(v,!0),n+="</strong> \u5c0f\u65f6 <strong>";var b=l(o,e,{},"mm",0,35);return n+=c(b,!0),n+="</strong> \u5206\n</div>\n"}}),KISSY.add("item-detail/deposit/index",["log","node","base","xtemplate/runtime","./template/deposit-xtpl"],function(e,t){var n=t("log").getLogger("deposit"),i=t("node").all,a=t("base"),o=t("xtemplate/runtime"),r=i("body"),s=t("./template/deposit-xtpl"),c=a.extend({initializer:function(){var e=this,t=e.get("data"),n=e.get("time");if(t&&n){var i=n.now,a=n.st,o=n.et;i>a&&o>i&&e.render()}},render:function(){var t=this,a=t.get("$el"),s=(t.get("$meta"),t.get("tpl")),c=t.get("api"),d=t.get("data");d.stepGroups&&d.stepGroups>0&&e.mix(d,{stepGroupsLen:d.stepGroups.length}),r.fire("price:update",{id:"origin",style:"strong"}),r.fire("price:create",{id:"deposit",name:d.promoPriceType,price:d.prePriceM}),c&&e.getScript(c,function(){var r=!1,c=TB.GroupData&&TB.GroupData.groupData,l=d.stepGroups;if(c){c>d.groupNumber?r=!0:a.addClass("tb-deposit-no-ready"),e.each(l,function(e,t){var n=l[t+1],i=0;if(n){var a=e.number,o=n.number;c>=a&&(i=Math.floor(c/o*100))}else{var a=e.number;c>=a&&(i=60)}i=i>100?100:i,e.progress=i}),d=e.merge(d,t.getLeftTime(),{ready:r,readyCount:c}),a.html(new o(s).render(d)).show();try{i(".tb-deposit-bd ul").last().children(".tb-deposit-price").addClass(".tb-deposit-last-price")}catch(u){n.warn("Exec failed: %s",u.message)}}})},getLeftTime:function(){var e=this,t=e.get("time"),n=(t.et-t.now)/36e5,i=Math.floor(n),a=Math.floor(60*(n-i));return{hh:i,mm:a}}},{ATTRS:{$el:{value:i("#J_Deposit")},$meta:{value:i(".tb-meta","#detail")},tpl:{value:s},api:{valueFn:function(){var e=Hub.config.get("sku");return e?e.bigGroupUrl:void 0}},data:{valueFn:function(){return g_config.stepGroupApi}},time:{valueFn:function(){var e=g_config.vdata.sys.now,t=g_config.idata.item.stepdata;return t?{now:e,st:t.stepGroupStart,et:t.stepGroupEnd}:void 0}}}});return c}),KISSY.add("item-detail/steppay/index",["dom","../deposit/"],function(e,t){function n(){var e=g_config.idata.item.stepdata,t=g_config.vdata.sys.now;if(!e)return!1;i.get("#J_StepPay")&&i.removeClass("#J_StepPay","tb-hidden");var n=e.stepItemStart,o=e.stepItemEnd;if(t>=1*n&&o>=t||"0"===o&&t>=n||"0"===o&&"0"===n)i.get("#J_Deposit")&&new a;else{var r=i.get("#J_listBuyerOnView");r&&i.attr(r,"data-api",i.attr(r,"data-api").replace("step=true","step=false"))}}var i=t("dom"),a=t("../deposit/");n()}),KISSY.add("item-detail/discount/goldcoin",["log","../config/","node"],function(e,t){var n=t("log").getLogger("goldcoin"),i=t("../config/"),a=t("node").all,o=g_config,r=(DT.mods.SKU,a("body")),s=a("#J_GoldCoin"),c=a("#J_OtherDiscount");return{render:function(t){if(s&&t){var n=a("<div>"+t+"</div>"),i=n.all(".tb_dashes_box");if(i.length){var o=i.text(),r=e.trim(o).replace("\u62b5\uffe5","");t="\u6dd8\u91d1\u5e01\u53ef\u62b5<strong>"+r+"</strong>\u5143"}t='<div class="tb-other-discount-content"><i class="tb-icon-coin"></i>'+t+"</div>",s.html(t),s.removeClass("tb-hidden"),c.removeClass("tb-hidden")}},init:function(){function e(e){var t,n=e||null;n&&a[n]?t=a[n]:n?a[-1]?t=a[-1]:a[-2]&&(t=a[-2]):a[-1]?t=a[-1]:a[-5]?t=a[-5]:a[-2]&&(t=a[-2]),s.render(t)}var t=o.PointData,a=o.PointDataNew,s=this;if(a&&"object"==typeof a){var c=i.getSkuId();return e(c),r.on("sku:selected",function(t){var n=t.sku.skuId;e(n)}),void r.on("sku:unselected",function(){o.PromoData&&o.PromoData.def&&0!==o.PromoData.def.length||e()})}if(t&&t.length){var d=t[0];n.info("Exist goldcoin data"),d&&(d=d.replace(/(.+?)(\d+%)/gi,function(){return arguments[1]+'<em class="tb-h"> '+arguments[2]+"</em>"}),s.render(d))}else n.info("No goldcoid data")}}}),KISSY.add("item-detail/discount/redgift",["log","../login/","../gl/","node","overlay","io"],function(e,t){var n=t("log").getLogger("redgift"),i=t("../login/"),a=t("../gl/"),o=t("node").all,r=t("overlay"),s=t("io"),c=o("#J_OtherDiscount"),d=1,l=0,u={};u[d]="coupon",u[l]="hongbao";var f=['<a class="tb-red-gift-got">\u5df2\u9886</a>','<a class="tb-red-gift-got">\u5df2\u9886\u53d6</a>','<a class="tb-red-gift-got">\u9886\u53d6\u5931\u8d25</a>'],m={lastResponse:null,receiveCoupon:function(t,n,i){var o=this;a("19940124?type="+("type"in t?t.type:"")),e.use("smf/coupon/apply",function(e,a){var r={applyChannel:22,cburl:location.protocol+"//"+location.host+o.config.cbUrl,daily:o.isDaily,showItems:!0,type:u[t.type],activityId:t.id,sellerId:o.lastResponse.basic.sellerId},s=new a(r);s.on("success",function(e,t){n&&n(t)}),s.on("fail",function(e,t){i&&i(t)})})},couponIsGot:function(e){for(var t=this,n=t.lastResponse.buyer,i=0,a=n.length;a>i;i++)if(n[i].id==e)return!0;return!1},renderRedGift:function(t){var n=this,a=n.$redGift;t=[t[0]],e.each(t,function(t){var r=n.couponIsGot(t.id),s=['<div class="tb-other-discount-content">','<i class="tb-icon-red-gift"></i>',"<em>",e.escapeHTML(t.name),"\u53ef\u62b5","<strong>",e.escapeHTML(t.value),"</strong>","\u5143&nbsp;","</em>",r?f[0]:'<a href="#" class="tb-red-gift-get J_GetRedGift">\u9886\u53d6</a>',"</div>"].join(""),c=o(s);r||c.all(".J_GetRedGift").on("click",function(e){e.preventDefault(),i(function(){n.receiveCoupon(t,function(){c.all(".J_GetRedGift").hide().after(f[0])},function(){c.all(".J_GetRedGift").hide().after(f[2])})})}),a.append(c)})},renderCoupon:function(t){function n(){o(".J_RG_Get_"+s.id).hide().after(f[0]),o(".J_RG_Get2_"+s.id).hide().after(f[1])}function i(t){var i=o(['<div class="tb-rg-popup-wrap" >','<div class="tb-rg-popup" >',"<ul></ul>","</div>","</div>"].join("")),r=i.all("ul");return e.each(t,function(t){var i=o(["<li>",'<div class="tb-rg-popup-icons" >','<em class="tb-rg-icon-coupon-wrap" ><em class="tb-rg-icon-coupon" >',e.escapeHTML(t.value),'</em><em class="tb-rg-memo" >\u6ee1',e.escapeHTML(t.startFee),"\u51cf</em></em>","</div>",'<div class="tb-rg-popup-desc" >',"\u6307\u5b9a\u5546\u54c1 \u6ee1",e.escapeHTML(t.startFee),"\u5143\u51cf",e.escapeHTML(t.value),"<br><em>",e.escapeHTML(t.start),"-",e.escapeHTML(t.end),"</em>","</div>",'<div class="tb-rg-popup-ctrl" >',a.couponIsGot(t.id)?f[1]:'<a href="#" class="tb-rg-get J_Get J_RG_Get2_'+e.escapeHTML(t.id)+'" >\u9886\u53d6</a>',"</div>","</li>"].join(""));i.all(".J_Get").on("click",function(e){e.preventDefault(),a.receiveCoupon(t,function(){t.id===s.id?n():i.all(".J_Get").hide().after(f[1])})}),r.append(i)}),i}for(var a=this,r=a.$redGift,s=t[0],c=0,d=t.length;d>c;c++){var l=t[c];if(a.couponIsGot(l.id)){s=l;break}}var u=t,m=a.couponIsGot(s.id),g=['<em class="tb-rg-icon-coupon-wrap J_Tr" ><em class="tb-rg-icon-coupon" ]>',e.escapeHTML(s.value),'</em><em class="tb-rg-memo">\u6ee1',e.escapeHTML(s.startFee),"\u51cf</em></em>",u.length>1?'<em class="tb-rg-icon-down J_Arr"></em>&nbsp;':"",e.escapeHTML(s.name),m?f[0]:'<a href="#" class="tb-rg-get J_Get J_RG_Get_'+e.escapeHTML(s.id)+'" >\u9886\u53d6</a>'].join(""),p=o(g),h=p.all(".J_Tr"),v=i(u);a.popup(h,v),m||p.all(".J_Get").on("click",function(e){e.preventDefault(),a.receiveCoupon(s,function(){n()})}),r.append(p)},popup:function(e,t,n){var i=new r.Popup({trigger:e,triggerType:"mouse",mouseDelay:.5,content:t});i.on("beforeVisibleChange",function(){i.align(e,["bl","tl"],[2,10])}),i.on("show",function(){n.all(".J_Arr").addClass("tb-rg-icon-up")}),i.on("hide",function(){n.all(".J_Arr").removeClass("tb-rg-icon-up")}),i.render()},render:function(e){var t=this,n=e.seller[0].type;n===l&&t.renderRedGift(e.seller)},init:function(){var t=Hub.config.get("sku").coupon,i=this;if(i.config=t,!t)return n.info("No coupon info");var a=t.couponApi;if(!a)return n.warn("Info url is empty");var r=t.couponWidgetDomain+"/apps/smf/utils/";i.isDaily=r.indexOf("daily")>-1,i.$redGift=o("#J_RedGift"),n.info("Request %s",a),new s({type:"get",dataType:"jsonp",url:a,success:function(t){n.info("Accept data success"),i.lastResponse=t,t.seller&&t.seller.length?(n.info("Load assets when exist redgift data"),e.getScript(r+"applyCoupon-min.css",{charset:"utf-8"}),e.getScript(r+"applyCouponWidget-min.js",{charset:"utf-8"}),t.buyer=t.buyer||[],i.render(t),c.removeClass("tb-hidden")):n.info("No redgift data")}})}};return m}),KISSY.add("item-detail/discount/index",["./goldcoin","./redgift"],function(e,t){function n(e){var t=e.el,n=e.weight,a=o.all(".tb-other-discount");if(a.length){var r=i('<div class="tb-other-discount-content"></div>');r.append(i(t)),n?a.prepend(r):a.append(r),o.removeClass("tb-hidden")}}var i=e.all,a=i("body");a.fire("resource:sib",{success:function(){var e=t("./goldcoin"),n=t("./redgift");e.init(),n.init()},error:function(){}});var o=i("#J_OtherDiscount");a.on("discount:create",function(e){n(e)})}),KISSY.add("item-detail/guideline/index",["dom","../gl/","event","ua"],function(e,t){function n(e,t){a.removeClass(i,l),a.removeClass(e,u),a.css(t,"display","none")}var i,a=t("dom"),o=t("../gl/"),r=t("event"),s=t("ua"),c="click",d="mouseleave",l="tb-payguide-show",u="tb-selected",f={init:function(){e.available("#J_PayGuide",function(){i=a.get("#J_PayGuide");var e,t,f=a.query(".J_Tab",i),m=a.query(".J_Panel",i);r.on(f,c,function(n){n.preventDefault(),e&&clearTimeout(e),t=a.attr(n.currentTarget,"data-index"),a.hasClass(n.currentTarget,u)||o("12."+(1*n.currentIndex+1)),a.hide(m),a.show(m[t]),a.removeClass(f,u),a.addClass(f[t],u),a.hasClass(i,l)||a.addClass(i,l),s.ie<8&&a.css(i.parentNode,"zoom",1)}),r.on(i,d,function(){e&&clearTimeout(e),e=setTimeout(function(){n(f[t],m[t])},500)})})}};f.init()}),KISSY.add("item-detail/sns/index",["node","dom","../gl/","event"],function(e,t){function n(e){var t={key:d,isShowFriend:!1,client_id:2,comment:"\u6211\u86ee\u559c\u6b22\u8fd9\u4e2a\u54e6\uff5e",type:"item",element:e,callback:{success:function(){}}};window.SNS.ui("btshare",t)}function i(e){var t={token:g_config.vdata.viewer.tkn,element:e,type:"item",appId:"1100102",targetKey:d,like:{anim:!1},initialize:{el:e,hoverTip:!1},share:{link:location.href,title:document.title},use:"jsonp",callback:{like:{favored:function(){s("12.39")},succeed:function(){s("12.39")}}}};window.SNS.ui("favor",t)}function a(t){if(a.loaded)return t();a.loaded=!0;var n="//"+(-1===location.host.indexOf("daily")?"assets.alicdn.com":"g-assets.daily.taobao.net")+"/p/snsdk/core2.js?t=20141212";e.getScript(n,t)}var o=t("node").all,r=t("dom"),s=t("../gl/"),c=t("event"),d=g_config.itemId,l={init:function(){e.use("io/xhr-transport-base",function(e,t){t.supportCORS=!1}),a(function(){var e=r.get(".tb-social-like","#J_Social");c.on(e,"click",function(e){e.preventDefault()}),i(e);var t=r.get(".tb-social-share","#J_Social");c.on(t,"click",function(e){e.preventDefault(),a(function(){n(t)})})})}};if(o(".tb-social-like").length)l.init();else{var u;o(".tb-social-share").on("click",function(){u?u.show():e.use("tbc/btn-share/1.0.0/",function(e,t){u=new t({shareBtnTrigger:".tb-social-share",bindEvent:!1,itemId:d,offset:[0,10]}),u.show()})})}}),KISSY.add("item-detail/header/index",["log","node","../config/"],function(e,t){function n(){i.info("Init header asserts"),e.use("header",function(e,t){new t({renderTo:r,type:o.getShopType(),item:o.getItemConfig(),shop:o.getShopConfig(),seller:o.getSellerConfig()});i.info("Render header")})}var i=t("log").getLogger("header"),a=t("node").all,o=t("../config/"),r=a("#J_Header");r.length&&n()}),KISSY.add("item-detail/shopinfo/index",["log","../config/"],function(e,t){function n(e,t){var n=window.devicePixelRatio>1,r=t?o:a,s=r[e],c=s?s[n?1:0]:s;return c?i+c:c}var i=(t("log").getLogger("shopinfo"),t("../config/"),"//gtms01.alicdn.com/tps/i1/"),a={red:["TB1.8JIFVXXXXbSXVXXFHLvIVXX-198-45.png","TB1xV8HFVXXXXbeaXXXCfnzRXXX-396-90.png"],blue:["TB1NYpMFVXXXXXsXFXXFHLvIVXX-198-45.png","TB1pR77FFXXXXXsapXXCfnzRXXX-396-90.png"],cap:["TB1f2dMFVXXXXcCXpXXFHLvIVXX-198-45.png","TB1fylOFVXXXXafXXXXCfnzRXXX-396-90.png"],crown:["TB16WBMFVXXXXcGXpXXFHLvIVXX-198-45.png","TB1KZRLFVXXXXcuXpXXCfnzRXXX-396-90.png"],"global-seller":["TB1MQiPGXXXXXbvXFXXxwHxIVXX-198-60.png","TB1gQmQGXXXXXbTXFXXTnAu0VXX-396-120.png"],"global-buyer":["TB1MQiPGXXXXXbvXFXXxwHxIVXX-198-60.png","TB1gQmQGXXXXXbTXFXXTnAu0VXX-396-120.png"],star:["TB15Y4KFVXXXXcZXFXXxwHxIVXX-198-60.png","TB1LXtNFVXXXXavXpXXTnAu0VXX-396-120.png"],agriculture:["TB1foLuGpXXXXX1XXXXxwHxIVXX-198-60.png","TB1MXbsGpXXXXaHXpXXTnAu0VXX-396-120.png"],tiaoshi:["TB1vE80GFXXXXa_aXXXxwHxIVXX-198-60.png","TB1PvPaGFXXXXXYapXXTnAu0VXX-396-120.png"],jiyoujia:["TB1BxUPHFXXXXbIaXXXxwHxIVXX-198-60.png","TB1jHgVHFXXXXa8XVXXTnAu0VXX-396-120.png"]},o={"global-seller":["TB1yl1WGXXXXXcWXXXXxwHxIVXX-198-60.png","TB11tSyGXXXXXXFapXXTnAu0VXX-396-120.png"],"global-buyer":["TB1yl1WGXXXXXcWXXXXxwHxIVXX-198-60.png","TB11tSyGXXXXXXFapXXTnAu0VXX-396-120.png"],star:["TB1We0OFVXXXXXpXpXXxwHxIVXX-198-60.png","TB1KQhKFVXXXXcmXFXXTnAu0VXX-396-120.png"],gold:["TB1zIlNFVXXXXXtXpXXxwHxIVXX-198-60.png","TB1KcJOFVXXXXb5XXXXTnAu0VXX-396-120.png"],agriculture:["TB1L.b3GXXXXXXxXFXXxwHxIVXX-198-60.png","TB1VCb1GXXXXXamXFXXTnAu0VXX-396-120.png"],tiaoshi:["TB1vE80GFXXXXa_aXXXxwHxIVXX-198-60.png","TB1PvPaGFXXXXXYapXXTnAu0VXX-396-120.png"],jiyoujia:["TB12vgQHFXXXXX9aXXXxwHxIVXX-198-60.png","TB1zt7VHFXXXXblXVXXTnAu0VXX-396-120.png"]};Hub.add({name:"shopinfo",listen:{"core:ready":"init"},instance:{init:function(){function t(e){return Number(e)<5?"":"\u5e74\u8001\u5e97"}var i=e.all,a=g_config.idata.seller,o=g_config.idata.item,r=i(".J_ShopInfoHeader"),s=i("#J_ShopInfo"),c=s.attr("data-creditflag"),d=s.attr("data-rateurl");if("tiaoshi"==o.type||"jiyoujia"==o.type?c=o.type:a.starSeller||a.globalSeller||a.globalBuyer||a.agricultureSeller?a.starSeller?(c="star",r.attr("href","//star.taobao.com/settle.htm"),s.css("borderColor","#cdd7f7")):a.globalSeller?(c="global-seller",r.attr("href","//www.taobao.com/go/act/welcome.php"),s.css("borderColor","#ded2ee")):a.globalBuyer?(c="global-buyer",r.attr("href","//www.taobao.com/go/act/welcome.php"),s.css("borderColor","#ded2ee")):a.agricultureSeller&&(c="agriculture",r.attr("href","//www.taobao.com/market/nongye/baozhang.php"),s.css("borderColor","#cfdead")):a.goldSeller?(c="gold",r.attr("href","//www.taobao.com/go/act/jpmj.php")):d&&r.attr("href",d),a.goldPeriods>0&&r.append('<span class="tb-gold-periods">\u8fde\u7eed<em class="tb-gold-periods-num">'+a.goldPeriods+"</em>\u671f</span>"),a.goldSeller){var l=i('<a class="tb-gold-icon" title="\u91d1\u724c\u5356\u5bb6" href="//www.taobao.com/go/act/jpmj.php" target="_blank"></a>');s.append(l)}var u=n(c,a.goldSeller);u?r.append('<img width="198" src="'+u+'">'):r.css({height:16,"min-height":16});var f=Number(g_config.idata.seller.shopAge),m=!0,g=t(f);if(!isNaN(f)&&g&&m){var p=['<div class="tb-shop-age">','<a href="{rateUrl}" target="_blank">','<div class="tb-shop-age-content">','<i class="tb-shop-age-icon"></i>','<span class="tb-shop-age-val">{shopAge}</span>','<span class="tb-shop-age-desc">{desc}</span>',"</div>","</a>","</div>"].join(""),h=e.substitute(p,{rateUrl:d,shopAge:f,desc:g});r.after(h)}Hub.fire("shopinfo:end")}}})}),KISSY.add("item-detail/ua/index",["log"],function(e,t){function n(){return+new Date}var i=t("log").getLogger("ua"),a=window,o=function(){return a.ua="",a.UA_Opt={LogVal:"ua",MaxMCLog:1,MaxMPLog:1,MaxKSLog:1,MaxFocusLog:1,Token:n()+":"+Math.random(),SendMethod:8,Flag:12942},a.getUA=function(){var e=a.ua;a.UA_Opt.Token=n()+":"+Math.random();try{a.UA_Opt.reload()}catch(t){i.warn("Get UA failed: %s",t.message)}return e},e.getScript("//uaction.aliyuncdn.com/js/ua.js",function(){try{UA_Opt.reload()}catch(e){i.warn("Init failed: %s",e.message)}}),{getUA:getUA}}();return o}),KISSY.add("item-detail/cdnurl/index",function(){var e=/img0(\d)\.taobaocdn\.com/gi,t=function(){var e=!1;try{WebP.isSupport(function(t){e=t})}catch(t){}return e}(),n=function(e){return!e.match(/(png|gif)$/gi)};return{rewrite:function(i,a,o){return(i.match(e)||location.host.indexOf(".daily.")>0)&&(a=a&&t&&n(i),(o||a)&&(i=i.replace(e,"gd$1.alicdn.com")),a&&(i+="_.webp")),i}}}),KISSY.add("item-detail/desc/content",["log","node","dom","datalazyload","../cdnurl/"],function(e,t){var n=t("log").getLogger("desc"),i=t("node").all,a=i("body"),o=t("dom"),r=t("datalazyload"),s=t("../cdnurl/"),c=200,d=6e3,l="//img.alicdn.com/tps/i4/T10B2IXb4cXXcHmcPq-85-85.gif";return{init:function(){var e=this;g_config.idata.item.desc?(n.warn("Description is sync output"),e.initLazyLoad()):(n.info("Description is asyn fetch"),e.render(+new Date))},render:function(e,t){var a=this,o=i("#J_DivItemDesc"),r=window.desc;if("undefined"==typeof r||!o.length)return+new Date-e>d&&!t&&(t=!0,n.warn("Item description data timeout")),setTimeout(function(){a.render(e,t)},c);if(!r)return o.html("\u8be5\u5546\u54c1\u6ca1\u6709\u8be6\u60c5\u63cf\u8ff0");var u,f=g_config,m=f.vdata.sys,g=m.toggle,p=g.p||1,h=f.descWebP||!1,v=f.newDomain||!1,b=m.q||"",y=f.enable||!0,k=/(<img[^>]*)(src *= *("[^"]*"|'[^']*'|[^ >]*))/gi,_=0,w="",C=function(e){var t=e.charAt(0);return'"'===t||"'"===t?e.substr(1,e.length-2):e},S=function(e){return b&&~e.indexOf("taobaocdn")&&2===e.split(".jpg").length?e.substring(0,e.length-1)+b:e};u=r.match(k)?r.match(k).length:0,r=r.replace(k,function(e,t,n,i){return _++,p&&p>0&&_/u>p?"":!y||5>_?[t,'src="',s.rewrite(S(C(i)),h,v),'"'].join(""):w=[t,'src="',l,'" data-ks-lazyload="',s.rewrite(S(C(i)),h,v),'"'].join("")}),o.html(r),a.initLazyLoad()},initLazyLoad:function(){n.info("Init desc lazyload");var e=g_config.lazyload||"#content",t=o.viewportHeight(),i=Hub.config.get("desc")&&Hub.config.get("desc").idsMod?80:40,s=new r(e,{mod:"manual",diff:{top:-i,bottom:2*t}});"#content"!==e&&a.on("tabbar:switch",function(e){var t=parseInt(e.idx,10);s[t?"pause":"resume"]()})}}}),KISSY.add("item-detail/desc/segment",["log","../gl/","node","dom","event","../config/"],function(e,t){var n=(t("log").getLogger("desc"),t("../gl/")),i=t("node").all,a=i("body"),o=t("dom"),r=t("event"),s=t("../config/"),c=s.getGlobalConfig("shopId"),d=s.getDescConfig(),l=s.getItemId(),u=function(){var t,s,u=d.idsMod,f=[],m=[],g=0,p=null,h=!0,v={},b={},y=function(){function d(t){C(t.target);var n=t.target;if("A"===n.tagName){var i=o.html(n),a=o.offset("#J_TabBar").left;o.html(I,i),o.css(I,{visibility:"visible",opacity:.8,left:a}),a-=50,e.later(function(){S=new e.Anim(I,{opacity:0,left:a},.5,null,function(){o.css(I,"visibility","hidden")}).run()},500)}}var u=o.query(".ke_anchor","#J_DivItemDesc"),b="tb-desc-segment-link-current",y=u.length,k=null,_=null,w=function(e){var t=u[e];return v[t.id]},C=function(e){o.removeClass(f,b),o.removeClass(m,b),o.addClass(e,b)};if(r.on(t,"click",function(t){n("12.414"),h&&(h=!1,n("12.415"));var i=t.target,a=i.href;"A"===i.tagName&&(o.removeClass(f,b),o.addClass(i,b),t.preventDefault(),e.later(function(){p=a.split("#")[1],p=o.get("#"+p),g=o.offset(p).top,_=e.later(function(){_=null},500),window.scroll(0,g-83);var t={itemId:l,shopid:c,key:a.charAt(a.length-1),am:a.charAt(a.length-3)};n("35626246?"+e.param(t))},100))}),s=i(".tb-vertical-desc-segments-list"),r.on(s,"click",function(t){n("12.414"),h&&(h=!1,n("12.415"));var i=t.target,a=i.href;"A"===i.tagName&&(o.removeClass(m,b),o.addClass(i,b),t.preventDefault(),e.later(function(){p=a.split("#")[1],p=o.get("#"+p),g=o.offset(p).top,_=e.later(function(){_=null},500),window.scroll(0,g-83);var t={itemId:l,shopid:c,key:a.charAt(a.length-1),am:a.charAt(a.length-3)};n("35626246?"+e.param(t))},100))}),r.on(window,"scroll",function(){_||(k&&k.cancel(),k=e.later(function(){e.each(u,function(e,t){if(o.offset(e).top-84>o.scrollTop(window)){if(0===t)return o.removeClass(f,b),!1;var n=w(t-1);return C(n),!1}return y-1===t?(C(w(t)),!1):void 0}),k=null},50))}),e.UA.ie>6||!e.UA.ie){var S,I=o.create('<div class="tb-seg-name-tip"></div>');o.css(I,{visibility:"hidden",opacity:0}),o.append(I,document.body),r.on(t,"click",d),r.on(s,"click",d),a.on("tabbar:unstick",function(){o.css(I,"visibility","hidden"),o.removeClass(t,"tb-desc-segments-list-sticky")}),a.on("tabbar:stick",function(){o.addClass(t,"tb-desc-segments-list-sticky")})}a.on("tabbar:switch",function(e){"0"==e.idx&&(o.removeClass(f,b),o.removeClass(m,b))})},k=function(){u&&0!=u.length&&(t=['<ul class="tb-desc-segments-list tb-clearfix">'],e.each(u,function(n,i){n.index=i+1,t.push(e.substitute('<li class="tb-desc-segment"><a class="tb-desc-segment-link" href="#{anchor}" data-key={index} >{name}</a></li>',n))}),t.push("</ul>"),t=t.join(""),t=o.create(t),e.each(e.query("li",t),function(e){var e=e.firstChild,t=e.href.split("#")[1];f.push(e),v[t]=e}),o.prepend(t,"#J_MainWrap"))},_=function(){if(u&&u.length>0?(i(".tb-ids-mod").css("display","block"),s=['<div class="col-extra" id="J_IdsSegments"><ul class="tb-vertical-desc-segments-list tb-clearfix tb-vertical-desc-segments-list-show">']):s=['<div class="col-extra" id="J_IdsSegments"><ul class="tb-vertical-desc-segments-list tb-clearfix tb-vertical-desc-segments-list-hide">'],e.each(u,function(t,n){t.index=n+1,s.push(e.substitute('<li class="tb-vertical-desc-segment"><a class="tb-vertical-desc-segment-link" href="#{anchor}" data-key={index} >{name}</a></li>',t))}),s.push("</ul></div>"),s=s.join(""),s=o.create(s),e.each(e.query("li",s),function(e){var e=e.firstChild,t=e.href.split("#")[1];m.push(e),b[t]=e}),i(".tb-main-layout").append(s),u&&!(u.length<=0)){o.scrollTop(),e.one("#J_MainWrap").offset().top}},w=function(){i("#J_CustomSegments").length||(k(),_(),y(),n("12.34"))};return{init:w}}();return u}),KISSY.add("item-detail/desc/custom",["log","node","dom"],function(e,t){var n=(t("log").getLogger("desc"),t("node").all),i=n("body"),a=t("dom"),o=function(){var e=a.get("#J_CustomMarket"),t=function(){i.on("cart:add:success",function(){e&&e.contentWindow&&e.contentWindow.location&&e.contentWindow.location.reload&&e.contentWindow.location.reload()})},n=function(){e&&t()};return{init:n}}();return o}),KISSY.add("item-detail/desc/flashplayer",["log","node","dom","../config/"],function(e,t){var n=(t("log").getLogger("desc"),t("node").all),i=n("body"),a=t("dom"),o=t("../config/"),r=o.getDescConfig(),s=function(){var t=function(){var e=0,t=null;if(navigator.plugins&&navigator.mimeTypes.length){var n=navigator.plugins["Shockwave Flash"];n&&n.description&&(e=n.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")[0])}else if(navigator.userAgent&&0<=navigator.userAgent.indexOf("Windows CE"))for(var i=3;t;)try{i++,t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i),e=i}catch(a){t=null}else{try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(a){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),e=6,t.AllowScriptAccess="always"}catch(a){if(6===e)return e}try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){}}null!==t&&(e=t.GetVariable("$version").split(" ")[1].split(",")[0])}return e},n=function(){var n,i="480",o="388",s="itemFlashObject",c=r.valFlashUrl,d=t();if(d>8){var l=a.get("#item-flash");l&&(n=navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length?'<embed type="application/x-shockwave-flash" src="'+c+'" width="'+i+'" height="'+o+'" id="'+s+'" name="'+s+'" quality="high" wmode="'+(e.UA.gecko?"transparent":"opaque")+'" allowfullscreen="true" menu="false" flashvars="MMplayerType=PlugIn" />':'<object id="'+s+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+i+'" height="'+o+'"><param name="movie" value="'+c+'" /><param name="quality" value="high" /><param name="wmode" value="opaque" /><param name="allowfullscreen" value="true" /><param name="menu" value="false" /><param name="flashvars" value="MMplayerType=ActiveX" /></object>',l.innerHTML=n)}};return{init:function(){r.valFlashUrl&&!o.isTouch&&i.on("info:playVideo",function(){n()})}}}();return s}),KISSY.add("item-detail/desc/imagesize",["log","node","dom","io","../config/"],function(e,t){var n=t("log").getLogger("desc"),i=t("node").all,a=(i("body"),t("dom")),o=t("io"),r=t("../config/"),s=r.getDescConfig(),c=function(){return{init:function(){function t(t){if(t&&t.size){var n="data-ks-lazyload",i="width",o="height",r=function(e){var t=e.style;return t&&(t[i]||t[o])||a.hasAttr(e,i)||a.hasAttr(e,o)},s=function(e){return e?e.substr(e.lastIndexOf("/")+1).replace("_.webp",""):e};e.each(e.query("#description img"),function(e){var c=t[s(a.attr(e,n))];c&&!r(e)&&(e[i]=c.w,e[o]=c.h)})}}var i=s.apiImgInfo;i&&(n.info("Fetch image size data from %s",i),o({type:"get",url:i,success:t,dataType:"jsonp",jsonp:"cb",jsonpCallback:"jsonp_image_info",cache:!0}))}}}();return c}),KISSY.add("item-detail/desc/localmap",["dom"],function(e,t){var n=t("dom"),i=function(){if(g_config.localMap){var t=g_config.localMap;e.available("#J_DivItemDesc",function(){var e=n.get("#attributes");e&&n.insertAfter(n.create('<iframe style="height: 420px;width: 750px" frameborder="0" scrolling="no"  src='+t+">"),e)})}};return{init:i}}),KISSY.add("item-detail/carmodel/templates/carmodel-table-header-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+="",n+="\n",n+="\n",n+='\n<div id="J_CmdContainer_';var u=l(o,e,{},"depth",0,4);n+=c(u,!0),n+='" class="tb-cmd-scroll-container" data-depth="';var f=l(o,e,{},"depth",0,4);n+=c(f,!0),n+='">\n    <div id="J_CmdSelector_';var m=l(o,e,{},"depth",0,5);n+=c(m,!0),n+='" class="tb-cmd-head-name" data-depth="';var g=l(o,e,{},"depth",0,5);n+=c(g,!0),n+='">\n        <b title="';var p=l(o,e,{},"name",0,6);n+=c(p,!0),n+='">';var h=l(o,e,{},"name",0,6);n+=c(h,!0),n+='</b>\n        <i id="J_CmdIcon_';var v=l(o,e,{},"depth",0,7);n+=c(v,!0),n+='" data-depth="';var b=l(o,e,{},"depth",0,7);n+=c(b,!0),n+='" class="tb-iconfont tb-cmd-icon">&#xe609;</i>\n    </div>\n    <div id="J_CmdSelectorShadow_';var y=l(o,e,{},"depth",0,9);n+=c(y,!0),n+='" class="tb-cmd-head-name tb-cmd-head-name-selected tb-cmd-head-name-shadow" data-depth="';var k=l(o,e,{},"depth",0,9);n+=c(k,!0),n+='" style="display: none;"\n                ';var _={},w=[],C=d(o,e,"modelIndex",0,10);w.push(C),_.params=w,_.fn=function(e){var t="";t+='\n                    model-index="';var n=l(o,e,{},"modelIndex",0,11);return t+=c(n,!0),t+='"\n                '},n+=s(o,e,_,"if",10),n+='\n        >\n        <b title="';var S=l(o,e,{},"name",0,14);n+=c(S,!0),n+='">';var I=l(o,e,{},"name",0,14);n+=c(I,!0),n+='</b>\n        <i id="J_CmdIcon_';var T=l(o,e,{},"depth",0,15);n+=c(T,!0),n+='" data-depth="';var x=l(o,e,{},"depth",0,15);n+=c(x,!0),n+='" class="tb-iconfont tb-cmd-icon">&#xe609;</i>\n    </div>\n    <ul id="J_CmdScroll_';var J=l(o,e,{},"depth",0,17);n+=c(J,!0),n+='" class="tb-cmd-head-scroll" data-depth="';var P=l(o,e,{},"depth",0,17);n+=c(P,!0),n+='">\n        ';var X={},D=[],L=d(o,e,"content",0,18);return D.push(L),X.params=D,X.fn=function(e){var t="";t+='\n        <li class="tb-cmd-head-scroll-item">\n            <div class="tb-cmd-head-scroll-item-text" data-depth="';var n=l(o,e,{},"depth",0,20);t+=c(n,!0),t+='" data-index="';var i=l(o,e,{},"xindex",0,20);t+=c(i,!0),t+='"\n                id="J_CmdScrollItem_';var a=l(o,e,{},"depth",0,21);t+=c(a,!0),t+="_";var r=l(o,e,{},"xindex",0,21);t+=c(r,!0),t+='"\n                ';var u={},f=[],m=d(o,e,"modelIndex",0,22);f.push(m),u.params=f,u.fn=function(e){var t="";t+='\n                    model-index="';var n=l(o,e,{},"modelIndex",0,23);t+=c(n,!0),t+="_";var i=l(o,e,{},"xindex",0,23);return t+=c(i,!0),t+='"\n                '},u.inverse=function(e){var t="";t+='\n                    model-index="';var n=l(o,e,{},"xindex",0,25);return t+=c(n,!0),t+='"\n                '},t+=s(o,e,u,"if",22),t+='\n                title="';var g=d(o,e,"this.name",0,27);t+=c(g,!0),t+='">\n                ';var p=d(o,e,"this.name",0,28);return t+=c(p,!0),t+="\n            </div>\n        </li>\n        "},n+=s(o,e,X,"each",18),n+="\n    </ul>\n</div>\n"}}),KISSY.add("item-detail/carmodel/templates/carmodel-table-content-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+="";var u={},f=[],m=d(o,e,"this",0,1);return f.push(m),u.params=f,u.fn=function(e){var t="";t+='\n<div class="tb-cmd-content">\n    ';var n={},i=[],a=d(o,e,"this.data",0,3);return i.push(a),n.params=i,n.fn=function(e){var t="";t+="\n        ";var n={},i=[],a=d(o,e,"this.data",0,4);return i.push(a),n.params=i,n.fn=function(e){var t="";t+="\n            ";var n={},i=[],a=d(o,e,"this.name",0,5);i.push(a),n.params=i,n.fn=function(e){var t="";t+="\n                ";var n={},i=[],a=d(o,e,"this.content",0,6);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n                <h1 class="tb-cmd-list-title">';var n=d(o,e,"this.name",0,7);return t+=c(n,!0),t+="</h1>\n                "},n.inverse=function(e){var t="";t+='\n                <span class="tb-cmd-list-item">';var n=d(o,e,"this.name",0,9);return t+=c(n,!0),t+="</span>\n                "},t+=s(o,e,n,"if",6),t+="\n            "},t+=s(o,e,n,"if",5),t+="\n            ";var r={},u=[],f=d(o,e,"this.content",0,12);return u.push(f),r.params=u,r.fn=function(e){var t="";t+="\n                ";var n={},i=[],a=d(o,e,"this.content",0,13);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n                    <span class="tb-cmd-list-item">';var n=l(o,e,{},"this",0,14);return t+=c(n,!0),t+="</span>\n                "},t+=s(o,e,n,"each",13),t+="\n            "},t+=s(o,e,r,"if",12),t+="\n        "},t+=s(o,e,n,"each",4),t+="\n    "},n.inverse=function(e){var t="";t+="\n        ";var n={},i=[],a=d(o,e,"this.name",0,19);i.push(a),n.params=i,n.fn=function(e){var t="";t+="\n            ";var n={},i=[],a=d(o,e,"this.content",0,20);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n            <h1 class="tb-cmd-list-title">';var n=d(o,e,"this.name",0,21);return t+=c(n,!0),
t+="</h1>\n            "},n.inverse=function(e){var t="";t+='\n            <span class="tb-cmd-list-item">';var n=d(o,e,"this.name",0,23);return t+=c(n,!0),t+="</span>\n            "},t+=s(o,e,n,"if",20),t+="\n        "},t+=s(o,e,n,"if",19),t+="\n        ";var r={},u=[],f=d(o,e,"this.content",0,26);return u.push(f),r.params=u,r.fn=function(e){var t="";t+="\n            ";var n={},i=[],a=d(o,e,"this.content",0,27);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n                <span class="tb-cmd-list-item">';var n=l(o,e,{},"this",0,28);return t+=c(n,!0),t+="</span>\n            "},t+=s(o,e,n,"each",27),t+="\n        "},t+=s(o,e,r,"if",26),t+="\n    "},t+=s(o,e,n,"if",3),t+="\n</div>\n"},n+=s(o,e,u,"each",1),n+="\n"}}),KISSY.add("item-detail/carmodel/index",["log","node","event","xtemplate/runtime","./templates/carmodel-table-header-xtpl","./templates/carmodel-table-content-xtpl"],function(e,t){"use strict";var n=t("log").getLogger("carmodel"),i=t("node").all,a=t("event"),o=t("xtemplate/runtime"),r=t("./templates/carmodel-table-header-xtpl"),s=t("./templates/carmodel-table-content-xtpl"),c=(i("body"),g_config.carModelTable),d=["\u54c1\u724c","\u8f66\u7cfb","\u5e74\u6b3e","\u8f66\u578b"];return{renderHeader:function(e){var t=this,n=parseInt(e);return 1===t.maxDepth?"\u54c1\u724c":new o(r).render({depth:n,content:t.levelData[n],name:d[n-1]})},renderContent:function(e,t){var n,i=this,a=parseInt(e);if(2==i.maxDepth){var r=i.levelData[a],c=r.length;if(c>0){n=[{data:[]}];for(var d=0;c>d;d++)for(var l=r[d].data,u=l.length,f=0;u>f;f++)n[0].data.push({name:l[f].name})}else{n=[{data:[]}];for(var l=r.data,u=l.length,f=0;u>f;f++)n[0].data.push({name:l[f].name})}return new o(s).render(n)}return t||(n=i.levelData[a]),new o(s).render(n)},init:function(){if(c){var e=this;try{i("#attributes").after('                        <div id="J_CarModelTable">                            <div class="tb-cmd-head" id="J_CarModelHeader">                                <div class="tb-cmd-head-title">\u9002\u5408\u6c7d\u8f66\uff1a</div>                            </div>                            <div id="J_CarModelTableContent"></div>                        </div>'),e.levelData=e.processData(c),i("#J_CarModelHeader").append(e.renderHeader(1)),i("#J_CarModelTableContent").html(e.renderContent(1)),e.bindEvents()}catch(t){n.warn("Init failed: %s",t.message)}}},levelData:{},maxDepth:0,processData:function(t){var n,i=this,a={},o=[],r=0;for(var s in t)n=s.split("_").length,e.inArray(n,o)||(o.push(n),a[n]=[]),n>r&&(r=n),a[n].push(t[s]);return i.maxDepth=r,a},bindEvents:function(){var e=this;a.delegate(document,"mouseenter",".tb-cmd-scroll-container",function(e){var t=i(e.currentTarget),n=t.attr("data-depth");i("#J_CmdScroll_"+n).show(),i("#J_CmdSelector_"+n).hide(),i("#J_CmdSelectorShadow_"+n).show(),i("#J_CmdIcon_"+n).html("&#xe608;")}),a.delegate(document,"mouseleave",".tb-cmd-scroll-container",function(t){var n=i(t.currentTarget),a=n.attr("data-depth");e.hideSelector(a)}),a.delegate(document,"click",".tb-cmd-head-name-shadow",function(t){var n=i(t.currentTarget),a=n.attr("data-depth");i("#J_CmdSelector_"+a+" b").text(d[parseInt(a)-1]).removeClass("tb-cmd-head-scroll-item-text-selected"),e.hideSelector(a);var o=n.attr("model-index");o?e.showContent(o):e.showContent(o,a),e.showHeader(a)}),a.delegate(document,"click",".tb-cmd-head-scroll-item-text",function(t){var n=i(t.currentTarget),a=n.text(),o=n.attr("data-depth"),r=(n.attr("data-index"),n.attr("model-index"));i("#J_CmdSelector_"+o+" b").text(a).addClass("tb-cmd-head-scroll-item-text-selected"),e.hideSelector(o),e.showContent(r),e.showHeader(o,r)})},hideSelector:function(e){i("#J_CmdScroll_"+e).hide(),i("#J_CmdSelector_"+e).show(),i("#J_CmdSelectorShadow_"+e).hide(),i("#J_CmdIcon_"+e).html("&#xe609;")},showHeader:function(t,n){var a=this,s=d.length-1;if(!(t>=s||t>=a.maxDepth-1)){var l=parseInt(t);if(n){var u=c[n];if(!(u.children&&s>t))return void e.error("error in carModel showHeader");for(var f=[],m=0,g=u.children.length;g>m;m++)f.push(c[u.children[m]]);var p,h={depth:l+1,content:f,name:d[l],modelIndex:n};if(p=new o(r).render(h),i("#J_CmdContainer_"+(l+1)).length>0&&i("#J_CmdContainer_"+(l+1)).remove(),i("#J_CmdContainer_"+l).after(p),s>l+1)for(var v=l+1;s>v;s--)i("#J_CmdContainer_"+s).remove()}else{if(!(s>t))return;for(;s>t;s--)i("#J_CmdContainer_"+s).remove()}}},showContent:function(e,t){var n=this;if(m=t?n.levelData[t]:c[e],2==n.maxDepth){var a=m,r=a.length;if(r>0){m=[{data:[]}];for(var d=0;r>d;d++)for(var l=a[d].data,u=l.length,f=0;u>f;f++)m[0].data.push({name:l[f].name})}else{m=[{data:[]}];for(var l=a.data,u=l.length,f=0;u>f;f++)m[0].data.push({name:l[f].name})}return void i("#J_CarModelTableContent").html(new o(s).render(m))}if(m.length&&m.length>0)i("#J_CarModelTableContent").html(new o(s).render(m));else if(m.data){var m=m.data,g=new o(s).render(m);i("#J_CarModelTableContent").html(g)}else m.name&&i("#J_CarModelTableContent").html(m.name)}}}),KISSY.add("item-detail/desc/index",["log","node","./content","./segment","./custom","./flashplayer","./imagesize","./localmap","../carmodel/"],function(e,t){var n=t("log").getLogger("desc"),i=t("node").all,a=i("body"),o=t("./content"),r=t("./segment"),s=t("./custom"),c=t("./flashplayer"),d=t("./imagesize"),l=t("./localmap"),u=t("../carmodel/");return{init:function(){n.info("Init start");try{o.init()}catch(t){n.warn("Content init failed: %s",t.message)}a.fire("resource:sib",{success:function(){try{g_config.sellerDetail&&g_config.sellerDetail.show&&e.use("item-seller",function(e,t){t.init(g_config)})}catch(t){n.warn("Item Seller error: %s",t.message)}}});try{r.init()}catch(t){n.warn("Segmentor init failed: %s",t.message)}try{c.init()}catch(t){n.warn("FlashPlayer init failed: %s",t.message)}try{s.init()}catch(t){n.warn("CustomMarket init failed: %s",t.message)}try{d.init()}catch(t){n.warn("ImageSize init failed: %s",t.message)}try{u.init()}catch(t){n.warn("CarModel init failed: %s",t.message)}try{l.init()}catch(t){n.warn("LocalMap init failed: %s",t.message)}n.info("Init end")}}}),KISSY.add("item-detail/records/index",["log","../config/","../gl/","../domain/","dom","event","ua","node","ajax"],function(e,t){function n(t,n){try{for(var i,a,o="jsonp_"+n.replace(/:/gi,"_"),r=t.split("?"),s=r[0],c=r[1].split("&"),d=c.length,l=0;d>l;l++){if(a=c[l],-1!=a.indexOf("title"))try{a=a.split("=")[0]+"="+encodeURIComponent(encodeURIComponent(C.getTitle()))}catch(u){u&&u.message&&w.warn("Records request failed: %s",u.message)}c[l]=a}var f;f=e.unparam(c.join("&")),e.mix(f,{v:2}),D(i={url:s,dataType:"jsonp",data:f,jsonpCallback:o,success:function(a){return a?void("sm"===a.rgv587_flag?e.use("sd/data_sufei/index,sd/data_sufei/css/taobao.css",function(e,t){new t({data:a,ioConfig:i,dialogConfig:{prefixCls:"sufei-tb-",headerContent:"\u8bbf\u95ee\u9a8c\u8bc1",zIndex:"99999999"},style:"taobao"})}):e.isArray(a)?(a.html=a[0],X.fire(n,a)):(w.info("Received data from [ %s ] for event [ %s ]",t,n),a.dataType=a.type,X.fire(n,a))):w.warn("Callback data is null from %s for event [ %s ]",t,n)},error:function(e){w.warn("Records request failed: %s",e.message)}})}catch(u){w.warn("Records request failed: %s",u.message)}}function i(){var e=T.query("tr",H),t="tb-hover",n="zoom";x.on(e,B,function(){var e=this;T.addClass(e,t),T.css(e,n,1)}),x.on(e,j,function(){var e=this;T.removeClass(e,t),T.css(e,n,0)})}function a(e){return e+(-1===e.indexOf("?")?"?":"&")}function o(t){var n=T.attr(t,"data-api")||T.attr(t,"detail:params")||T.attr(t,"href");return a(n)+"t="+e.now()}function r(e){var t=T.get(F);t.src=e}function s(e){var t=T.get(O);r(e.code),t.value=E,t.select()}function c(e){return e.replace(/<\/?[^>]+>/gi,"")}function d(t){var i=e.trim(c(t.value));if(i&&i!==E){var o=a(T.attr(k,A))+"&code="+i;n(o,"records:reload")}}function l(t){var i=t.target;if(T.hasClass(i.parentNode,"J_TAjaxTrigger")&&(i=i.parentNode),T.hasClass(i,"J_TAjaxTrigger")){t.halt();var a=i.innerText||i.textContent;if("0"!==e.trim(a)){S(T.attr(i,"data-val"));var r=o(i);T.attr(k,A,r),n(r,"records:reload"),window.scrollTo(0,T.offset("#J_showBuyerList").top-130)}}}function u(){x.on(k,N,function(e){l(e),S("12.18."+(T.parent(e.target,".tb-view-all")?"0":"1"))})}function f(){var e=T.query(".J_View",k);e.length&&(6===J.ie&&i(),V.init(),x.on(e,B,function(e){var t=this;e.halt(),V.setTitle(T.attr(t,"data-title")).show(t)}),x.on(e,j,function(e){e.halt(),V.hide()}))}function m(){var t=T.attr(K,"data-apicode");t=a(t),x.on(T.parent(F),N,function(i){i.halt(),n(t+e.now(),"records:changeCode")})}function g(){var e=T.get(O);x.on(e,"focus",function(){e.value===E&&(e.value="")}),x.on("#J_DealCodeBtn",N,function(t){t.halt(),d(e)}),x.on(K,"keydown",function(t){13==t.keyCode&&d(e)}),x.on("#J_CloseDealCode",N,function(e){e.preventDefault(),T.removeClass(k,R)})}function p(e){e&&(T.removeClass(k,R),k.innerHTML=e,Y||(u(),f(),Y=!0))}function h(e){var t=e.html;switch(e.dataType){case"list":p(t);break;case"code":T.addClass(k,R),T.get(K)||(k.appendChild(T.create(t)),m(),g());break;default:p(t)}}function v(e){var t=T.get(".J_TAjaxIndicator",k),i=o(e);t.innerHTML="\u6b63\u5728\u52a0\u8f7d\u6570\u636e...",n(i,"records:reload")}function b(){var e=T.get("#J_PriceCutContainer"),t=T.get("iframe",e),n=g_config.priceCutUrl;return!t&&e&&n?(I.degrade(),t=T.create('<iframe id="J_PriceTrendFrame" src="'+n+'" width="100%" height="590" scrolling="no" frameborder="0"></iframe>'),void e.appendChild(t)):!1}function y(e){function t(e){e>0?b():T.remove(".tb-public-notice")}if(!U){U=!0,v(e);var n=Number(T.html(".J_TDealCount"));0!=n?t(n):X.on("info:quantity",function(e){var n=Number(e.quanity);t(n)})}}var k,_,w=t("log").getLogger("records"),C=t("../config/"),S=t("../gl/"),I=t("../domain/"),T=t("dom"),x=t("event"),J=t("ua"),P=t("node").all,X=P("body"),D=t("ajax"),L=document,A="data-request-url",M="tb-hidden",R="tb-show-code",N="click",B="mouseenter",j="mouseleave",E="\u8f93\u5165\u6709\u8bef",H="#J_showBuyerList",K="#J_DealCode",F="#J_DealCodePic",O="#J_DealCodeInput",Y=!1,U=!1,V={init:function(){var e="J_RecordPopup",t=T.get("#"+e),n=this,i=J.ie<8;t||(t=L.createElement("div"),t.id=e,t.className="tb-record-popup tb-hidden",L.body.appendChild(t),t.innerHTML='<div class="tb-wrap"><h3>\u6210\u4ea4\u65f6\u540d\u79f0\uff1a</h3><p id="J_RecordTitle"></p><i></i></div></div>'),n.box=t,n.titleBox=T.get("#J_RecordTitle"),n.offX=i?48:50,n.offY=i?-8:-6},show:function(e){var t=this,n=t.box,i=T.offset(e);return T.removeClass(n,M),T.css(n,"top",i.top-n.offsetHeight+t.offY),T.css(n,"left",i.left-n.offsetWidth+t.offX),t},hide:function(){var e=this;return T.addClass(e.box,M),e},setTitle:function(e){var t=this;return t.titleBox.innerHTML=e,t}};return{init:function(){(k=T.get(H))&&(X.on("records:load",e.bind(this.load,this)),X.on("records:reload",e.bind(this.reload,this)),X.on("records:changeCode",e.bind(this.changeCode,this)),X.on("info:quantity",function(t){if("refundCount"in t){w.info("Render buyer list view");var n=T.attr("#J_listBuyerOnView","data-api")+"&pss=";t=e.mix(t,{urlInprocess:n+"1",urlsucceeded:n+"2",urlRefunded:n+"3"});var i;i=t.filterRecords===!1?'<div class="tb-deal-statistics">30\u5929\u5185\uff1a\u4ea4\u6613\u4e2d  <span class="tb-blue"> {paySuccessItems} </span>\u7b14\uff0c\u4ea4\u6613\u6210\u529f <span class="tb-blue">{confirmGoodsItems}</span> \u7b14\uff0c\u7ea0\u7eb7\u9000\u6b3e <span class="tb-blue">{refundCount}</span> \u7b14</div>':'<div class="tb-deal-statistics">30\u5929\u5185\uff1a\u4ea4\u6613\u4e2d <a href="{urlInprocess}" class="J_TAjaxTrigger" data-val="12.70"><span class="tb-blue"> {paySuccessItems} </span></a>\u7b14\uff0c\u4ea4\u6613\u6210\u529f <a href="{urlsucceeded}" class="J_TAjaxTrigger" data-val="12.71"><span class="tb-blue">{confirmGoodsItems}</span></a> \u7b14\uff0c\u7ea0\u7eb7\u9000\u6b3e <a href="{urlRefunded}" class="J_TAjaxTrigger" data-val="12.69"><span class="tb-blue">{refundCount}</span></a> \u7b14</div>';var a=T.get(".tb-public-notice");i=e.substitute(i,t),i=T.create(i),T.insertBefore(i,a),x.on(i,N,l)}}))},load:function(){var e=T.get("#J_listBuyerOnView");e&&y(e)},reload:function(e){e.html?h(e):e.code?s(e):w.warn("Record data list is null")},changeCode:function(t){e.isString(t.code)&&e.isObject(t)&&r(t.code)},switchTo:function(e){_&&_.switchTo(e||0)}}}),KISSY.add("item-detail/tabbar/switcher",["../gl/","log","dom","event","ua","node","anim"],function(e,t){function n(t,n){if(!isNaN(n)){var i=this;if(!t||"J_TabShopCart"!==d(t.currentTarget).attr("id")){if(u.fire("tabbar:preswitch",{index:n}),0!=n){var o=d("#J_PublicWelfare");o&&o.hide();var r=d("#J_SellerDetailMobile");r&&r.hide()}else 4!=n&&(d("#J_ServiceTab")&&d("#J_ServiceTab").removeClass("selected"),d("#service")&&d("#service").addClass("tb-hidden"));if(!isNaN(n)&&0!=n&&d(".tb-vertical-desc-segment").length>0&&(d(".tb-vertical-desc-segments-list").addClass("tb-vertical-desc-segments-list-hide").removeClass("tb-vertical-desc-segments-list-show"),d(".tb-ids-mod").hide(),d(".tb-vertical-desc-segment").hide()),n!==i.getLastIndex()){switch(n){case 0:t&&a("12.4"),i.toggleTab(0);break;case 1:t&&a("12.5"),i.Rate?i.Rate.loadReviewList():e.use("rate",function(e,t){i.Rate=t,i.Rate.init({container:"#reviews",itemId:g_config.itemId,tka:g_config.idata.item.tka,iurl:g_config.DyBase.iurl,afterSales:!0}),i.Rate.loadReviewList()}),!f&&d(".tb-r-try-check").length>0&&(f=!0,a("12.2","tbsy")),i.toggleTab(1);break;case 2:u.fire("records:load"),t&&a("12.6"),i.toggleTab(2);break;case 4:d("#J_ServiceTab").fire("click"),i.toggleTab(4);break;case 5:i.toggleTab(5);break;case 6:i.toggleTab(6)}d("#J_TabBarWrap").hasClass("tb-tabbar-wrap-sticky")&&d(document).scrollTop(d(".tb-main-layout").offset().top-60),u.fire("tabbar:postswitch",{index:n})}}}}var i,a=t("../gl/"),o=t("log").getLogger("tabbar"),r=t("dom"),s=t("event"),c=t("ua"),d=t("node").all,l=t("anim"),u=d("body"),f=!1,m=c.ie&&(6===c.ie||7===c.ie),g=750,p=(r.query("a","#J_TabBar"),document.body),h="selected",v="#J_ReviewTabTrigger",b=".tb-sell-counter a";return{lastIndex:0,tabSwitchTo:function(e,t){e&&e.halt&&(e.halt(),e.preventDefault()),u.fire("tabbar:switch",{idx:t}),new l(window,{scrollTop:d("#J_TabBar").offset().top},.1).run()},initSKUSwitch:function(){var e=this,t=d(v);t&&t.on("click",function(t){e.tabSwitchTo(t,1)});var n=d(b);n&&n.on("click",function(t){e.tabSwitchTo(t,2)})},Rate:null,checkStick:function(){var t=this,n=r.scrollTop(),i=e.one(".tb-main-layout").offset().top-62;return n>i?(t.sticked||t.stick(),!0):(t.sticked&&t.unstick(),!1)},init:function(){var t=this;return u.on("tabbar:switch",e.bind(t.switchTo,t)),t.initSKUSwitch(),r.get("#J_DivItemDesc")?(c.ie<=8&&d(".tb-tabbar-inner-wrap").width(d(window).width()<1180?799:948),i=r.get("#J_TabBarWrap"),g=Math.ceil(r.offset(i).top)+1,s.delegate("#J_TabBar","click","a",function(e){try{var t=parseInt(d(e.currentTarget).attr("data-index"),10);n.call(this,e,t)}catch(i){o.warn("Exec error: %s",i.message)}},t),s.on(i,"click",function(e){r.hasClass(e.target,"ww-inline")&&a("12.24")}),t.initStick(),void t.initServiceTab()):!1},initServiceTab:function(){var e=d("#J_ServiceIconBd"),t=d("#J_ServiceTab"),n=d("a",t),i=d("#service");return i.length&&i.hide(),!t.length&&e.length?void e.delegate("click",".J_Cont",function(e){e.preventDefault()}):(n.attr("data-index","4"),void e.delegate("click",".J_Cont",function(e){e.preventDefault(),KISSY.use("pledge/init",function(){t.scrollIntoView(window,!0),n.length&&n.fire("click")})}))},stick:function(){var e=this;if(d("#J_TabBarWrap").after('<div id="J_TabBarWrapStickyPlaceHolder" style="width: 100%; height: 46px; margin-bottom: 16px;"></div>').addClass("tb-tabbar-wrap-sticky"),d(".J_LinkAdd").length>0&&1===g_config.idata.item.quickAdd&&r.css(".tb-shop-cart","display","block"),e.sticked=!0,u.fire("tabbar:stick"),d(".col-extra").length>0){d(".col-extra").addClass("tb-desc-segments-list-sticky");var t=(r.width(window)-r.width(".tb-main-layout"))/2;d(".tb-vertical-desc-segments-list").addClass("tb-sticky-vertical-desc-segments-list").css("right",t+"px")}else o.info("Segments list load and scrolled")},unstick:function(){var e=this;d("#J_TabBarWrap").removeClass("tb-tabbar-wrap-sticky"),d("#J_TabBarWrapStickyPlaceHolder").remove(),d(".J_LinkAdd").length>0&&r.css(".tb-shop-cart","display","none"),u.fire("tabbar:unstick"),d(".tb-vertical-desc-segments-list").length>0&&d(".tb-vertical-desc-segments-list").removeClass("tb-sticky-vertical-desc-segments-list").css("right","0px"),e.sticked=!1},initStick:function(){var t=this;if(!m){var n=e.one("#J_TabBarWrap");if(n){t.sticked=!1;{r.get("#J_TabbarPlaceHolder")}s.on(window,"scroll",function(){t.checkStick();var e=d(".tb-vertical-desc-segments-list");if(e.length>=1){var n=d("#J_MainWrap"),i=n.height()+n.offset().top-800,a=d(document).scrollTop();if(a>=i){var o=r.viewportHeight(),s=o-(a-i)-100,c=s>0?s:0;e.height(c)}else e.height("100%")}}),s.on(window,"resize",function(){if(t.checkStick()){if(d(".tb-vertical-desc-segments-list").length>0){var e=(r.width(window)-r.width(".tb-main-layout"))/2;d(".tb-vertical-desc-segments-list").addClass("tb-sticky-vertical-desc-segments-list").css("right",e+"px")}}else d(".tb-vertical-desc-segments-list").length>0&&d(".tb-vertical-desc-segments-list").removeClass("tb-sticky-vertical-desc-segments-list").css("right","0px");c.ie<=8&&d(".tb-tabbar-inner-wrap").width(d(window).width()<1180?799:948)})}}},getLastIndex:function(){var e=this;return e.lastIndex},setLastIndex:function(e){var t=this;t.lastIndex=e},toggleTab:function(e){var t=this.getLastIndex(),n=d(".tb-tab-anchor[data-index='"+t+"']"),i=d(".tb-tab-anchor[data-index='"+e+"']"),a=d(".tb-ids-mod"),o=d(".tb-vertical-desc-segment"),r=d(".tb-vertical-desc-segments-list"),s=d("#J_PublicWelfare"),c=s.length>0,l=d("#J_IframeForLife"),u=l.length>0,f="tb-vertical-desc-segments-list-show",m="tb-vertical-desc-segments-list-hide",g=d("#J_SellerDetailMobile"),v=g.length>0,b=d("#J_CarModelTable");n.parent().removeClass(h),i.parent().addClass(h),d(p).removeClass("tab-active-index-"+t),d(p).addClass("tab-active-index-"+e),this.setLastIndex(e),5==e||6==e?d("#farm-auth").show():d("#farm-auth").hide(),0===e?(c&&s.show(),v&&g.show(),u&&l.show(),o.length&&(a.show(),o.show(),r.addClass(f).removeClass(m)),b.length&&b.show()):(c&&s.hide(),v&&g.hide(),u&&l.hide(),o.length&&(a.hide(),o.hide(),r.addClass(m).removeClass(f)),b.length&&b.hide())},switchTo:function(e){var t=this;e.load&&(t.loadQualification=!0);var i=e.idx||e.index;if(n.call(this,e,i),e.stick&&!e.load){var a=d("#J_TabBarWrap").offset().top;if(t.tabbarTop){if(a>t.tabbarTop){var o=d("#tad_head_area").height()+d("#tad_first_area").height();t.tabbarTop=t.tabbarTop+o+50,t.loadTad=!0}}else t.tabbarTop=a;d(window).scrollTop(t.tabbarTop),t.checkStick(),t.loadQualification&&(t.loadTad&&d(window).scrollTop(t.tabbarTop-20),u.fire("tabbar:sticked"))}}}}),KISSY.add("item-detail/tabbar/index",["../desc/","../records/","./switcher"],function(e,t){return{init:function(){var e=t("../desc/");e.init();var n=t("../records/");n.init();var i=t("./switcher");i.init()}}}),KISSY.add("item-detail/security/copyfilter",["event"],function(e,t){function n(){var t,n,o="\u60a8\u9009\u4e2d\u7684\u5185\u5bb9\u53ef\u80fd\u6709\u5b89\u5168\u9690\u60a3,\u8bf7\u8c28\u614e\u4f7f\u7528! ",r=a.createElement("div"),s="<.+(?:",c=").+>",d="\\s*",l=/[\r\n]+/g,u=[["display","none"],["visibility","hidden"],["width","0"],["text-indent","-\\d{3,}"]],f=[];e.each(u,function(e){f.push(e[0]+d+":"+d+e[1])}),t=s+f.join("|")+c,n=new RegExp(t,"mi"),i.on(document.body,"copy",function(){var e,t;window.getSelection?e=window.getSelection():a.selection&&(e=a.selection.createRange()),t=e.htmlText||e.getRangeAt(0).cloneContents(),"string"!=typeof t&&(r.appendChild(t),t=r.innerHTML),t=t.replace(l,""),n.test(t)&&alert(o),r.innerHTML=""})}var i=t("event"),a=document;n()}),KISSY.add("item-detail/security/consolewarn",function(){window.top==window&&window.console&&(console.log("%c%s","color: red; background: yellow; font-size: 24px; font-weight: bold;","\u5b89\u5168\u8b66\u544a!"),console.log("%c%s","color: black; font-size: 18px;","\u8bf7\u52ff\u5728\u6b64\u63a7\u5236\u53f0\u8f93\u5165\u6216\u7c98\u8d34\u4f60\u4e0d\u660e\u767d\u7684\u4ee3\u7801\uff0c\u4ee5\u907f\u514d\u653b\u51fb\u8005\u7a83\u53d6\u4f60\u7684\u4fe1\u606f\u6765\u5192\u5145\u4f60\u3002"))}),KISSY.add("item-detail/security/index",["./copyfilter","./consolewarn"],function(e,t){t("./copyfilter"),t("./consolewarn")}),KISSY.add("item-detail/typerecommend/index",["dom","node"],function(e,t){function n(){o.on("dc:decorated",function(){var t=null;if(t=i.get("#J_RecommendedSameTypesItems")){var n=i.attr(t,"detail:params"),a=Hub.config.get("desc").similarItems;if(!a)return void i.remove(t);n=KISSY.unparam(n.replace(";","&").replace(/:/g,"=")),n.title=encodeURIComponent(encodeURIComponent(n.title)),DT.sameTypeRecomCallback=function(e){t.innerHTML=e,i.children(t).length||i.remove(t)},e.getScript([a.api,"?shopId="+a.rstShopId,"&auctionId="+a.rstItemId,"&shopcatlist="+a.rstShopcatlist,"&title="+n.title,"&count="+n.count,"&dk="+a.rstdk,"&t="+e.now(),"&callback=DT.sameTypeRecomCallback"].join(""))}})}var i=t("dom"),a=t("node").all,o=a("body");n()}),KISSY.add("item-detail/switcher/index",["dom","event","ua","node","../gl/"],function(e,t){var n,i=t("dom"),a=(t("event"),t("ua")),o=t("node").all,r=(t("../gl/"),o("body")),s=document,c=(s.body,a.ie,6===a.ie,i.get("#bd")),d=!1;return{init:function(){r.on("switcher:expand",e.bind(this._expand,this)),r.on("switcher:toggle",e.bind(this._toggle,this)),r.on("switcher:collapse",e.bind(this._collapse,this)),!(n=i.get("#detail"))||"normal"==i.attr("#content","data-type")},_expand:function(){o(".col-sub").fadeOut(.3,function(){},"easeOut"),o("#J_MainWrap").animate({width:"950px"},{duration:.3,easing:"swing"}),i.addClass(c,"expanded"),d=!0},_collapse:function(){o(".col-sub").fadeIn(.3,function(){},"easeIn"),o("#J_MainWrap").animate({width:"750px"},{duration:.3}),i.removeClass(c,"expanded"),d=!1},_toggle:function(e){e&&e.halt(),this[d?"_collapse":"_expand"]()}}}),KISSY.add("item-detail/stat/index",["log","dom","event","node","../gl/","../config/"],function(e,t){var n=t("log").getLogger("stat"),i=t("dom"),a=t("event"),o=t("node"),r=t("../gl/"),s=o.all,c=s("body"),d=t("../config/");Hub.add({name:"stat",listen:{"domready:end":"init"},factory:function(e,t){function o(e){return e=e||100,KISSY.Config.debug||100*Math.random()<=e}function l(e,t){o(t)&&r(e)}var u=g_config.itemId,f=g_config.idata.seller.id;return{init:function(){d.isMS||this.lz(),this.cps(),this.scroll(),this.goldlog(),this.youshu(),this.a11y()},a11y:function(){var e=0;s(window).on("keydown",function(t){9===t.keyCode&&e++,10===e&&l("1024.200")})},youshu:function(){t.getScript("//g.alicdn.com/alilog/mlog/xwj.js",function(){try{window._ap_xwj&&_ap_xwj.monitor("201408203137236981",{sample_rate:.01,dead_line:14243616e5})}catch(e){n.warn("Youshu init failed: %s",e.message)}})},goldlog:function(){var e=s("body");e.on("header:market:hover",function(){l("12.403")}),e.on("header:search:shop",function(){l("12.410")}),e.on("header:search:tb",function(){l("12.409")}),e.on("footer:async:load",function(){l("1024.100",10)}),e.on("popsku:add:cart",function(){l("12.417")}),e.on("sizepicker:click",function(){l("9.0.0")}),e.on("thumb:switch",function(e){void 0!==e.index&&l("8.0.0?idx="+e.index)}),e.on("thumb:zoom",function(e){l("24253?type=2&idx="+e.index+"&w="+e.width)}),e.on("region:pick",function(){l("10.0.0")}),a.on("#detail","click",function(e){var t=e.target;i.hasClass(t,"ww-inline")&&l("12.22")}),s("#J_ReviewTabTrigger").on("click",function(){l("12.23")}),t.later(function(){s("#his_bar_wrap").length&&l("23420980"),s("#youdaoGWZS").length&&l("12.301"),s("#TK-con").length&&l("12.303"),s(".tickLabels").length&&l("12.304")},5e3),t.available("#J_ShopSearchIcon",function(e){s(e).on("click",function(){l("12.411")})}),s(".tb-social-pk").on("click",function(){(new Image).src="//gm.mmstat.com/pk.1.10"});var n=s("#J_Social"),o=s("#J_ShopInfo"),r=s(".tb-shop-info-ft",o);n.delegate("click",".J_Share",function(){l("12.405")}),r.delegate("click","a",function(e){var t=s(e.currentTarget);t.hasClass("J_TDialogTrigger")||l("12.413")})},scroll:function(){var e=document,n=i.scrollLeft(e),o=i.scrollTop(e),s=i.viewportHeight(),d=i.viewportWidth(),l=0,u=0,f=function(){var t=i.attr(e.body,"class").match(/tab-active-index-(\d)/g),n=t&&t[0];return n?n.substring(n.length-1):"-"}(),m=Math.max,g=t.one("#page"),p=t.one(".J_DetailSection"),h=g.offset().top,v=p.offset().top,b=function(){var t=i.scrollTop(e);0==f&&(n=m(n,i.scrollLeft(e)),o=m(o,t)),h>t&&(r.scrollShopBanner=!0),t>v&&(r.scrollItemDetail=!0)};c.on("tabbar:switch",function(e){f=e.idx}),a.on(i.query("li",i.get("#J_UlThumb")),"mouseenter",function(){++l}),a.on(e,"click",function(){++u}),a.on(e,"scroll",b),a.on(window,"beforeunload",function(){b();var a=g_config.startTime,c=t.now()-a,m={type:"vh4",sh:n,sv:o,vh:s,vw:d,cost:c,h:i.height(e),m:l,dh:i.height("#J_DivItemDesc"),c:u,s:a,r:e.referrer,tab:f};r("3242?"+t.param(m))})},cps:function(){t.getScript("//assets.alicdn.com/cps/trace.js",function(){try{CPS.trace({type:1,subtype:6,itemid:u,sellerid:f})}catch(e){n.warn("CPS init failed: %s",e.message)}})},lz:function(){t.getScript("//assets.alicdn.com/apps/lz/hc.js?v=5")}}}})}),KISSY.add("item-detail/underscore/index",function(){var e=Array.prototype,t=Object.prototype,n=Function.prototype,i=(e.push,e.slice,e.concat,t.toString),a=(t.hasOwnProperty,Array.isArray),o=(Object.keys,n.bind,{});return o.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},o.isArray=a||function(e){return"[object Array]"===i.call(e)},o.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},o.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var a=function(){var a=Array.prototype.slice.call(arguments),o=a.pop(),r=t.apply(null,a);r in n?o.apply(null,n[r]):r in i?i[r].push(o):(i[r]=[o],e.apply(null,a.concat([function(){n[r]=arguments;var e=i[r];delete i[r];for(var t=0,a=e.length;a>t;t++)e[t].apply(null,arguments)}])))};return a.unmemoized=e,a},o.now=Date.now||function(){return(new Date).getTime()},o.throttle=function(e,t,n){var i,a,r,s=null,c=0;n||(n={});var d=function(){c=n.leading===!1?0:o.now(),s=null,r=e.apply(i,a),s||(i=a=null)};return function(){var l=o.now();c||n.leading!==!1||(c=l);var u=t-(l-c);return i=this,a=arguments,0>=u||u>t?(clearTimeout(s),s=null,c=l,r=e.apply(i,a),s||(i=a=null)):s||n.trailing===!1||(s=setTimeout(d,u)),r}},o.extend=function(){var e,t,n,i,a,r,s=arguments[0]||{},c=1,d=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[c]||{},c++),"object"!=typeof s&&(s={}),c===d&&(s=this,c--);d>c;c++)if(null!=(e=arguments[c]))for(t in e)n=s[t],i=e[t],s!==i&&(l&&i&&(o.isObject(i)||(a=o.isArray(i)))?(a?(a=!1,r=n&&o.isArray(n)?n:[]):r=n&&o.isObject(n)?n:{},s[t]=o.extend(l,r,i)):void 0!==i&&(s[t]=i));return s},o}),KISSY.add("item-detail/footer/index",["node","io","../underscore/"],function(e,t){var n=t("node").all,i=n("body"),a=t("io"),o=t("../underscore/");Hub.add({name:"footer",listen:{"domready:end":"init"},instance:{init:function(){var t=n("[data-type=dr]"),r=n("[data-type=df]"),s=[];t.length&&s.push("dr"),r.length&&s.push("df");var c=o.once(function(){var n=Hub.config.get("async_sys"),o=n&&n.api||"//sd3.tbcdn.cn/asyn.htm?g=sys&v=2";a({type:"get",url:o,data:{mods:s.join(",")},success:function(n){e.each(n.mods,function(e,n){var i=e.data;"dr"==n?t.html(i):"df"==n&&r.html(i)}),i.fire("footer:async:load")},dataType:"jsonp",jsonp:"cb",jsonpCallback:"jsonp_sys",cache:!0})});t.length&&Viewport.watch(t,c),r.length&&Viewport.watch(r,c)}}})}),KISSY.add("item-detail/stock/stock",["log","base","../gl/","node"],function(e,t){var n=(t("log").getLogger("stock"),t("base")),i=t("../gl/"),a=t("node").all,o=a("body"),r=n.extend({initializer:function(){var e=this,t=e.$el;e.$input=a("input",t),e.$reduce=a(".J_Reduce",t),e.$increase=a(".J_Increase",t),t.length&&(e.check(),e.bind())},bind:function(){var e=this,t=e.$el,n=e.$input;n.on("valuechange",function(){e.check()}),t.delegate("click","a",function(t){var o=a(t.currentTarget),r=parseInt(n.val());t.halt(),o.data("data-disable")||(r?o.hasClass("J_Increase")?e.roll("up",r,function(){n.val(r+1),i("14.0"),e.check()}):e.roll("down",r,function(){n.val(r-1),i("14.1"),e.check()}):n.val(1))})},check:function(){var t=this,n=t.$input,i=t.$reduce,r=t.$increase,s=a(".J_StockVal",t.$el),c=s.text(),d=n.val(),l=Number(d),u=Number(c);t.validator.check(l)||(n.fire("focus"),setTimeout(function(){n.fire("select")},50)),d&&!l&&e.isNumber(l)&&(l=1,n.val(l)),1>l&&(l=1),l-1===0?i.data("data-disable",!0).addClass("tb-disable-reduce"):i.data("data-disable",!1).removeClass("tb-disable-reduce"),l>=99999999&&(l=99999999,n.val(l)),l>=u?r.data("data-disable",!0).addClass("tb-disable-increase"):r.data("data-disable",!1).removeClass("tb-disable-increase"),o.fire("quantity:changed",{quantity:l})},roll:function(t,n,i){var o,r,s,c=this,d="",l=c.$el,u=function(e,t,n){var i="";e+="",i+='<span id="'+t+'" class="'+n+'">';for(var a=0;a<e.length;a++)i+="<span>"+e[a]+"</span>";return i+="</span>"};if("up"===t?(o=n+1,r=-25,s="J_StockNumUp"):(o=n-1,r=25,s="J_StockNumDown"),e.UA.ie&&e.UA.ie<8)return void i();d+=u(n,"J_StockNum","tb-stock-num"),d+=u(o,s,"tb-stock-num tb-stock-num-"+t),a(".J_StockSpinner",l).append(d);var f=a("#J_StockNum"),m=a("#"+s);f.last("span").animate({top:r,opacity:.5},{duration:.1,complete:function(){f.remove()}}),m.last("span").animate({top:r,opacity:1},{duration:.1,complete:function(){m.remove(),i&&i()}})}},{ATTRS:{el:{setter:function(e){this.$el=e,this.el=e[0]}},validator:{setter:function(e){this.validator=e}}}});return r}),KISSY.add("item-detail/validator/validator",["base","../stockinfo/","node"],function(e,t){var n=t("base"),i=t("../stockinfo/"),a=t("node").all,o=n.extend({check:function(e){var t=this;if(t.hideError(),0>=e)t.showError("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5b9d\u8d1d\u6570\u91cf\uff01");else if(t.isOverSold())t.showError("\u5df2\u62cd\u5b8c, \u4f46\u8fd8\u6709\u4eba\u672a\u4ed8\u6b3e, \u5f85\u4f1a\u513f\u6765\u770b\u770b\uff01");else if(t.hasLocalStock())if(e>t.getStock())t.showError("\u60a8\u6240\u586b\u5199\u7684\u5b9d\u8d1d\u6570\u91cf\u8d85\u8fc7\u5e93\u5b58\uff01");else{if(!(e>t.getLimit()))return!0;t.showError("\u60a8\u6240\u586b\u5199\u7684\u5b9d\u8d1d\u6570\u91cf\u8d85\u8fc7\u9650\u8d2d\u6570\u91cf\uff01")}else t.showError("\u8be5\u5b9d\u8d1d\u5728\u60a8\u6240\u9009\u5730\u533a\u6682\u65e0\u5e93\u5b58\uff01")},hasLocalStock:function(){return this.sku.hasSku()?!i.isNoStock():0!==this.sku.getStock()},isOverSold:function(){return this.sku.isOverSold()},getLimit:function(){return this.sku.getLimit()},getStock:function(){return this.sku.getStock()},showError:function(e){var t=this.el,n=a(".tb-stop",t),e=e||"\u53d1\u751f\u9519\u8bef";if(!n[0]){var i=a('<div class="tb-msg"><p class="tb-stop">'+e+"</p></div>"),o=a(".tb-msgs",t);o.append(i),n=a(".tb-stop",t)}n.html(e),a(".tb-msg",t).show()},hideError:function(){var e=a(".tb-msg",this.el);e.hide()}},{ATTRS:{el:{setter:function(e){this.$el=e,this.el=e[0]}},sku:{setter:function(e){this.sku=e}}}});return o}),KISSY.add("item-detail/popsku/popsku",["sku","dom","../stock/stock","../validator/validator","../config/"],function(e,t){function n(){var e;return window.Hub&&(e=Hub.config.get("sku").valItemInfo.skuMap),e}var i=t("sku"),a=t("dom"),o=t("../stock/stock"),r=t("../validator/validator"),s=t("../config/"),c=e.all,d=e.Base,l=c(".tb-shop-cart");if(l.length){var u,f=c("body");f.on("promo:price",function(e){u=e.price});var m=d.extend({initializer:function(){var t=c("#detail"),n=this.get("tpl"),i=this.get("propTpl"),a=[];c(".J_Prop",t).each(function(t){var n=c("[data-property]",t),o=n.attr("data-property"),r=e.substitute(i,{propType:o,propContents:n.html(),propCls:n.hasClass("tb-img")?"tb-img":""});a.push(r)}),this.set("staticPrice",c("#J_StrPrice .tb-rmb-num").html()),this.set("staticStock",s.getStock()),this.contents=e.substitute(n,{propsContents:a.join(""),priceType:u?"\u4fc3\u9500":"\u4ef7\u683c",
priceContents:u||c("#J_StrPrice").html(),stock:g_config.DynamicStock&&g_config.DynamicStock.stock||this.get("staticStock")})},destructor:function(){this.$el.remove(),this.set("created",!1),this.set("rendered",!1),this.el=null,this.$el=null},render:function(){if(!this.get("rendered")){var e=c(this.contents);this.set("el",e);var t=a.viewportHeight();c(".J_PopSKUProps",e).css("maxHeight",String(t-this.get("propsOffsetHeight"))+"px"),this.bind(),c(this.get("render")).append(e),this.set("rendered",!0)}},bind:function(){function e(e){e.each(function(e){var t=c(e).css("background-image");if(-1!==t.indexOf("url(")){var n=t.match(/url\("?([^\)^"]*)/)[1].replace("30x30","160x160");a.set("pic",n)}})}var t=this.$el,a=this,s=n(),d=new i({root:t,hook:"li",skuMap:s,promoMap:g_config.PromoData||{},stockMap:g_config.DynamicStock||{},attrName:"data-value",selectedClass:"tb-selected",disabledClass:"tb-disabled"});d.on("selectionChanged",function(t){var n=c("a",t.sku.els);e(n)}),d.on("skuChanged skuFound",function(e){var t=e.sku;a.set("sku",t),a.set("price",t.price),t.limit?a.set("limit",t.limit):a.set("stock",t.stock),"skuFound"===e.type&&c(".J_PopSKUProps").removeClass("tb-attention"),d.isOverSold()}),d.on("skuLost",function(){var e=a.get("limit");e?a.set("limit",e):a.get("hasPromoPrice")?a.setDefaultStock(d):a.setDefaultProps(d)}),d.init(),d.getStock=function(){return a.get("stock")},d.getLimit=function(){return a.get("limit")},d.getStaticStock=function(){return Number(a.get("staticStock"))};var l=g_config.Price;l&&this.set("staticPrice",l),this.setDefaultProps(d);{var u=new r({el:t,sku:d});new o({el:c(".J_PopSKUStockProp",t),validator:u})}c(".J_PopSKUAddCart",t).on("click",function(e){e.preventDefault();var n=!1;if(c(".J_Prop",t).each(function(e){var t=c(e),i=c(".tb-selected",t);0===i.length?(t.addClass(".tb-prop-unselected"),n=!0):t.removeClass(".tb-prop-unselected")}),n)c(".J_PopSKUProps",t).addClass("tb-attention");else{var i=a.get("sku"),o=a.get("amount");f.fire("popsku:add:cart"),f.fire("cart:add",{skuId:i&&i.skuId,amount:o,validator:u,success:function(){f.fire("toolbar:cart:fly",{pos:c(".J_PopSKUAddCart",t).offset(),pic:a.get("pic")||g_config.idata.item.pic+"_60x60.jpg"}),a.hide()}})}}),c(".J_PopSKUCancer",t).on("click",function(e){e.preventDefault(),t.toggle()}),c(".J_PopSKUClose",t).on("click",function(e){e.preventDefault(),c(".J_PopSKUProps").removeClass("tb-attention")})},setDefaultProps:function(e){var t=e.getDefaultPromo();!t||!t.price||t.limitTime&&"false"===t.isStart?this.set("price",this.get("staticPrice")):(this.set("price",t.price),this.set("priceType","\u4fc3\u9500"),this.set("hasPromoPrice",!0)),t&&t.limit?this.set("limit",t.limit):this.setDefaultStock(e)},setDefaultStock:function(e){var t=e.getDefaultStock();this.set("stock",t.stock)},toggle:function(){return this.$el.toggle()},show:function(){return this.$el.show()},hide:function(){return this.$el.hide()}},{ATTRS:{tpl:{value:'<div class="J_PopSKU bubble tb-popsku"><span class="arrow-top"><i></i></span><div class="tb-popsku-content">                    <div class="tb-prop tb-price-prop tb-clearfix"><div class="tb-property-type J_PopSKUPriceType">{priceType}</div><div class="tb-price">{priceContents}</div></div>                    <div class="tb-props J_PopSKUProps">                    {propsContents}                    <dl class="J_PopSKUStockProp tb-amount tb-prop tb-clearfix">                    <dt class="tb-property-type">\u6570\u91cf</dt>                    <dd>                    <span class="J_StockSpinner tb-stock">                    <a href="#" hidefocus class="tb-reduce J_Reduce tb-iconfont ">&#411;</a>                    <input type="text" class="J_PopSKUAmount tb-text" value="1" maxlength="8" title="\u8bf7\u8f93\u5165\u8d2d\u4e70\u91cf"/>                    <a href="#" hidefocus class="tb-increase J_Increase tb-iconfont ">&#410;</a>\u4ef6</span>                    <em>(\u5e93\u5b58<span class="tb-count J_StockVal">{stock}</span>\u4ef6)</em>                    </dd></dl>                    <div class="tb-actions">                    <div class="tb-btns">                    <div class="tb-btn-add"><a href="#" class="J_PopSKUAddCart" title="\u52a0\u5165\u8d2d\u7269\u8f66">\u786e\u5b9a</a></div>                    <div class="tb-btn-cancer"><a href="#" class="J_PopSKUCancer" title="\u53d6\u6d88">\u53d6\u6d88</a></div>                    </div>                    <div class="tb-info">\u8bf7\u52fe\u9009\u60a8\u8981\u7684\u5546\u54c1\u4fe1\u606f<span class="tb-close J_PopSKUClose tb-iconfont">&#223;</span></div>                    </div>                    <div class="tb-msgs"></div>                    </div>                </div></div>'},propTpl:{value:'<dl class="J_Prop tb-prop tb-clearfix">                    <dt class="tb-property-type">{propType}</dt>                    <dd>                    <ul data-property="{type}" class="tb-clearfix {propCls}">                    {propContents}                    </ul></dd></dl>'},render:{},created:{value:!1},rendered:{value:!1},el:{setter:function(e){this.$el=e,this.el=e[0]}},pic:{setter:function(t){function n(){s.height(Number(a.height())-i.get("showcaseOffsetHeight"))}var i=this,a=this.$el;if(this._picInited)c(".J_PopSKUPic",a).attr("src",t);else{var o='<div class="tb-showcase"><img class="J_PopSKUPic tb-pic" src="{src}"></div>',r=e.substitute(o,{src:t});a.addClass("tb-popsku-large");var s=c(r);a.append(s),this.get("rendered")?n():this.on("afterRenderedChange",function(){n()})}this.pic=t,this._picInited=!0},getter:function(){return this.pic||""}},sku:{},amount:{getter:function(){return c(".J_PopSKUAmount",this.el)[0].value},setter:function(){}},stock:{setter:function(e){c(".J_StockVal",this.el).html(e)},getter:function(){return this.get("hasLimit")?void 0:Number(c(".J_StockVal",this.el).text())}},limit:{setter:function(e){c(".J_StockVal",this.el).parent().html('(\u9650\u8d2d<span class="tb-count J_StockVal">'+e+"</span>\u4ef6)"),this.set("hasLimit",!0)},getter:function(){return this.get("hasLimit")?Number(c(".J_StockVal",this.el).text()):void 0}},price:{setter:function(e){e&&c(".tb-rmb-num",this.el).html(e)},getter:function(){return c(".tb-rmb-num",this.el).text()}},priceType:{setter:function(e){c(".J_PopSKUPriceType",this.el).html(e)}},listeners:{value:[]},propsOffsetHeight:{value:150},showcaseOffsetHeight:{value:80}}});return m}}),KISSY.add("item-detail/popsku/index",["node","../gl/","./popsku"],function(e,t){var n=t("node").all,i=t("../gl/"),a=t("./popsku");if(0!==g_config.idata.item.quickAdd){var o=n(".tb-shop-cart"),r=new a({render:o}),s=!1;n("#J_TabShopCart").on("click",function(){r.render(),r.toggle(),s||(n(document).on("click",function(e){o.contains(e.target)||o.equals(e.target)||r.hide()}),s=!0),i("12.408")})}}),KISSY.add("item-detail/doctor/index",["node","../gl/","ua"],function(e,t){function n(){return o.ios||o.android}var i=t("node").all,a=t("../gl/"),o=t("ua");return{init:function(){n()||e.use("doctor",function(e,t){var n=i("body");n.on("doctor:screen:zoom",function(){a("1024.10")}),n.on("doctor:screen:reset",function(){a("1024.11")});new t})}}}),KISSY.add("item-detail/shortcuts/index",["ua","node"],function(e,t){var n=t("ua"),i=t("node").all;n.webkit&&Hub.add({name:"shortcuts",listen:{load:"init"},instance:{init:function(){function t(){e.use(["shortcuts"],function(e,n){t.loaded?s.show():(t.loaded=!0,s=new n,s.show(),i(".J_ShortcutsHideDialog",a).on("click",function(){s.hide()}))})}var n='<div style="border: 0;clip: rect(0 0 0 0);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;">                <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u952e\u76d8\u5feb\u6377\u952e\u9009\u62e9\u64cd\u4f5c\u6216\u8fdb\u884c\u7ad9\u70b9\u5bfc\u822a\u3002</p>                <button class="J_ShortcutsShowDialog" tabindex="-1">\u663e\u793a\u5feb\u6377\u952e\u9762\u677f</button>                <button class="J_ShortcutsHideDialog" tabindex="-1">\u5173\u95ed\u5feb\u6377\u952e\u9762\u677f</button>                </div>',a=i(n),o=i("body"),r=o.first();r[0]?r.before(a):o.append(a),i(document).on("keydown",function(e){var n=e.target,i=n.tagName;e.shiftKey!==!0||191!==e.keyCode||"INPUT"===i||"SELECT"===i||"TEXTAREA"===i||n.isContentEditable||(e.preventDefault(),t())}),i(".J_ShortcutsShowDialog",a).on("click",function(){t()});var s}}})}),KISSY.add("item-detail/favorite/index",["node","../tbtoken/"],function(e,t){var n=t("node").all,i=(n("body"),t("../tbtoken/"));n(".J_TDialogTrigger").on("click",function(e){e.preventDefault();var t=e.currentTarget,n=t.getAttribute("href");KISSY.use("favorite",function(e,t){i.setFavToken();var a=new t({url:n,showEvent:!1,callback:function(e){}});a.show()})})}),KISSY.add("item-detail/custommarket/index",["dom","node"],function(e,t){function n(e){return e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.getElementById("J_serviceId")?e.contentWindow.document.getElementById("J_serviceId").value:void 0}var i=t("dom"),a=t("node").all,o=a("body"),r=i.get("#J_CustomMarket");r&&(o.fire("cart:params",{params:function(e){var t=n(r);return t?"flushingPictureServiceId="+g_config.itemId+"_"+(e.skuId||0)+"_"+t:""}}),o.fire("buy:before",{action:function(e){var t=i.get("#J_FrmBid"),a=n(r);if(a){var o=i.create('<input type="hidden" name="flushingPictureServiceId" value="'+g_config.itemId+"_"+(e.skuId||"0")+"_"+a+'"/>');i.append(o,t)}else t.elements.flushingPictureServiceId&&i.remove(t.elements.flushingPictureServiceId)}}))}),KISSY.add("item-detail/relatemarket/index",["dom","io","node"],function(e,t){function n(t,n){var i='30 \u5929\u552e<a href="{reviewUrl}" target="_blank">{sellCount}</a>\u4ef6',a=0,o=[];return e.each(n,function(n){var r=n.url,s=n.monthSellCount,c=e.substitute(i,{sellCount:s,reviewUrl:r.replace("&","&on_comment=1&")}),d="";n.extMap&&n.extMap.mark20141111&&(d='<span class="tb-icon-201411"></span>',n.extMap.price20141111&&(n.price=n.extMap.price20141111)),o[a++]=e.substitute(t,{url:r,pic:n.pic,desc:n.itemName,price:parseFloat(n.price).toFixed(2),sales:s?c:"\u7b49\u4f60\u8d2d\u4e70",icon:d})}),o.join("")}function i(e){return d.replace(/{{#each}}(.*){{\/each}}/,function(t,i){return n(i,e)})}function a(t){l||r({url:t,cache:!1,type:"get",dataType:"jsonp",jsonpCallback:"jsonp_relatemarket",success:function(t){if(e.isPlainObject(t)){{var n,a=t.result;t.spm}l=!0,e.isArray(a)&&a.length&&(n=o.create(i(a)),o.get("#J_CartInfo").appendChild(n))}},timeout:3})}var o=t("dom"),r=t("io"),s=t("node").all,c=s("body"),d='<div class="tb-relate-market" data-spm="1001000"><h4>\u8d2d\u4e70\u6b64\u5b9d\u8d1d\u7684\u7528\u6237\u8fd8\u8d2d\u4e70\u4e86\uff1a</h4><ul>{{#each}}<li><div class="tb-pic tb-s80"><a href="{url}" target="_blank"><img src="{pic}_b.jpg" height="80" alt="{desc}" /></a></div><a class="tb-desc" href="{url}" title="{desc}" target="_blank">{desc}</a><span class="tb-price">&yen;<em>{price}</em></span><span class="tb-sales">{sales}</span><span class="tb-icon">{icon}</span></li>{{/each}}</ul></div>',l=!1;c.on("relatemarket:show",function(){var e=Hub.config.get("sku"),t=e.apiRelateMarket;t&&a(t)})}),KISSY.add("item-detail/report/index",["node"],function(e,t){var n=t("node").all,i=function(){this.init()};i.prototype.init=function(){var e=this;e.bind()},i.prototype.bind=function(){var e=n("#J_TEditItem");e.delegate("click","#J_Report",function(e){var t=n(e.currentTarget);t.toggleClass("tb-report-hover")})},new i}),KISSY.add("item-detail/tbcp/index",function(e){function t(){"undefined"!=typeof tbcpData&&"undefined"!=typeof tbcpConfig&&e.available("#J_LinkBuy",function(){e.getScript(tbcpConfig.url)})}t()}),KISSY.add("item-detail/o2oservice/index",["log","../config/","node"],function(e,t){var n=t("log").getLogger("o2o"),i=t("../config/"),a=t("node"),o=a.all,r=o("#J_O2OService");return{init:function(){g_config.supportO2OService&&r.length&&(e.config("packages",{cbase:{base:(i.isDaily?"//g-assets.daily.taobao.net/":"//g.alicdn.com/")+"cm/base/0.4.1/"}}),e.use("cbase/p/o2o-service/tb-detail",{success:function(e,t){try{t.init({itemId:g_config.itemId,container:r})}catch(i){n.warn("Init failed: %s",i.message)}},error:function(e){n.warn("Component load error: %s",e.message)}}))}}}),KISSY.add("item-detail/skutip/index",["log","node","../config/","overlay","event"],function(e,t){var n=t("log").getLogger("skutip"),i=t("node").all,a=t("../config/"),o=(i("body"),t("overlay")),r=t("event"),s=function(){this.init()};return s.prototype.init=function(){var e=Hub.config.get("sku").valItemInfo;if(e&&e.propertyMemoMap&&(this.skuMemo=e.propertyMemoMap),this.skuMemo)try{this._initColorTip()}catch(t){n.warn("Init failed: %s",t.message)}},s.prototype._initColorTip=function(){var e=this;if(i(".J_Prop_Color li").length){var t=new o({elStyle:{border:"1px solid #ccc",color:"#3f3f3f",padding:"5px",background:"#fff"}});r.delegate(".J_Prop_Color","mouseenter","li",function(n){var a=i(n.target),o=a.attr("data-value");o||(a=a.parent("li"),o=a.attr("data-value"));var r=e.skuMemo[o];t.set("content",r),r&&(t.set("align",{node:a,points:["bl","tl"],offset:[0,5]}),t.show())}),r.delegate(".J_Prop_Color","mouseleave","li",function(){t.hide()})}},{init:function(){a.isTouch||new s}}}),KISSY.add("item-detail/stepprice/index",["log","node"],function(e,t){var n=t("log").getLogger("stepprice"),i=t("node"),a=i.all,o=a("body"),r=a(".tb-meta");o.on("core:ready",function(){try{s.init()}catch(e){n.warn("Init failed: %s",e.message)}});var s={init:function(){var e=this,t=g_config.PromoData;t&&(t.def&&this.update(t.def),o.on("sku:found sku:changed",function(n){var i=";"+n.sku.pvs+";";t[i]&&e.update(t[i])}))},_initContainer:function(){try{var e='<div class="tb-clearfix tb-step-price"><span class="tb-name">\u9636\u68af\u4ef7</span><div class="tb-step-price-info"></div>';a(e).insertAfter(r),this.priceContainer=a(".tb-step-price"),this.priceEl=this.priceContainer.one(".tb-step-price-info")}catch(t){n.warn("Render failed: %s",t.message)}},render:function(t){try{if(t.length){var i="";e.each(t,function(e){i+='<span class="tb-step-price-group">\u6ee1'+e.count+'\u4ef6: <em class="tb-rmb">\xa5</em>'+e.price+"/\u4ef6</span>"}),this.priceEl.html(i),this.priceContainer.show()}else this.priceContainer.hide(),this.priceEl.html("")}catch(a){n.warn("Render failed: %s",a.message)}},update:function(e){var t=this;try{var i=e&&e[0]&&e[0].stepPrice;i&&i.length?(t.priceEl||t._initContainer(),t.render(i)):t.priceContainer&&t.render([])}catch(a){n.warn("Exec error: %s",a.message)}}}}),KISSY.add("item-detail/afterPayment/index",["node","log"],function(e,t){function n(){KISSY.use("installment/afterPayment",{success:function(e,t){function n(){try{t.render({curPrice:i,num:a})}catch(e){r.warn("Render failed: %s",e.message)}}var i=g_config.idata.item.price,a=1;g_config.PromoData&&g_config.PromoData.def&&g_config.PromoData.def.length&&g_config.PromoData.def[0].price&&(i=g_config.PromoData.def[0].price),t.on("paymentChange",function(e){try{o.fire("buy:params",{params:function(){return{xshmPay:e}}}),e?o.fire("buy:button",{content:"\u5148\u7528\u540e\u4ed8"}):o.fire("buy:button",{content:"\u7acb\u5373\u8d2d\u4e70"})}catch(t){r.warn("Exec failed: %s",t.message)}}),o.on("sku:found sku:changed",function(e){i=e.sku.price,n()}),o.on("quantity:changed",function(e){a=e.quantity,n()});try{t.init({el:"#J_AfterPayment",itemId:g_config.itemId,curPrice:i,num:a,data:g_config.tryThenBuy})}catch(s){r.warn("Init failed: %s",s.message)}},error:function(e){r.warn("Component load failed: %s",e.message)}})}var i=t("node"),a=i.all,o=a("body"),r=t("log").getLogger("afterpayment");o.on("stock:ready",function(){g_config.tryThenBuy&&(g_config.tryThenBuy.success||"-3"==g_config.tryThenBuy.errorCode)&&n()})}),KISSY.add("item-detail/sitenav/index",["log"],function(e,t){var n=t("log").getLogger("sitenav");return{init:function(){n.info("Init start");try{TB.Global.blacklist=["fn-cart"],TB.Global.init()}catch(e){n.warn("Init execution failed: %s",e.message)}n.info("Init end")}}}),KISSY.add("item-detail/toolbar/index",["log","../config/"],function(e,t){{var n=t("log").getLogger("toolbar");t("../config/")}return{init:function(){function t(){n.info("Init load assets"),e.use(["tbar"],function(e,t){t.config("feedback",i),t.config("gotop",o),t.config("pk",a);var r=new t({items:[{list:["ww","cart","pk"]},{list:["feedback","gotop"]}]});n.info("Render toolbar"),r.render()})}var i={url:"//ur.taobao.com/survey/view.htm?spm=2013.1.0.0.bGUIH3&id=1927"},a={ctItem:{itemId:g_config.itemId,skuId:0,from:2,pic:g_config.idata.item.pic+"_160x160.jpg",url:location.href}},o={animation:!0};try{TB.Global.plugin.showSideBar({config:{feedback:i,pk:a,gotop:o},items:[{list:["ww","cart","pk"],splitLine:!0},{list:["feedback","gotop"]}],success:function(){},error:function(){t()}})}catch(r){t()}}}}),KISSY.add("item-detail/redeem/index",["log","node","dom","event","../config/"],function(e,t){var n=(t("log").getLogger("redeem"),t("node").all),i=(n("body"),t("dom")),a=t("event"),o=t("../config/"),r=o.getSkuConfig,s="tb-selected",c=function(){var e=i.get(".J_RedeemMethods");if(e){var t=i.query("li",e);if(t.length){i.addClass(t[0],s);var n=i.create('<input type="hidden" name="etm" value="">');i.append(n,r().form),n.value=i.attr(t[0],"data-value"),a.on(t,"click",function(e){e.preventDefault();for(var a=e.target;"LI"!==a.tagName;)a=a.parentNode;i.hasClass(a,s)||(i.removeClass(t,s),i.addClass(a,s),n.value=i.attr(a,"data-value"))})}}};return{init:c}}),KISSY.add("item-detail/viewer/template/viewer-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+='<div id="J_Viewer" class="tb-viewer" data-spm="20140017">\n    <a id="J_ViewerClose" href="javascript:;" class="tb-viewer-close"><i class="tb-viewer-icon">&#xe602;</i></a>\n    <div class="tb-viewer-control">\n        <a href="javascript:;" class="tb-viewer-control-left tb-viewer-icon" id="J_ViewerPrev">&#xe600;</a>\n    </div>\n\n    <div class="tab-content tb-viewer-contents">\n        ';var u={},f=[],m=d(o,e,"images",0,8);f.push(m),u.params=f,u.fn=function(){var e="";return e+='\n        <div class="tab-pannel">\n        </div>\n        '},n+=s(o,e,u,"each",8),n+='\n    </div>\n    <div class="tb-viewer-control">\n        <a href="javascript:;" class="tb-viewer-control-right tb-viewer-icon" id="J_ViewerNext">&#xe601;</a>\n    </div>\n\n    <div class="tb-viewer-side">\n        <h3 class="tb-viewer-title">';var g=l(o,e,{},"title",0,18);n+=c(g,!0),n+='</h3>\n        <ul class="tab-nav tb-viewer-indicators">\n            ';var p={},h=[],v=d(o,e,"images",0,20);h.push(v),p.params=h,p.fn=function(e){var t="";t+='\n            <li class="tb-viewer-thumb"><img src="';var n=l(o,e,{},"this",0,21);return t+=c(n,!1),t+='_50x50.jpg"></li>\n            '},n+=s(o,e,p,"each",20),n+="\n        </ul>\n        ";var b={},y=[],k=d(o,e,"enableAddToCart",0,24);y.push(k),b.params=y,b.fn=function(){var e="";return e+='\n        <a href="javascript:;" role="button" data-spm-click="gostr=/tbdetail;locaid=d1" role="button" id="J_ViewerAddCart" class="tb-viewer-btn"><i class="tb-viewer-icon">&#xe604; </i>\u52a0\u5165\u8d2d\u7269\u8f66</a>\n        '},n+=s(o,e,b,"if",24),n+='\n        <a href="//www.taobao.com/market/2014/similar.php?itemid=';var _=l(o,e,{},"itemId",0,27);return n+=c(_,!0),n+='" target="_blank" data-spm-click="gostr=/tbdetail;locaid=d2" class="tb-viewer-link"><i class="tb-viewer-icon">&#xe603; </i>\u672c\u5e97\u76f8\u4f3c\u5b9d\u8d1d</a>\n    </div>\n</div>\n'}}),KISSY.add("item-detail/viewer/index",["node","../underscore/","../config/","xtemplate","overlay","./template/viewer-xtpl","slide"],function(e,t){function n(e,t){t=t||f;var n={top:t.scrollTop(),left:t.scrollLeft()};n.right=n.left+t.width(),n.bottom=n.top+t.height();var i=e.offset();return i.right=i.left+e.outerWidth(),i.bottom=i.top+e.outerHeight(),!(n.right<i.left||n.left>i.right||n.bottom<i.top||n.top>i.bottom)}function i(){this.images=this.getImagesFromDOM()}function a(){var e=0;return o("#J_UlThumb > li").each(function(t,n){"J_VideoThumb"==t[0].id&&(e-=1),t.hasClass("tb-selected")&&(e+=n)}),e}var o=t("node").all,r=o("body"),s=t("../underscore/"),c=t("../config/"),d=t("xtemplate"),l=t("overlay"),u=t("./template/viewer-xtpl"),f=o(window);i.prototype={getTitleFromDOM:function(){return o(".tb-main-title").text()},getImagesFromDOM:function(){var t=c.getItemConfig("auctionImages")||[];return t[0]||e.map(o("#J_UlThumb img"),function(e){var n=o(e).attr("data-src");n&&t.push(n.replace(/_\d0x\d0\.jpg(_\.webp)?$/g,""))}),t},show:function(e){this.render(),this.overlay.show(),this.bind(),e&&this.slide&&this.slide.go(e)},hide:function(){this.overlay.hide()},render:function(){if(!this.rendered){var e=new d(u).render({images:this.images,title:this.getTitleFromDOM(),itemId:c.getGlobalConfig().itemId,enableAddToCart:c.getItemConfig("disableAddToCart")?!c.getItemConfig("disableAddToCart"):!0}),t=new l({content:e,elCls:"tb-viewer-overlay",align:{points:["cc","cc"]},mask:{effect:"fade",closeOnClick:!0},zIndex:100000021});this.overlay=t,this.rendered=!0}},centerImage:function(e,t){var n=!0;t.css({overflow:"hidden",position:"absolute"==t.css("position")?"absolute":"relative"}),e.css({position:"static",width:"auto",height:"auto","max-width":"100%","max-height":"100%"});var i={w:t.width(),h:t.height(),r:t.width()/t.height()},a={w:e.width(),h:e.height(),r:e.width()/e.height()};e.css({"max-width":"none","max-height":"none",width:Math.round(i.r>a.r^n?"100%":i.h/a.h*a.w),height:Math.round(i.r<a.r^n?"100%":i.w/a.w*a.h)});var i={w:t.width(),h:t.height()},a={w:e.width(),h:e.height()};e.css({position:"absolute",left:Math.round((i.w-a.w)/2),top:Math.round((i.h-a.h)/3)})},bind:function(){function e(e){var t=o("#J_Viewer .tab-pannel")[e],n=new Image;n.onload=function(){var e=o(this),t=e.parent().parent();i.centerImage(e,t)},n.src=i.images[e],o(t).append(n)}if(!this.binded){var i=this,a=t("slide"),c=new a("#J_Viewer",{eventType:"mouseover",triggerDelay:400,effect:"fade",touchmove:!0});e(0),c.on("switch",function(t){e(t.index)}),o("#J_ViewerPrev").on("click",function(e){e.halt(),c.previous(),c.autoSlide&&c.stoped===!1&&c.stop().play()}),o("#J_ViewerNext").on("click",function(e){e.halt(),c.next(),c.autoSlide&&c.stoped===!1&&c.stop().play()}),o("#J_ViewerClose").on("click",function(e){e.halt(),i.overlay.hide()}),o("#J_ViewerAddCart").on("click",function(){r.fire("cart:click"),i.overlay.hide()});var d=o(".tb-viewer-overlay");f.on("scroll",s.throttle(function(){n(d)||i.overlay.hide()},100)),this.slide=c,this.binded=!0}}};var m=new i;r.on("viewer:show",function(e){m.show(e.url)}),r.on("viewer:hide",function(){m.hide()}),c.getItemConfig("auctionImages")&&o(".tb-booth > a").on("click",function(e){var t=a();e.preventDefault(),m.show(t)})}),KISSY.add("item-detail/wangpu/index",["log","io","dom","ua","node","../cdnurl/","../config/"],function(e,t){function n(t){t&&e.isArray(t)&&e.each(t,function(t){e.getScript(t)})}function i(e){return['<style type="text/css">',e||"","</style>"].join("")}function a(e,t){try{l.html(e,t,!0)}catch(n){c.warn("Wangpu html error: %s",n.message)}}function o(t,n,i,o){var r=l.create('<div style="display: none"></div>'),s=null;for(l.prepend(r,document.body),a(r,n);r.firstChild;)8!==r.firstChild.nodeType?(s=r.firstChild.cloneNode(!0),"side"==o&&-1!=Object.prototype.toString.call(s).indexOf("HTMLDivElement")&&e.all(".tshop-signboard",s)&&e.all(".tshop-signboard",s).parent()&&e.all(".tshop-signboard",s).parent().remove(),l.insertBefore(s,t),s.tagName&&"DIV"===s.tagName&&i.push(s),r.removeChild(r.firstChild)):r.removeChild(r.firstChild);l.remove(t),l.remove(r)}function r(e,t,n){a(e,t),n.push(e)}function s(){return u.ios||u.android}var c=t("log").getLogger("wangpu"),d=t("io"),l=t("dom"),u=t("ua"),f=t("node").all,m=t("../cdnurl/"),g=(t("../config/"),f("body")),p=150,h=!0,v=function(){var t={};return e.each(l.query(".J_AsyncDC"),function(e){var n=l.attr(e,"data-type");n&&(t[n]=e)}),t}(),b={init:function(){var t=Hub.config.get("async_dc")||{},n=t.api;return!n||e.isEmptyObject(v)||s()?void b.noDc():(c.info("Request %s",n),void d({type:"get",url:n+(b.times?"&t="+b.times:""),success:b.newDc,error:b.noDc,dataType:"script",cache:!0}))},parse:function(t){{var i=t.mods;t.id}if(t.cb){{e.now()}t.cb(t.mods)}else e.each(i,function(t,i){try{{var a=(e.now(),t.assets||{}),o=t.cb;t.m}n(a.css),t.name=i,o(t),n(a.js)}catch(r){e.log(r)}})},times:0,retry:function(){var e=this;return e.times<1?(e.times+=1,c.info("Retry request"),e.init(),void 0):!0},newDc:function(){function t(){var e=i(n.styleCode),t=f(e);f(".J_AsyncDC[data-type=css]").append(t)}if(!window.SHOP_DC)return c.warn("Request failed"),void(b.retry()&&(c.warn("Request failed then retry request failed"),b.noDc()));var n=SHOP_DC,a={},o={},r=function(e){var t={};return t.data=e,t};if("errorMsg"in n&&!n.globalCssUrl){if(c.warn("Server response error"),b.retry()){{"\u88c5\u4fee\u8fd4\u56de\u9519\u8bef:"+n.errorMsg}c.warn("Response error then retry request failed"),b.noDc()}}else{c.info("Init end"),u.ie?e.getScript(n.globalCssUrl,{success:function(){var e=n.styleCode;l.addStyleSheet(e)}}):(Hub.loadCSS(n.globalCssUrl),t()),h=n.newTemplate,a.mods=o,a.cb=b.dc,o.head=r(n.header),o.side=r(n.left),o.main=r(n.right),o.foot=r(n.footer),b.parse(a),n.showLeft===!1&&g.fire("switcher:expand");var s="",d={1:"//img.alicdn.com/tps/i4/T1prA2XhlhXXcgU5U6-113-21.png",2:"//img.alicdn.com/tps/i1/T1lKXaXp4hXXcgU5U6-113-21.png"};h?d[n.siteCategory]&&(s='<div class="shop-info"><a target="_blank" class="version" href="//wangpu.taobao.com/wangpu/comparation.htm?spm=a1z10.1.0.192.KUW8sQ"><img src="'+d[n.siteCategory]+'" /></a></div>'):s='<div id="wangpu-copyright" class="grid-c" data-spm="1000376"><p><a data-spm="d1" href="//wangpu.taobao.com?spm=2013.1.1000376.1">\u672c\u5e97\u6240\u4f7f\u7528\u65fa\u94fa\u7248\u672c:'+n.categoryName+"</a></p></div>",l.get("#copyright").innerHTML=s}},dc:function(){var t=document.createElement("div"),n=g_config.vdata.sys.toggle,i=function(e,t){var n=l.attr(e,t);n&&l.attr(e,t,m.rewrite(n,g_config.webp,g_config.newDomain))},a=function(a){return a=a.replace('class="col-sub','class="col-sub tb-shop'),t.innerHTML="a"+a,n&&"false"===n.dcP?e.each(l.query("img",t),function(e){e.src="//g.alicdn.com/s.gif",l.removeAttr(e,"data-ks-lazyload")}):e.each(l.query("img",t),function(e){i(e,"src"),i(e,"data-ks-lazyload")}),t.innerHTML.substring(1)},s=function(){g_config.dcCheck&&((new Image).src=g_config.dcCheck)};return function(t){var n=window.g_config,i=(n.assetsHost,Hub.config.get("isv")),c=[];e.each(t,function(e,t){var n=v[t];if(t&&n){var i=a(e.data,t);"main"===t||"head"===t?r(n,i,c):o(n,i,c,t),delete v[t]}}),l.css(l.next(l.parent("#J_MainWrap")),"margin-top","-17px");var d=f("#hd");if(d){var u=d.height();p>u&&d.parent().css("height","auto")}h||e.config({packages:[{name:"wangpu",path:"//g.alicdn.com/shop/taesite/0.1.7/old-tpl",ignorePackageNameInUri:h,charset:"utf-8"}]}),e.use("wangpu/init",function(e,t){t.init({pageType:"cdetail",lazyContainers:c,isvParams:i}),g.fire("dc:decorated")}),s()}}(),noDc:function(){f("#J_DcHead").hide(),v.css&&r(v.css,i(),[]),e.all(".tb-switch-bar").hide(),g.fire("switcher:expand")}};return b}),KISSY.add("item-detail/agriculture/index",["log","dom","node","ajax"],function(e,t){"use strict";function n(e){return o("<div></div>").html(e).text()}{var i=t("log").getLogger("agriculture"),a=t("dom"),o=t("node").all,r=t("ajax");o("body")}g_config&&g_config.farmInfo&&g_config.farmInfo.farmUrl&&(i.info("Request %s",g_config.farmInfo.farmUrl),r({url:g_config.farmInfo.farmUrl,dataType:"jsonp",jsonpCallback:"jsonp_agriculture_intro",error:function(e){i.warn("Request failed: %s",e.message)},success:function(e){if(i.info("Success accept data"),e){var t="",r="",s="",c="",d="",l=0;if(e.isCertiFarm&&e.farmPics&&e.farmPics.length>0){l=e.farmPics.length,t="\u8ba4\u8bc1\u8bc1\u4e66",r="J_FarmCerti",s='<li><a class="tb-tab-anchor" href="javascript:void(0);" hidefocus="true" shortcut-key="g c" shortcut-label="\u67e5\u770b\u8ba4\u8bc1\u8bc1\u4e66" shortcut-effect="click"data-index="5" data-spm-click="gostr=/tbdetail;locaid=d2">'+t+'<em class="'+r+'"></em></a><div class="tb-selected-indicator"></div></li>';for(var u=0;l>u;u++)d+='<img src="'+e.farmPics[u]+'" alt="\u65b0\u519c\u4e1a\u8ba4\u8bc1\u8bc1\u4e66"></span>';c='<div id="farm-auth" class="J_DetailSection" style="display: none;"><h4 class="hd" style="display: none;">\u8ba4\u8bc1\u8bc1\u4e66</h4><div class="tb-farm-auth-book"><p class="tb-msg"><span class="tb-tips">\u4ee5\u4e0b\u8bc1\u4e66\u662f\u7531\u56fd\u5bb6\u8ba4\u76d1\u59d4\u6307\u5b9a\u7684\u6709\u673a\u8ba4\u8bc1\u673a\u6784\u9881\u53d1\u7684\u6709\u6548\u8bc1\u4e66\u3002</span></p><p class="farm-auth-img-box" id="J_farm_auths">'+d+"</p></div></div>",o("#J_TabBar .tb-last").after(s),o("#J_SubWrap").after(c)}else if(e.promiseUrls&&e.promiseUrls.length>0){l=e.promiseUrls.length,t="\u519c\u573a\u627f\u8bfa",r="J_FarmPromise",s='<li><a class="tb-tab-anchor" href="javascript:void(0);" hidefocus="true" shortcut-key="g c" shortcut-label="\u67e5\u770b\u519c\u573a\u627f\u8bfa" shortcut-effect="click"data-index="6" data-spm-click="gostr=/tbdetail;locaid=d2">'+t+'<em class="'+r+'"></em></a><div class="tb-selected-indicator"></div></li>';for(var u=0;l>u;u++)d+='<img src="'+e.promiseUrls[u]+'" alt="\u65b0\u519c\u4e1a\u519c\u573a\u627f\u8bfa">';c='<div id="farm-auth" class="J_DetailSection" style="display: none;"><div class="tb-farm-auth-book"><p class="farm-auth-img-box" id="J_farm_auths">'+d+"</p></div></div>",o("#J_TabBar .tb-last").after(s),o("#J_SubWrap").after(c)}try{var f={};for(var u in e)e.hasOwnProperty(u)&&(f[u]=n(e[u]));var m=f.farmAuthenticate;if(m&&f.isCertiFarm&&"true"==f.isCertiFarm){var g=o(".tb-amount","#J_isku");g.after(['<dl class="tb-clear">','<dt class="tb-property-type">\u8d44\u683c\u8ba4\u8bc1</dt>',"<dd>",m,"</dd>","</dl>"].join(""))}var p=f.farmImg?f.farmImg:"",h=f.farmName?f.farmName:"",v=f.farmUrl?f.farmUrl:"",b=f.farmPromise?"\u627f\u8bfa:"+f.farmPromise:"",y=f.category?"\u4ea7\u54c1:"+f.category:"",k=f.createTime?"\u521b\u59cb\u4e8e:"+f.createTime:"",_=f.scale?"\u519c\u573a\u89c4\u6a21:"+f.scale:"",w='<div class="tb-agriculture-farmInfo">'+(p?'<img class="tb-agriculture-farmImg" src="'+p+'">':"")+'<div class="tb-agriculture-farmInfoDetail">'+(h?'<div class="tb-agriculture-farmName">'+h+"</div>":"")+(v?'<a class="tb-agriculture-farmUrl" target="_blank" href="'+v+'">\u4e86\u89e3\u66f4\u591a</a>':"")+(b?'<div class="tb-agriculture-farmPromise">'+b+"</div>":"")+(_||k||y?'<div class="tb-agriculture-farmInfo-attr">'+(_?'<div class="tb-agriculture-scale">'+_+"</div>":"")+(k?'<div class="tb-agriculture-createTime">'+k+"</div>":"")+(y?'<div class="tb-agriculture-category">'+y+"</div>":"")+"</div>":"")+"</div></div>";o("#attributes").append(a.create(w))}catch(C){i.warn("Render failed: %s",C.message)}}}}))}),KISSY.add("item-detail/activity/bigpromotion/index",["log","node","../../config/"],function(e,t){function n(){r(u.getActivitySource("pre"))}function i(){r(u.getActivitySource("start"))}function a(){o()}function o(){var e=d(".J_BigProm");e.length&&e.remove()}function r(e){if(o(),e){var t='<div class="J_BigProm tb-big-prom"><img class="tb-big-prom-img" src="'+e+'"/></div>';d(t).insertAfter(f)}}var s=t("log").getLogger("activity"),c=t("node"),d=c.all,l=d("body"),u=t("../../config/"),f=d("#J_Title");l.fire("resource:sib",{success:function(){try{m.init()}catch(e){s.error("Big promotion init error: %s",e.message)}}});var m={init:function(){(u.isDaily||u.isPre)&&(location.href.indexOf("activity=pre")>-1?n():location.href.indexOf("activity=start")>-1&&i());var t,a=this,o=Number(g_config.vdata.sys.now),r=864e5,c=g_config.bigPromotion,d=Hub.config.get("sku"),l=Hub.config.get("activity");if(d&&d.activity)t=d.activity;else{if(!l)return;t={start:l.startTime,end:l.endTime,pre:l.preHotStartTime}}if(o>Number(t.end))return void s.info("Big promotion is end");s.info("Start big promotion"),c&&c.time&&(t=c.time);var f={},m=a.formatStages(t);

e.each(m,function(t){var n=t.time;if(o>=n)return s.info("Show big promotion stage %s",f.type),t.fn(f),!1;var i=n-o;r>i&&(s.info("Start big promotion timer for stage %s",f.type),e.later(t.fn,i,!1,null,f))})},formatStages:function(e){var t=[];return e.end&&t.push({type:"end",time:e.end,fn:a}),e.start&&t.push({type:"start",time:e.start,fn:i}),e.pre&&t.push({type:"pre",time:e.pre,fn:n}),t}}}),KISSY.add("item-detail/shoplab/index",["dom","../gl/","datalazyload"],function(e,t){var n=t("dom"),i=t("../gl/"),a=t("datalazyload"),o=Hub.config.get("shopLab");if(o){var r=n.create('<div id="J_ShopLab" style="max-height: 400px;overflow: hidden"></div>'),s=o.isInTop?"insertBefore":"insertAfter",c=o.isInTop?1:0,d=Math.random()>.5?"1":"0",l=o.url+"&basic="+d;e.jsonp(l,function(t){if(1===t.state){n.html(r,t.data.content);var o=e.all("a",r);o.each(function(e){e[0].href+=(~e[0].href.indexOf("?")?"&":"?")+"spm=2013.1.2.7"}),n.remove("#J_AsyncDCMain"),n[s](r,"#J_DivItemDesc"),new a(r),i("2315213?num="+o.length+"&ver="+t.data.version+"&pos="+c),e.all("a","#J_DivItemDesc").each(function(e){e[0].href+=(~e[0].href.indexOf("?")?"&":"?")+"spm=2013.1.2.6"})}})}}),KISSY.add("item-detail/reminder/index",["log","node","xtemplate"],function(e,t){function n(e){if(e&&0!=e.length){var t='<dl><dt>\u63d0\u9192</dt><dd style="line-height: 22px;color: #6c6c6c;">{{#each reminders}}<p>{{this}}</p>{{/each}}</dd></dl>',n=new o(t).render({reminders:e});r("#J_tbExtra").append(n)}}var i=t("log").getLogger("reminder"),a=t("node"),o=t("xtemplate"),r=a.all,s=r("body");s.fire("resource:sib",{success:function(){try{n(g_config.reminderText)}catch(e){i.warn("Init failed: %s",e.message)}}})}),KISSY.add("item-detail/timing/index",["node","base"],function(e,t){var n=t("node"),i=t("base"),a=n.all,o=a("body"),r=i.extend({initializer:function(){var e=this;try{a(window).on("load",function(){e.sendTiming()})}catch(t){o.fire("track",{msg:{url:location.href,err:t},category:"timing:init:false"})}},sendTiming:function(){var t=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;if(t&&t.timing){var n=t.timing;if(e.each({appCache:n.domainLookupStart-n.fetchStart,dns:n.domainLookupEnd-n.domainLookupStart,connect:n.connectEnd-n.connectStart,ttfb:n.responseStart-n.connectEnd,response:n.responseEnd-n.responseStart,domReady:n.domContentLoadedEventEnd-n.responseEnd},function(e,t){e>0&&o.fire("track",{url:"//item.taobao.com/track/timing/",msg:{url:location.href},delay:e,category:t})}),n.msFirstPaint&&n.navigationStart&&o.fire("track",{url:"//item.taobao.com/track/timing/",msg:{url:location.href},delay:parseInt(n.msFirstPaint)-parseInt(n.navigationStart),category:"ieFirstPaint"}),window.chrome&&window.chrome.loadTimes){var i=window.chrome.loadTimes();i.firstPaintTime&&i.requestTime&&o.fire("track",{url:"//item.taobao.com/track/timing/",msg:{url:location.href},delay:parseInt(i.firstPaintTime)-parseInt(i.requestTime),category:"chromeFirstPaint"})}}}});return new r,r}),KISSY.add("item-detail/auto/index",["log","dom","node","xtemplate"],function(e,t){function n(t){var n=this;e.mix(n,{domain:"l_"+e.guid(),config:t,_data:null,_dataHash:{},_curNode:null}),n.loadData(n.config.data),n.init()}function i(e){return function(){a.info("Method %s not implement",e)}}var a=t("log").getLogger("auto"),o=t("dom"),r=t("node").all,s=r("body"),c=t("xtemplate");e.mix(n.prototype,{setCurNode:function(e,t){var n=this;n._curNode=e,t||n.ui_setCurNode(e)},getCurNode:function(){var e=this;return e._curNode},getParents:function(e){for(var t=this,n=[],i=e;i._pid&&(i=t._dataHash[i._pid]);)n.push(i);return n},getNodePath:function(e){var t=this,n=null;return n=t.getParents(e),n.reverse(),n.push(e),n},inNodePath:function(t,n){var i=this,a=i.getNodePath(n);return e.inArray(t,a)},getRoot:function(){var e=this;return e._data},getNode:function(e){var t=this;return t._dataHash[e]},isLastLevel:function(e){if(e.childs)for(var t=0,n=e.childs.length;n>t;t++)if(e.childs[t].childs)return!1;return!0},loadData:function(t){function n(t,a){var o=e.guid();if(t._id=o,i._dataHash[o]=t,a&&(t._pid=a),t.childs)for(var r=0,s=t.childs.length;s>r;r++)n(t.childs[r],o)}var i=this,a=e.clone(t);n(a),i._data=a},reset:function(){var e=this;e.setCurNode(null,!0),e.ui_reset()},init:function(){var e=this;e.ui_init()},ui_init:i("ui_init"),ui_setCurNode:i("ui_setCurNode"),ui_reset:i("ui_setCurNode")});var d='<ul>{{#each childs}}<li data-nodeID="{{_id}}" class="li-id-{{_id}}" ><span class="icon-pinyin" >{{firstPinyin}}</span><a href="#">{{name}}<i></i><span class="tb-auto-arr" ></span></a></li>{{/each}}</ul>',l=e.extend(function(t){function i(e){e.all(".tb-auto-popup-container").css("overflow","visible"),"none"!==e.all(".tb-auto-popup-scrollbar").css("display")?e.addClass("tb-auto-col-has-scr"):e.removeClass("tb-auto-col-has-scr")}function a(t){var n,a,o,r,s,f=t||u.getCurNode();n=f?u.getNodePath(f):[u.getRoot()],l=f;for(var p=0,h=n.length,v=Math.max(h,m.length);v>p;p++)if(h>p&&n[p].childs){if(a=n[p],a.childs){if(m[p]||(o=e.all('<div style="display:none" class="tb-auto-sku-popup-col tb-auto-sku-popup-lv-'+(p+1)+'" ><h5>{{childLevelName}}</h5><div class="tb-auto-sku-popup-inner tb-clearfix"></div></div>'),m[p]=o,function(t){e.use("kscroll",function(e,n){var a=new n(t.all(".tb-auto-sku-popup-inner"),{prefix:"tb-auto-popup-",hotkey:!0,bodydrag:!1,allowArrow:!0});t.data("kscr",a),t.all(".tb-auto-popup-container").attr("hidefocus","on"),t.all(".tb-auto-popup-container").append(t.all("h5")).siblings("h5").remove(),i(t)})}(o),g.append(o)),o=m[p],s=o.data("lv_id")!=a._id){var b=new c(d).render(a);o.all(".tb-auto-sku-popup-inner").html(b),o.all("h5").text(a.childLevelName)}else o.all(".selected").removeClass("selected");u.isLastLevel(a)?o.addClass("tb-auto-sku-popup-col-leaf"):o.removeClass("tb-auto-sku-popup-col-leaf"),r=n[p+1],r&&o.all(".li-id-"+r._id).addClass("selected"),o.show();var y=o.data("kscr");s&&y&&(y.resize(),y.scrollByPercent(0),i(o)),o.data("lv_id",a._id)}}else(o=m[p])&&o.hide()}function r(){p||(f.detach("click",r),e.use("overlay",function(e,t){function n(e){o.contains(g,e.target)||o.contains(f.parent(),e.target)||s.hide()}s=new t.Popup({trigger:f,elCls:"tb-auto-sku-popup",content:'<div class="J_ShimRoot" ></div>',toggle:!0}),s.on("beforeVisibleChange",function(e){e.newVal&&s.align(f,["bl","tl"],[0,0])}),s.on("show",function(){a(),o.addClass(f,"tb-auto-drop"),e.all(document.body).on("mousedown",n)}),s.on("hide",function(){o.removeClass(f,"tb-auto-drop"),e.all(document.body).detach("mousedown",n)}),a(),s.render(),e.all(s.el).all(".J_ShimRoot").append(g),s.show(),p=!1}))}var s,l,u=this,f=e.all(t.trigger),m=[],g=([].join(""),e.all('<div class="tb-auto-sku-popup-set"></div>')),p=!1;f.on("click",r),g.delegate("click","li",function(t){t.preventDefault();var n=e.all(t.currentTarget),i=0|n.attr("data-nodeid"),o=u.getNode(i);l&&o.childs&&u.inNodePath(o,l)||(a(o),u.config.ev_afterPickedNode.call(u,o,function(e){e&&u.setCurNode(e)}))}),u.ui_setCurNode=function(e){s.hide(),u.config.ev_afterSetCurNode(e)},u.ui_reset=function(){a()},u.ui_init=function(){},n.apply(u,arguments)},n),u=function(){var t;return{init:function(){function n(t){e.each(e.map(t,function(t,n){var i=e.all("#J_selected_auto_"+n);return t?(i.attr("data-value",t.id),s.fire("auto:clearpvid",{trigger:o.get("a",i)}),function(){i.addClass("tb-selected").removeClass("tb-out-of-stock").all("span").text(t.name),s.fire("auto:change",{trigger:o.get("a",i)})}):(i.attr("data-value",""),function(){i.removeClass("tb-selected").removeClass("tb-out-of-stock"),s.fire("auto:clearpvid",{trigger:o.get("a",i)})})}),function(e){e()})}function i(){var e=t.getRoot();c||t.setCurNode(e.childs[0].childs[0],!0)}var a=this,r=(Hub.config.get("sku").valItemInfo||0).carList,c=null,d=e.all("#J_ChooseAutoBrand");if(d.length&&r){if(d.length&&200!=r.code)return void d.replaceWith("<span>\u5b9d\u8d1d\u5f02\u5e38\u8bf7\u8054\u7cfb\u5356\u5bb6</span>");r=function(t){function n(t){t.childs&&(t.childLevelName=t.childs[0].levelName,e.each(t.childs,function(e,i){var a=t.childs[i-1]||0;e.pinyinName!=a.pinyinName&&(e.firstPinyin=e.pinyinName),n(e)}))}return n(t),t}(r),t=new l({trigger:d,data:r,ev_afterPickedNode:function(e,t){e.childs||t(e,e.name)},ev_afterSetCurNode:function(i){var a,o=t.getNodePath(i).slice(1),r=[],s=23,c=o.slice(0);for(r.unshift(c.pop().name);a=c.pop();)r.unshift(a.name),e.reduce(r,function(e,t){return e+t.length})+a.length>s&&r.shift();d.html(r.join(" ")+"<i></i>"),n(o),d.addClass("tb-auto-selected")}}),i(),a.resetBrand=function(){d.html(d.attr("data-text")+"<i></i>"),t.reset(),i(),n(e.map(e.all(".J_isAutoProp"),function(){return null})),d.removeClass("tb-auto-selected")},s.on("auto:reset",a.resetBrand),a.is=!0}}}}();return u}),KISSY.add("item-detail/util/index",["node","xtemplate","event","log"],function(e,t){function n(t,n){try{Light.light()}catch(a){0===i(t).length&&(n.lightTry<3?setTimeout(function(){try{Light.Light()}catch(t){e.log("Light.light failed once more")}},500):(n.failed=!0,r.warn("Detail Util Light Try Failed")))}}var i=t("node").all,a=t("xtemplate"),o=t("event"),r=t("log").getLogger("detail-util"),s='<div id="J_WebWangwangHidden" data-nick="{{nick}}" data-enconde="true" title="\u70b9\u51fb\u54a8\u8be2\u5356\u5bb6" class="J_WangWang"></div>',c='<div id="J_WebWangwang" data-nick="{{nick}}" data-enconde="true" title="\u70b9\u51fb\u54a8\u8be2\u5356\u5bb6" class="J_WangWang"></div>',d=g_config.sellerNick;return{light:function(t,l,u,f){if(!t.lighted){var m;u?(i(f).append(new a(c).render({nick:encodeURIComponent(d)})),m="#J_WebWangwang a"):(i(f).append(new a(s).render({nick:encodeURIComponent(d)})),m="#J_WebWangwangHidden a"),t.lightTry=0,n(m,t),t.lighted=!0,o.delegate(document,"click",l,function(){if(t.failed||0===i(m).length)try{window.Light?Light.light():e.use("tbc/webww/"+TB.Global.v["fn-webww"]+"/webww",function(){try{Light.light()}catch(e){r.warn("Detail Util Light Failed Still!")}})}catch(n){return void r.warn("Detail Util Light Failed Completely!!")}i(m).fire("click")})}}}}),KISSY.add("item-detail/car/templates/car-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+="",n+="\n";var u={},f=[],m=d(o,e,"match",0,2);f.push(1===m),u.params=f,u.fn=function(){var e="";return e+='\n<div class="tb-car-profile tb-car-profile-match">\n'},n+=s(o,e,u,"if",2),n+="\n",n+="\n";var g={},p=[],h=d(o,e,"match",0,6);p.push(2===h),g.params=p,g.fn=function(){var e="";return e+='\n<div class="tb-car-profile tb-car-profile-part-match">\n'},n+=s(o,e,g,"if",6),n+="\n",n+="\n";var v={},b=[],y=d(o,e,"match",0,10);b.push(3===y),v.params=b,v.fn=function(){var e="";return e+='\n<div class="tb-car-profile tb-car-profile-no-match">\n'},n+=s(o,e,v,"if",10),n+='\n\n  <i class="tb-iconfont tb-car-icon">&#xe601;</i>\n\n  <div class="tb-car-profile-content">\n  ',n+="\n  ";var k={},_=[],w=d(o,e,"match",0,18);_.push(1===w),k.params=_,k.fn=function(e){var t="";t+='\n\n    <i class="tb-iconfont tb-car-full-match">&#xe606;</i>\n    <div class="tb-car-info">\u9002\u5408:</div>\n\n    ';var n={},i=[],a=d(o,e,"carName",0,23);i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n      <div class="tb-car-name" id="J_TbCarName" title="';var n=l(o,e,{},"carName",0,24);t+=c(n,!0),t+='">';var i=l(o,e,{},"carName",0,24);return t+=c(i,!0),t+="</div>\n    "},t+=s(o,e,n,"if",23),t+='\n\n    <i title="\u4fee\u6539\u8f66\u578b" class="tb-iconfont J_ModifyCarProfile">&#xe600;</i>\n  </div>\n\n    ';var r={},u=[],f=d(o,e,"soldCount",0,30);return u.push(f),r.params=u,r.fn=function(e){var t="";t+='\n    <div class="tb-car-soldcount">';var n=l(o,e,{},"soldCount",0,31);t+=c(n,!0),t+='\u8f66\u53cb\u8d2d\u4e70</div>\n    <div class="tb-car-soldcount-tip" style="display: none;">\n      ';var i=l(o,e,{},"soldCount",0,33);t+=c(i,!0),t+="\u4f4d";var a=l(o,e,{},"tips",0,33);return t+=c(a,!0),t+='\u8f66\u4e3b\u8d2d\u4e70\n      <div class="tb-car-soldcount-triangle">\n        <div class="tb-car-soldcount-arrow"></div>\n        <div class="tb-car-soldcount-arrow-inner"></div>\n      </div>\n    </div>\n    '},t+=s(o,e,r,"if",30),t+="\n\n  "},n+=s(o,e,k,"if",18),n+="\n\n  ",n+="\n  ";var C={},S=[],I=d(o,e,"match",0,44);S.push(2===I),C.params=S,C.fn=function(e){var t="";t+='\n\n    <i class="tb-iconfont tb-car-match-warn">&#xe607;</i>\n    <div class="tb-car-info">\n    \u90e8\u5206\u9002\u5408:\n    </div>\n\n    ';var n={},i=[],a=d(o,e,"carName",0,51);i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n      <div class="tb-car-name" id="J_TbCarName" title="';var n=l(o,e,{},"carName",0,52);t+=c(n,!0),t+='">';var i=l(o,e,{},"carName",0,52);return t+=c(i,!0),t+="</div>\n    "},t+=s(o,e,n,"if",51),t+='\n    <i class="tb-iconfont J_ModifyCarProfile" title="\u5b8c\u5584\u8f66\u578b\u4fe1\u606f">&#xe600;</i>\n  </div>\n\n    ';var r={},u=[],f=d(o,e,"soldCount",0,57);return u.push(f),r.params=u,r.fn=function(e){var t="";t+='\n    <div class="tb-car-soldcount">';var n=l(o,e,{},"soldCount",0,58);t+=c(n,!0),t+='\u8f66\u53cb\u8d2d\u4e70</div>\n    <div class="tb-car-soldcount-tip" style="display: none;">\n      ';var i=l(o,e,{},"soldCount",0,60);t+=c(i,!0),t+="\u4f4d";var a=l(o,e,{},"tips",0,60);return t+=c(a,!0),t+='\u8f66\u4e3b\u8d2d\u4e70\n      <div class="tb-car-soldcount-triangle">\n        <div class="tb-car-soldcount-arrow"></div>\n        <div class="tb-car-soldcount-arrow-inner"></div>\n      </div>\n    </div>\n    '},r.inverse=function(e){var t="";t+="\n      ";var n={},i=[],a=d(o,e,"showCarTable",0,67);return i.push(a),n.params=i,n.fn=function(){var e="";return e+='\n      <div title="\u70b9\u51fb\u67e5\u770b\u5b9d\u8d1d\u9002\u5408\u8f66\u578b\u8868" class="J_ViewCarModel">\u9002\u5408\u8f66\u578b</div>\n      '},t+=s(o,e,n,"if",67),t+="\n    "},t+=s(o,e,r,"if",57),t+="\n\n  "},n+=s(o,e,C,"if",44),n+="\n\n  ",n+="\n  ";var T={},x=[],J=d(o,e,"match",0,75);return x.push(3===J),T.params=x,T.fn=function(e){var t="";t+='\n\n    <i class="tb-iconfont tb-car-match-warn">&#xe607;</i>\n    <div class="tb-car-info">\n    \u4e0d\u9002\u5408:\n    </div>\n\n    ';var n={},i=[],a=d(o,e,"carName",0,82);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n      <div class="tb-car-name" id="J_TbCarName" title="';var n=l(o,e,{},"carName",0,83);t+=c(n,!0),t+='">';var i=l(o,e,{},"carName",0,83);return t+=c(i,!0),t+="</div>\n    "},t+=s(o,e,n,"if",82),t+='\n    <i title="\u4fee\u6539\u8f66\u578b" class="tb-iconfont J_ModifyCarProfile">&#xe600;</i>\n  </div>\n\n  <div id="J_AskWangwang">\u54a8\u8be2\u5356\u5bb6</div>\n  '},n+=s(o,e,T,"if",75),n+="\n\n</div>\n"}}),KISSY.add("item-detail/car/templates/car-recommend-xtpl",function(e,t,n,i){return function(e){var t,n="",a=this.config,o=this,r=a.utils;"undefined"!=typeof i&&i.kissy&&(t=i);var s=r.runBlockCommand,c=r.renderOutput,d=r.getProperty,l=(r.runInlineCommand,r.getPropertyOrRunCommand);n+="";var u={},f=[],m=d(o,e,"result",0,1);return f.push(m),u.params=f,u.fn=function(e){var t="";t+='\n<div class="tb-car-recommend" style="display: none;">\n  <div class="tb-car-recommend-title">\u5e97\u94fa\u4e2d\u9002\u5408\u60a8\u5ea7\u9a7e\u7684\u5b9d\u8d1d</div>\n  <div class="tb-car-recommend-content">\n  ';var n={},i=[],a=d(o,e,"result",0,5);return i.push(a),n.params=i,n.fn=function(e){var t="";t+='\n  <a class="tb-car-recommend-link" href="';var n=l(o,e,{},"url",0,6);t+=c(n,!0),t+='" target="_blank">\n    <img src="';var i=l(o,e,{},"pic",0,7);return t+=c(i,!0),t+='_60x60.jpg" />\n  </a>\n  '},t+=s(o,e,n,"each",5),t+="\n  </div>\n</div>\n"},n+=s(o,e,u,"if",1),n+="\n"}}),KISSY.add("item-detail/car/index",["node","ua","../gl/","../config/","event","xtemplate/runtime","ajax","log","anim","../util/","./templates/car-xtpl","./templates/car-recommend-xtpl"],function(e,t){"use strict";var n=t("node").all,i=t("ua"),a=t("../gl/"),o=t("../config/"),r=t("event"),s=t("xtemplate/runtime"),c=t("ajax"),d=t("log").getLogger("car"),l=t("anim"),u=n("body"),f=t("../util/"),m=o.getItemId(),g=n(".sep-line"),p=t("./templates/car-xtpl"),h=t("./templates/car-recommend-xtpl"),v=o.getTaobaoHost();return{init:function(){if(TB.Global.isLogin&&g_config.carVMarket){var t=this;e.use("carProfile",function(e,n){t.carProfile=n,t.carProfile.init({itemId:m,token:o.getToken()},function(e){!function(){e?t._render(e):d.info("CarProfile data empty")}(e)}),t._bindEvents(),u.on("carprofile:saved",function(){t.carProfile.CurrentCarInfo?t._render(t.carProfile.CurrentCarInfo):d.warn("CarProfile data empty")})})}},_render:function(t){var a=this,o="",r="",c=t.brand,l=t.carSeries,m=t.carYear,h=t.modelId;if(c=c&&c.name?e.trim(c.name):"",l=l&&l.name?e.trim(l.name):"",m=m&&m.name?e.trim(m.name):"",h=h&&h.name?e.trim(h.name):"",r=c+l,o=c+l+m+h,t.carName=o.replace(/\s/g,""),t.tips=r,t.showCarTable=g_config.carModelTable,e.indexOf(t.match,[1,2,3])>-1)if(g.length>0){n(".tb-car-profile, .tb-car-recommend").remove(),i.ie&&i.ie<9&&t.carName&&t.carName.length>14&&(t.carName=t.carName.slice(0,10)+"..."),g.after(new s(p).render(t));try{f.light(a,"#J_AskWangwang",!1,".tb-detail-bd")}catch(v){d.info("Car Light.light")}a.log={},t.soldCount&&(a.log.cheyou=t.soldCount),t.match&&(a.log.status=t.match),3==t.match?a.setRecommend():u.fire("car:show")}else d.warn("$SEP not available")},setRecommend:function(){var t=this;t.carInfo={};var i=t.carProfile.CurrentCarInfo;i.brand&&(t.carInfo.brandPid=i.brand.pid,t.carInfo.brandVid=i.brand.vid),i.carSeries&&(t.carInfo.demioPid=i.carSeries.pid,t.carInfo.demioVid=i.carSeries.vid),i.carYear&&(t.carInfo.carYearPid=i.carYear.pid,t.carInfo.carYearVid=i.carYear.vid),i.modelId&&(t.carInfo.modelIdPid=i.modelId.pid,t.carInfo.modelIdVid=i.modelId.vid);var a=e.mix({itemid:g_config.itemId,count:3,appid:1418},t.carInfo);new c({url:"//tui."+v+"/recommend",data:a,dataType:"jsonp",timeout:3,success:function(e){if(e&&e.result&&e.result.length>0){var i=new s(h).render(e);n(".tb-car-profile").after(i),l(".tb-car-recommend",{height:"100px",display:"block"},.3,"easeInStrong").run(),t.log.tuijian=e.result.length,u.fire("car:show",t.log)}else d.info("CarProfile Nomatch has no recommend data.")},error:function(){d.info("CarProfile Recommend API error")}})},_bindEvents:function(){var t=this;r.delegate(document,"mouseenter",".tb-car-profile-content",function(){n(".J_ModifyCarProfile").css("visibility","visible")}),r.delegate(document,"mouseleave",".tb-car-profile-content",function(){n(".J_ModifyCarProfile").css("visibility","hidden")}),r.delegate(document,"click",".J_ViewCarModel",function(){l(window,{scrollTop:n("#J_CarModelTable").offset().top-100},.3).run(),a("12.77.5?"+e.param(t.log))}),r.delegate(document,"click",".J_ModifyCarProfile",function(){t.carProfile.renderPopup(),a("12.77.3?"+e.param(t.log))}),r.delegate(document,"click",".tb-car-profile",function(){a("12.77.2?"+e.param(t.log))}),r.delegate(document,"click",".tb-car-recommend-link",function(){a("12.77.6?"+e.param(t.log))}),r.delegate(document,"mouseenter",".tb-car-soldcount",function(){n(".tb-car-soldcount-tip").show()}),r.delegate(document,"mouseleave",".tb-car-soldcount",function(){n(".tb-car-soldcount-tip").hide()}),u.on("car:show",function(){a("12.77.1?"+e.param(t.log))})}}}),KISSY.add("item-detail/route/index",["node","event","anim"],function(e,t){{var n=t("node").all,i=n("body");t("event"),t("anim")}return{init:function(){var t,n=this,a=location.hash,o=/^#reviews(\/.*)?$/,r=e.unparam(location.search),s={reviews:1,records:2,desc:0,addToCart:3};-1!==location.href.indexOf("on_comment=1")||o.test(a)?t=1:r&&r.selected&&(t=s[r.selected]),i.on("component:loaded",function(){n.jump(t)}),i.fire("resource:sib",{success:function(){n.jump(t)}}),0==t&&i.on("qualified:init",function(){n.jump(t,!0)})},jump:function(t,n){if(t>=0){var a={index:t,stick:!0};n&&e.mix(a,{load:n}),i.fire("tabbar:switch",a)}}}}),KISSY.add("item-detail/index",["./track/","./hub/","./dt/","./price/","./domain/","./base/","./buy/","./resource/","./newsku/","./sku/","./oversold/","./counter/","./info/","./ms/","./channelstock/","./tbtoken/","./userinfo/","./thumb/","./contracticons/","./video/","./pk/","./insurance/","./tags/","./steppay/","./discount/","./guideline/","./sns/","./header/","./shopinfo/","./ua/","./tabbar/","./security/","./typerecommend/","./switcher/","./stat/","./footer/","./popsku/","./doctor/","./shortcuts/","./favorite/","./custommarket/","./relatemarket/","./report/","./tbcp/","./o2oservice/","./skutip/","./stepprice/","./afterPayment/","./sitenav/","./toolbar/","./redeem/","./viewer/","./wangpu/","./agriculture/","./activity/bigpromotion/","./shoplab/","./reminder/","./timing/","./auto/","./car/","./route/"],function(e,t){function n(){n.fired||(n.fired=!0,g_config.load_start=a(),Hub.fire("load"),g_config.load_end=a(),Hub.fire("load:end"))}t("./track/"),t("./hub/"),t("./dt/"),t("./price/"),t("./domain/").init(),t("./base/").init(),t("./buy/").init(),t("./resource/"),t("./newsku/"),t("./sku/").init(),t("./oversold/").init(),t("./counter/").init(),t("./info/").init(),t("./ms/"),t("./channelstock/").init(),t("./tbtoken/"),t("./userinfo/"),t("./thumb/"),t("./contracticons/"),t("./video/"),t("./pk/"),t("./insurance/"),t("./tags/"),t("./steppay/"),t("./discount/"),t("./guideline/"),t("./sns/"),t("./header/"),t("./shopinfo/"),t("./ua/"),t("./tabbar/").init(),t("./security/"),t("./typerecommend/"),t("./switcher/").init(),t("./stat/"),t("./footer/"),t("./popsku/"),t("./doctor/").init(),t("./shortcuts/"),t("./favorite/"),t("./custommarket/"),t("./relatemarket/"),t("./report/"),t("./tbcp/"),t("./o2oservice/").init(),t("./skutip/").init(),t("./stepprice/"),t("./afterPayment/"),t("./sitenav/").init(),t("./toolbar/").init(),t("./redeem/").init(),t("./viewer/"),t("./wangpu/").init(),t("./agriculture/"),t("./activity/bigpromotion/"),t("./shoplab/"),t("./reminder/"),t("./timing/"),t("./auto/").init(),t("./car/").init(),t("./route/").init();var i=e.all,a=e.now;e.ready(function(){g_config.domready_start=a(),Hub.fire("domready"),Hub.fire("base:done"),Hub.fire("sku:done"),Hub.fire("tabbar:done"),Hub.fire("core:ready"),Hub.fire("core:load"),g_config.domready_end=a(),Hub.fire("domready:end")}),i(window).on("load",n),setTimeout(n,5e3)});