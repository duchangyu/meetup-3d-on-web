head.ready(function(){setTimeout(function(){initializeUnitSwitch(window._cat_default_locale)},10)});function initializeThumbnails(){var a=$(".video-thumbnails");_.each(a,function(b){if($(b).find("a").length<2){$(b).find("a").hide()}});$(".video-thumbnails").on("click","a",function(b){b.preventDefault();activateThumbs($(this),$(this).closest(".video-thumbnails").index(".video-thumbnails"));trackGa("cta",$(this).find("img").attr("data-poster-id"))})}function activateThumbs(f,c){var a=$(".video-thumbnails").eq(c);console.log(a);a.find("a").removeClass("active");f.addClass("active");var e=f.find("img");var b=a.find(".desc");var d=e.attr("data-video-id");$(b).removeClass("active");a.find('.desc[data-desc-id="'+d+'"]').addClass("active");attachVideo(e,c)}function attachVideo(g,d){var b=$(".video-player").eq(d);if(b.find("iframe").length>0){b.find("iframe").hide()}b.removeClass("player");var f=g.attr("data-video-id");var e=g.attr("src");var c=g.data("video-name");var a="";if(e.indexOf("youtube")>0){a="youtube"}else{a="youku"}b.html("<h6>Watch Video</h6><img class="+a+' data-video-id="'+f+'" data-src="'+e+'" data-video-name="'+c+'">');initialzePoster(d);b.find("iframe").show()}function initialzePoster(a){var b;if(typeof a!=="undefined"){b=$(".video-player").eq(a)}else{b=$(".video-player")}b.off("click");b.on("click",function(j){var h=$(this),c=h.find("img").attr("data-video-id"),f='<iframe frameborder="0" allowfullscreen src="//www.youtube.com/embed/'+c+'?html5=1&autoplay=1&rel=0"></iframe>',g='<iframe src="http://player.youku.com/embed/'+c+'" frameborder="0" allowfullscreen></iframe>',d=f;if(h.find("img").attr("data-video-type")==="youku"){d=g}trackGa("video-view",$(this).find("img").attr("data-video-id"));h.addClass("player").html(d).off("click")})}function initializeModal(){modalOpenListener();var a=window.location.hash;if(a!==""){data=a.substring(1);$('a.modal-open[data-subpage="'+data+'"]').trigger("click")}}function modalOpenListener(){$("a.modal-open").on({click:function(c){var b=$(window).scrollTop();var a=$(this).data("subpage");attachModal(a,b);trackGa("cta",a.substr(a.lastIndexOf("/")+1));window.location.hash=$(this).attr("href");c.preventDefault()}})}function modalCloseListener(a){$("a.modal-close").on({click:function(b){$("html").removeClass("open-modal");$(this).closest(".modal").remove();$("html, body").animate({scrollTop:a},"fast");window.location.hash="";if(!$("html").hasClass("lt-ie9")){history.pushState("",document.title,window.location.pathname)}b.preventDefault();$(this).off("click")}})}function attachModal(a,b){$("body").append('<div class="modal"> <div class="container-fluid"><a class="modal-close" href="#">Close</a><iframe src="'+a+'.html" width="100%" height="100%" scroll="no"></iframe></div></div>');$("html").addClass("open-modal");setTimeout(function(){$(window).scrollTop(0)},50);modalCloseListener(b)}function initializeTrackGa(){$(".subpage .download").on("click",function(){trackGa("download",$(this).attr("data-doc-name"))});$(".subpage .video-view").on("click",function(){trackGa("video-view",$(this).attr("data-video-name"))});$(".subpage .cta-tracking").on("click",function(){trackGa("cta",$(this).attr("href"))});$(".hero-text-container .btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))});$(".subpage a.btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))});$(".npi a.btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))});$(".npi .hero-selector-container .btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-dealer-locator.html")});$(".event a.pdf").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))});$(".event a.video").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"Video-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))});$(".event a.link").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))})}function trackGa(b,a){var c=window.location.href.substr(window.location.href.lastIndexOf("/")+1);switch(b){case"video-select":b="Video select-"+a;break;case"video-view":b="Video-"+a;break;case"download":b="Download-"+a;break;default:b="CTA-"+a;break}trackerGA("Landing page",c,b)}function initializeScene7(){$(".s7-container").each(function(c){var f=$(this);var e=f.attr("data-scene-path");var b="http://s7d2.scene7.com/is/image/";var a="s7_spinview-"+c;f.append('<div id="'+a+'"></div>');if(e.indexOf(b)>-1){cleanedAsset=e.split(b);e=cleanedAsset[1]}var d=new s7viewers.SpinViewer({containerId:a,params:{asset:e,serverurl:b,contenturl:"http://s7d2.scene7.com/skins/",config:"Scene7SharedAssets/Universal_HTML5_SpinSet_light"},handlers:{initComplete:function(){$.fn.matchHeight._update()}}}).init()})}function eventNav(){$("#cat-event-nav").affix({offset:{top:400}});$(".event-nav a").on({click:function(c){c.preventDefault();$(".event-nav a").removeClass("active");$(this).toggleClass("active");var d=$(this).attr("href");var b=$("#cat-event-nav");var a=b.height();$("html, body").animate({scrollTop:$(d).offset().top-a},10)}})}function eventMap(){if($(".map-container").attr("data-location")){var a=$(".map-container").attr("data-location");a=a.replace(/\s/g,"+");console.log("PLACE",a);var b={zoom:15,center:new google.maps.LatLng(-34.397,150.644)};var d=new google.maps.Map(document.getElementById("event-map-container"),b);var c=new google.maps.Geocoder();c.geocode({address:a},function(g,f){if(f==google.maps.GeocoderStatus.OK){d.setCenter(g[0].geometry.location);var e=new google.maps.Marker({map:d,position:g[0].geometry.location});d.panTo(e.getPosition())}else{console("Geocode was not successful for the following reason: "+f)}google.maps.event.trigger(d,"resize")})}else{$(".map-container img").draggable()}}function showfloorDraggable(){$(".showfloor-container img").draggable()}function checkForRepeatPattern(){$.each($(".sub-hero .bg-img"),function(){if($(this).siblings().length<2){repeatPattern($(this))}})}function repeatPattern(a){setTimeout(function(){$(".info-graphic").matchHeight(true);$.fn.matchHeight._update()},100)}function updateRowsHeight(){setTimeout(function(){$.fn.matchHeight._update()},100)}function detectUrlAnchor(){var a=function(){var c=".campaignEventAnchorNav li a";if(window.location.hash){var d=window.location.hash;var b=$(c+"[href$='"+d+"']");if(b.length>0){$(c).removeClass("active");$(b).addClass("active")}}else{$(c).removeClass("active");$(c+"[href$='overview']").addClass("active")}};$(window).load(function(){a()}).bind("hashchange",function(){a()})}head.ready(function(){initialzePoster();if($(".subpage").length>0){$(".subpage").find(".flextable").flextable()}if($(".campaign-guidelines .video-thumbnails").length>0){initializeThumbnails()}detectUrlAnchor();initializeModal();initializeTrackGa();if($(".s7-container").length>0){initializeScene7()}$(".subpage .content-module-secondary .span6.info-graphic h6").closest(".info-graphic").hide();repeatPattern($(".repeat-pattern .bg-img"));eventNav();if($(".showfloor-container").length>0){showfloorDraggable()}if($(".info-graphic").find(".tile-image").length>0){$(".info-graphic").find(".tile-image").parent().parent().addClass("tile-image-holder")}if($(".event").length){$(".event").find(".flextable").flextable()}setTimeout(function(){if($(".map-container").length>0){eventMap()}},4000)});function initializeContentModuleVideos(){$("figure").fitVids()}head.ready(function(){if($("figure iframe").length>0){initializeContentModuleVideos()}});function accordionTabReset(){$(".panel-group .panel-title a").each(function(){if(!$(this).hasClass("in")){$(this).addClass("collapsed")}})}head.ready(function(){if($(".panel-group").length>0){accordionTabReset()}});function validateFormField(g){var j=$.trim(g.val());var a=true;var h;switch(g.data("validate")){case"required":if(g.is("select")){j=g.find("option:selected").val()}if(g.is("fieldset")){if(g.find(":checked").length>0){j="checked"}else{j=""}}break;case"email":h=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,10})+$/;if(h.test(j)){j="email"}else{j=""}break;case"serial":regexFull=/^[a-z0-9]{3}[0-9]{1,5}$/i;regexPrefix=/^[a-z0-9]{3}$/i;if(regexFull.test(j)){}else{if(j.length==3&&regexPrefix.test(j)){}else{j=""}}break;case"rental-start-date":var e=new Date();var c=new Date(j);if(c.setHours(0,0,0,0)>=e.setHours(0,0,0,0)){$("input.end-date").removeAttr("disabled").siblings(".add-on").show()}else{j=""}break;case"rental-end-date":var b=new Date($('[data-validate="rental-start-date"]').val());var d=new Date(j);if(d.setHours(0,0,0,0)>=b.setHours(0,0,0,0)){}else{j=""}break}var f="";if(j===""){g.addClass("error");g.siblings(".error-text").show();if(g.data("view")){f=$("#"+g.data("view"));f.find("input").addClass("error");f.find(".error-text").show()}a=false}else{g.removeClass("error");g.siblings(".error-text").hide();if(g.data("view")){f=$("#"+g.data("view"));f.find("input").removeClass("error");f.find(".error-text").hide()}}return a}window.validateForm=validateFormField;function initializeFormValidation(){$("form").each(function(){var a=true;if($(this).find("[data-validate]").length>0){$(this).on("submit",function(){a=true;$(this).find("[data-validate]").each(function(){var b=validateFormField($(this));if(!b){a=false}});if(!a){}else{}return a})}});$("[data-validate]").each(function(){var a,b;switch($(this).data("validate")){case"required":b=this.tagName.toLowerCase();if($('.validate-messages .error-text[data-validate-message="required:'+b+'"]').length>0){a=$('.validate-messages .error-text[data-validate-message="required:'+b+'"]')}else{a=$('.validate-messages .error-text[data-validate-message="required"]')}break;case"email":a=$('.validate-messages .error-text[data-validate-message="email"]');break;case"serial":a=$('.validate-messages .error-text[data-validate-message="serial"]');break;case"rental-start-date":a=$('.validate-messages .error-text[data-validate-message="rental-start-date"]');break;case"rental-end-date":a=$('.validate-messages .error-text[data-validate-message="rental-end-date"]');break}if(a!==undefined&&$(this).attr("type")!=="hidden"){a.clone().appendTo($(this).parent()).data("validate-message","")}$(this).siblings(".error-text").hide();$(this).on("blur, change",function(){validateFormField($(this))});if($(this).is("fieldset")){$(this).find(":checkbox,:radio").on("click",function(){validateFormField($(this).closest("fieldset"))})}if($(this).is("select")){$(this).on("change",function(){validateFormField($(this))})}})}function initializeDatePicker(){var a=new Date();$(".date-picker-container").datepicker({autoclose:true,format:"mm/dd/yyyy",startDate:a,todayHighlight:true});if($(".date-picker-container").find("input.start-date").length>0){$("input.end-date").attr("disabled","disabled").siblings(".add-on").hide()}}function facetedNavRadioDisplayHandler(){var a=$(".facet-filter input[type=radio]");$(".facet-filter input[type=radio]:checked").next().addClass("on");$(a).change(function(){$(".facet-filter input[type=radio]:not(:checked)").next().removeClass("on");$(this).next().addClass("on")})}head.ready(function(){initializeDatePicker();initializeFormValidation();facetedNavRadioDisplayHandler()});function initializeHomePageHeroHandlers(){$(window).on("throttledresize",function(e){if(Math.round($("footer .span3").width())===Math.round($("footer .span7").width())){var b=$(".hero-text-wrapper").outerHeight(true);var c=$(".hero-selector-container").outerHeight(true);var d=$(".hero.container-fluid").outerHeight();var a=(b+c)-d;$(".hero.container-fluid").css("margin-bottom",a+"px")}else{$(".hero.container-fluid").css("margin-bottom","0px");$(".home .hero-selector-container .hero-selector ul li a span").each(function(){spanHeight=$(this).outerHeight(false);if(spanHeight>45){$(this).css("margin-bottom","5px")}else{$(this).css("margin-bottom","26px")}})}})}head.ready(function(){if($("body").hasClass("home")){initializeHomePageHeroHandlers()}});var CatNS=CatNS||{};CatNS.i18n={keys:{},loadKeys:function(c){var b=false;var a=this;amplify.request.define("CAT_I18N","ajax",{url:(b)?"http://localhost:7070/cat/i18n":window._cat_effective_url+"/_jcr_content.i18n.json",dataType:(b)?"jsonp":"json",type:"GET"});amplify.request({resourceId:"CAT_I18N",success:function(d){a.keys=d;c()},error:function(d,e){amplify.publish(CAT_EVENTS.SERVICE_ERROR,d)}})},get:function(a){return(this.keys[a])?this.keys[a]:"Missing i18n"}};$(function(){});head.ready(function(){exampleLoadingStates()});function exampleLoadingStates(){$(".showloading").on("click",function(b){b.preventDefault();var a=$(".mini-form:not(.callout)");miniformLoadingScreen(a)});$(".showloaded").on("click",function(b){b.preventDefault();var a='<p>Thanks! Your product information is ready for download.</p><ul class="secondary-links"><li><a href="#">Download 320 L Brochure</a></li><li><a href="#">Download 320 L Specs</a></li></ul><strong>Related Product Information</strong><ul class="secondary-links"><li><a href="#">Download 320 L Brochure</a></li><li><a href="#">Download 320 L Specs</a></li></ul>';$(".mini-form:not(.callout)").html(a)});$(".showoriginal").on("click",function(a){a.preventDefault();location.reload()})}function miniformLoadingScreen(a){var b="<div class='loading'><div class='spinner-container'><span class='spinner'></span>Loading...</div></div>";$(a).append(b)}function initializeMQProxy(){$(window).on("throttledresize",function(c){var b=$("body").data("is-mobile");var a=Math.round($("footer .span3").width())===Math.round($("footer .span7").width());$("body").data("is-mobile",a);if(b!=a){$("body").trigger({type:"mode-change",mobile:a,time:new Date()})}});$.event.trigger("throttledresize")}head.ready(function(){initializeMQProxy()});function initializeNavEventHandlers(){$("nav >ul >li.menu >a, nav >ul >li.menu >ul >li >a").on("click",function(a){if($("body").data("is-mobile")){a.preventDefault();$(this).parent().siblings().removeClass("active");$(this).parent().toggleClass("active");forceWebkitRedraw()}}).on("mouseover",function(a){$("nav li.location, nav li.search").removeClass("active")});$("nav >ul >li.search >a").on("click",function(a){if($("body").data("is-mobile")){a.preventDefault();$(this).parent().siblings().removeClass("active");$(this).parent().toggleClass("active");if($("body").data("is-mobile")){forceWebkitRedraw()}}});$("nav li.products >div >ul >li").on("mouseover",function(a){if(!$("body").data("is-mobile")){$("nav li.products >div").addClass("extended")}}).on("mouseout",function(a){if(!$("body").data("is-mobile")){$("nav li.products >div").removeClass("extended")}});$("nav li.menu, nav >ul >li.search").on("mouseover",function(a){if(!$("body").data("is-mobile")){$("nav li.location > div > ul > li").removeClass("active");$("nav li.location > div > ul > li > a").attr("aria-expanded","false");$("nav li.location > div > ul > li > div").attr("aria-hidden","true")}});$("nav li.location").on("mouseover",function(a){a.preventDefault();$(this).parent().siblings().removeClass("active");$("nav li.location").toggleClass("active");$(this).attr("aria-expanded","false");$(this).parent().find(">div").attr("aria-hidden","true")}).on("mouseout",function(a){a.preventDefault();$("nav li.location").toggleClass("active");$(this).attr("aria-expanded","true");$(this).parent().find(">div").attr("aria-hidden","false")});$("nav li.location >div >ul >li >a").on("mouseover",function(a){$(this).parent().addClass("active");$(this).attr("aria-expanded","true");$(this).parent().find(">div").attr("aria-hidden","false");$(this).parent().addClass("active").siblings().removeClass("active")})}head.ready(function(){$(".tableContainer table").each(function(){$table=$(this);var b=$table.closest(".tableContainer").find(".moreText:first").html();var a=$table.closest(".tableContainer").find(".lessText:first").html();$table.attr("border",0);$table.find("tr:first").children().each(function(){var c=$(this).attr("class");if(c){$(this).removeAttr("class");if(c.indexOf("always")>=0){$(this).attr("data-hide","phone-portrait,phone-landscape,tablet-portrait,tablet-landscape,desktop-full,always")}else{$(this).attr("data-hide",c)}}});$firstRowHtml=$table.find("tr:first");$firstRowHtml.html($firstRowHtml.html().replace(/<td/g,"<th").replace(/<\/td/g,"</th"));$firstRowHtml=$firstRowHtml.append("<th class='flextable-control flextable-last-column'> </th>");$tableHead=$("<thead></thead>").append($firstRowHtml);$table.prepend($tableHead);$table.find("tbody > tr").each(function(){$tableRow=$(this);$tableRow.append("<td class='flextable-control flextable-last-column'><a href='#table-toggle'><span class='collapsed'>"+b+"</span><span class='expanded'>"+a+"</span></a></td>")});$table.attr("class","flextable")});if($(".flextable").length>0&&$(".tableContainer").length>0){$(".flextable").flextable();initializeFlexTableEventHandlers();$(".tableContainer").css("visibility","visible")}});function forceWebkitRedraw(){$("body").hide();var a=$("body").get(0).offsetHeight;$("body").show()}function countriesLayout(){if($(".menu-countries").length>0){$(".menu-countries").columnize({width:350,lastNeverTallest:true,doneFunc:function(){$(".menu-countries").css("visibility","visible")}})}}head.ready(function(){initializeNavEventHandlers();countriesLayout()});function initalizePlaceholder(){$("input, textarea").placeholder()}head.ready(function(){initalizePlaceholder()});function initializeCarousel(){var c=navigator.userAgent.toLowerCase();var b=typeof swfobject!=="undefined"&&swfobject.getFlashPlayerVersion().major!==0;if(b===false){$(".carousel-flash-360s").remove()}$(".product-gallery .gallery-filters").show();if($(".product-gallery .carousel li").length>0){var e=$(".product-gallery .carousel ul:first-child li:first-child a img");toggleGallery(e);if($(".product-gallery .carousel li").length>1){var d=$(".gallery-filters a:first-child").data("filter");filterGallery(d);$(".gallery-filters").on("click","a",function(f){f.preventDefault();filterGallery($(this).data("filter"))});$("#gallery-viewer").attr("aria-owns","");$(".product-gallery .carousel ul li a").each(function(g){$(this).attr("id","carousel-item-"+g);var f=$("#gallery-viewer").attr("aria-owns")+" "+$(this).attr("id");$("#gallery-viewer").attr("aria-owns",f);$(this).attr("aria-controls","gallery-viewer")});$(".gallery-filters ul li a").each(function(f){$(this).attr("aria-controls","carousel-"+$(this).data("filter"))});$(".product-gallery .mobile-controls").on("click","a",function(g){g.preventDefault();var f=$(".product-gallery .carousel  li a.active").parent();f=$(".product-gallery .carousel li").index(f);if($(this).hasClass("next")){nextElement=$(".product-gallery .carousel li").eq(f+1).find("a img");if(nextElement.length<1){nextElement=$(".product-gallery .carousel li").eq(0).find("a img")}}else{nextElement=$(".product-gallery .carousel li").eq(f-1).find("a img");if(nextElement.length<1){nextElement=$(".product-gallery .carousel li").last().find("a img")}}toggleGallery(nextElement)});$(".product-gallery .carousel ul").on("click","a",function(f){$(".product-gallery .carousel a").attr("aria-selected","false");$(this).attr("aria-selected","true");f.preventDefault();toggleGallery($(this).find("img"))});var a=Math.round($("footer .span3").width())===Math.round($("footer .span7").width());setInternalCarouselWidth(a);$(".product-gallery .paginator").on("click","a",function(f){f.preventDefault();setCarouselPage($(this).attr("class"))});$(document).on("mode-change","body",function(f){setInternalCarouselWidth(f.mobile)});$(window).on("throttledresize",function(f){setCarouselWidth();setGalleryHeight()});setGalleryHeight();$(".product-gallery .gallery-filters, .product-gallery .paginator").show()}else{$(".product-gallery #gallery-viewer img, .product-gallery #gallery-viewer .fluid-width-video-wrapper").css("position","static");$(".product-gallery .gallery-filters, .product-gallery .paginator").hide();$(".product-gallery .mobile-controls, .product-gallery .carousel").remove()}}else{$(".product-gallery").remove()}}function setGalleryHeight(){var a=$("#gallery-viewer").outerWidth();$("#gallery-viewer").css("height",a*3/4+"px")}function setInternalCarouselWidth(a){if(!a&&$(".product-gallery .carousel").data("width-set")!==true){$(".product-gallery .carousel").data("width-set",true);var b=$(".product-gallery .carousel ul li").outerWidth();$(".product-gallery .carousel ul").each(function(){var c=parseInt($(this).find("li").css("margin-right"),10);var d=$(this).find("li").length;d=(d*(b+c));$(this).css("width",d+"px")})}}function setCarouselWidth(){var h=$(".product-gallery .carousel ul.active li").outerWidth(true);var g=parseInt($(".product-gallery .carousel ul.active li").css("margin-right"),10);var f=$(".product-gallery").outerWidth();var b=Math.floor((f+g)/h);if(!$("body").data("is-mobile")){f=(b*h)-g+1;$(".product-gallery .carousel").css("max-width",f+"px");$(".product-gallery .paginator").css("max-width",f+"px");var a=Math.ceil($(".product-gallery .carousel ul.active li").length/b);var e=$(".product-gallery .carousel ul.active a.active").parent().index();if(e<0){e=0}var d=Math.ceil((e+1)/b);$(".product-gallery .paginator").data("total-pages",a);$(".product-gallery .paginator").data("current-page",d);$(".product-gallery .paginator").data("images-displayed-per-page",b);setCarouselPage()}else{$(".product-gallery .carousel li").removeClass("last");for(i=b;i<=$(".product-gallery .carousel li").length;i=i+b){var c=i-1;$(".product-gallery .carousel li").eq(c).addClass("last")}}}function setCarouselPage(d){currentPage=$(".product-gallery .paginator").data("current-page");pages=$(".product-gallery .paginator").data("total-pages");imagesDisplayedPerPage=$(".product-gallery .paginator").data("images-displayed-per-page");if(d){if(d.indexOf("previous")>=0){currentPage=currentPage-1}else{if(d.indexOf("next")>=0){currentPage=currentPage+1}}if(currentPage<1||currentPage>pages){return false}}$(".product-gallery .paginator").data("current-page",currentPage);var c=$(".product-gallery .carousel ul.active li").outerWidth(true);var b=parseInt($(".product-gallery .carousel ul li").css("margin-right"),10);var a;if(currentPage<=1){a="0";currentPage=1}else{a=((currentPage-1)*(imagesDisplayedPerPage*c))*-1}$(".product-gallery .paginator .paginator-number").html(currentPage+" of "+pages);if(pages===1){$(".product-gallery .paginator").addClass("hidden")}else{$(".product-gallery .paginator").removeClass("hidden")}$(".product-gallery .carousel ul.active").css("left",a+"px")}function filterGallery(a){$(".gallery-filters li").removeClass("active");$('.gallery-filters li a[data-filter="'+a+'"]').parent().addClass("active");$(".product-gallery .carousel ul").removeClass("active");$(".product-gallery .carousel .carousel-"+a).addClass("active");var b=$(".product-gallery .carousel ul.active li:first-child a img");toggleGallery(b);$(".gallery-filters li:not(.active) a").attr("aria-expanded","false");$(".gallery-filters li.active a").attr("aria-expanded","true");$(".product-gallery .carousel ul:not(.active)").attr("aria-hidden","true");$(".product-gallery .carousel ul.active").attr("aria-hidden","false");setCarouselWidth()}function toggleGallery(b){if($(".product-gallery iframe").length>0){$(".product-gallery iframe").hide()}$(".product-gallery .carousel li a").removeClass("active");var d=$(b).closest("li");var h=$(".product-gallery .carousel li").index(d)+1;$(".product-gallery .mobile-paginator-number").html(h+" of "+$(".product-gallery .carousel li").length);$(b).parent().addClass("active");var j=b.data("carousel-type");switch(j){case"image":var m="<img src='"+b.data("fullsize-src")+"' alt='' />";$("#gallery-viewer").html(m);$("#gallery-text").html(b.attr("alt"));break;case 360:var g=b.data("xmlfile");var f=b.data("vpt-type");var e=b.data("vpt-loader-uri");$("#gallery-viewer").html("<div id='gallery-360s' class='fluid-width-video-wrapper' style='padding-top: 66.419355%;'><iframe src="+e+g+" frameborder='0' height='380' width='100%' id='vpt' style='height: 384px;'></iframe></div>");$("#gallery-text").html(b.attr("alt"));break;case"scene7":$("#gallery-viewer").html("<div id='s7_spinview'></div>");$("#gallery-text").html(b.attr("alt"));scene7(d.find("img").attr("data-scene-id"));break;case"video":var a=b.data("video-id");var k=b.data("video-link");var l=b.data("video-height");var c=b.data("video-width");$("#gallery-viewer").html('<iframe width="'+c+'" height="'+l+'" src="'+k+'&wmode=transparent" frameborder="0" allowfullscreen></iframe>');embedCompleteFunction();$("#gallery-text").html(b.attr("alt"));break}}function scene7(b){var a=new s7viewers.SpinViewer({containerId:"s7_spinview",params:{asset:b,serverurl:"http://s7d2.scene7.com/is/image/",contenturl:"http://s7d2.scene7.com/skins/",config:"Scene7SharedAssets/Universal_HTML5_SpinSet_light"}}).init()}function load360(c,e){var a={showPopups:"true",usePopupImageWindows:"true",vptType:e,xmlfile:c};var d={scale:"showall",salign:"TL",align:"TL",wmode:"transparent"};var b={id:"vpt"};swfobject.embedSWF("gallery-360s/vpt_loader.swf","gallery-360s","620","356","10.0.0","gallery-360s/expressInstall.swf",a,d,b,embedCompleteFunction)}function embedCompleteFunction(){$(".gallery-viewer").fitVids()}head.ready(function(){if($(".product-gallery .carousel").length>0){initializeCarousel()}});var CatNS=CatNS||{};CatNS.social={};CatNS.social.patterns=[{name:"en",path:"/en_IN/"},{name:"ru",path:"/ru_RU/"},{name:"zh",path:"/zh_CN/"},{name:"pt",path:"/pt_BR/"}];CatNS.social.shareLinks=[{twitter:[{url:"https://twitter.com/intent/tweet?url=",width:"610",height:"470"},{network:"en,pt,ru"},{title:"&text="}],facebook:[{url:"https://facebook.com/sharer.php?u=",width:"545",height:"300"},{network:"en,pt,ru"},{title:"&t="},],linkedIn:[{url:"http://linkedin.com/shareArticle?mini=true&url=",width:"480",height:"620"},{network:"en,pt,ru"}],google:[{url:"https://plus.google.com/share?url=",width:"568",height:"458"},{network:"en,pt,ru"}],vk:[{url:"http://vk.com/share.php?url=",width:"655",height:"453"},{network:"ru"},{title:"&title="}],odnoklassniki:[{url:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=",width:"600",height:"321"},{network:"ru"},{title:"&title="}],"sina-weibo":[{url:"http://service.weibo.com/share/share.php?url=",width:"650",height:"492"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}],"netease-weibo":[{url:"http://t.163.com/article/user/checkLogin.do?link=http://news.163.com/&source=&info="+encodeURIComponent($("meta[property='og:title']").attr("content")),width:"750",height:"281"},{network:"zh"},{title:"&source=&info="}],"tencent-weibo":[{url:"http://share.v.t.qq.com/index.php?c=share&a=index&url=",width:"658",height:"488"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}],"tencent-qzone":[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=",width:"600",height:"626"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pics="}],"baidu-space":[{url:"http://apps.hi.baidu.com/share/?url=",width:"600",height:"608"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}]}];(function(a){a(function(){CatNS.social.shareListener=function(){var n=".social-toolbox";var d=n+" .share",e=document.URL,f,h,q,l,c,m,o,k,g,r,j,p,b;if(a(n).length<1||a(d).length<1){return false}if(a("html").hasClass("touch")||a("html").hasClass("lt-800")){o=true}else{o=false}a(d).on("click",function(s){s.preventDefault();l=encodeURIComponent(a("meta[property='og:title']").attr("content"));c=encodeURIComponent(a("meta[property='og:description']").attr("content"));m=encodeURIComponent(a("meta[property='og:image']").attr("content"));h=a.trim(a(s.currentTarget).attr("class").replace("share",""));f=CatNS.social.shareLinks[0][h][0].url+e;if(CatNS.social.shareLinks[0][h][2]&&CatNS.social.shareLinks[0][h][2].title){q=CatNS.social.shareLinks[0][h][2].title;q=q+l;f=f+q}if(CatNS.social.shareLinks[0][h][3]&&CatNS.social.shareLinks[0][h][3].summary){q=CatNS.social.shareLinks[0][h][3].summary;q=q+c;f=f+q}if(CatNS.social.shareLinks[0][h][4]&&CatNS.social.shareLinks[0][h][4].pic){q=CatNS.social.shareLinks[0][h][4].pic;q=q+m;f=f+q}trackerGA("social share","share on "+h,e);if(o===false){g=600;r=260;if(CatNS.social.shareLinks[0][h][0].width&&CatNS.social.shareLinks[0][h][0].height){g=CatNS.social.shareLinks[0][h][0].width;r=CatNS.social.shareLinks[0][h][0].height}j=(screen.width/2)-(g/2);p=(screen.height/2)-(r/2);b="menubar=no, location=no, resizable=yes, scrollbars=yes, status=no, width="+g+", height="+r+", top="+p+", left="+j;k=window.open(f,"",b)}else{k=window.open(f,"_blank")}})};CatNS.social.shareLocalization=function(){var b=document.URL,e=CatNS.social.patterns[0].name,f="",d,c=".social-toolbox";if(a(c).length<1){return false}a.each(CatNS.social.patterns,function(h,j){var g=b.indexOf(CatNS.social.patterns[h].path);if(g>-1){e=CatNS.social.patterns[h].name;return e}});a.each(CatNS.social.shareLinks[0],function(g,h){d=CatNS.social.shareLinks[0][g][1].network;pathExist=d.indexOf(e);if(pathExist>-1){f=f+'<li><a class="'+g+' share" href="#"></a></li>'}});a(c).html(f)};CatNS.social.init=function(){CatNS.social.shareLocalization();CatNS.social.shareListener()};CatNS.social.init()})})(jQuery,window);
/*!
 * Flextable
 *
 * Based on: FooTable - Awesome Responsive Tables
 * http://themergency.com/footable
 *
 * Requires jQuery - http://jquery.com/
 *
 * Copyright 2012 Steven Usher & Brad Vincent
 * Released under the MIT license
 * You are free to use FooTable in commercial projects as long as this copyright header is left intact.
 *
 * Date: 18 Nov 2012
 */
(function(d,a,f){a.flextable={options:{delay:100,breakpoints:{"phone-portrait":320,"phone-landscape":480,"tablet-portrait":768,"tablet-landscape":1024,"desktop-full":1600,always:10000},parsers:{alpha:function(g){return d(g).data("value")||d.trim(d(g).text())}},selectorEnabled:true,toggleSelector:" > tbody .flextable-control a",customToggleSelector:"> tbody > tr > td .custom-flextable-control a",createDetail:function(n,m){var h={_none:{name:null,data:[]}};for(var o=0;o<m.length;o++){var k=m[o].group;if(k!==null){if(!(k in h)){h[k]={name:m[o].groupName,data:[]}}h[k].data.push(m[o])}else{h._none.data.push(m[o])}}for(var q in h){if(h[q].data.length===0){continue}if(q!="_none"){n.append("<h4>"+h[q].name+"</h4>")}for(var l=0;l<h[q].data.length;l++){if(h[q].data[l].name.length>0){n.append("<div><strong>"+h[q].data[l].name+"</strong>: "+h[q].data[l].display+"</div>");if(this.isHtml(h[q].data[l].display)){var p=d(h[q].data[l].display);var g=n.find(".custom-flextable-control");if(p.hasClass("custom-flextable-control")){this.bindCustomInnerToggle(g)}}}else{n.append("<div>"+h[q].data[l].display+"</div>")}}}},isHtml:function(j){var g=document.createElement("div");g.innerHTML=j;for(var k=g.childNodes,h=k.length;h--;){if(k[h].nodeType==1){return true}}return false},bindCustomInnerToggle:function(h){var g=d(h);g.unbind("click.flextable").bind("click.flextable",function(j){j.preventDefault();if(h.next().is(":visible")){h.removeClass("open").addClass("close");h.next().hide()}else{h.removeClass("close").addClass("open");h.next().show()}})},classes:{loading:"flextable-loading",loaded:"flextable-loaded",sorted:"flextable-sorted",descending:"flextable-sorted-desc",indicator:"flextable-sort-indicator"},debug:true},version:{major:0,minor:1,toString:function(){return a.flextable.version.major+"."+a.flextable.version.minor},parse:function(g){version=/(\d+)\.?(\d+)?\.?(\d+)?/.exec(g);return{major:parseInt(version[1],10)||0,minor:parseInt(version[2],10)||0,patch:parseInt(version[3],10)||0}}},plugins:{_validate:function(g){if(typeof g.name!=="string"){if(a.flextable.options.debug===true){console.error('Validation failed, plugin does not implement a string property called "name".',g)}return false}if(!d.isFunction(g.init)){if(a.flextable.options.debug===true){console.error('Validation failed, plugin "'+g.name+'" does not implement a function called "init".',g)}return false}if(a.flextable.options.debug===true){console.log('Validation succeeded for plugin "'+g.name+'".',g)}return true},registered:[],register:function(h,g){if(a.flextable.plugins._validate(h)){a.flextable.plugins.registered.push(h);if(g!==f&&typeof g==="object"){d.extend(true,a.flextable.options,g)}if(a.flextable.options.debug===true){console.log('Plugin "'+h.name+'" has been registered with the Foobox.',h)}}},init:function(g){for(var h=0;h<a.flextable.plugins.registered.length;h++){try{a.flextable.plugins.registered[h].init(g)}catch(j){if(a.flextable.options.debug===true){console.error(j)}}}}}};var c=0;d.fn.flextable=function(g){g=g||{};var h=d.extend(true,{},a.flextable.options,g);return this.each(function(){c++;this.flextable=new e(this,h,c)})};function b(){var g=this;g.id=null;g.busy=false;g.start=function(j,h){if(g.busy){return}g.stop();g.id=setTimeout(function(){j();g.id=null;g.busy=false},h);g.busy=true};g.stop=function(){if(g.id!==null){clearTimeout(g.id);g.id=null;g.busy=false}}}function e(j,l,n){var m=this;m.id=n;m.table=j;m.options=l;m.breakpoints=[];m.breakpointNames="";m.columns={};var h=m.options;var g=h.classes;var k=0;m.timers={resize:new b(),register:function(o){m.timers[o]=new b();return m.timers[o]}};a.flextable.plugins.init(m);m.init=function(){var q=d(a),p=d(m.table);if(p.hasClass(g.loaded)){m.raise("flextable_already_initialized");return}p.addClass(g.loading);p.find("> thead > tr:last-child > th").each(function(){var s=m.getColumnData(this);m.columns[s.index]=s;if(s.className!==null){var r="",t=true;d.each(s.matches,function(u,v){if(!t){r+=", "}r+="> tbody > tr:not(.flextable-row-detail) > td:nth-child("+(parseInt(v,10)+1)+")";t=false});p.find(r).not(".flextable-cell-detail").addClass(s.className)}});for(var o in h.breakpoints){m.breakpoints.push({name:o,width:h.breakpoints[o]});m.breakpointNames+=(o+" ")}m.breakpoints.sort(function(s,r){return s.width-r.width});m.bindToggleSelectors();m.raise("flextable_initializing");p.bind("flextable_initialized",function(){m.resize();p.removeClass(g.loading);p.find('[data-init="hide"]').hide();p.find('[data-init="show"]').show();p.addClass(g.loaded)});q.bind("resize.flextable",function(){m.timers.resize.stop();m.timers.resize.start(function(){m.resize()},h.delay)});m.raise("flextable_initialized")};m.bindToggleSelectors=function(){var o=d(m.table);var p;if(!h.selectorEnabled){p=h.toggleSelector.find(".flextable-control a")}else{p=o.find(h.toggleSelector)}p.unbind("click.flextable").bind("click.flextable",function(r){r.preventDefault();if(o.is(".breakpoint")){var q=d(this).closest("tr");m.toggleDetail(q.get(0))}});o.find(h.customToggleSelector).bind("click.flextable",function(r){r.preventDefault();var q=d(this).closest("tr");var s=d(this).parent().next();m.toggleCustomDetail(q.get(0),s,d(this).parent(),d(this))})};m.parse=function(o,p){var q=h.parsers[p.type]||h.parsers.alpha;return q(o)};m.getColumnData=function(p){var B=d(p),v=B.data("hide"),w=B.index();var z=B.data("custom");v=v||"";v=v.split(",");var u={index:w,hide:{},type:B.data("type")||"alpha",name:B.data("name")||d.trim(B.text()),ignore:B.data("ignore")||false,className:B.data("class")||null,matches:[],names:{},group:B.data("group")||null,groupName:null};if(u.group!==null){var A=d(m.table).find('> thead > tr.flextable-group-row > th[data-group="'+u.group+'"], > thead > tr.flextable-group-row > td[data-group="'+u.group+'"]').first();u.groupName=m.parse(A,{type:"alpha"})}var q=parseInt(B.prev().attr("colspan")||0,10);k+=q>1?q-1:0;var r=parseInt(B.attr("colspan")||0,10),s=u.index+k;if(r>0){var y=B.data("names");y=y||"";y=y.split(",");for(var t=0;t<r;t++){u.matches.push(t+s);if(t<y.length){u.names[t+s]=y[t]}}}else{u.matches.push(s)}u.hide["default"]=(B.data("hide")==="all")||(d.inArray("default",v)>=0);for(var o in h.breakpoints){u.hide[o]=(B.data("hide")==="all")||(d.inArray(o,v)>=0)}var x=m.raise("flextable_column_data",{column:{data:u,th:p}});return x.column.data};m.getViewportWidth=function(){return window.innerWidth||(document.body?document.body.offsetWidth:0)};m.getViewportHeight=function(){return window.innerHeight||(document.body?document.body.offsetHeight:0)};m.hasBreakpointColumn=function(o){for(var p in m.columns){if(m.columns[p].hide[o]){return true}}return false};m.resetCustomDetails=function(p){var o=d(m.table);o.find(".custom-flextable-control").removeClass("open").addClass("close");o.find(".flextable-row-detail").each(function(){var t=d(this).hasClass("custom-detail");var s=d(this).hasClass("open");if(t){var v=d(this).prev();var u=v.find(".custom-flextable-control");var q=u.next();var r=u.find("a");r.unbind("click.flextable").bind("click.flextable",function(w){m.toggleCustomDetail(v,q,u,r)});setTimeout(function(){v.next().remove()},0)}})};m.resize=function(){var p=d(m.table);var u={width:p.width(),height:p.height(),viewportWidth:m.getViewportWidth(),viewportHeight:m.getViewportHeight(),orientation:null};u.orientation=u.viewportWidth>u.viewportHeight?"landscape":"portrait";u.width=u.viewportWidth;u.height=u.viewportHeight;var v=p.data("flextable_info");p.data("flextable_info",u);m.raise("flextable_resizing",{old:v,info:u});if(!v||((v&&v.width&&v.width!=u.width)||(v&&v.height&&v.height!=u.height))){var t=null,o;for(var r=0;r<m.breakpoints.length;r++){o=m.breakpoints[r];if(o&&o.width&&u.width<=o.width){t=o;break}}var q=(t===null?"default":t.name);var s=m.hasBreakpointColumn(q);if(s){m.resetCustomDetails(q)}p.removeClass("default breakpoint no-breakpoint").removeClass(m.breakpointNames).addClass(q+(s?" breakpoint":" no-breakpoint")).find("> thead > tr:last-child > th").each(function(){var A=m.columns[d(this).index()],w="",C=true;d.each(A.matches,function(D,E){if(!C){w+=", "}var F=E+1;w+="> tbody > tr:not(.flextable-row-detail) > td:nth-child("+F+")";w+=", > tfoot > tr:not(.flextable-row-detail) > td:nth-child("+F+")";w+=", > colgroup > col:nth-child("+F+")";C=false});w+=', > thead > tr[data-group-row="true"] > th[data-group="'+A.group+'"]';var B=p.find(w).add(this);if(A.hide[q]===false){B.show()}else{B.hide()}if(p.find("> thead > tr.flextable-group-row").length==1){var y=p.find('> thead > tr:last-child > th[data-group="'+A.group+'"]:visible, > thead > tr:last-child > th[data-group="'+A.group+'"]:visible'),z=p.find('> thead > tr.flextable-group-row > th[data-group="'+A.group+'"], > thead > tr.flextable-group-row > td[data-group="'+A.group+'"]'),x=0;d.each(y,function(){x+=parseInt(d(this).attr("colspan")||1,10)});if(x>0){z.attr("colspan",x).show()}else{z.hide()}}}).end().find("> tbody > tr.flextable-detail-show").each(function(){m.createOrUpdateDetailRow(this)});p.find("> tbody > tr.flextable-detail-show:visible").each(function(){var w=d(this).next();if(w.hasClass("flextable-row-detail")){if(q=="default"&&!s){w.hide()}else{w.show()}}});p.find("> thead > tr > th.flextable-last-column, > tbody > tr > td.flextable-last-column").removeClass("flextable-last-column");p.find("> thead > tr > th.flextable-first-column, > tbody > tr > td.flextable-first-column").removeClass("flextable-first-column");p.find("> thead > tr, > tbody > tr").find("> th:visible:last, > td:visible:last:not(.flextable-cell-detail)").addClass("flextable-last-column").end().find("> th:visible:first, > td:visible:first:not(.flextable-cell-detail)").addClass("flextable-first-column");m.raise("flextable_breakpoint_"+q,{info:u})}m.raise("flextable_resized",{old:v,info:u})};m.toggleDetail=function(r){var o=d(r);var q=m.createOrUpdateDetailRow(o.get(0));var p=o.next();if(!q&&p.is(":visible")){o.removeClass("flextable-detail-show");if(p.hasClass("flextable-row-detail")){p.hide()}p.attr("aria-hidden","true")}else{o.addClass("flextable-detail-show");p.show();p.attr("aria-hidden","false")}};m.toggleCustomDetail=function(v,w,t,q){var y=d(v),s=y.next(),o,A=[],x;var p=d(w);var B=d(t);var u=false;u=!s.is(":visible");var r=y.find("> td:visible").length;var z=s.hasClass("flextable-row-detail");if(z){s.remove();z=false}if(!z){s=d('<tr class="flextable-row-detail custom-detail"><td class="flextable-cell-detail"><div class="flextable-row-detail-inner"><table>'+p.html()+"</table></div></td></tr>");y.after(s);u=true}s.find("> td:first").attr("colspan",r);if(u){B.removeClass("close").addClass("open");s.removeClass("close").addClass("open");q.unbind("click.flextable").bind("click.flextable",function(C){s.remove();B.removeClass("open").addClass("close");q.unbind("click.flextable").bind("click.flextable",function(D){m.toggleCustomDetail(v,w,t,q)})})}else{B.removeClass("open").addClass("close");s.removeClass("open").addClass("close")}};m.getColumnFromTdIndex=function(p){var o=null;for(var q in m.columns){if(d.inArray(p,m.columns[q].matches)>=0){o=m.columns[q];break}}return o};m.createOrUpdateDetailRow=function(u){var o=d(u),p=o.next(),s,q=[];if(o.is(":hidden")){return false}o.find("> td:hidden").each(function(){var w=d(this).index(),x=m.getColumnFromTdIndex(w),v=x.name;if(x.ignore===true){return true}q.push({name:v,value:m.parse(this,x),display:d.trim(d(this).html()),group:x.group,groupName:x.groupName});return true});if(q.length===0){return false}var t=o.find("> td:visible").length;var r=p.hasClass("flextable-row-detail");if(!r){p=d('<tr class="flextable-row-detail"><td class="flextable-cell-detail"><div class="flextable-row-detail-inner"></div></td></tr>');o.after(p)}p.find("> td:first").attr("colspan",t);s=p.find(".flextable-row-detail-inner").empty();h.createDetail(s,q);return !r};m.createCustomRow=function(s){var o=d(s),p=o.next(),r,q=[];if(o.is(":hidden")){return false}};m.raise=function(o,p){p=p||{};var q={ft:m};d.extend(true,q,p);var r=d.Event(o,q);if(!r.ft){d.extend(true,r,q)}d(m.table).trigger(r);return r};m.init();d(m.table).css("display","none").css("display","");return m}})(jQuery,window);function initializeFlexTableEventHandlers(){$(".flextable").on("mouseover","tr",function(a){if($(this).hasClass("flextable-detail-show")){if($(this).next().hasClass("flextable-row-detail")){$(this).next().addClass("active")}}else{if($(this).prev().hasClass("flextable-detail-show")){$(this).prev().addClass("active");$(this).addClass("active")}}}).on("mouseout","tr",function(a){if($(this).hasClass("flextable-detail-show")){if($(this).next().hasClass("flextable-row-detail")){$(this).next().removeClass("active")}}else{if($(this).prev().hasClass("flextable-detail-show")){$(this).prev().removeClass("active");$(this).removeClass("active")}}}).on("click","tr.flextable-detail-show td.flextable-control a",function(a){if($(this).closest("tr.flextable-detail-show").next().hasClass("flextable-row-detail")){$("tr.flextable-detail-show, tr.flextable-row-detail").removeClass("active");$(this).closest("tr.flextable-detail-show").addClass("active").next().addClass("active")}}).on("click","tr.flextable-row-detail .custom-flextable-control a",function(a){if($(this).closest(".flextable-row-detail").prev().hasClass("flextable-detail-show")){$("tr.flextable-detail-show, tr.flextable-row-detail").removeClass("active");$(this).closest(".flextable-row-detail").addClass("active").prev().addClass("active")}})}head.ready(function(){$("#tables-example, #product-model-tip").find(".flextable").flextable();initializeFlexTableEventHandlers()});function initializeTabs(){$(".tab-wrapper").tabify({hideClass:"tab-hidden"});$(".tab-wrapper").each(function(){setAccessibilityTags($(this));addToggleControls($(this));$(this).attr("role","tablist");$(this).find("> h2").attr("role","tab")});$(".tab-wrapper").on("click","h2.tab",function(c){$wrapper=$(this).closest(".tab-wrapper");c.preventDefault();if($("html").hasClass("lt-768")){var b=$(this).data("toggle-tab-handler");var a=$('[data-toggle-tab-group="'+b+'"]');if(!$(this).hasClass("open")){$wrapper.data("last-selected",b)}else{$wrapper.data("last-selected","")}toggle($(this),a)}else{$(this).trigger("tabClick");setAccessibilityTags($wrapper)}});$("h2.tab a").on("keydown",function(c){if(c.which===37||c.which===39){var a=$(this).parent();var b;if(c.which===37){if(a.index()===0){b=a.siblings("h2.tab").last().find("a")}else{b=a.prev().prev().find("a")}}else{if(a.next().next("h2.tab").size()===0){b=a.siblings("h2.tab").first().find("a")}else{b=a.next().next().find("a")}}b.focus()}});if($("html").hasClass("ie")){setTabMode($("body").data("is-mobile"))}else{$(window).load(function(){setTabMode($("body").data("is-mobile"))})}$(document).on("mode-change","body",function(a){setTabMode(a.mobile)})}function setTabMode(a){checkLastSelected(a);if(!a){fixTabWidth()}}function setAccessibilityTags(a){$currentTab=a.find(".tab.selected");$currentTabContent=a.find(".tab-content:not(.tab-hidden)");$currentTabContent.attr("aria-hidden","false");$currentTab.attr("aria-expanded","true");$currentTabContent.attr("tabindex","0");a.find(".tab-content.tab-hidden").attr("aria-hidden","true");a.find(".tab:not(.selected)").attr("aria-expanded","false")}function fixTabWidth(a){$(".tab-wrapper").each(function(){var b=$(this).find(".tab").eq(0).height();$(this).css({"padding-top":b+"px"});$wrapper=$(this);var c=(a)?a:0;$wrapper.find(".tab").each(function(){$(this).css("left",c+"px");c+=$(this).outerWidth()})})}function checkLastSelected(a){$(".tab-wrapper").each(function(){if(a){$selectedTab=$(this).find(".tab.selected");if($selectedTab.length===0){$selectedTab=$(this).find(".tab:first-child")}$selectedTab.addClass("open").removeClass("selected");var b=$selectedTab.data("toggle-tab-handler");$target=$('[data-toggle-tab-group="'+b+'"]');$target.addClass("show");$(this).data("last-selected",$selectedTab.data("toggle-tab-handler"))}else{$selectedTab=$(".tab[data-toggle-tab-handler='"+$(this).data("last-selected")+"']");$(this).find(".tab").removeClass("open");$(this).find(".tab-content").removeClass("show");if($selectedTab.length>0){$selectedTab.trigger("tabClick")}else{if($(this).find("h2.selected").length>0){$selectedTab=$(this).find(".selected")}else{$selectedTab=$(this).find(".tab").first()}$selectedTab.trigger("tabClick")}}})}function addToggleControls(a){a.find(".tab").each(function(){var c=$(this).attr("aria-controls");var b=$("#"+c);$(this).data("toggle-tab-handler",c);$(this).attr("data-toggle-tab-handler",c);b.attr("data-toggle-tab-group",c)})}head.ready(function(){initializeTabs()});var CatNS=CatNS||{};CatNS.tpl={templates:{},loadTemplates:function(c,d){var b=this;var a=function(f){var e=c[f];console.log("Loading template: "+e);$.get(tplPath+e+".html",function(g){b.templates[e]=g;f++;if(f<c.length){a(f)}else{d()}})};a(0)},get:function(a){return this.templates[a]}};function initializeToggles(){$("body").on("click","[data-toggle-mobile-handler]",function(c){c.preventDefault();if($("html").hasClass("lt-768")){var b=$(this).data("toggle-mobile-handler");var a=$('[data-toggle-mobile-group="'+b+'"]');toggle($(this),a)}});$("body").on("keypress","[data-toggle-mobile-handler]",function(a){if(a.which==13){$(this).trigger("click")}});$("body").on("click","[data-toggle-handler]",function(c){c.preventDefault();var b=$(this).data("toggle-handler");var a=$('[data-toggle-group="'+b+'"]');toggle($(this),a)});$("[data-toggle-handler]").each(function(){var b=$(this).data("toggle-handler");var a=$('[data-toggle-group="'+b+'"]');if($(this).hasClass("open")){a.addClass("show")}setToggleAriaTags($(this),b,a)});setToggleMode($("body").data("is-mobile"));$(document).on("mode-change",function(a){setToggleMode(a.mobile)})}function toggle(b,a){var c=false;if(b.data("toggle-handler")=="toggle-sidekick"&&!$("html").hasClass("touch")){c=true}if(c===false){b.toggleClass("open");a.toggleClass("show");b.attr("aria-expanded",a.hasClass("show"));a.attr("aria-hidden",!a.hasClass("show"))}}function setToggleMode(a){if(a){$("[data-toggle-mobile-handler]").each(function(c){var d=$(this).data("toggle-mobile-handler");var b=$('[data-toggle-mobile-group="'+d+'"]');var e=$(this).html();$(this).html('<a href="#">'+e+"</a>");setToggleAriaTags($(this),d,b)})}else{$("[data-toggle-mobile-handler]").each(function(c){var d=$(this).data("toggle-mobile-handler");var b=$('[data-toggle-mobile-group="'+d+'"]');if($(this).find("a").length>0){var e=$(this).find("a").html();$(this).html(e)}$(this).attr("tabindex","-1");$(this).removeAttr("aria-expanded");b.removeAttr("aria-hidden");$(this).removeAttr("aria-controls");$(this).removeAttr("role")})}}function setToggleAriaTags(b,c,a){controlName=c.replace("toggle-","");b.attr("aria-controls",controlName);a.attr("id",controlName);b.attr("tabindex","0");b.attr("role","button");b.attr("aria-expanded",b.hasClass("open"));a.attr("aria-hidden",!b.hasClass("open"))}head.ready(function(){initializeToggles()});function initializeToolTips(){var b="ontouchstart" in document.documentElement;if(!b){var a={container:".carousel",placement:"bottom"};$(".product-gallery .carousel ul li").tooltip(a)}}head.ready(function(){initializeToolTips()});function triggerUnitSwitch(a){$(".unit").addClass("unit-hidden").filter(".unit-"+a).removeClass("unit-hidden");$("li[data-switch-class]").removeClass("active").filter('[data-switch-class="'+a+'"]').addClass("active")}function initializeUnitSwitch(a){$("li[data-switch-class]").on("click",function(b){b.preventDefault();triggerUnitSwitch($(this).data("switch-class"))});if(a){triggerUnitSwitch(a)}}if(!window.console){console={log:function(){}}}var CatNS=CatNS||{};var CATDealerModel=Backbone.Model.extend({defaults:{intId:"dealerId",name:"dealer name",street:"street",city:"city",state:"state",locations:[],encryptedDealerCode:"",parentDealerCode:""},initialize:function(){}});var CATDealerCollection=Backbone.Collection.extend({model:CATDealerModel,initialize:function(){},fetch:function(d,b){var c=this;var a={resourceId:CAT_SERVICES_NAME.DEALER_IDS,data:{lat:d.lat,lng:d.lng}};amplify.request({resourceId:a.resourceId,data:a.data,success:function(k){var e=false;var n=(e)?k:dealerList["dealerlocation-array"];_.each(n,function(q,p){n[p].encryptedDealerCode=$.trim(q.encryptedDealerCode);n[p].parentDealerCode=$.trim(q.parentDealerCode)});_.sortBy(n,"distanceInMiles");var h=_.groupBy(n,"parentDealerCode");var o=_.keys(h);var g=[];var j=[];_.each(o,function(p){var r=_.where(n,{encryptedDealerCode:p});var q=new CATDealerModel(r[0]);q.set("locations",h[p]);j.push(q)});j=_.sortBy(j,function(p){return p.get("distanceInMiles")});var l=j.slice(0,5);console.log("DEALERS RAW COLLECTION",l);amplify.store(CAT_STORE.DEALERS_RAW,l);var m=amplify.store(CAT_STORE.CAT_CATALOG_DEALERS);if(!_.isEmpty(m)){o=_.intersection(o,m)}_.each(o,function(q){var p=_.where(n,{encryptedDealerCode:q});var r=new CATDealerModel(p[0]);r.set("locations",h[q]);g.push(r)});g=_.sortBy(g,function(p){return p.get("distanceInMiles")});var f=g.slice(0,5);c.reset(f);if(!c.size()){amplify.publish(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL)}else{amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL)}amplify.publish(CAT_EVENTS.DEALERS_LIST_SUCCESS,c)},error:function(e,f){console.log("error")}})},getDealers:function(a){amplify.publish(CAT_EVENTS.DEALERS_SEARCHING);this.fetch(a)}});var CATCompetitorModel=Backbone.Model.extend({defaults:{Machine_ID:"0",Manufacturer_ID:"0",Manufacturer:"xx",Model:"740",Discontinued:"0",Tier_ID:"3",Sort_Display:"39500"}});var CATCompetitorDataHeader=Backbone.Model.extend({defaults:{Label:"Backhoe type",DataType:"A",Data:[{Machine_ID:"0",Region_ID:"0",Manufacturer:"",Model:"",Tier_ID:"0",Tier:"",Discontinued:"0"}]}});var CATCompetitorDataModel=Backbone.Model.extend({defaults:{Label:"Backhoe type",DataType:"A",Unit:"",Data:[]},initialize:function(){var m=this.get("Unit"),f,j=[],l=/\[(.*?)\]/,e,h,d,a,g=this.get("Data").length;function b(o){if(o===""){return""}var k=o.indexOf(" [");var n=[];if(k>-1){n.push(o.substring(0,(k-1)));f=o.match(l);if(f&&f.length>0){n.push(f[1])}h=j.length;a=n.length;if(h===a){for(d=0;d<h;d++){n[d]=n[d]+" "+j[d]}}}return n}if(m!==""&&m.length>3){var c=m.indexOf(" [");if(c>-1){j.push(m.substring(0,(c-1)));f=m.match(l);if(f.length>0){j.push(f[1])}}for(e=0;e<g;e++){this.get("Data")[e]=b(this.get("Data")[e]["Column "+e])}}else{for(e=0;e<g;e++){this.get("Data")[e]=this.get("Data")[e]["Column "+e]}}}});var CATCompetitorDataCollection=Backbone.Collection.extend({model:function(b,a){switch(b.Label){case"MACHINES":return new CATCompetitorDataHeader(b,a);default:return new CATCompetitorDataModel(b,a)}},fetch:function(b){console.log("fetch function: params",b);var a=this;amplify.request({resourceId:CAT_SERVICES_NAME.COMPETITORS_DATA,data:{mids:b.ids},success:function(c){a.reset(c);amplify.publish(CAT_EVENTS.COMPETITORS_DATA_SUCCESS,a)},error:function(d,c){amplify.publish(CAT_EVENTS.SERVICE_ERROR,c)}})},getHeader:function(){var a=this.shift();console.log("getHeader: header:",a);return a},getData:function(){return this.slice(0)}});var CATCompetitorCollection=Backbone.Collection.extend({model:CATCompetitorModel,initialize:function(){console.log("initialize collection.length=",this.length)},fetch:function(c,a){var b=this;amplify.request({resourceId:CAT_SERVICES_NAME.COMPETITORS,data:{mid:c.id},success:function(d){b.reset(d);console.log("before exclude collection.length=",b.length);b.exclude(a);console.log("after exclude collection.length=",b.length);console.log("collection listings:",b.pluck("Manufacturer"),b.pluck("Machine_ID"));amplify.publish(CAT_EVENTS.COMPETITORS_SUCCESS,b)},error:function(e,d){console.log("2. >>>>>competitor ERROR: msg=",e," / status=",d);amplify.publish(CAT_EVENTS.SERVICE_ERROR,d)}})},exclude:function(d){var e=this;var b=[];console.log(".....exclude catSpecCheckId = ",d);if(typeof d==="undefined"){d="5"}this.each(function(f){console.log("manufacturer:",f.get("Manufacturer")," / Manufacturer_ID=",f.get("Manufacturer_ID")," / Model:",f.get("Machine_ID"));if(f.get("Manufacturer_ID")==d||f.get("Discontinued")=="1"){console.log("...remove:",f.get("Manufacturer"),"-",f.get("Machine_ID"));b.push(f)}});console.log("removing items:",b);var a=b.length;for(var c=0;c<a;c++){e.remove(b[c])}},getGroups:function(){console.log("getGroups: len=",this.length,this.pluck("Manufacturer"));var b=this.groupBy(function(d){return d.get("Manufacturer")});var a=[],c;for(c in b){a.push({label:c,list:b[c]})}return a},removeSelectedModels:function(d){var e=this,f=[],a=d.length;console.log("collection before remove:",e);for(var c=0;c<a;c++){var b=e.findWhere({Machine_ID:d[c]+""});if(typeof b!=="undefined"){f.push(b);e.remove(b)}}console.log("selectedModels:",f);console.log("collection after remove selected model:",e.pluck("Manufacturer"));return f},getTop2Models:function(){var c=[],d=this,b=0;if(d.length>0){d.each(function(e){if(b<2){c.push(e);b+=1}else{return false}})}for(var a=0;a<b;a++){d.remove(c[a])}console.log("top2Models:",c);console.log("collection:",d.pluck("Manufacturer"));return c}});var CATProductDetailModel=Backbone.Model.extend({defaults:{pid:"0",itemtype:"new/rental",quantity:1,path:"path",startDate:"",endDate:"",delivered:false,did:"0",dName:"dealer name",dAddress1:"Address line 1",dAddress2:"Address line 2",dPhone:"000-000-0000"}});var CATProductDetailView=Backbone.View.extend({model:CATProductDetailModel,initialize:function(){console.log("product detail view",this.$el)},events:{"click .cart-add-button":"addToCart"},addToCart:function(a){a.preventDefault();CatNS.CATEnhanceModel.addItemToCart(this.model.attributes)}});CatNS.CATEnhanceModel={dealers:new CATDealerCollection(),dealersSelected:[],competitors:new CATCompetitorCollection(),competitorsData:new CATCompetitorDataCollection(),initialize:function(){amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,this.onDealersUpdate);amplify.subscribe(CAT_EVENTS.DEALER_SEARCH_SUCCESS,this.onDealerSearch);amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,this,this.onDealerSelected);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,this,this.onFilterDealerReset);var a=$("#cat-family-name").val();if($("#cat-family-name")){amplify.store(CAT_STORE.CAT_FAMILY_NAME,a)}this.dealersSelected=amplify.store(CAT_STORE.DEALER_SELECTED)},onFilterDealerReset:function(){this.dealersSelected=[]},getDealerLocation:function(a){var b=this;var c=new google.maps.Geocoder();console.log("getDealerLocation",a);c.geocode({address:a},function(e,d){if(d==google.maps.GeocoderStatus.OK){var f=e[0].geometry.location;b.getDealers({lat:f.lat(),lng:f.lng()},true);amplify.publish(CAT_EVENTS.DEALER_SEARCH_SUCCESS,a)}else{amplify.publish(CAT_EVENTS.SERVICE_ERROR,{message:"Geocode was not successful for the following reason: "+d});amplify.publish(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL);amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);amplify.publish(CAT_EVENTS.GOOGLE_GEO_ERROR);return false}})},getDealers:function(b,a){if(!a&&amplify.store(CAT_STORE.DEALERS)){console.log("getting dealers from storage");this.dealers.reset(amplify.store(CAT_STORE.DEALERS))}else{console.log("requesting dealers service",CAT_SERVICES_URL.DEALER_IDS);this.dealers.getDealers(b)}},onDealersUpdate:function(a){amplify.store(CAT_STORE.DEALERS,a.toJSON());amplify.store(CAT_STORE.DEALER_SELECTED,null)},onDealerSearch:function(a){amplify.store(CAT_STORE.DEALERS_SEARCHED,a)},setDealer:function(d){var b=d.dealer;var c=(_.where(this.dealersSelected,{encryptedDealerCode:b.encryptedDealerCode}).length===0)?false:true;if(!this.dealersSelected){this.dealersSelected=[]}if(!c){this.dealersSelected.push(b)}else{if(d.value){this.dealersSelected.push(b)}else{this.dealersSelected=_.reject(this.dealersSelected,function(e){return(e.encryptedDealerCode===b.encryptedDealerCode)})}}amplify.store(CAT_STORE.DEALER_SELECTED,this.dealersSelected);if(!_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED))){var a=_.sortBy(this.dealersSelected,function(e){return e.distanceInMiles});amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,a[0])}else{amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null)}},onDealerSelected:function(a,b){console.log("MODEL ON DEALER SELECTED",a,b);if(!b){this.setDealer(a)}},getCompetitors:function(a){this.competitors.fetch(a)},getCompetitorsData:function(a){this.competitorsData.fetch(a)},addItemToCart:function(b){var a={action:"add",pid:b.pid,itemtype:b.itemtype,quantity:1,path:b.path,startDate:b.startDate,endDate:b.endDate,delivered:b.delivered,did:b.did,dName:b.dName,dAddress1:b.dAddress1,dAddress2:b.dAddress2,dPhone:b.dPhone};console.log("sending",a);amplify.request({resourceId:CAT_SERVICES_NAME.CART,data:a,success:function(c){console.log("RESPONSE ADD",c);if(c.result==="success"){amplify.publish(CAT_EVENTS.CART_ADD_SUCCESS,c);window.location="/content/catdotcom/en_US/quote-cart-page.html"}else{amplify.publish(CAT_EVENTS.SERVICE_ERROR,c)}},error:function(c,d){amplify.publish(CAT_EVENTS.SERVICE_ERROR,c)}})}};var CAT_STORE={DEALERS:"DEALERS",DEALERS_RAW:"DEALERS_RAW",DEALERS_SEARCHED:"DEALERS_SEARCHED",DEALER_SELECTED:"DEALER_SELECTED",DETAIL_DEALER_SELECTED:"DETAIL_DEALER_SELECTED",CAT_FAMILY_ID:"CAT_FAMILY_ID",CAT_CATALOG_FACETS:"CAT_CATALOG_FACETS",CAT_CATALOG_DEALERS_FACETS:"CAT_CATALOG_DEALERS_FACETS",CAT_CATALOG_DEALERS:"CAT_CATALOG_DEALERS",CAT_FAMILY_PAGE:"CAT_FAMILY_PAGE",CURRENCY:"CURRENCY",CAT_CURRENT_PAGETYPE:"CAT_CURRENT_PAGETYPE"};var CAT_EVENTS={SERVICE_ERROR:"SERVICE_ERROR",DEALERS_LIST_SUCCESS:"DEALER_LIST_SUCCESS",DEALER_SEARCH_SUCCESS:"DEALER_SEARCH_SUCESS",DEALER_SELECTED:"DEALER_SELECTED",COMPETITORS_SUCCESS:"COMPETITORS_LIST_SUCCESS",COMPETITORS_DATA_SUCCESS:"COMPETITORS__DATALIST_SUCCESS",CART_DELETE_SUCCESS:"CART_DELETE_SUCCESS",CART_ADD_SUCCESS:"CART_ADD_SUCCESS",CART_UPDATE_SUCCESS:"CART_UPDATE_SUCCESS",CART_DELETE_ITEM:"CART_DELETE_ITEM",CATALOG_SUCCESS:"CATALOG_SUCCESS",CATALOG_SIDEKICK_SUCCESS:"CATALOG_SIDEKICK_SUCCESS",CATALOG_SHOW_SIDEKICK:"CATALOG_SHOW_SIDEKICK",CATALOG_HIDE_SIDEKICK:"CATALOG_HIDE_SIDEKICK",CATALOG_PAGINATION:"CATALOG_PAGINATION",CATALOG_RENDER_DONE:"CATALOG_RENDER_DONE",CATALOG_FILTER:"CATALOG_FILTER",CATALOG_FILTER_UPDATE:"CATALOG_FILTER_UPDATE",CATALOG_FILTER_RESET:"CATALOG_FILTER_RESET",CATALOG_FILTER_DEALER_RESET:"CATALOG_FILTER_DEALER_RESET",CATALOG_FILTER_DEEPLINK:"CATALOG_FILTER_DEEPLINK",CATALOG_PAGE_DEEPLINK:"CATALOG_PAGE_DEEPLINK",CAT_SPINNER_HIDE:"CAT_SPINNER_HIDE",CAT_SPINNER_SHOW:"CAT_SPINNER_SHOW",CAT_SPINNER_TIME_OUT:"CAT_SPINNER_TIME_OUT",CAT_SPINNER_ERROR:"CAT_SPINNER_ERROR",TIP_SUCCESS:"TIP_SUCCESS",CAT_DEALERS_DETAIL_SUCCESS:"CAT_DEALERS_DETAIL_SUCCESS",DEALER_RATES_SUCCESS:"DEALER_RATES_SUCCESS",DEALER_CURRENCY_SEARCH:"DEALER_CURRENCY_SEARCH",DEALER_RATES_NO_RATES:"DDEALER_RATES_NO_RATES",DEALERS_BY_PRODUCT_SUCCESS:"DEALERS_BY_PRODUCT_SUCCESS",DEALERS_NEW_SEARCH:"DEALERS_NEW_SEARCH",DEALERS_NOT_AVAILABLE_RENTAL:"DEALERS_NOT_AVAILABLE",DEALERS_AVAILABLE_RENTAL:"DEALERS_AVAILABLE_RENTAL",DEALERS_SEARCHING:"DEALERS_SEARCHING",GOOGLE_GEO_ERROR:"GOOGLE_GEO_ERROR",HIDE_DEALER_LIST:"HIDE_DEALER_LIST",SHOW_DEALER_LIST:"SHOW_DEALER_LIST"};var CAT_LANG="en";var CAT_SERVICES_URL={DEALER_IDS:"http://dealerlocator.cat.com/dealerlocator/jsonService/V1/latlonp/{lat}/{lng}/1",CQ_DEALER_IDS:"#get_from_kapil",CART:"http://localhost:4502/services/updatequotecart",COMPETITORS:window.location.pathname.split(".")[0]+".speccheck",COMPETITORS_DATA:window.location.pathname.split(".")[0]+".speccheck",CATALOG_DATA:"/_jcr_content.feed.json",DEALERS_RATES:"/services/dealerRates?data=",DEALERS_BY_PRODUCT:"/services/dealersByProduct?data="};var CAT_SERVICES_NAME={DEALER_IDS:"DEALER_IDS",CQ_DEALER_IDS:"CQ_DEALER_IDS",CART:"CART",COMPETITORS:"COMPETITORS",COMPETITORS_DATA:"COMPETITORS_DATA",CATALOG_DATA:"CATALOG_DATA",TIP_DATA:"TIP_DATA",DEALERS_DETAIL:"DEALERS_DETAIL",DEALERS_RATES:"DEALERS_RATES",DEALERS_BY_PRODUCT:"DEALERS_BY_PRODUCT"};amplify.request.define(CAT_SERVICES_NAME.CART,"ajax",{url:CAT_SERVICES_URL.CART,dataType:"json",type:"POST"});amplify.request.define(CAT_SERVICES_NAME.DEALER_IDS,"ajax",{url:CAT_SERVICES_URL.DEALER_IDS,dataType:"script",type:"GET"});amplify.request.define(CAT_SERVICES_NAME.CQ_DEALER_IDS,"ajax",{url:CAT_SERVICES_URL.CQ_DEALER_IDS,dataType:"jsonp",type:"GET",contentType:"application/javascript"});amplify.request.define(CAT_SERVICES_NAME.COMPETITORS,"ajax",{url:CAT_SERVICES_URL.COMPETITORS,dataType:"json",type:"GET",contentType:"application/javascript"});amplify.request.define(CAT_SERVICES_NAME.COMPETITORS_DATA,"ajax",{url:CAT_SERVICES_URL.COMPETITORS_DATA,dataType:"json",type:"GET",contentType:"application/javascript"});$.ajaxSetup({timeout:window._cat_ajax_timeout});$(document).ajaxSend(function(a,c,b){window._cat_ajax_timedout=false});$(document).ajaxError(function(a,c,b,d){if(d==="timeout"){window._cat_ajax_timedout=true}});amplify.subscribe(CAT_EVENTS.SERVICE_ERROR,function(a){if(a==="timeout"){window._cat_ajax_timedout=true}});jQuery.extend({getQueryParameters:function(){var b=(document.location.search).replace(/(^\?)/,"").split("&"),a=b.length,e={};for(var d=0;d<a;d++){var g=b[d].split("=");var c=decodeURIComponent(g[0]);var f=decodeURIComponent(g[1]);e[c]=f}return e}});var CatNS=CatNS||{};CatNS.common={};head.ready(function(){CatNS.common.addLinkEvents=function(){console.log("addLinkEvents");if($(".back-link").length){if(document.referrer===""&&history.length<=1){$(".back-link").hide()}else{$(".back-link").on("click",function(a){a.preventDefault();history.go(-1);return false})}}$(".print").on("click",function(a){a.preventDefault();window.print()})};CatNS.common.catSpinner={html:'<div id="cat-spinner" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-body"><div class="spinning"><span class="spinner"></span></div></div></div>',$el:null,$focusEl:null,addSpinner:function(){if(CatNS.common.catSpinner.$el===null){if($("#cat-spinner").length<1){CatNS.common.catSpinner.$el=$(CatNS.common.catSpinner.html).appendTo(document.body);console.log("append Spinner to body")}else{CatNS.common.catSpinner.$el=$("#cat-spinner");console.log("got existing spinner")}CatNS.common.catSpinner.$el.on("hidden",function(){if(CatNS.common.catSpinner.$focusEl){console.log("focus on elment:");CatNS.common.catSpinner.$focusEl.focus()}})}},show:function(){CatNS.common.catSpinner.addSpinner();CatNS.common.catSpinner.$el.modal("show")},hide:function(a){CatNS.common.catSpinner.addSpinner();if(typeof a!=="undefined"){CatNS.common.catSpinner.$focusEl=$(a)}CatNS.common.catSpinner.$el.modal("hide")},error:function(a){CatNS.common.catSpinner.hide();$(a).show().focus()},init:function(){amplify.subscribe(CAT_EVENTS.CAT_SPINNER_SHOW,CatNS.common.catSpinner.show);amplify.subscribe(CAT_EVENTS.CAT_SPINNER_HIDE,CatNS.common.catSpinner.hide);amplify.subscribe(CAT_EVENTS.CAT_SPINNER_TIME_OUT,CatNS.common.catSpinner.timedOut);amplify.subscribe(CAT_EVENTS.CAT_SPINNER_ERROR,CatNS.common.catSpinner.error)}};CatNS.common.init=function(){CatNS.common.addLinkEvents();CatNS.common.catSpinner.init()};CatNS.common.init()});var CatNS=CatNS||{};CatNS.compare={};head.ready(function(){CatNS.compare.pagePath=location.pathname;CatNS.compare.dropdown=function(){var g=".model-tab-content .dropdown",e=g+" li a",c=" a h5",f=["model-brand","model-id"],d=[".model-brand",".dropdown-display"];function b(){var m={},j="productId",l="",k="",h=0;if(__cq_var.compareCompetitor&&__cq_var.compareCompetitor.info){j="modelId"}if(location.search){m=$.getQueryParameters()}else{m[j]=""}console.log("page params=",m);$(g+c).each(function(n){k+=((n>0)?",":"")+$(this).attr("data-model-id")});console.log("ids=",k);$.each(m,function(n,o){if(n.toLowerCase()===j.toLowerCase()){o=k}l+=((h===0)?"?":"&")+n+"="+o;h+=1});return location.pathname+l}function a(j){var h=j.find(".dropdown-menu li a");if(h.length<1){return}h.on("click",function(k){var o=$(this),q=j.find("h5"),n=f.length;if(o.parents("li").hasClass("disabled")||o.parents("li").hasClass("active")){k.preventDefault();return false}for(var m=0;m<n;m++){var p=o.data(f[m]);if(typeof p!=="undefined"){if(f[m]==="model-id"){q.find(".dropdown-display").html(o.text());q.attr("data-"+f[m],p)}else{q.find("."+f[m]).html(p)}}}var l=b();o.attr("href",l);return true})}console.log(">>adding compare dropdown");$(g).each(function(h){console.log("adding dropdown #",h);a($(this))})};CatNS.compare.modelTabs=function(){console.log("modelTabs");var b=$(".compare-model-tabs");if(b.length<1){return}var a=b.find(".model-tab");a.on("click",".tab-toggle",function(d){console.log(d);d.preventDefault();var c=b.find(".model-tab-content");var e=$(d.delegateTarget);if(e.hasClass("selected")){window.location=e.find(".tab-link").attr("href")}a.removeClass("selected");e.addClass("selected");c.removeClass("selected");c.filter("#"+$(this).data("target")).addClass("selected")})};CatNS.compare.affix=function(){var d=$("#compare-table-header"),a=$("#table-header-ghost"),b=d.outerHeight(true);d.affix({offset:{top:function(){return(this.top=Math.round(d.offset().top))},bottom:function(){var e=d.offset().top,g=$(document).height()-(e+d.outerHeight()),f=$(document).height()-($("footer").offset().top)+(d.outerHeight()-d.height());return(this.bottom=Math.round(f))}}});function c(){a.removeClass("show")}d.on("affix.bs.affix",function(){console.log("----- affix ---");$(this).width()});d.on("affixed.bs.affix",function(){console.log("----- affix ---");a.addClass("show");a.height(d.height());$(this).width()});d.on("affixed-top.bs.affix",function(){console.log("affix > top");c()});d.on("affix-bottom.bs.affix",function(){console.log("affix > btm");$(this).width()})};CatNS.compare.init=function(){if($(".compare").length<1){return}CatNS.compare.pagePath=$(".cq-page-path").data("path");CatNS.compare.dropdown();CatNS.compare.modelTabs();CatNS.compare.affix()};CatNS.compare.init()});var CatNS=CatNS||{};CatNS.datepicker={init:function(){}};head.ready(function(){CatNS.datepicker.init()});var CatNS=CatNS||{};var CATFacetedFilterModel=Backbone.Model.extend({defaults:{idFilter:"0",name:[],url:"url",type:"facet/family",count:0,groupName:"name",}});var CATFacetedFilterCollection=Backbone.Collection.extend({model:CATFacetedFilterModel});var CATFacetedFilterListView=Backbone.View.extend({model:CATFacetedFilterCollection,initialize:function(){var b=$(".filter-boxes");var a=$(".filter-radios");var c=this.model;c.reset();_.each(b,function(e){var d=$(e).find(".filter");_.each(d,function(f){var g=new CATFacetedFilterModel({idFilter:$(f).attr("data-id"),name:[$($(f).find("label")[1]).text(),$($(f).find("label")[0]).text()],url:$(f).attr("data-url"),type:$(f).attr("data-type"),groupName:$(f).parent().attr("role")});c.add(g);var h=new CATFacetedFilterView({model:c.get(g),el:$(f)})})})}});var CATFacetedFilterView=Backbone.View.extend({model:CATFacetedFilterModel,events:{"click label":"onFilterClick","change input":"onFilterClick"},initialize:function(){var a=this;this.model.set("groupName",this.$el.parent().attr("role"));this.onFilterReset();amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_RESET,this,a.onFilterReset);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,this,a.onDeeplink);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_UPDATE,function(e,d,f,b){if(a.model.get("type")==="facet"||a.model.get("type")==="family"){if(window._cat_primary_facet===a.model.get("groupName")){var c=_.values(amplify.store(CAT_STORE.CAT_CATALOG_FACETS));if(_.values(_.groupBy(c,"groupName")).length>1){a.validateFacetQuantity(e,a.model.get("type"),f)}else{a.addFamilyTypeSimpleCount(d)}}else{a.validateFacetQuantity(e,a.model.get("type"),f)}}})},onDeeplink:function(b){var a=this;console.log("=====>",b,this.model);if(b===this.model.get("idFilter")){this.$el.addClass("selected");this.$el.find("input").prop("checked",true);setTimeout(function(){a.$el.parent().parent().parent().addClass("show").siblings(".facet-filter").addClass("open");if(_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))){window._cat_primary_facet=(this.model)?this.model.get("groupName"):"facet-type"}else{window._cat_primary_facet=_.values(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))[0].groupName}amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:a.model.get("idFilter"),value:true,type:a.model.get("type"),groupName:a.model.get("groupName"),primary:(window._cat_primary_facet===a.model.get("groupName"))})},100)}},onFilterReset:function(a){this.$el.find("input").prop("checked","");this.$el.slideDown(200);this.$el.removeClass("hidden");this.$el.removeClass("selected")},onFilterClick:function(b){b.preventDefault();this.$el.toggleClass("selected");var d=this.$el.hasClass("selected");var c=this.$el.find("input").attr("id");if($(b.currentTarget)[0].localName==="label"){this.$el.find("input").prop("checked",d)}if($("html").hasClass("lt-ie9")){var a=this.$el.find("input");if(d===true){a.attr("checked","checked")}else{a.removeAttr("checked")}}if(_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))){window._cat_primary_facet=this.model.get("groupName")}amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:this.model.get("idFilter"),value:d,type:this.model.get("type"),groupName:this.model.get("groupName"),primary:(window._cat_primary_facet===this.model.get("groupName"))})},updateLabel:function(b){var c=this.model.get("name")[0];var a=this.model.get("name")[1];var d=this.model.get("count");if(window._cat_locale!=="ar_SA"){$(this.$el.find("label")[0]).html(a+" ("+d+")");$(this.$el.find("label")[1]).html(c+" ("+d+")")}else{$(this.$el.find("label")[0]).html("("+d+") "+a);$(this.$el.find("label")[1]).html("("+d+") "+c)}},addFamilyTypeSimpleCount:function(e){var b=(window._cat_prodtype==="rental")?true:false;var c=0;var a=this;var d=this.$el.hasClass("selected");e.each(function(f){_.each(f.attributes.filters,function(g){if(g===a.model.get("idFilter")){c++}})});this.model.set("count",c);this.updateLabel();if(!b){this.$el.slideDown(200);this.$el.removeClass("hidden")}else{if(c!==0){this.$el.slideDown(200);this.$el.removeClass("hidden")}else{if(!d){this.$el.slideUp(200);this.$el.addClass("hidden")}}}},validateFacetQuantity:function(d,g,h){var e=0;var a=this.model.get("idFilter");var j=this;var c=this.$el.hasClass("selected");d.each(function(k){_.each(k.attributes.filters,function(l){if(a===l){e++}},this)});if(e===0&&!c){this.$el.slideUp(200);this.$el.addClass("hidden")}if(e>0){this.$el.slideDown(200);this.$el.removeClass("hidden")}var b=this.$el.parent().parent().parent().parent();var f=this.$el.parent();if(f.find(".hidden").length===f.children().length){b.hide()}else{b.show()}this.model.set("count",e);this.updateLabel()}});var CATFacetedFilterRadioView=Backbone.View.extend({model:CATFacetedFilterModel,events:{click:"onFilterClick"},onFilterClick:function(a){a.preventDefault()}});var CATFacetedClear=Backbone.View.extend({events:{click:"onClear"},onClear:function(a){a.preventDefault();amplify.publish(CAT_EVENTS.CATALOG_FILTER_RESET)}});head.ready(function(){$(function(){if($("#product-family-page").length){CatNS.CATEnhanceModel.initialize();var b=new CATFacetedClear({el:$("#family-clear-all")});var a=new CATFacetedFilterCollection();var c=new CATFacetedFilterListView({model:a})}if($("#rental-nav-selector").length){if(window._cat_prodtype==="rental"){$("#toggle-narrow-rental").prop("checked",true)}else{$("#toggle-narrow-new").prop("checked",true)}$("#rental-nav-selector").find("input").on("click",function(d){console.log("E,",d);window.location=$(d.target).data("fwd")});window.onunload=function(){}}})});head.ready(function(){if($("#request-a-rentalquote-page").length>0){$("select#jobsite-country").on("change",function(){$state=$("#jobsite-stateprov");if($("jobsite-stateprov").length===0){$("#jobsite-stateprov").remove()}manageStateProvince(this.value,"jobsite-stateprov");validateStateBox($("#jobsite-stateprov"));$(".stateprov-box .error-text").hide()});$("#jobsite-stateprov[data-validate]").on("change blur",function(){validateStateBox($(this))})}});var CatNS=CatNS||{};head.ready(function(){var b=Backbone.View.extend({initialize:function(){var f=this;amplify.subscribe("cat_delete_item",function(g){f.checkCartGroups(g)});var e=this.$el.find(".facet-cart-item,.facet-cart-new");_.each(e,function(j){var h=new a({itemtype:$(j).find("input[name='itemtype']").val(),pid:$(j).find("input[name='pid']").val(),path:$(j).find("input[name='path']").val()});var g=new d({model:h,el:j})})},checkCartGroups:function(e){var f=this.$el.find(".cart-rental");var g=this.$el.find(".cart-new");if(f.find(".facet-cart-item").length===0){f.remove()}if(g.find(".facet-cart-item").length===0){g.remove()}$("h2").text($("h2").text().split(":")[0]+": "+e.totalitems)}});var d=Backbone.View.extend({model:a,initialize:function(){console.log("NEW CartItem view",this);var f=this;amplify.subscribe(CAT_EVENTS.CART_DELETE_SUCCESS,function(g){f.removeSuccess(g)});amplify.subscribe(CAT_EVENTS.CART_UPDATE_SUCCESS,function(g){f.updateSuccess(g)});var e=new Date();this.$el.find(".input-append.date").datepicker({autoclose:true,format:"mm/dd/yyyy",startDate:e})},events:{"change input[type='checkbox']":"updateDelivered","change select":"updateQty","click .cart-remove":"removeItem","changeDate .input-append.date.from":"updateStartDate","changeDate .input-append.date.to":"updateEndDate",},removeItem:function(e){e.preventDefault();this.model.remove(this.removeSuccess)},removeSuccess:function(e){console.log("delete success",e);if(e.pid===this.model.get("pid")&&e.itemtype===this.model.get("itemtype")){this.remove();amplify.publish("cat_delete_item",e)}},updateQty:function(e){var f=e.target.value;console.log("qty",f);this.model.set("quantity",f);this.model.update(this.updateSucess)},updateDelivered:function(e){var f=e.target.checked;this.model.set("delivered",f);this.model.update(this.updateSucess)},updateEndDate:function(e){var f=this.$el.find(".to");console.log("set end date to",f.find("input").val());this.model.set("endDate",f.find("input").val());this.model.update(this.updateSucess)},updateStartDate:function(f){var e=this.$el.find(".from");console.log("set start date to",e.find("input").val());this.model.set("startDate",e.find("input").val());var g=new Date(e.datepicker("getDate"));g.setDate(g.getDate()+1);this.$el.find(".to").datepicker("setStartDate",g);this.model.update(this.updateSucess)},updateSuccess:function(e){if(e.pid===this.model.get("pid")){console.log("updateSucess")}}});var a=Backbone.Model.extend({defaults:{itemtype:"new/rental",pid:"0",path:"0",name:"0"},initialize:function(){},fetch:function(f){var e=f;amplify.request({resourceId:CAT_SERVICES_NAME.CART,data:{action:f.action,pid:f.pid,itemtype:f.itemtype,quantity:f.quantity,path:f.path,startDate:f.startDate,endDate:f.endDate,delivered:f.delivered},success:function(g){console.log("RESPONSE",g);if(g.result==="success"){switch(g.action){case"delete":amplify.publish(CAT_EVENTS.CART_DELETE_SUCCESS,g);break;case"update":amplify.publish(CAT_EVENTS.CART_UPDATE_SUCCESS,g);break}}else{amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}},error:function(g,h){amplify.publish(CAT_EVENTS.SERVICE_ERROR,g)}})},remove:function(e){console.log("removing item");this.fetch({action:"delete",pid:this.get("pid"),itemtype:this.get("itemtype"),callback:e})},update:function(e){console.log("updating item");this.fetch({action:"update",pid:this.get("pid"),itemtype:this.get("itemtype"),quantity:this.get("quantity"),startDate:this.get("startDate"),endDate:this.get("endDate"),delivered:this.get("delivered"),path:this.get("path"),callback:e})}});var c=new b({el:$(".cart-list")})});head.ready(function(){CatNS.tpl.loadTemplates(["cat-single-card","pagination","cat-sidekick"],function(){var b=false;var c=Backbone.Router.extend({routes:{":id":"deeplink"},initialize:function(){if(window.location.hash){if(window.location.hash.split("#")[1]){this.deeplinkFilter(window.location.hash.split("#")[1])}}},deeplinkFilter:function(o){amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,o)}});var f=Backbone.Model.extend({defaults:{idmodel:"1",model_name:"cat model name",image_url:"full path to image",small_image_url:"full path to image",family:"cat family: dozers,draglines etc",familyId:"id",itemtype:"new/rental",sort_order:"1",specs:[],compare_url:"",detail_url:"full path to detail",filters:[],dealers:[],keys:[]},initialize:function(){var o=this.get("familyId");var p=0;_.each(this.get("filters"),function(q){if(q===o){p++}});if(p===0){this.get("filters").push(o)}this.set("keys",CatNS.i18n.keys);if(p===0&&this.get("compare_url")!==""){this.set("compare_url",window._cat_effective_url+"/../"+this.get("compare_url"))}}});var g=Backbone.PageableCollection.extend({model:f,mode:"client"});var n=Backbone.Collection.extend({model:f,fetch:function(p){var q=(b)?"http://localhost:7070/cat/facets":window._cat_effective_url+CAT_SERVICES_URL.CATALOG_DATA;var o=this;amplify.request.define(CAT_SERVICES_NAME.CATALOG_DATA,"ajax",{url:q,dataType:(b)?"jsonp":"json",type:"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.CATALOG_DATA,success:function(r){o.reset(r.models);amplify.publish(CAT_EVENTS.CATALOG_SUCCESS,o,r.sidekicks,r.dealers)},error:function(r,s){amplify.publish(CAT_EVENTS.SERVICE_ERROR,r)}})}});var e=Backbone.View.extend({el:$(".catalog-container"),model:g,sidekickCollection:"",initialize:function(){},render:function(o){this.$el.empty();var p=this;var s=$("<div class='row-fluid'></div>").appendTo(this.$el);var q=this.model.getPage(this.model.state.currentPage).length-1;console.log("RENDER CATALOG",this.model);if($("#rental-no-dealers-box")){$("#rental-no-dealers-box").hide();$(".catalog-top-pag").show();$(".catalog-bottom-pag").show()}this.model.getPage(this.model.state.currentPage).each(function(u,t){var v=new d({model:u,index:t,last:(t===q)?true:false});if(t%3===0){if(t===3){if(o){if(this.model.length){var w=new h({model:o});$(w.el).appendTo(this.$el);$("#rental-no-dealers-box").hide();$(".catalog-top-pag").show();$(".catalog-bottom-pag").show()}else{$("#rental-no-dealers-box").show();$(".catalog-top-pag").hide();$(".catalog-bottom-pag").hide()}}}s=$("<div class='row-fluid equal-height'></div>").appendTo(this.$el)}s.append(v.el)},this);if(this.model.getPage(this.model.state.currentPage).length<=3){if(o){if(this.model.length){var r=new h({model:o});$(r.el).appendTo(this.$el);$("#rental-no-dealers-box").hide();$(".catalog-top-pag").show();$(".catalog-bottom-pag").show()}else{$("#rental-no-dealers-box").show();$(".catalog-top-pag").hide();$(".catalog-bottom-pag").hide()}}}if(!this.model.length){$("#rental-no-dealers-box").show();$(".catalog-top-pag").hide();$(".catalog-bottom-pag").hide()}}});var d=Backbone.View.extend({model:f,className:"span4 selector single-card product-selector",template:_.template(CatNS.tpl.get("cat-single-card")),isLast:false,initialize:function(p){var o=this;this.isLast=p.last;o.render(p.index);if(p.index%3===0){this.$el.addClass("first-card")}if(this.model.get("compare_url")===""){this.$el.find(".btn.compare").css("visibility","hidden")}},render:function(q){var p=200*q;var r=this.template(this.model.attributes);var o=this;this.$el.html(r).hide().delay(p).fadeIn(200,function(){if(o.isLast){amplify.publish(CAT_EVENTS.CATALOG_RENDER_DONE)}});return this}});var m=Backbone.View.extend({model:g,className:"pagination",template:_.template(CatNS.tpl.get("pagination")),gapSize:3,initialize:function(p){var o=this;o.render()},render:function(u){var q=[];var w={model:this.model,setup:{},lastPage:false,firstPage:false,keys:CatNS.i18n.keys};var p=Math.ceil(this.model.state.totalPages/this.gapSize);var t=1;var x=this;for(var r=1;r<=p;r++){var v={};var o=t+this.gapSize-1;if(o<=this.model.state.totalPages){v={start:t,end:t+this.gapSize-1}}else{v={start:this.model.state.totalPages-this.gapSize,end:this.model.state.totalPages}}if(this.model.state.currentPage>=v.start&&this.model.state.currentPage<=v.end){if(r===p){w.lastPage=true}if(r===1){w.firstPage=true}w.setup=v}q.push(v);t+=this.gapSize}var s=this.template(w);this.$el.html(s);if(this.model.state.totalPages<=1){setTimeout(function(){x.$el.fadeOut(100)},0)}else{setTimeout(function(){x.$el.fadeIn(100)},0)}amplify.store(CAT_STORE.CAT_FAMILY_PAGE,this.model.state.currentPage);return this},events:{"click .next":"nextPage","click .back":"previousPage","click .pag":"goToPage"},show:function(){var o=this;if(this.model.state.totalPages<=1){setTimeout(function(){o.$el.fadeOut(100)},0)}else{setTimeout(function(){o.$el.fadeIn(100)},0)}},hide:function(){this.$el.hide()},nextPage:function(o){o.preventDefault();if(this.model.state.currentPage!==this.model.state.totalPages){this.model.getNextPage();amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state)}},previousPage:function(o){o.preventDefault();if(this.model.state.currentPage!==1){this.model.getPreviousPage();amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state)}},goToPage:function(o){var p;if(_.isNumber(o)){p=o}else{o.preventDefault();p=Number($(o.target).text())}if(p!==this.model.state.currentPage){this.model.getPage(p);amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state)}}});var j=Backbone.Model.extend({defaults:{id:"0",title:"sidekick title",description:"description"}});var k=Backbone.Collection.extend({model:j});var h=Backbone.View.extend({model:j,className:"row-fluid catalog-sidekick",template:_.template(CatNS.tpl.get("cat-sidekick")),currentFamily:{},initialize:function(){var o=this;o.render()},render:function(){var o=this.template(this.model);this.$el.html(o);return this}});var a=Backbone.Collection.extend();var l={fullCollection:"",pagedCollection:"",filteredCollection:"",filteredDealerCollection:"",sidekickCollection:"",view:"",paginationTop:"",paginationBot:"",facetsCollection:"",facets:{},families:{},dealers:{},groups:{},currentGroup:"",currentCategory:"",familiesSelected:[],isRental:false,init:function(o,q){var p=this;this.currentCategory=q;this.facets={};this.dealers={};this.families={};this.facetsCollection=new a();this.groupCollection=new a();this.fullCollection=new n();this.filteredDealerCollection=new n();this.filteredCollection=new n();this.pagedCollection=new g([],{state:{pageSize:o}});this.fullCollection.fetch();amplify.subscribe(CAT_EVENTS.CATALOG_SUCCESS,p,p.onData);amplify.subscribe(CAT_EVENTS.CATALOG_PAGINATION,p,p.render);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER,p,p.onFilter);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_RESET,this,p.onFilterReset);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,this,p.onFilterDealerReset);amplify.subscribe(CAT_EVENTS.CATALOG_RENDER_DONE,this,p.onRenderDone);amplify.subscribe(CAT_EVENTS.DEALERS_NEW_SEARCH,this,p.onNewLocation);amplify.subscribe(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL,p,p.noRentalDealers);amplify.subscribe(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL,p,p.rentalDealersAvalaible);amplify.subscribe(CAT_EVENTS.DEALERS_SEARCHING,p,function(){if(this.paginationTop){this.paginationTop.hide();this.paginationBot.hide()}});this.isRental=(window._cat_prodtype==="rental")?true:false},noRentalDealers:function(){var o=this;var p=amplify.store(CAT_STORE.DEALERS_SEARCHED);amplify.publish(CAT_EVENTS.HIDE_DEALER_LIST);if(this.isRental&&!_.isEmpty(p)){$("#rental-no-dealers-box").fadeIn();$(".catalog-top-pag").fadeOut();$(".catalog-bottom-pag").fadeOut();this.filteredCollection.reset([]);this.render()}},rentalDealersAvalaible:function(){$("#rental-no-dealers-box").fadeOut();if($(".catalog-top-pag").length){$(".catalog-top-pag").fadeIn();$(".catalog-bottom-pag").fadeIn()}amplify.publish(CAT_EVENTS.SHOW_DEALER_LIST)},onRenderDone:function(){this.view.$el.find(".equal-height").each(function(){$(this).find(".height-item").matchHeight(true)})},onFilterDealerReset:function(){this.dealers={}},onFilterReset:function(){var o=amplify.store(CAT_STORE.DEALERS);var p=_.isEmpty(o);this.families={};this.facets={};if(!this.isRental){this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON())}else{if(p){this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON())}else{this.pagedCollection.fullCollection.reset(this.filteredDealerCollection.toJSON())}}this.render();this.notifyFacets();this.storeFacets()},onNewLocation:function(){this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON())},onData:function(u,s,r){var o=this;var p=false;var q="";this.sidekickCollection=new k(s);this.pagedCollection.fullCollection.reset(u.toJSON());amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);amplify.store(CAT_STORE.CAT_CATALOG_DEALERS,r);if(_.isEmpty(amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE))){amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE,window._cat_prodtype)}else{var t=amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE);if(t!==window._cat_prodtype){amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE,window._cat_prodtype);o.onFilterReset()}}if(!_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))){q=amplify.store(CAT_STORE.CAT_FAMILY_ID);if(q!==this.currentCategory){p=true}}if(_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))){this.storeFacets()}else{if(!_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))){q=amplify.store(CAT_STORE.CAT_FAMILY_ID);if(q!==this.currentCategory){this.facets={};this.storeFacets()}else{_.each(amplify.store(CAT_STORE.CAT_CATALOG_FACETS),function(v){amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,v.name)})}}else{this.storeFacets()}}if(!_.isEmpty(amplify.store(CAT_STORE.DEALERS))){amplify.publish(CAT_EVENTS.CATALOG_FILTER,null)}setTimeout(function(){var v;if(!p&&!_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))){q=amplify.store(CAT_STORE.CAT_FAMILY_ID);if(q===o.currentCategory){if(_.isNumber(amplify.store(CAT_STORE.CAT_FAMILY_PAGE))){v=amplify.store(CAT_STORE.CAT_FAMILY_PAGE);if(v>o.pagedCollection.state.totalPages){v=1}}else{v=1}}else{v=1}}else{v=1}o.view=new e({model:o.pagedCollection.getPage(v),sidekickCollection:o.sidekickCollection});o.paginationTop=new m({model:o.pagedCollection});o.paginationBot=new m({model:o.pagedCollection});$(".catalog-top-pag").html(o.paginationTop.el);$(".catalog-bottom-pag").html(o.paginationBot.el);var x=_.isEmpty(amplify.store(CAT_STORE.DEALERS))?[]:amplify.store(CAT_STORE.DEALERS);var w=amplify.store(CAT_STORE.DEALERS_SEARCHED);if(o.isRental&&w&&w.length>0&&x.length===0){console.log("NO ITEMS AT ALL ASSOCIATED TO THE DEALERS LIST");amplify.publish(CAT_EVENTS.HIDE_DEALER_LIST);o.pagedCollection.fullCollection.reset([]);o.noRentalDealers();o.notifyFacets()}else{amplify.publish(CAT_EVENTS.SHOW_DEALER_LIST);o.view.render(o.sidekickCollection.where({id:o.checkFamilyFilters().name})[0])}amplify.subscribe(CAT_EVENTS.CAT_SPINNER_SHOW,o,function(){if(o.paginationTop){o.paginationTop.hide();o.paginationBot.hide()}o.view.$el.hide()});amplify.subscribe(CAT_EVENTS.CAT_SPINNER_HIDE,o,function(){o.view.$el.fadeIn();if(o.paginationTop){o.paginationTop.show();o.paginationBot.show()}});amplify.publish(CAT_EVENTS.CATALOG_FILTER,null)},1000)},render:function(o){if(this.paginationTop){this.paginationBot.render();this.paginationTop.render()}if(this.view){this.view.render(this.sidekickCollection.where({id:this.checkFamilyFilters().name})[0])}},onFilter:function(q){var A=this;if(q){if(q.type=="dealer"){this.setDealer(q)}if(q.type=="facet"){this.setFilter(q)}if(q.type=="family"){this.setFilter(q)}this.currentGroup=q.groupName}var s=[];var x=[];var r=[];var B=[];A.facetsCollection.reset([]);var w=amplify.store(CAT_STORE.DEALERS);var y=amplify.store(CAT_STORE.DEALER_SELECTED);var u=null;var z=_.isEmpty(w);if(A.isRental){if(!_.isEmpty(w)){if(!_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED))){console.log("DEALER SELECTED LIST AVAILABLE",y);u=_.keys(_.indexBy(y,"encryptedDealerCode"))}else{console.log("NOT DEALER SELECTED LIST AVAILABLE",y);u=_.keys(_.indexBy(w,"encryptedDealerCode"))}_.each(this.fullCollection.models,function(C){_.each(C.get("dealers"),function(D){if(_.contains(u,D)&&!_.contains(B,C)){B.push(C)}})});this.filteredDealerCollection.reset(B);if(this.filteredDealerCollection.size()===0){console.log("NO ITEMS AT ALL ASSOCIATED TO THE DEALERS LIST");this.pagedCollection.fullCollection.reset([]);this.noRentalDealers();this.notifyFacets();return false}if(this.filteredCollection.size()===0){this.filteredCollection=this.fullCollection.clone()}var p=_.intersection(this.filteredDealerCollection.models,this.fullCollection.models);this.filteredCollection.reset(p)}else{var v=amplify.store(CAT_STORE.DEALERS_SEARCHED);if(v&&v.length>0){console.log("NO DEALERS AT ALL ASSOCIATED TO THE DEALERS LIST");this.pagedCollection.fullCollection.reset([]);this.noRentalDealers();this.notifyFacets();return false}else{this.filteredDealerCollection=this.fullCollection.clone()}}}else{this.filteredDealerCollection=this.fullCollection.clone()}_.each(this.facets,function(C){x.push(C.name);A.facetsCollection.add(C)});_.each(A.facetsCollection.groupBy("groupName"),function(C){s.push(C)});var o=s.length;A.groupCollection.reset(s);var t=null;if(!this.isRental){t=(this.filteredCollection.size()===0||!q.value||q.primary)?this.fullCollection.clone():this.filteredCollection.clone()}else{if(z){t=(this.filteredCollection.size()===0||!q.value||q.primary)?this.fullCollection.clone():this.filteredCollection.clone()}else{t=(this.filteredCollection.size()===0)?this.filteredDealerCollection.clone():this.filteredCollection.clone()}}if(x.length){this.filteredCollection.reset();t.each(function(E,C){var D=0;_.each(E.get("filters"),function(G,F){_.each(s,function(I){var H=I.length;while(H--){if(I[H].attributes.name===G){D++;break}}})});if(D>=o){A.filteredCollection.add(E)}})}else{this.filteredCollection=t.clone()}this.storeFacets();this.pagedCollection.fullCollection.reset(this.filteredCollection.toJSON());this.render();this.notifyFacets();if($(".catalog-sidekick").css("margin-top")=="20px"){$(".product-sidekick-wrapper a").removeClass("open");$("#toggle-sidekick").removeClass("show")}},checkFamilyFilters:function(){var o=[];if(_.isEmpty(this.facets)){return false}_.each(this.facets,function(p){if(p.type=="family"){o.push(p)}});_.each(this.facets,function(p){if(p.type=="facet"){o=[]}});return(o.length===1)?o[0]:false},storeFacets:function(){if(_.isEmpty(this.facets)){$("#family-clear-all").slideUp(200)}else{$("#family-clear-all").slideDown(200)}amplify.store(CAT_STORE.CAT_CATALOG_FACETS,this.facets);amplify.store(CAT_STORE.CAT_CATALOG_DEALERS_FACETS,this.dealers);amplify.store(CAT_STORE.CAT_FAMILY_ID,null);amplify.store(CAT_STORE.CAT_FAMILY_ID,this.currentCategory)},notifyFacets:function(){var o=amplify.store(CAT_STORE.DEALERS);var p=_.isEmpty(o);if(!this.isRental){amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.fullCollection,this.currentGroup,this.dealers)}else{if(p){amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.fullCollection,this.currentGroup,this.dealers)}else{amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.filteredDealerCollection,this.currentGroup,this.dealers)}}},setFilter:function(o){if(this.facets[o.name]){if(!o.value){this.facets[o.name]=null;delete this.facets[o.name]}}else{this.facets[o.name]=o}},setDealer:function(o){if(this.dealers[o.name]){if(!o.value){this.dealers[o.name]=null;delete this.dealers[o.name]}}else{this.dealers[o.name]=o}},setFamily:function(o){if(this.families[o.name]){if(!o.value){this.families[o.name]=null;delete this.families[o.name]}}else{this.families[o.name]=o}}};$(function(){if($("#product-family-page").length){CatNS.i18n.loadKeys(function(){amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);var r=$("#catalog-family-id").val();var p=Number($("#catalog-pagesize").val());var q=new c();l.init(p,r)})}if($(".contact-rental")){var o=$(".contact-rental").data("tel");if(o&&$("html").hasClass("mobile")){$(".contact-rental").on("click",function(p){window.location.href=$(this).data("tel")})}}})})});var CatNS=CatNS||{};CatNS.compareCompetitor={Views:{},collections:{},cols:0,colMapping:[],compCnt:0,loadError:false,competitorsInfo:{}};CatNS.lang="en";head.ready(function(){if(typeof __cq_var.compareCompetitor==="undefined"||typeof __cq_var.compareCompetitor.info==="undefined"){return}CatNS.tpl.loadTemplates(["cc-dropdown","cc-tab-content-template","cc-theader-template","cc-link-list-img-template","cc-table-data"],function(){CatNS.compareCompetitor.Views.dropdown=Backbone.View.extend({el:$(".dropdown .dropdown-menu"),template:_.template(CatNS.tpl.get("cc-dropdown")),initialize:function(){var a=this;a.render()},render:function(){$(".dropdown .dropdown-menu").append(this.template({competitors:this.collection}));if(CatNS&&CatNS.compare){CatNS.compare.dropdown()}return this}});CatNS.compareCompetitor.Views.tabContent=Backbone.View.extend({el:$(".model-tab-contents .row-fluid"),template:_.template(CatNS.tpl.get("cc-tab-content-template")),initialize:function(){var a=this;a.render()},render:function(){this.$el.append(this.template({competitors:this.model.get("Data"),compCnt:CatNS.compareCompetitor.compCnt,maxCols:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping}));if(CatNS.compareCompetitor.compCnt>0){var a=new CatNS.compareCompetitor.Views.dropdown({collection:CatNS.compareCompetitor.collections.dropdown})}return this}});CatNS.compareCompetitor.Views.tableHeader=Backbone.View.extend({el:$("#compare-table-header .no-hover"),template:_.template(CatNS.tpl.get("cc-theader-template")),initialize:function(){var a=this;a.render()},render:function(){this.$el.append(this.template({competitors:this.model.get("Data"),colCnt:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping}));return this}});CatNS.compareCompetitor.Views.linkList=Backbone.View.extend({el:$(".compare-model-listing .row-fluid"),template:_.template(CatNS.tpl.get("cc-link-list-img-template")),initialize:function(){var a=this;a.render()},render:function(){this.$el.append(this.template({competitors:this.model.get("Data"),compImg:CatNS.compareCompetitor.competitorsInfo.competiorImage,maxCols:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping}));amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE,".compare-model-tabs");$.fn.matchHeight._update();return this}});CatNS.compareCompetitor.Views.tableData=Backbone.View.extend({el:$(".compare-data-accordion .three-col tbody"),template:_.template(CatNS.tpl.get("cc-table-data")),initialize:function(){var a=this;a.render()},render:function(){var b=this;console.log("render: ",this.collection);var a=this.collection.length;for(var d=0;d<a;d++){var c=b.collection[d];b.$el.append(b.template({model:c,colCnt:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping}))}return this}});CatNS.compareCompetitor.init=function(){CatNS.compareCompetitor.cols=0;if(__cq_var.compareCompetitor&&__cq_var.compareCompetitor.info){if(__cq_var.lang&&__cq_var.lang!==""){CatNS.lang=__cq_var.lang}amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);CatNS.compareCompetitor.competitorsInfo=__cq_var.compareCompetitor.info;console.log("compareCompetitor init id:",CatNS.compareCompetitor.competitorsInfo.models[0]);var b=CatNS.compareCompetitor.competitorsInfo.models[0];if(b.indexOf(",")>-1){console.log("split the string");CatNS.compareCompetitor.competitorsInfo.models=b.split(",");$("#model-tab-content-0 h5").attr("data-model-id",CatNS.compareCompetitor.competitorsInfo.models[0])}console.log("new array:",CatNS.compareCompetitor.competitorsInfo.models);var a=new CATCompetitorCollection();a.fetch({id:CatNS.compareCompetitor.competitorsInfo.models[0],lid:CatNS.lang},CatNS.compareCompetitor.competitorsInfo.catSpecCheckId);amplify.subscribe(CAT_EVENTS.COMPETITORS_SUCCESS,CatNS.compareCompetitor.handleCompetitorCollection);amplify.subscribe(CAT_EVENTS.SERVICE_ERROR,CatNS.compareCompetitor.handleAjaxError)}};CatNS.compareCompetitor.handleAjaxError=function(a){console.log("3. ------ handleAjaxError: ",a);if(!CatNS.compareCompetitor.loadError){CatNS.compareCompetitor.loadError=true;var b=".spinner-error";if(a==="timeout"){b=".spinner-timeout"}amplify.publish(CAT_EVENTS.CAT_SPINNER_ERROR,b)}};CatNS.compareCompetitor.handleCompetitorCollection=function(d){console.log("handleCompetitorCollection collection.length=",d.length,d);if(window._cat_ajax_timedout){return}if(d.length<1){CatNS.compareCompetitor.handleAjaxError("server-error");return}if(CatNS.compareCompetitor.competitorsInfo.models.length===1){var c=d.getTop2Models();$.each(c,function(g,f){CatNS.compareCompetitor.competitorsInfo.models.push(f.get("Machine_ID"))})}else{console.log("more than 1 ids");var a=d.removeSelectedModels(CatNS.compareCompetitor.competitorsInfo.models.slice(1))}CatNS.compareCompetitor.compCnt=d.length;CatNS.compareCompetitor.collections.dropdown=d.getGroups();CatNS.compareCompetitor.cols=CatNS.compareCompetitor.competitorsInfo.models.length;if(CatNS.compareCompetitor.cols>3){CatNS.compareCompetitor.cols=3}var e=CatNS.compareCompetitor.competitorsInfo.models.join(",");console.log("dataId=",e);var b=new CATCompetitorDataCollection();b.fetch({ids:e,lid:CatNS.lang});amplify.subscribe(CAT_EVENTS.COMPETITORS_DATA_SUCCESS,CatNS.compareCompetitor.handleDataCollection)};CatNS.compareCompetitor.handleDataCollection=function(j){if(window._cat_ajax_timedout){return}CatNS.compareCompetitor.collections.compDataHeader=j.getHeader();CatNS.compareCompetitor.collections.compDataTable=j.getData();var l=CatNS.compareCompetitor.competitorsInfo.models.length;var p=CatNS.compareCompetitor.collections.compDataHeader.get("Data");var d=p.length;var h,g;for(h=0;h<l;h++){var a=CatNS.compareCompetitor.competitorsInfo.models[h];for(g=0;g<d;g++){if(a==p[g].Machine_ID){CatNS.compareCompetitor.colMapping.push(g);break}}}console.log("dataMapping:",CatNS.compareCompetitor.colMapping);var n=$(".compare-model-tabs .model-tab");var c=n.length;var o=CatNS.compareCompetitor.cols-1;for(h=0;h<CatNS.compareCompetitor.cols;h++){if(h<c){$(n.get(h)).removeClass("hidden")}}var m=new CatNS.compareCompetitor.Views.tabContent({model:CatNS.compareCompetitor.collections.compDataHeader});var f=new CatNS.compareCompetitor.Views.tableHeader({model:CatNS.compareCompetitor.collections.compDataHeader});var b=new CatNS.compareCompetitor.Views.tableData({collection:CatNS.compareCompetitor.collections.compDataTable});var e=new CatNS.compareCompetitor.Views.linkList({model:CatNS.compareCompetitor.collections.compDataHeader})};CatNS.compareCompetitor.init()})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["dealer-list","dealer-modal","dealer-modal-detail"],function(){CatNS.DealerListView=Backbone.View.extend({el:$(".dealer-list-container"),template:_.template(CatNS.tpl.get("dealer-list")),initialize:function(){var a=this;var c=this.model.toJSON();var b=[];_.each(c,function(d){b.push(d.encryptedDealerCode)});a.render();amplify.subscribe(CAT_EVENTS.HIDE_DEALER_LIST,function(){a.$el.find(".filter").hide()});amplify.subscribe(CAT_EVENTS.SHOW_DEALER_LIST,function(){a.$el.find(".filter").show()});amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_UPDATE,function(h,g,k,d){var j=[];h.each(function(l){j=_.union(j,l.get("dealers"))});var e=_.difference(b,j);var f=_.difference(b,e)});amplify.subscribe(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL,a,function(){a.showError(true)});amplify.subscribe(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL,a,function(){a.showError(false)})},render:function(){if(!$(".dealer-list-container").hasClass("hidden")){amplify.publish("empty-list")}this.$el.find("form fieldset ul.filters").html(this.template({dealers:this.model.toJSON()}));amplify.publish("toggle-list");amplify.publish("toggle-loader");if(this.model.length||amplify.store("DEALERS_SEARCHED")!==""){$(".facet-dealer-clear").show()}},showError:function(a){if(a){this.$el.find(".no-dealers-box").fadeIn();this.$el.find(".filter").hide()}else{this.$el.find(".no-dealers-box").hide();this.$el.find(".filter").show()}}});CatNS.DealerFormView=Backbone.View.extend({el:$(".facet-dealer"),events:{"submit #get-dealer-location":"submitForm","keyup .clearToggle":"showClear","click .facet-dealer-clear":"clearAction","click .filter input[type='radio']":"trackDealer","click .filter input[type='checkbox']":"toggleSelect","click .details":"openModal"},initialize:function(){var e=this;amplify.subscribe(CAT_EVENTS.GOOGLE_GEO_ERROR,function(){$("#zip-code").addClass("error");e.$el.find(".error-text").show()});amplify.subscribe("toggle-list",function(){e.toggleList()});amplify.subscribe("toggle-loader",function(){e.toggleLoader()});amplify.subscribe("empty-list",function(){e.emptyList()});var b=amplify.store(CAT_STORE.CAT_FAMILY_ID);var c=$("#catalog-family-id").val();if(b!==c){if(amplify.store(CAT_STORE.DEALERS_SEARCHED)){$("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED));this.submitForm()}}else{if(amplify.store(CAT_STORE.DEALERS_SEARCHED)){$(".facet-dealer-clear").css("display","inline");$("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED))}if(amplify.store(CAT_STORE.DEALERS)){amplify.publish("toggle-loader");CatNS.CATEnhanceModel.dealers.reset(amplify.store(CAT_STORE.DEALERS));var a=new CatNS.DealerListView({model:CatNS.CATEnhanceModel.dealers})}if(!_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED))){var d=amplify.store(CAT_STORE.DEALER_SELECTED);_.each(d,function(f){$("#dealer-"+f.intId).prop("checked",true);$("#li-"+f.intId).addClass("selected")})}}},emptyList:function(){this.toggleList();$(".facet-dealer").find(".dealer-list-container").find("ul.filters li:not(.all)").remove()},toggleLoader:function(){this.$el.find(".loading").toggleClass("hidden")},toggleList:function(){this.$el.find(".dealer-list-container").toggleClass("hidden")},toggleSelect:function(c){var e=c.target.id.split("-")[1];var a=$("#dealer-"+e);$("#li-"+e).toggleClass("selected");var b=$("#li-"+e).hasClass("selected");var d={value:true,dealer:_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:a.data("parent")})};if(b){d.value=true;amplify.publish(CAT_EVENTS.DEALER_SELECTED,d);amplify.publish(CAT_EVENTS.CATALOG_FILTER,{type:"dealer",name:a.data("parent"),value:true})}else{d.value=false;amplify.publish(CAT_EVENTS.DEALER_SELECTED,d);amplify.publish(CAT_EVENTS.CATALOG_FILTER,{type:"dealer",name:a.data("parent"),value:false})}},trackDealer:function(a){},submitForm:function(b){if(b){b.preventDefault()}amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);$("#zip-code").removeClass("error");this.$el.find(".error-text").hide();var a=this.$el.find("#zip-code").val();if(a!==""||a!==undefined){amplify.publish("toggle-loader");if(!this.$el.find(".dealer-list-container").hasClass("hidden")){this.emptyList()}amplify.store(CAT_STORE.DEALERS,null);amplify.store(CAT_STORE.DEALER_SELECTED,null);amplify.store(CAT_STORE.DEALERS_SEARCHED,null);amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null);amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET);setTimeout(function(){amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL);CatNS.CATEnhanceModel.getDealerLocation(a,true)},500)}else{alert("please enter search query")}},showClear:function(){$(".facet-dealer-clear").css("display","inline")},clearAction:function(){$("input.clearToggle").val("");$(this).css("display","none");$(".facet-dealer-clear").hide();if(!$("dealer-list-container").hasClass("hidden")){this.emptyList()}amplify.store(CAT_STORE.DEALERS,null);amplify.store(CAT_STORE.DEALER_SELECTED,null);amplify.store(CAT_STORE.DEALERS_SEARCHED,null);amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null);amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET);amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:false});amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL)},updateDealerList:function(){},openModal:function(a){a.preventDefault();var b=$(a.target).data("dealer-id");if(CatNS.DealerModal){CatNS.DealerModal=null;delete CatNS.DealerModal}CatNS.DealerModal=new CatNS.DealerModalDetail({id:b})}});CatNS.DealerModalCollection=Backbone.Collection.extend({fetch:function(d){console.log("DEALER MODAL Collection fetch",d);var b=false;var c=window.location.href.split("/");var j=c[0];var k=c[2];var a=j+"//"+k;var h="";if(d){b=(d.productPath)?true:d.useOriginalDealerList;h=(d.productPath)?d.productPath:window._cat_prodpath}else{h=window._cat_prodpath}var e='["'+h+'"]';var g=a+CAT_SERVICES_URL.DEALERS_BY_PRODUCT+e;var f=this;console.log("calling dealerview",g);amplify.request.define(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,"ajax",{url:g,dataType:"json",type:"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,success:function(p){console.log(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,p);var o=amplify.store(CAT_STORE.DEALERS);var m=amplify.store(CAT_STORE.DEALERS_RAW);var n=p.dealers;var l=[];_.each(n,function(r){var q=_.findWhere(o,{encryptedDealerCode:r});if(q){l.push(q)}});if(!b){f.reset(l)}else{f.reset(m);f.isRaw=true}amplify.publish(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,f)},error:function(l,m){amplify.publish(CAT_EVENTS.SERVICE_ERROR,l)}})}});CatNS.DealerModalView=Backbone.View.extend({collection:new CatNS.DealerModalCollection(),template:_.template(CatNS.tpl.get("dealer-modal")),initialize:function(b){var a=this;console.log("DEALER MODAL View PRAMS",b);amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,function(c){if(c&&c.length>0){c=c.sortBy(function(d){return d.get("distanceInMiles")});a.collection.reset(c)}a.render();amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);return false});amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);this.collection.fetch(b)},render:function(){var b=this;$("body").append(this.template({dealers:b.collection.toJSON()}));$.each($(".dealer-modal-locations"),function(){var d=$(this),c=0,e=d.text();e=e.replace(/(\r\n|\n|\r)/gm,"").replace(/\s{2,}/g," ");if($(".lt-480").length>0){c=44}else{if($(".lt-640").length>0){c=52}else{if($(".gt-768").length>0){c=55}else{c=60}}}if(e.length>=c){d.text(e.slice(0,c)+"...")}});$("#dealer-modal").modal("show");$("#dealer-modal").on("hidden.bs.modal",function(){b.remove();$("#dealer-modal").remove()});$(".modal-backdrop").on("click",function(){$("#dealer-modal").modal("hide")});$("#select-dealer-button").on("click",function(){b.changeDealer()});var a=$("#select-dealer-button");a.prop("disabled",true);a.addClass("disabled");$("body").on("click",".dealer>input[name*='dealer-modal-radio']",function(){a.prop("disabled",false);a.removeClass("disabled")})},changeDealer:function(){var c=$("input:radio[name ='dealer-modal-radio']:checked").data("code");if(window.console){console.log("DEALER SELECTED",c)}if(c){var a=_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:c});if(_.isEmpty(a)){a=_.findWhere(amplify.store(CAT_STORE.DEALERS_RAW),{encryptedDealerCode:c})}var b={dealer:a,value:true};console.log("IS RAW",this.collection.isRaw);if(!this.collection.isRaw){amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,b.dealer)}amplify.publish(CAT_EVENTS.DEALER_SELECTED,b,this.collection.isRaw)}$("#dealer-modal").modal("hide")}});CatNS.moveToPositionModalDealer=function(a){$("#allLocations").collapse("show");$('a[href="#allLocations"]').removeClass("collapsed");$("#"+a).collapse("show");setTimeout(function(){$("html,body").animate({scrollTop:document.getElementById(a).offsetTop-30},"slow");$('a[href="#'+a+'"]').removeClass("collapsed")},500)};CatNS.DealerModal=null;CatNS.DealerModalDetailCollection=Backbone.Collection.extend({fetch:function(d){var a=d;a=a.replace(/\//g,"%");var c=window._cat_effective_url+"/_jcr_content.dealer."+encodeURIComponent(a)+".json";var b=this;if(window.console){console.log("REDNER",_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:d}))}amplify.request.define(CAT_SERVICES_NAME.DEALERS_DETAIL,"ajax",{url:c,dataType:"json",type:"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_DETAIL,success:function(f){var e=_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:d});e.extraData=f;b.reset(e);amplify.publish(CAT_EVENTS.CAT_DEALERS_DETAIL_SUCCESS,b)},error:function(e,f){amplify.publish(CAT_EVENTS.SERVICE_ERROR,e)}})}});CatNS.DealerModalDetail=Backbone.View.extend({template:_.template(CatNS.tpl.get("dealer-modal-detail")),map:"",markers:[],initialize:function(b){var a=this;amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);amplify.subscribe(CAT_EVENTS.CAT_DEALERS_DETAIL_SUCCESS,a,a.onData);this.collection=new CatNS.DealerModalDetailCollection();this.collection.fetch(b.id)},onData:function(a){this.collection=a.clone();this.render();amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);return false},render:function(){var a=this;$("body").append(this.template({dealer:this.collection.models[0]}));$("#dealer-modal-detail").modal({show:true,backdrop:true});$(".modal-backdrop").on("click",function(){$("#dealer-modal-detail").modal("hide")});$("#dealer-modal-detail").on("hidden.bs.modal",function(){a.remove();$("#dealer-modal-detail").remove()});this.initMap();$("#dealer-modal-detail").find(".collapse").collapse();$("html,body").animate({scrollTop:0},"slow")},initMap:function(){var b=this;var e=this.collection.models[0];var d={zoom:7,center:new google.maps.LatLng(e.get("latitude"),e.get("longitude")),zoomControl:true,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};this.map=new google.maps.Map(document.getElementById("dealer_detail_map_canvas"),d);var a={id:e.get("intId"),name:e.get("name"),street:e.get("street"),postalCode:e.get("postalCode"),city:e.get("city"),state:e.get("state"),country:e.get("country"),main:true};var f=new google.maps.LatLng(e.get("latitude"),e.get("longitude"));var c=0;b.setMarker(f,a,c);_.each(e.get("locations"),function(g){a={id:g.intId,name:g.name,street:g.street,postalCode:g.postalCode,city:g.city,state:g.state,country:g.country,main:(g.encryptedDealerCode===g.parentDealerCode)?true:false};var h=new google.maps.LatLng(g.latitude,g.longitude);if(g.encryptedDealerCode!==g.parentDealerCode){c++;b.setMarker(h,a,c)}})},setMarker:function(d,j,g){var k=this;var h,f;if(j.main){h=window._cat_imgpath+"/dealerLocator/marker_shadow_dark.png";f=new MarkerWithLabel({map:k.map,position:d,visible:true,icon:h,labelContent:(g+1),title:j.name,labelAnchor:new google.maps.Point(15,27),labelClass:"labels",labelInBackground:false})}else{h=window._cat_imgpath+"/dealerLocator/marker_shadow_skinny.png";f=new MarkerWithLabel({map:k.map,position:d,visible:true,icon:h,title:j.name})}k.markers.push(f);var a=$("#result_"+(g+1)).position();var b="More Info";var e='<div id="infobox" class="map-info-window"><h5 class="map-info-window-heading">'+j.name+"</h5><p>"+j.street+" "+j.postalCode+"<br>"+j.city+" "+j.state+", "+j.country+'</p><a style="cursor:pointer;" onclick="CatNS.moveToPositionModalDealer(\'location'+j.id+"')\">"+b+'</a><div class="arrow-down"></div></div>';var c=new InfoBox({content:e,disableAutoPan:false,maxWidth:250,pixelOffset:new google.maps.Size(-122,-171),zIndex:null,boxStyle:{opacity:1,width:"245px"},closeBoxMargin:"13px 12px 2px 2px; z-index: 9999999;",closeBoxURL:window._cat_imgpath+"/dealerLocator/btn_close.png",infoBoxClearance:new google.maps.Size(1,1)});google.maps.event.addListener(f,"click",function(){c.open(k.map,this)})}});if($("#rental-dealer-facet").length){CatNS.i18n.loadKeys(function(){var a=new CatNS.DealerFormView();amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,function(c){var b=new CatNS.DealerListView({model:c});amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:false})})})}})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["pdp-dealer-pricing","pdp-dealer-detail","dealer-modal","dealer-modal-detail"],function(){CatNS.DealerVerifyCollection=Backbone.Collection.extend({fetch:function(d){console.log("DEALER VERIFY Collection fetch",d);var b=false;var c=window.location.href.split("/");var j=c[0];var k=c[2];var a=j+"//"+k;var h="";if(d){b=d.useOriginalDealerList;h=(d.productPath)?d.productPath:window._cat_prodpath}else{h=window._cat_prodpath}var e='["'+h+'"]';var g=a+CAT_SERVICES_URL.DEALERS_BY_PRODUCT+e;var f=this;console.log("calling",g);amplify.request.define(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,"ajax",{url:g,dataType:"json",type:"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,success:function(o){console.log(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,o);var n=amplify.store(CAT_STORE.DEALERS);var m=o.dealers;var l=[];_.each(m,function(q){var p=_.findWhere(n,{encryptedDealerCode:q});if(p){l.push(p)}});if(!b){f.reset(l)}else{f.reset(n)}amplify.publish(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,f)},error:function(l,m){amplify.publish(CAT_EVENTS.SERVICE_ERROR,l)}})}});CatNS.DealerPricingModel=Backbone.Model.extend({defaults:{currency:"USD",dailyRate:"USD00,00.00",weeklyRate:"USD00,00.00",monthlyRate:"USD00,00.00"},initialize:function(){},fetch:function(c){amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);var g=window._cat_prodpath;var d='{"product":"'+g+'","dealerCodes":["'+c.code+'"],"currency":"'+c.currency+'"}';var e=this;var b=window.location.href.split("/");var h=b[0];var j=b[2];var a=h+"//"+j;var f=a+CAT_SERVICES_URL.DEALERS_RATES+encodeURIComponent(d);amplify.request.define(CAT_SERVICES_NAME.DEALERS_RATES,"ajax",{url:f,dataType:"json",type:"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_RATES,success:function(k){if(_.values(k).length){if(k.status==="ok-nodata"){amplify.publish(CAT_EVENTS.DEALER_RATES_NO_RATES);amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);return}e.set(_.values(k)[0]);amplify.publish(CAT_EVENTS.DEALER_RATES_SUCCESS,e)}else{amplify.publish(CAT_EVENTS.DEALER_RATES_NO_RATES)}amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE)},error:function(k,l){amplify.publish(CAT_EVENTS.SERVICE_ERROR,k)}})}});CatNS.DealerPricingInfoModel=Backbone.Model.extend({defaults:{name:"Dealer Name",locations:[],encryptedDealerCode:"","default":true},initialize:function(){this.update()},update:function(){var c=amplify.store(CAT_STORE.DEALER_SELECTED);var b=amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED);var d=_.isEmpty(amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED));console.log("DEALERS DETAL SELECTED MODEL EXIST",b);if(d){if(_.isEmpty(c)){this.set("default",true)}else{console.log("DEALERS SELECTED MODEL",c);var a=_.sortBy(c,function(e){return e.distanceInMiles});b=a[0];this.set("default",false)}}else{this.set("default",false)}if(!this.get("default")){this.set("name",b.name);this.set("locations",b.locations);this.set("encryptedDealerCode",b.encryptedDealerCode)}}});CatNS.DealerPricingView=Backbone.View.extend({model:new CatNS.DealerPricingModel(),template:_.template(CatNS.tpl.get("pdp-dealer-pricing")),initialize:function(){var a=this;amplify.subscribe(CAT_EVENTS.DEALER_RATES_SUCCESS,a,a.rates);amplify.subscribe(CAT_EVENTS.DEALER_RATES_NO_RATES,a,a.noRates);a.render()},render:function(){this.$el.html(this.template({data:this.model.toJSON()}));this.$el.find("h5").hide();this.$el.find(".perday").hide();this.$el.find(".others").hide()},rates:function(){this.render();this.$el.removeClass("no-rates");this.$el.find("h5").show();this.$el.find(".perday").show();this.$el.find(".others").show()},noRates:function(){this.$el.addClass("no-rates");this.$el.find("h5").hide();this.$el.find(".perday").hide();this.$el.find(".others").hide()}});CatNS.DealerPricingDropView=Backbone.View.extend({initialize:function(){var a=this;if(_.isEmpty(amplify.store(CAT_STORE.CURRENCY))){amplify.store(CAT_STORE.CURRENCY,"USD");this.$el.find("select").val("USD")}else{this.$el.find("select").val(amplify.store(CAT_STORE.CURRENCY))}amplify.subscribe(CAT_EVENTS.DEALER_RATES_SUCCESS,a,a.rates);amplify.subscribe(CAT_EVENTS.DEALER_RATES_NO_RATES,a,a.noRates)},events:{"submit #dealer-currency":"onSubmit"},noRates:function(){this.$el.hide()},rates:function(){this.$el.show()},onSubmit:function(a){a.preventDefault();amplify.publish(CAT_EVENTS.DEALER_CURRENCY_SEARCH,this.$el.find("select").val());amplify.store(CAT_STORE.CURRENCY,this.$el.find("select").val())},manualSubmit:function(){var a=this;setTimeout(function(){a.$el.find("#dealer-currency").submit()},100)}});CatNS.DealerPricingInfoView=Backbone.View.extend({showLocations:true,productPath:"",model:new CatNS.DealerPricingInfoModel(),template:_.template(CatNS.tpl.get("pdp-dealer-detail")),initialize:function(c){var a=this;if(c){this.showLocations=(c.showLocations)?c.showLocations:true;this.productPath=(c.productPath)?c.productPath:false}var b=new CatNS.DealerVerifyCollection();amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,function(k){var e=[];var j=[];var g=amplify.store(CAT_STORE.DEALER_SELECTED);if(k&&k.length>0){k.each(function(l){e.push(l.get("encryptedDealerCode"))})}_.each(g,function(l){j.push(l.encryptedDealerCode)});console.log("valids",e);console.log("selecteds",j);console.log("inter",_.intersection(j,e));var d=_.intersection(j,e);if(d.length){var h=[];_.each(d,function(l){var m=_.findWhere(g,{encryptedDealerCode:l});if(m){h.push(m)}});console.log("filtered list",h);var f=_.sortBy(h,function(l){if(!l){return 0}return l.distanceInMiles});if(f[0]){amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,f[0]);a.model.set("name",f[0].name);a.model.set("locations",f[0].locations);a.model.set("encryptedDealerCode",f[0].encryptedDealerCode);console.log("NEW DEALER",f[0])}else{console.log("NO NEW DEALER; undefined")}}console.log("Model",a.model);a.render()});b.fetch()},events:{"click a.change-dealer":"clearAction","click .dealer-details":"openModal"},render:function(){this.$el.html(this.template({data:this.model.toJSON(),showLocations:this.showLocations}))},getCode:function(){return this.model.get("encryptedDealerCode")},changeDealer:function(){var a=new CatNS.DealerModalView({productPath:this.productPath})},clearAction:function(a){if(a){a.preventDefault()}$(".dealer-pricing-form, .dealer-rental-form").show();$("input.clearToggle").val("");$(".dealer-pricing-detail, .dealer-rental-detail").hide();$(".dealer-pricing-drop").hide();$(".dealer-pricing-info").hide();amplify.store(CAT_STORE.DEALERS,null);amplify.store(CAT_STORE.DEALER_SELECTED,null);amplify.store(CAT_STORE.DEALERS_SEARCHED,null);amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null);amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET);amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:false});amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL)},update:function(){this.model.update();this.render()},openModal:function(a){a.preventDefault();if($("#request-a-rentalquote-page").length<1){var b=$(a.currentTarget).data("dealer-id");if(CatNS.DealerModal){CatNS.DealerModal=null;delete CatNS.DealerModal}CatNS.DealerModal=new CatNS.DealerModalDetail({id:b})}}});CatNS.DealerPricingForm=Backbone.View.extend({skip:false,productPath:"",initialize:function(b){var a=this;this.$el.find(".error-text").hide();this.skip=b.skipDealerFilter;this.productPath=b.productPath;amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,a,a.onDealersData);if(amplify.store(CAT_STORE.DEALERS_SEARCHED)){$("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED))}amplify.subscribe(CAT_EVENTS.GOOGLE_GEO_ERROR,function(){$("#zip-code").addClass("error");a.$el.find(".error-text").show()})},events:{"submit #detail-get-dealer-location":"submitForm"},submitForm:function(b){b.preventDefault();amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);$("#zip-code").removeClass("error");this.$el.find(".error-text").hide();var a=this.$el.find("#zip-code").val();if(a!==""||a!==undefined){CatNS.CATEnhanceModel.getDealerLocation(a,true)}else{console.log("please enter search query");this.$el.find(".error-text").show()}},onDealersData:function(b){console.log("Dealer Pricing form onDealersData",b);var a=new CatNS.DealerModalView({useOriginalDealerList:this.skip,productPath:this.productPath})}});CatNS.DealerPricingControlView=Backbone.View.extend({search:{},rates:{},dropdown:{},dealerInfo:{},initialize:function(){var a=this;amplify.subscribe(CAT_EVENTS.DEALER_CURRENCY_SEARCH,a,a.onCurrencyChange);amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,a,a.onDealerUpdated);this.search=new CatNS.DealerPricingForm({el:$(".dealer-pricing-form")});this.rates=new CatNS.DealerPricingView({el:$(".dealer-pricing-detail")});this.dropdown=new CatNS.DealerPricingDropView({el:$(".dealer-pricing-drop")});this.dealerInfo=new CatNS.DealerPricingInfoView({el:$(".dealer-pricing-info")});this.checkSteps()},checkSteps:function(){if(!this.dealerInfo.model.get("default")){this.search.$el.hide();this.rates.$el.fadeIn();this.dropdown.$el.fadeIn();this.dealerInfo.$el.fadeIn();this.dropdown.manualSubmit()}else{this.search.$el.fadeIn();this.rates.$el.hide();this.dropdown.$el.hide();this.dealerInfo.$el.hide()}},onCurrencyChange:function(b){var a=this;var c={currency:b,code:a.dealerInfo.getCode()};this.rates.model.fetch(c)},onDealerUpdated:function(a){this.dealerInfo.update();this.dropdown.manualSubmit();this.checkSteps()}});CatNS.DealerRentalFormControlView=Backbone.View.extend({search:{},dealerInfo:{},checkCollection:new CatNS.DealerVerifyCollection(),initialize:function(){var b=this;amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,b,b.onDealerUpdated);amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,b,b.onVerifyDealer);amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,b,function(){$("#form-dealer-id").val("");$("#form-dealer-name").val("")});location.queryString={};if($(".lt-ie9").length<1){location.search.substr(1).split("&").forEach(function(e){if(e===""){return}var d=e.split("=");location.queryString[d[0]]=d[1]&&decodeURIComponent(d[1].replace(/\+/g," "))})}else{$.each(location.search.substr(1).split("&"),function(d,f){if(f===""){return}var e=f.split("=");location.queryString[e[0]]=e[1]&&decodeURIComponent(e[1].replace(/\+/g," "))})}console.log("LOCATION",location.queryString);var a=(location.queryString.productpathNew)?location.queryString.productpathNew:false;var c=(a)?false:true;this.search=new CatNS.DealerPricingForm({el:$(".dealer-rental-form"),skipDealerFilter:c,productPath:a});this.dealerInfo=new CatNS.DealerPricingInfoView({el:$(".dealer-rental-detail"),showLocations:false,productPath:a});this.checkSteps()},checkSteps:function(){if(!this.dealerInfo.model.get("default")){if(location.queryString.productpathNew){this.checkCollection.fetch({useOriginalDealerList:false,productPath:location.queryString.productpathNew})}console.log("setting pre dealer id  to",this.dealerInfo.model.get("encryptedDealerCode"));$("#form-dealer-id").val(this.dealerInfo.model.get("encryptedDealerCode"));$("#form-dealer-name").val(this.dealerInfo.model.get("name"));this.search.$el.fadeOut();this.dealerInfo.$el.fadeIn()}else{this.search.$el.fadeIn();this.dealerInfo.$el.fadeOut()}},onVerifyDealer:function(a){},onDealerUpdated:function(a){this.dealerInfo.model.set("name",a.dealer.name);this.dealerInfo.model.set("locations",a.dealer.locations);this.dealerInfo.model.set("encryptedDealerCode",a.dealer.encryptedDealerCode);this.dealerInfo.render();$("#form-dealer-id").val(a.dealer.encryptedDealerCode);$("#form-dealer-name").val(a.dealer.name);$("#dealer-error").fadeOut();this.search.$el.fadeOut();this.dealerInfo.$el.fadeIn()}});if($(".dealer-pricing-container").length){CatNS.i18n.loadKeys(function(){CatNS.CATEnhanceModel.initialize();var a=new CatNS.DealerPricingControlView({el:$(".dealer-pricing-container")})})}if($(".dealer-rental-container").length){CatNS.i18n.loadKeys(function(){CatNS.CATEnhanceModel.initialize();var a=new CatNS.DealerRentalFormControlView({el:$(".dealer-rental-container")})})}})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["pm-acc-panel-template","pm-row-template"],function(){var j=false;var h=document.URL.replace(".html",".pmsvlet");var f=Backbone.Model.extend({defaults:{operation:"operation name",partNumber:"0",quantity:"0",partName:"part name"}});var b=Backbone.Collection.extend({url:(j)?"xml/NAS00312_3.xml":h,model:f,initialize:function(l){this.data=l},parse:function(m){var l=[];$(m).find("Interval").each(function(n){var o=$(this).find("JobOperation").text();$(this).find("PartInfo").each(function(q){var s=$(this).find("PartNumber").text();var t=$(this).find("Quantity").text();var p=$(this).find("Description").text();var r=new f({operation:o,partNumber:s,quantity:t,partName:p,code:q});l.push(r)})});return l},fetch:function(l){l=l||{};l.dataType="xml";if(!j){l.type="POST"}l.data=this.data;return Backbone.Collection.prototype.fetch.call(this,l)}});var e=Backbone.View.extend({model:b,template:_.template(CatNS.tpl.get("pm-row-template")),initialize:function(m){var l=this;this.model=new b(m.data);this.model.fetch({success:function(){l.render()},error:function(){$("#pm-serial-number-form").find(".alert-error").parent().removeClass("hidden")}})},render:function(){var m=this.template(this.model);this.$el.html(m);var l=this;setTimeout(function(){var o=l.$el.parent();var n=$("#"+o.attr("id")+" .flextable-control a");o.flextable({toggleSelector:n,selectorEnabled:true});o.focus();o.parent().hide().show()},100)}});var g=Backbone.Model.extend({defaults:{id:"0",title:"Interval description",code:"0"}});var a=Backbone.Collection.extend({url:(j)?"xml/NAS00312_2.xml":h,model:g,initialize:function(l){this.data=l},parse:function(m){var l=[];$(m).find("pmSegment").each(function(p){var o=$(this).find("description").text();var n=new g({id:p,title:o,code:$(this).attr("code")});l.push(n)});return l},fetch:function(l){l=l||{};l.dataType="xml";if(!j){l.type="POST"}l.data=this.data;return Backbone.Collection.prototype.fetch.call(this,l)}});var k=Backbone.View.extend({el:"#pm-accordion",model:a,initialize:function(m){var l=this;this.model=new a(m);this.model.fetch({success:function(){l.render()},error:function(){$("#pm-serial-number-form").find(".alert-error").parent().removeClass("hidden")}})},render:function(){this.$el.empty();this.model.each(function(m){var l=new d({model:m.attributes});this.$el.append(l.el)},this)}});var d=Backbone.View.extend({model:g,className:"panel panel-default",template:_.template(CatNS.tpl.get("pm-acc-panel-template")),events:{"show.bs.collapse":"onShow","hidden.bs.collapse":"onHide"},initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model))},onShow:function(m){var n={"pm-part-list-code":this.model.code};var l=new e({data:n,el:this.$el.find("tbody")})},onHide:function(m){var l=this.$el.find("table");l.find("tbody").empty();l.unbind();l.removeClass("flextable-loaded");l.data("flextable_info","")}});var c=Backbone.View.extend({el:"#pm-serial-number-form",initialize:function(m){var l=this;this.$el.on("submit",function(n){l.submit(n)})},submit:function(m){m.preventDefault();this.$el.find(".alert-error").parent().addClass("hidden");var r=this.$el.find("#pm-serial-number");var l=validateFormField(r);var q=this.$el.find("#pm-serial-number").val();var p=this.$el.find("#pm-measure").val();var o={"pm-serial-number":q,"pm-measurement":p};if(l){var n=new k(o)}}});$(function(){if($("#preventative-maintenance").length){var l=new c()}})});CatNS.tpl.loadTemplates(["tip-row-template"],function(){var b=false;var g=document.URL.replace(".html",".tipservlet");var d=Backbone.Model.extend({defaults:{ekw:"",performanceNumber:"0",voltage:"0",dutyType:"duty type",frequency:"0",rpm:"0",kva:"0",region:"0",emissions:"",bhp:"0",bkw:"0",documents:[]},initialize:function(){var h=[];_.each(this.get("documents"),function(j){var j=new c(j);h.push(j)});this.set("documents",h)},belongsToRegion:function(j){var h=_.indexOf(this.get("region").split(","),j);if(h>=0){return true}return false}});var c=Backbone.Model.extend({defaults:{name:"",type:"",size:"",url:""},initialize:function(){this.set("size",(Number(this.get("size"))/1024).toFixed(2))}});var f=Backbone.Collection.extend({model:d,fetch:function(j){var k=(b)?"xml/tips.json":g;var h=this;amplify.request.define(CAT_SERVICES_NAME.TIP_DATA,"ajax",{url:k,dataType:"json",type:(b)?"GET":"GET"});amplify.request({resourceId:CAT_SERVICES_NAME.TIP_DATA,data:j,success:function(m){var l=m[0];h.reset(_.rest(m,1));amplify.publish(CAT_EVENTS.TIP_SUCCESS,l)},error:function(l,m){console.log("TIP ERROR",l,m);amplify.publish(CAT_EVENTS.SERVICE_ERROR,l);$("#tip-maintenance").find(".alert-error").parent().removeClass("hidden")}})}});var a=Backbone.View.extend({el:$("#tip-maintenance-table"),model:f,initialize:function(j){var h=this;amplify.subscribe(CAT_EVENTS.TIP_SUCCESS,function(k){h.render(k)});this.model=new f();this.model.fetch(j)},render:function(q){var s=this;var l=s.$el.find(".tip-data-container");var m=s.$el.find("#tip-header");var p=s.$el.find("#tip-extra-header");var j=q.regions;var n=_.values(j);var r=_.keys(j);var k=_.values(q.header);var u=[];var o=_.keys(q.header);var h=(Number(q.format)===1);var t=r.length+1;_.each(k,function(w,v){if(v===0){m.append('<th data-group="groupHeader" data-ignore="true">'+w+"</th>")}if(v!==0){m.append('<th data-group="groupHeader" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">'+w+"</th>")}});if(h){u=_.values(q.subheader);_.each(u,function(w,v){if(v===0){p.append('<th data-group="groupHeader" colspan="'+o.length+'">'+w+"</th>")}if(v!==0){p.append('<th data-group="groupRegion" colspan="'+t+'" class="flextable-last-column">'+w+"</th>")}});_.each(n,function(v){m.append('<th data-group="groupRegion" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">'+v+"</th>")})}m.append('<th data-group="groupRegion" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">DOCUMENTS</th>');m.append('<th class="flextable-control">&nbsp;</th>');_.each(this.model.models,function(w){var v=new e({model:w,keys:o,regions:r});l.append(v.$el)});setTimeout(function(){var x=s.$el;var w=$("#tip-maintenance-table .flextable-control a");var v=$("#tip-extra-header");if(Number(q.format)===1){v.removeClass("hidden")}x.flextable({toggleSelector:w,selectorEnabled:true});x.focus();x.parent().hide().show();amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE)},100)}});var e=Backbone.View.extend({template:_.template(CatNS.tpl.get("tip-row-template")),tagName:"tr",model:d,keys:[],initialize:function(h){this.keys=h.keys;this.model=h.model;this.regions=h.regions;this.render()},render:function(){var h={model:this.model,keys:this.keys,regions:this.regions};this.$el.html(this.template(h))}});$(function(){if($("#tip-maintenance").length){console.log("START TIP");var j={tipUrl:$("#tipUrl").val(),tipFormat:$("#tipFormat").val()};amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);var h=new a(j)}})})});